OBJECT Codeunit 50030 Autom. EMail Processes
{
  OBJECT-PROPERTIES
  {
    Date=05.06.15;
    Time=17:29:15;
    Modified=Yes;
    Version List=DN(1),gob1.10,SII,HME4267,T0098;
  }
  PROPERTIES
  {
    TableNo=50043;
    OnRun=VAR
            SentInvoices@1108200000 : Record 80020;
            PaymentProposalHeaderL@1000000000 : Record 5157896;
            BatchPostDocumentLineL@1000000001 : Record 50190;
          BEGIN
            IF "Action Type" = "Action Type"::"Purch. EMail" THEN BEGIN
              PurchHeader.GET(PurchHeader."Document Type" :: Order,"Document No.");

                CASE "Document Type" OF
                  "Document Type"::Order:
                    BEGIN
                      RealizeOrderEMail(PurchHeader,'');
                    END;
                  "Document Type"::"Splitted Order":
                    BEGIN
                      CreateSplittedPurchOrderMail(PurchHeader."No.");
                    END;
                  "Document Type"::"Container Order":
                    BEGIN
                      CreateContainerOrderMail(PurchHeader."No.");
                    END;
                END;

            END ELSE
              IF "Action Type" = "Action Type"::"Sales EMail" THEN
                CASE "Document Type" OF
                  "Document Type"::Invoice:
                    BEGIN
                      SalesInvHeader.GET("Posted Document No.");
                      IF NOT SentInvoices.GET(SalesInvHeader."External Document No.") THEN

                        CreateSalesInvMail(SalesInvHeader);
                    END;
                  "Document Type"::Order: BEGIN
                    IF "Return E-Mail Type" = "Return E-Mail Type"::ChangeOrderMail THEN BEGIN
                      SalesHeader.GET(SalesReturnHeader."Document Type"::Order,"Document No.");
                      CreateReturnChangeOrderMail(SalesHeader);
                    END;
                  END;
                  //H1783 19.11.14 MIK +++++++++++++++++++++++++++++
                  // Case ("Document Type"::"Return Order") removed.
                  // Return confirmation email is created in codeunit 50169-SII Fill Log - Create. Function CreateReturnOrderInstruction
                  // Return Label is created in codeunit 50169-SII Fill Log - Create. Function CreateReturnOrderLabel
                  //S/P1010
                  //T0044 28.08.14 tec-cs +++++++++++++++++++++++++++++
                  //T0044 28.08.14 tec-cs -----------------------------
                  //E/P1010
                  //H1783 19.11.14 MIK -----------------------------
                  "Document Type"::"Credit Memo":
                    BEGIN
                      SalesCrMemoHeader.GET("Posted Document No.");
                      CreateSalesCrMemoMail(SalesCrMemoHeader);
                    END;
                END;

            //H1475 12.09.14 ARI +++++++++++++++++++++++++++++++++++++
            IF "Action Type" = "Action Type"::"Send Payment Advise" THEN BEGIN
              BatchPostDocumentLineL.SETRANGE("Assigned to Entry No.","Entry No.");
              IF BatchPostDocumentLineL.FINDSET(FALSE,FALSE) THEN BEGIN
                REPEAT
                  IF PaymentProposalHeaderL.GET("Journal Template Name",BatchPostDocumentLineL."Document No.",
                                                BatchPostDocumentLineL."Document Line No.") THEN BEGIN
                    CreatePaymentAdviseMailHME(PaymentProposalHeaderL);
                  END;
                UNTIL BatchPostDocumentLineL.NEXT = 0;
              END;
            END;
            //H1475 12.09.14 ARI -------------------------------------
          END;

  }
  CODE
  {
    VAR
      CompanyInfo@1000000016 : Record 79;
      PurchSetup@1000000004 : Record 312;
      PurchHeader@1000000018 : Record 38;
      PurchLine@1000000001 : Record 39;
      SalesHeader@1000000003 : Record 36;
      SalesLine@1000000005 : Record 37;
      SalesInvHeader@1000000019 : Record 112;
      SalesReturnHeader@1000000020 : Record 36;
      TempSalesHeader@1000000002 : TEMPORARY Record 36;
      SalesCrMemoHeader@1108200000 : Record 114;
      Item@1000000007 : Record 27;
      Cust@1000000015 : Record 18;
      Vend@1000000013 : Record 23;
      Cont@1000000014 : Record 5050;
      UserSetup@1000000012 : Record 91;
      BatchPostDoc@1000000010 : Record 50043;
      DHLMgt@1000000000 : Codeunit 50020;
      GeneralMgt@1000000009 : Codeunit 11501;
      GeneralMgt2@1000000017 : Codeunit 50040;
      ExpFile@1000000008 : File;
      SendMailDirect@1000000011 : Boolean;
      i@1000000006 : Integer;
      RecipientName@1000000021 : Text[50];
      "** Home 24 GmbH **"@1100409000 : Integer;
      ExtTextLines@1100409002 : Record 280;
      MailTextLanguageCode@1100409001 : Code[10];
      LanguageCode@1100409003 : Code[10];
      TEXT0001HME@1100409004 : TextConst 'DEU=For Mailtext Code %1 is no content in Textline %2 for Language Code %3!;ENU=For Mailtext Code %1 is no content in Textline %2 for Language Code %3!';
      TEXT0002HME@1100409005 : TextConst 'DEU=Setup for Textline Entry %1 for Mailtextcode %2 and Language Code %3 is missing!;ENU=Setup for Textline Entry %1 for Mailtextcode %2 and Language Code %3 is missing!';
      Position@1100409006 : Integer;
      TxtStr@1100409007 : Text[150];
      TXtType@1100409008 : Text[10];
      SubjectTxtStr@1100409009 : Text[250];
      Add2Filename@1100409010 : Text[150];
      SalesHeaderArc@1100409011 : Record 5107;
      TEXT0003HME@1000000023 : TextConst 'ENU="<font face=""Arial"",""sans-serif""><table width=590 border=0></span><span style=''font-size:9.0pt; font-family:""Arial"",""sans-serif""; mso-fareast-font-family:""Times New Roman""; color:black''>"';
      TEXT0004HME@1000000027 : TextConst 'DEU=" (KOPIE)";ENU=_COPY';
      GOBText001@1000000022 : TextConst 'ENU=No Ext. Text Found for %1 Language: %2';
      AddEMailAddress@1000000024 : Record 50189;
      EMailStr@1000000025 : Text[1024];
      Text001@1000000026 : TextConst 'ENU=Vendor %1 has not a valid active e-mail!';
      ConditionalText@1000000028 : Text[30];
      "** HME ****************"@1000000039 : TextConst;
      HMEText001@1000000029 : TextConst 'DEU=enclosed you find an order on invoice by %1;ENU=enclosed you find an order on invoice by %1';
      HMEText002@1000000030 : TextConst 'DEU=To be delivered to:;ENU=To be delivered to:';
      HMEText003@1000000031 : TextConst 'DEU=Our order no.: %1';
      HMEText004@1000000032 : TextConst 'DEU=Please send an order confirmation within 24h including the planned delivery date and a confirmation of the amount of articles as a reply to this email.';
      HMEText005@1000000033 : TextConst 'DEU=Kind regards,';
      HMEText006@1000000034 : TextConst 'DEU=Your Home24 team';
      HMEText007@1000000035 : TextConst 'DEU=Phone: %1 | Fax: %2';
      HMEText008@1000000036 : TextConst 'DEU=UST-ID: DE266182271';
      HMEText009@1000000038 : TextConst 'DEU=Zahlungsavis;ENU=Payment Advise';
      HMEText011@1000000048 : TextConst 'DEU=Checkliste Avisierungsprozess*:;ENU=Check list advise process*:';
      HMEText012@1000000047 : TextConst 'DEU=Ihr Home24 Team';
      HMEText013@1000000046 : TextConst 'ENU=Unloading time: %1';
      HMEText014@1000000045 : TextConst 'ENU=Dear Madams or Sirs,';
      HMEText015@1000000044 : TextConst 'ENU=please deliver the enclosed order to the following address:';
      HMEText016@1000000043 : TextConst 'ENU=Checklist notifications*:';
      HMEText017@1000000042 : TextConst 'ENU=Best regards';
      HMEText018@1000000041 : TextConst 'ENU=Your Home24 team';
      HMEText019@1000000040 : TextConst 'ENU=For English version see below.';
      HMEText020@1000000037 : TextConst 'ENU=anbei erhalten Sie eine Bestellung aufgrund eines GewÑhrleistungsfalles';
      HMEText021@1000000049 : TextConst 'ENU=enclosed you find an order due to a warranty case';
      TextHME001@1000000050 : TextConst 'DEU=Avis;ENU=Avis';
      TextHME002@1000000051 : TextConst 'DEU=Zahlungsavis;ENU=Payment Advise';

    PROCEDURE RealizeOrderRequest@1000000000(_PurchOrderHeader@1000000000 : Record 38);
    VAR
      L_OldStatus@1000000001 : Integer;
    BEGIN
      CLEAR(TempSalesHeader);
      TempSalesHeader.DELETEALL;
      PurchLine.RESET;
      PurchLine.SETRANGE("Document Type",_PurchOrderHeader."Document Type");
      PurchLine.SETRANGE("Document No.",_PurchOrderHeader."No.");
      IF PurchLine.FINDSET THEN REPEAT
        IF PurchLine."Drop Shipment" AND (PurchLine."Sales Order No." <> '') THEN BEGIN
          SalesHeader.GET(SalesHeader."Document Type"::Order,PurchLine."Sales Order No.");
          SalesLine.GET(SalesLine."Document Type"::Order,PurchLine."Sales Order No.",PurchLine."Sales Order Line No.");

          IF (SalesLine.Type = SalesLine.Type::Item) AND Item.GET(SalesLine."No.") THEN BEGIN
            IF SalesHeader.Status <> SalesHeader.Status::Open THEN BEGIN
              L_OldStatus := SalesHeader.Status;
              SalesHeader.Status := SalesHeader.Status::Open;
              SalesHeader.MODIFY;
            END;
            SalesLine.VALIDATE("Shipment Date",WORKDATE);
            SalesLine.VALIDATE("Planned Shipment Date",CALCDATE(Item."Lead Time Calculation (max.)",WORKDATE));
            IF GeneralMgt2.CheckMP(PurchLine."No.",_PurchOrderHeader."Buy-from Vendor No.") <> 0 THEN BEGIN
              IF GeneralMgt2.CheckMP(PurchLine."No.",_PurchOrderHeader."Buy-from Vendor No.") = 1 THEN
                PurchLine.VALIDATE("Direct Unit Cost",SalesLine."Unit Price")  //wÑhrung und VAT prÅfen############
              ELSE
                PurchLine.VALIDATE("Direct Unit Cost",0);
              PurchLine.MODIFY;
            END;
            SalesLine.MODIFY;
            IF SalesHeader.Status <> L_OldStatus THEN BEGIN
              SalesHeader.Status := L_OldStatus;
              SalesHeader.MODIFY;
            END;
          END;
          TempSalesHeader := SalesHeader;
          IF TempSalesHeader.INSERT THEN;
        END;
      UNTIL PurchLine.NEXT = 0;

      IF TempSalesHeader.FIND('-') THEN REPEAT
        IF TempSalesHeader.Kommissionierung THEN BEGIN
          CLEAR(DHLMgt);
          DHLMgt.SetParameters;
          DHLMgt.RUN(TempSalesHeader);
        END;
      UNTIL TempSalesHeader.NEXT = 0;
    END;

    PROCEDURE RealizeOrderEMail@1000000001(_PurchOrderHeader@1000000002 : Record 38;ChangeChannelCaseV@1000000003 : Code[10]);
    VAR
      L_DropShip@1000000000 : Boolean;
      L_MP@1000000001 : Boolean;
      IsSpecialOrder@1108200000 : Boolean;
      AutomEMailProc2@1000000004 : Codeunit 50094;
    BEGIN
      CLEAR(TempSalesHeader);
      TempSalesHeader.DELETEALL;
      L_DropShip := FALSE;
      L_MP := FALSE;
      IsSpecialOrder := FALSE;
      PurchLine.RESET;
      PurchLine.SETRANGE("Document Type",_PurchOrderHeader."Document Type");
      PurchLine.SETRANGE("Document No.",_PurchOrderHeader."No.");

      IF PurchLine.FINDSET THEN REPEAT
        IF PurchLine."Drop Shipment" AND (PurchLine."Sales Order No." <> '') THEN BEGIN
          L_DropShip := TRUE;
          IF GeneralMgt2.CheckMP(PurchLine."No.",_PurchOrderHeader."Buy-from Vendor No.") = 2 THEN
            L_MP := TRUE;
          // H0332 >>
          IF SalesHeader.GET(SalesHeader."Document Type"::Order,PurchLine."Sales Order No.") THEN
            TempSalesHeader := SalesHeader
          ELSE BEGIN
            SalesHeaderArc.SETRANGE("No.", PurchLine."Sales Order No.");
            IF SalesHeaderArc.FIND('-') THEN
              TempSalesHeader.TRANSFERFIELDS(SalesHeaderArc);
          END;
          // H0332 <<
          IF TempSalesHeader.INSERT THEN;
        END;
        //A/gob-rste/28.06.12/GOB1.07
        IF PurchLine."Special Order" AND (PurchLine."Special Order Sales No." <> '') THEN BEGIN
          IsSpecialOrder := TRUE;

          // H0332 >>
          IF SalesHeader.GET(SalesHeader."Document Type"::Order,PurchLine."Special Order Sales No.") THEN
            TempSalesHeader := SalesHeader
          ELSE BEGIN
            SalesHeaderArc.SETRANGE("No.", PurchLine."Special Order Sales No.");
            IF SalesHeaderArc.FIND('-') THEN
              TempSalesHeader.TRANSFERFIELDS(SalesHeaderArc);
          END;
          //TempSalesHeader := SalesHeader;
          // H0332 <<
          IF TempSalesHeader.INSERT THEN;
        END;
        //E/gob-rste/28.06.12/GOB1.07
      UNTIL PurchLine.NEXT = 0;

      //H1626 08.10.14 TST +++++++++++++++++++++++++++++
      //IF STRPOS(_PurchOrderHeader."No.",'PO99') = 1 THEN BEGIN
      IF STRPOS(_PurchOrderHeader."No.",'CD') = 1 THEN BEGIN
      //H1626 08.10.14 TST -----------------------------
        AutomEMailProc2.CreateSpecialOrderMail(_PurchOrderHeader,TempSalesHeader);
        EXIT;
      END;

      IF STRPOS(_PurchOrderHeader."No.",'PO98') = 1 THEN BEGIN
        AutomEMailProc2.CreateSpecialOrderMail(_PurchOrderHeader,TempSalesHeader);
        EXIT;
      END;
      //S/P1092
      IF _PurchOrderHeader."RHD Real Crossdocking" THEN BEGIN
        AutomEMailProc2.CreateSpecialOrderMail(_PurchOrderHeader,TempSalesHeader);
        EXIT;
      END;
      //E/P1092

      IF NOT IsSpecialOrder THEN BEGIN
        IF TempSalesHeader.FIND('-') THEN BEGIN
          REPEAT
            CreateOrderMail(_PurchOrderHeader, TempSalesHeader, L_MP, L_DropShip);
          UNTIL TempSalesHeader.NEXT = 0;
        END ELSE
          CreateOrderMail(_PurchOrderHeader,TempSalesHeader,FALSE,FALSE);
      END ELSE BEGIN
        IF TempSalesHeader.FIND('-') THEN BEGIN
          REPEAT
            CreateSpecialOrderMail(_PurchOrderHeader,TempSalesHeader);
          UNTIL TempSalesHeader.NEXT = 0;
        END;
      END;
    END;

    PROCEDURE CreateOrderMail@1000000002(PurchOrderHeaderV@1000000029 : Record 38;SalesOrderHeaderV@1000000030 : Record 36;MPV@1000000018 : Boolean;DropshipV@1000000020 : Boolean);
    VAR
      LT_MailITSetup@1000000028 : Record 75402;
      LT_WebSiteTransfer@1000000034 : Record 50033;
      LT_WebSource@1000000026 : Record 5059;
      LT_Location@1000000044 : Record 14;
      LT_LabelDHL@1000000045 : Record 50020;
      LT_ExtTextLine@1000000065 : Record 280;
      LR_SalesOrder@1000000050 : Report 50020;
      FormatAddr@1000000023 : Codeunit 365;
      ClientFso@1000000005 : Automation "{420B2830-E718-11CF-893D-00A0C9054228} 1.0:{0D43FE01-F093-11CF-8940-00A0C9054228}:'Microsoft Scripting Runtime'.FileSystemObject";
      ClientUtil@1000000003 : Automation "{1639594D-2135-4248-BE9B-FB55210F8AD8} 1.0:{D7CD856D-3889-4F19-BBBA-7608CF34EFB6}:'ExpandIT Dynamics Role Tailored Client Utility'.Utility";
      DivUtil@1000000054 : Automation "{2CD8D481-009C-4685-98EA-BC16452327B2} 1.0:{F1BBE10B-6E48-41B0-9EF6-F428C7A48655}:'Dynovus_SHA1Encryption'.SHA1EncryptAutomation";
      MailIT@1000000006 : OCX "{C8C4804C-89BA-4291-AB58-4C6050B65175}:'ExpandIT.MailIT2'";
      ShipAddr@1000000012 : ARRAY [8] OF Text[80];
      MailText@1000000032 : Text[250];
      DocName@1000000016 : Text[250];
      DocName2@1000000021 : Text[250];
      JobID@1000000007 : Text[50];
      ClientTempFolder@1000000004 : Text[250];
      ClientPdfFileName@1000000015 : Text[250];
      ClientFileName@1000000022 : Text[250];
      OldDefaultPrinter@1000000013 : Text[250];
      DefaultPrinterChanged@1000000014 : Boolean;
      ReportID@1000000001 : Integer;
      L_Text001@1000000002 : TextConst 'DEU=Bestellung Nr.:;ENU=Order No.:';
      L_Text002@1000000017 : TextConst 'DEU=Kunde:;ENU=Seller:';
      L_Text010@1000000010 : TextConst 'DEU=Sehr geehrte(r) %1,';
      L_Text010a@1000000063 : TextConst 'DEU=Sehr geehrte Damen und Herren,';
      L_Text011@1000000009 : TextConst 'DEU=anbei erhalten Sie eine Bestellung auf Rechnung %1';
      L_Text012@1000000000 : TextConst 'DEU=Anbei der Lieferschein, der der Sendung beigefÅgt werden kann.';
      L_Text013@1000000008 : TextConst 'DEU=Unsere Bestellnummer: %1';
      L_Text014@1000000011 : TextConst 'DEU=Versandadresse:';
      L_Text015@1000000064 : TextConst 'DEU=Bitte schicken Sie uns eine AuftragsbestÑtigung innerhalb von 24h mit dem geplanten Liefertermin und der bestÑtigten Anzahl als Antwort auf diese E-Mail.';
      L_Text016@1000000025 : TextConst 'DEU=Vielen Dank fÅr die Zusammenarbeit mit %1 !';
      L_Text017@1000000027 : TextConst 'DEU=Mit freundlichen GrÅ·en';
      L_Text018@1000000033 : TextConst 'DEU=Tel: %1 | Fax: %2';
      L_Text019@1000000037 : TextConst 'DEU="anbei erhalten Sie eine Bestellung fÅr folgende Lieferadresse: "';
      L_Text020@1000000041 : TextConst 'DEU=Bitte beachten Sie die Lieferanschrift, da wir mehrere Lager haben.';
      L_Text021@1000000042 : TextConst 'DEU=Bitte beachten Sie auch, dass Sie spÑtestens %1 vor Anlieferung Ihre Anlieferung avisieren.';
      L_Text022@1000000031 : TextConst 'DEU=Die neue Lieferadresse ist:';
      L_Text023@1000000046 : TextConst 'DEU=Entladezeit: %1';
      L_Text024@1000000047 : TextConst 'DEU=Ansprechpartner fÅr die Lieferavisierung ist %1.';
      L_Text025@1000000048 : TextConst 'DEU=Bitte folgenden Verteiler wÑhlen, wenn es um die Avisierung geht:';
      L_Text026@1000000049 : TextConst 'DEU=Bitte stellen Sie sicher, dass unsere Bestell-Referenz und die Bestellnummer auf dem Lieferschein hinterlegt sind.';
      L_Text027@1000000051 : TextConst 'DEU=anbei eine Bestellung aus dem %1 Marketplace, welche Sie bitte auf eigene Rechnung versenden.';
      L_Text028@1000000052 : TextConst 'DEU=Den vollen Bruttobetrag haben wir bereits eingezogen/reserviert und sichern Ihnen hiermit verbindlich die Auszahlung zu vereinbarten Konditionen zu.';
      L_Text029@1000000053 : TextConst 'DEU=Bitte beachten Sie, dass Sie mindestens die Liefer-KW eintragen und auf Aktualisieren klicken mÅssen, damit der Lieferschein erzeugt wird. Sie brauchen dafÅr fortan keine AuftragsbestÑtigungen mehr auf anderem Wege zusenden.';
      L_Text030@1000000060 : TextConst 'DEU=Kunde:';
      L_TextT001@1000000058 : TextConst 'DEU=Menge;ENU=Quantity';
      L_TextT002@1000000057 : TextConst 'DEU=Beschreibung (Artikelnr.);ENU=Description';
      L_TextT003@1000000056 : TextConst 'DEU=VK-Preis;ENU=Sales Price';
      L_TextT004@1000000055 : TextConst 'DAN=Enhed;DEU=Ihre SKU;ENU=Unit;ESP=Unidad;FRA=UnitÇ;SVE=Enhet';
      L_TextT005@1000000059 : TextConst 'DEU=Max. Liefer-KW';
      L_TextI001@1000000035 : TextConst 'DEU=Impressum';
      L_TextI002@1000000036 : TextConst 'DEU=Eingetragen beim %1';
      L_TextI004@1000000038 : TextConst 'DEU=USt-ID: %1';
      L_TextI005@1000000039 : TextConst 'DEU=GeschÑftsfÅhrer %1, %2';
      L_TextI006@1000000040 : TextConst 'DEU=(Montag - Freitag 09:00 - 18:00 Uhr)';
      Text040@1000000019 : TextConst 'DAN=Der blev ikke dannet et PDF-dokument.;DEU=Es wurde kein PDF Dokument erzeugt.;ENU=No PDF Document was generated.;ESP=No se gener¢ ning£n documento PDF.;FRA=Aucun document PDF n''a ÇtÇ crÇÇ.;SVE=Inget PDF-dokument skapades.';
      LinkID@1000000043 : Code[10];
      L_MaxKW@1000000061 : Text[10];
      L_Hash@1000000062 : Text[250];
      L_Port@1000000024 : Integer;
      PurchLineLoc@1108200000 : Record 39;
      DHLPaketLabelReport@1108200001 : Report 50009;
      VendLoc@1108200002 : Record 23;
      SKUOK@1108200003 : Boolean;
      LabelCounter@1108200004 : Integer;
      Purchlineloc2@1108200005 : Record 39;
      L_Text031@1108200012 : TextConst 'ENU="Artikel-Bezeichnung: "';
      L_Text032@1108200011 : TextConst 'ENU="Unsere Artikelnr.: "';
      L_Text033@1108200010 : TextConst 'ENU="Ihre Artikelnr.: "';
      L_Text034@1108200009 : TextConst 'ENU="Menge: "';
      L_Text035@1108200008 : TextConst 'ENU=Unsere Kundennr.: %1';
      L_Text036@1108200007 : TextConst 'ENU="Versandart: "';
      L_Text037@1108200006 : TextConst 'ENU=Auftragsdatum: %1';
      SalesLineLoc@1108200013 : Record 37;
      FPCGeneralSetup@1000000067 : Record 50055;
      DHLPaketLabelReportINTDS@1000000066 : Report 50156;
      DHLSetup@1000000068 : Record 50022;
      DPDSetup@1000000079 : Record 50221;
      DPDLabelManagement@1000000080 : Codeunit 50269;
      DPDGeneralMgt@1000000081 : Codeunit 50112;
      "***HME************************"@1000000082 : Integer;
      SalesLineL@1000000083 : Record 37;
      PrinterSelectionL@1000000084 : Record 78;
      PurchaseLineL@1000000085 : Record 39;
      ContainsChannelFromFilterL@1000000086 : Boolean;
      SuppressDeliveryNoteL@1000000087 : Boolean;
      SparPartMgtL@1000000089 : Codeunit 50322;
      VendorContactTypeL@1000000088 : Record 50189;
      IsSparePartOrderL@1000000090 : Boolean;
      ContainsDefectLineL@1000000091 : Boolean;
      "***CC*************************"@1000000188 : Integer;
      MPDocMgt@1000000189 : Codeunit 50500;
      MailITSetupL@1100000084 : Record 75402;
      PurchaseMailCodeL@1100000085 : Record 50338;
      PurchaseMailHTMLPathL@1100000086 : Record 50339;
      VendorL@1100000087 : Record 23;
    BEGIN
      //P0921 Code simplification, deleted unused Code
      LT_MailITSetup.GET;
      LT_MailITSetup.TESTFIELD("Purchase E-Mail BCC (Direct)");
      LT_MailITSetup.TESTFIELD("Purchase E-Mail BCC (Location)");
      UserSetup.GET(USERID);
      UserSetup.TESTFIELD("PDF Creator");
      //H2078 04.02.15 EHN +++++++++++++++++++++++++++++++++++
      IsSparePartOrderL := SparPartMgtL.IsSparePartOrderFromPOrder(PurchOrderHeaderV);
      ContainsDefectLineL := SparPartMgtL.CheckForDefectLine(PurchOrderHeaderV);
      //H2078 04.02.15 EHN -----------------------------------

      //P0921 info: get Report ID / Doc Names / Mail Subject
      PurchOrderHeaderV.SETRECFILTER;
      SalesOrderHeaderV.SETRECFILTER;
      IF DropshipV THEN BEGIN
        LT_WebSiteTransfer.SETRANGE("Website No.",SalesOrderHeaderV."Website No.");
        LT_WebSiteTransfer.FINDLAST;
        LT_WebSiteTransfer.CALCFIELDS("Website Name");

        //H0979 03.04.14  FF ++++++++++++++++++++++++++++++++++++++++++
        MailText := LT_WebSiteTransfer."Website Name" +': '+ L_Text001 +' '+ PurchOrderHeaderV."No.";
        //H0979 03.04.14  FF ------------------------------------------

        // H0773 22.01.14 FX +++++++++++++++++++++++++++++++++++++++++++++++++
        IF (PurchHeader.CheckSecondEMail(PurchOrderHeaderV) <> '') AND
          (PurchHeader.CheckSecondEMail(PurchOrderHeaderV) <> '!') THEN
          MailText += TEXT0004HME;
        // H0773 22.01.14 FX -----------------------------------------------

        // S/P1277
        DocName := '_Labels_'+  PurchOrderHeaderV."No.";
        // E/P1277
        DocName2 := LT_WebSiteTransfer."Website Name" +'_Packzettel_'+  PurchOrderHeaderV."No.";
        ReportID := 50020
      END ELSE BEGIN
        MailText := L_Text001 +' '+ PurchOrderHeaderV."No.";
        DocName2 := 'Bestellung_'+  PurchOrderHeaderV."No.";
        ReportID := 405;

        // H0773 22.01.14 FX +++++++++++++++++++++++++++++++++++++++++++++++++
        IF (PurchHeader.CheckSecondEMail(PurchOrderHeaderV) <> '') AND
          (PurchHeader.CheckSecondEMail(PurchOrderHeaderV) <> '!') THEN
          MailText += TEXT0004HME;
        // H0773 22.01.14 FX -----------------------------------------------

      END;

      CREATE(ClientFso,TRUE,TRUE);
      CREATE(ClientUtil,TRUE,TRUE);
      CREATE(DivUtil,TRUE,TRUE);
      JobID := MailIT.CreateGUID();

      // Get folder for temporary files on the client
      ClientTempFolder := ClientUtil.GetTempPath();
      IF ClientTempFolder = '' THEN
        ERROR('Unable to create the path of the temporary folder.');
      ClientTempFolder := ClientTempFolder + 'ExpMail';
      IF NOT ClientFso.FolderExists(ClientTempFolder) THEN
        ClientFso.CreateFolder(ClientTempFolder);
      ClientTempFolder := ClientTempFolder + '\' + JobID;
      IF NOT ClientFso.FolderExists(ClientTempFolder) THEN
        ClientFso.CreateFolder(ClientTempFolder);

      // Locate bill to customer
      Vend.GET(PurchOrderHeaderV."Buy-from Vendor No.");
      CompanyInfo.GET;

      // Initialize the email
      IF SendMailDirect THEN
        MailIT.SetService('SMTP')
      ELSE
        MailIT.SetService(FORMAT(UserSetup."Mail Client"));

      IF DropshipV THEN BEGIN
        //H2078 10.02.15 EHN +++++++++++++++++++++++++++++++++++
        IF IsSparePartOrderL THEN
          MailIT.SetFrom(LT_MailITSetup."SparePart Order E-Mail")
        ELSE
          MailIT.SetFrom(LT_MailITSetup."User Name (Direct)");
        //H2078 10.02.15 EHN -----------------------------------
        //H3782 17.03.15 EHN +++++++++++++++++++++++++++++++++
        IF NOT LT_MailITSetup."Test Mode" THEN BEGIN
          IF IsSparePartOrderL THEN
            MailIT.AddRecipientBCC(LT_MailITSetup."SparePart Order E-Mail BCC",LT_MailITSetup."SparePart Order E-Mail BCC")
          ELSE
            MailIT.AddRecipientBCC(LT_MailITSetup."Purchase E-Mail BCC (Direct)",LT_MailITSetup."Purchase E-Mail BCC (Direct)");
        END ELSE
        //H3782 17.03.15 EHN ---------------------------------
          MailIT.AddRecipientBCC(LT_MailITSetup."Test E-Mail BCC",LT_MailITSetup."Test E-Mail BCC");
      END ELSE BEGIN
        //H2078 10.02.15 EHN +++++++++++++++++++++++++++++++++++
        IF IsSparePartOrderL THEN
          MailIT.SetFrom(LT_MailITSetup."SparePart Order E-Mail")
        ELSE
          MailIT.SetFrom(LT_MailITSetup."Purchase E-Mail BCC (Location)");
        //H2078 10.02.15 EHN -----------------------------------
        //H3782 17.03.15 EHN +++++++++++++++++++++++++++++++++
        IF NOT LT_MailITSetup."Test Mode" THEN BEGIN
          IF IsSparePartOrderL THEN
            MailIT.AddRecipientBCC(LT_MailITSetup."SparePart Order E-Mail BCC",LT_MailITSetup."SparePart Order E-Mail BCC")
          ELSE
            MailIT.AddRecipientBCC(LT_MailITSetup."Purchase E-Mail BCC (Location)",LT_MailITSetup."Purchase E-Mail BCC (Location)")
        END ELSE
        //H3782 17.03.15 EHN ---------------------------------
          MailIT.AddRecipientBCC(LT_MailITSetup."Test E-Mail BCC",LT_MailITSetup."Test E-Mail BCC");
        //A/P1017
        IF (NOT LT_MailITSetup."Test Mode") AND (Vend."E-Mail Recipient Order Mail" <> '') THEN
          MailIT.AddRecipientCC(Vend."E-Mail Recipient Order Mail",Vend."E-Mail Recipient Order Mail");
        //E/P1017
      END;

      // 1.00 B >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
      IF DropshipV THEN BEGIN
        IF (Vend."Primary Contact No. (Direct)" <> '') AND Cont.GET(Vend."Primary Contact No. (Direct)") AND (Cont."E-Mail" <> '') THEN
          Vend."E-Mail" := Cont."E-Mail";
      END ELSE
      // 1.00 E <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
        IF (Vend."Primary Contact No. (Order)" <> '') AND Cont.GET(Vend."Primary Contact No. (Order)") AND (Cont."E-Mail" <> '') THEN
          Vend."E-Mail" := Cont."E-Mail";

      //H2078, H1534 26.01.15 RST +++++++++++++++++++++++++
      IF IsSparePartOrderL THEN BEGIN
        SparPartMgtL.RetrieveVendPOSparePaEmailAddr(Vend,VendorContactTypeL);
        IF VendorContactTypeL."Contact Medium" <> '' THEN
          Vend."E-Mail" := VendorContactTypeL."Contact Medium";
      END;
      //H2078, H1534 26.01.15 RST --------------------------

      Vend.TESTFIELD("E-Mail");
      IF Vend."E-Mail" <> '' THEN
        IF LT_MailITSetup."Test Mode" THEN
          MailIT.AddRecipient(LT_MailITSetup."Test E-Mail",LT_MailITSetup."Test E-Mail")
        ELSE
          MailIT.AddRecipient(Vend."E-Mail",Vend."E-Mail");

      MailIT.SetSubject(MailText);

      // Add some HTML to the mail body
      // A/P0903
      IF NOT DropshipV THEN BEGIN
        PurchOrderHeaderV."Ship-to Contact" := '';
        PurchOrderHeaderV."Ship-to Country/Region Code" := '';
      END;
      // E/P0903
      FormatAddr.PurchHeaderShipTo(ShipAddr,PurchOrderHeaderV);

      MailIT.AppendHTML('<font face="Arial","sans-serif">');
      //A/P0305
      MailIT.AppendHTML('<table width=590 border=0>');
      //E/P0305

      //H0575 24.10.13 ARU ++++++++++++++++++++++++++++++++++++++
      MailIT.AppendHTML(TEXT0003HME);
      MailIT.AppendHTML('<u><i>');
      MailIT.AppendHTML(HMEText019);
      MailIT.AppendHTML('</u></i>');
      MailIT.AppendHTML('<br /><br />');
      MailIT.AppendHTML('<br /><br />');
      MailIT.AppendHTML(STRSUBSTNO(L_Text010a) + '<br /><br />');
      //H0575 24.10.13 ARU --------------------------------------

      IF DropshipV THEN BEGIN
        IF MPV THEN BEGIN
          MailIT.AppendHTML(STRSUBSTNO(L_Text027,LT_WebSiteTransfer."Website Name") +' '+ L_Text028 + '<br /><br />');
        //H2078 04.02.15 EHN +++++++++++++++++++++++++++++++++++
        END ELSE IF IsSparePartOrderL AND ContainsDefectLineL THEN BEGIN
          MailIT.AppendHTML('<b>'+ HMEText020 + '</b><br /><br />');
        //H2078 04.02.15 EHN -----------------------------------
        END ELSE
          //T0098 19.02.15 CC-JGR +++++++++++++++++++++++++++++
          //MailIT.AppendHTML('<b>'+ STRSUBSTNO(L_Text011,CompanyInfo.Name) + '</b><br /><br />');
          MailIT.AppendHTML('<b>'+ STRSUBSTNO(L_Text011,MPDocMgt.CheckMPPartner(PurchOrderHeaderV,CompanyInfo)) + '</b><br /><br />');
          //T0098 19.02.15 CC-JGR -----------------------------

        //A/gob-rste/30.07.12/GOB1.14
        IF CheckAlternativeEMail(PurchOrderHeaderV) AND NOT(MPV) THEN BEGIN
          // H0979, H0773 23.01.14 FX ++++++++++++++++++++++++++++++++++++++++++++++++++++
          IF (PurchHeader.CheckSecondEMail(PurchOrderHeaderV) <> '') AND
            (PurchHeader.CheckSecondEMail(PurchOrderHeaderV) <> '!') THEN
              ConditionalText := TEXT0004HME
            ELSE
              ConditionalText := '';
          // H0979, H0773 23.01.14 FX ----------------------------------------------------
          MailIT.AppendHTML(STRSUBSTNO(L_Text013,PurchOrderHeaderV."No." + ConditionalText)+ '<br /><br />');
          MailIT.AppendHTML(L_Text014 + '<br />');  //Versandaddresse
        END ELSE BEGIN
        //E/gob-rste/30.07.12/GOB1.14

          // H0773 23.01.14 FX ++++++++++++++++++++++++++++++++++++++++
          IF (PurchHeader.CheckSecondEMail(PurchOrderHeaderV) <> '') AND
            (PurchHeader.CheckSecondEMail(PurchOrderHeaderV) <> '!') THEN
            ConditionalText := TEXT0004HME
          ELSE
            ConditionalText := '';
          MailIT.AppendHTML(STRSUBSTNO(L_Text013,PurchOrderHeaderV."No.") + ConditionalText + '<br /><br />');
          // H0773 23.01.14 FX ---------------------------------------------------------------------------------

        IF MPV THEN
          MailIT.AppendHTML(L_Text030 + '<br />')
        ELSE
          MailIT.AppendHTML(L_Text014 + '<br />');
        //A/gob-rste/30.07.12/GOB1.14
        END;
        //E/gob-rste/30.07.12/GOB1.14
      END ELSE BEGIN
        IF NOT LT_Location.GET(PurchOrderHeaderV."Location Code") THEN
          LT_Location.INIT;

        MailIT.AppendHTML(L_Text019 + '<br />');

        //H0575, p0072 24.10.13 ARU ++++++++++++++++++++++++++++++++++++++
        MailIT.AppendHTML('<br />');
        //H0575, p0072 24.10.13 ARU --------------------------------------
      END;

      IF MPV THEN BEGIN
        MailIT.AppendHTML(PurchOrderHeaderV."Ship-to Name" +', '+
          PurchOrderHeaderV."Ship-to Post Code" +' '+ PurchOrderHeaderV."Ship-to City" +'<br />');
      END ELSE BEGIN
        FOR i := 1 TO 8 DO
          IF ShipAddr[i] <> '' THEN
            MailIT.AppendHTML(ShipAddr[i] + '<br />');
        IF DropshipV AND Cust.GET(PurchOrderHeaderV."Sell-to Customer No.") AND (Cust."Phone No." <> '') THEN
          MailIT.AppendHTML('T: '+ Cust."Phone No.");
      END;

      IF NOT DropshipV THEN BEGIN
        MailIT.AppendHTML(STRSUBSTNO( L_Text023,LT_Location."Discharge Time") + '<br /><br />');

        //H0575 24.10.13 ARU ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
        LT_ExtTextLine.RESET;
        LT_ExtTextLine.SETRANGE("Table Name",LT_ExtTextLine."Table Name"::"Standard Text");
        LT_ExtTextLine.SETRANGE("Language Code",'DEU');
        LT_ExtTextLine.SETRANGE("Text No.",1);
        //H0575 24.10.13 ARU --------------------------------------------------------------

        //a/gob-sfe/P0099
        LT_ExtTextLine.SETRANGE("No.",'BESTAB');

        IF LT_ExtTextLine.FINDSET THEN REPEAT
          MailIT.AppendHTML(LT_ExtTextLine."Text (Long)" + '<br />');
        UNTIL LT_ExtTextLine.NEXT = 0;

        MailIT.AppendHTML('<br /><br />');
        LT_ExtTextLine.SETRANGE("No.",'BESTAVI');

        IF LT_ExtTextLine.FINDSET THEN REPEAT
          MailIT.AppendHTML(LT_ExtTextLine."Text (Long)" + '<br />');
        UNTIL LT_ExtTextLine.NEXT = 0;
        MailIT.AppendHTML('<br /><br />');
        //e/gob-sfe/P0099

        //H0575 24.10.13 ARU +++++++++++++
        MailIT.AppendHTML('<u>');
        MailIT.AppendHTML(HMEText011);
        MailIT.AppendHTML('</u>');
        MailIT.AppendHTML('<br /><br />');

        MailIT.AppendHTML('<i>');
        //H0575 24.10.13 ARU -------------

        LT_ExtTextLine.SETRANGE("No.",'BESTTEXT');
        IF LT_ExtTextLine.FINDSET THEN REPEAT
          //H0575 24.10.13 ARU ++++++++++++++++++++++++++++++++++++++++
          MailIT.AppendHTML(LT_ExtTextLine."Text (Long)");
          IF LT_ExtTextLine."Text (Long)" = '' THEN
           MailIT.AppendHTML('<br /><br />');
          //H0575 24.10.13 ARU ----------------------------------------
        UNTIL LT_ExtTextLine.NEXT = 0;

        //H0575 24.10.13 ARU +++++++++++++
        MailIT.AppendHTML('</i>');

        MailIT.AppendHTML('<br /><br />');
        MailIT.AppendHTML(L_Text017);
        MailIT.AppendHTML('<br /><br />');
        MailIT.AppendHTML('<strong>');
        MailIT.AppendHTML(HMEText012);
        MailIT.AppendHTML('</strong>');
        //H0575 24.10.13 ARU -------------
      END;

      //++++++ for English Version >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
      IF NOT DropshipV THEN BEGIN
        MailIT.AppendHTML('<br /><br />');
        MailIT.AppendHTML('<br /><br />');
        MailIT.AppendHTML('***********************************************************');
        MailIT.AppendHTML('<br /><br />');

        MailIT.AppendHTML(STRSUBSTNO(HMEText014) + '<br /><br />');

        MailIT.AppendHTML(HMEText005 + '<br />');
        MailIT.AppendHTML('<br />');

        FOR i := 1 TO 8 DO
          IF ShipAddr[i] <> '' THEN
            MailIT.AppendHTML(ShipAddr[i] + '<br />');
        IF DropshipV AND Cust.GET(PurchOrderHeaderV."Sell-to Customer No.") AND (Cust."Phone No." <> '') THEN
          MailIT.AppendHTML('P: '+ Cust."Phone No.");

        MailIT.AppendHTML(STRSUBSTNO(HMEText013, LT_Location."Discharge Time") + '<br /><br />');

        LT_ExtTextLine.RESET;
        LT_ExtTextLine.SETRANGE("Table Name",LT_ExtTextLine."Table Name"::"Standard Text");
        LT_ExtTextLine.SETRANGE("Language Code",'ENU');
        LT_ExtTextLine.SETRANGE("Text No.",1);

        LT_ExtTextLine.SETRANGE("No.",'BESTAB');
        IF LT_ExtTextLine.FINDSET THEN REPEAT
          MailIT.AppendHTML(LT_ExtTextLine."Text (Long)" + '<br />');
        UNTIL LT_ExtTextLine.NEXT = 0;

        MailIT.AppendHTML('<br /><br />');

        LT_ExtTextLine.SETRANGE("No.",'BESTAVI');
        IF LT_ExtTextLine.FINDSET THEN REPEAT
          MailIT.AppendHTML(LT_ExtTextLine."Text (Long)" + '<br />');
        UNTIL LT_ExtTextLine.NEXT = 0;
        MailIT.AppendHTML('<br /><br />');

        MailIT.AppendHTML('<u>');
        MailIT.AppendHTML(HMEText016);
        MailIT.AppendHTML('</u>');
        MailIT.AppendHTML('<br /><br />');
        MailIT.AppendHTML('<i>');

        LT_ExtTextLine.SETRANGE("No.",'BESTTEXT');
        IF LT_ExtTextLine.FINDSET THEN REPEAT
          MailIT.AppendHTML(LT_ExtTextLine."Text (Long)");

          IF LT_ExtTextLine."Text (Long)" = '' THEN
           MailIT.AppendHTML('<br /><br />');
        UNTIL LT_ExtTextLine.NEXT = 0;

        MailIT.AppendHTML('</i>');
        MailIT.AppendHTML('<br /><br />');
        MailIT.AppendHTML(HMEText017);
        MailIT.AppendHTML('<br /><br />');
        MailIT.AppendHTML('<strong>');
        MailIT.AppendHTML(HMEText018);
        MailIT.AppendHTML('</strong>');
      END;
      //------ for English Version <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

      //H0676 03.12.12 ARU +++++++++++
      MailIT.AppendHTML('<br />');
      //H0676 03.12.12 ARU -----------

      IF MPV THEN BEGIN
        //A/P0305
        MailIT.AppendHTML('<table width=590 border=1><tr>' +
        //E/P0305
          '<th>' + L_TextT001 + '</th>' +
          '<th>' + L_TextT002 + '</th>' +
          '<th>' + L_TextT004 + '</th>' +
          '<th align="right">' + L_TextT003 + '</th>' +
          '<th>' + L_TextT005 + '</th></tr>');
        PurchLine.RESET;
        PurchLine.SETRANGE("Document Type",PurchOrderHeaderV."Document Type");
        PurchLine.SETRANGE("Document No.",PurchOrderHeaderV."No.");
        PurchLine.SETRANGE(Type,PurchLine.Type::Item);
        PurchLine.SETFILTER("No.",'<>%1','');
        PurchLine.SETFILTER("Sales Order No.",'<>%1','');
        IF PurchLine.FINDSET THEN REPEAT
          Item.GET(PurchLine."No.");
          L_MaxKW := FORMAT(DATE2DWY(PurchLine."Max. Delivery Date",2)) +'.'+ FORMAT(DATE2DMY(PurchLine."Max. Delivery Date",3));
          SalesLine.GET(SalesLine."Document Type"::Order,PurchLine."Sales Order No.",PurchLine."Sales Order Line No.");
          MailIT.AppendHTML('<tr>' +
            '<td width="9%" align="center">' + FORMAT(PurchLine.Quantity) + '</td>'+
            '<td width="40%">' + MailIT.HTMLEncode(SalesLine.Description) +' ('+ MailIT.HTMLEncode(SalesLine."No.") +')'+ '</td>' +
            '<td width="25%">' + Item."Vendor Item No." + Item."Vendor Item No. Add." + '</td>' +
            '<td width="13%" align="right">' + FORMAT(SalesLine."Unit Price",0,'<Precision,2><Standard Format,0>') + '</td>' +
            '<td width="10%" align="center">' + L_MaxKW + '</td></tr>');
        UNTIL PurchLine.NEXT = 0;
        MailIT.AppendHTML('</table>');
        MailIT.AppendHTML('<table><border=0');
        MailIT.AppendHTML(L_Text029 + '<br /><br />');
        MailIT.AppendHTML('</table>');
      END ELSE BEGIN
        IF DropshipV THEN BEGIN
          //H0676 03.12.12 ARU +++++++
          MailIT.AppendHTML('<br />');
          //H0676 03.12.12 ARU -------
          MailIT.AppendHTML(L_Text015 + '<br />');
        END;
      END;

      IF MPV THEN BEGIN
        L_Hash := DivUtil.GetSHA1HashData(PurchOrderHeaderV."No." + PurchOrderHeaderV."Ship-to Post Code" +'jrlewu3j54');
        //A/P0305
        MailIT.AppendHTML('<table width=590 border=0>');
        //E/P0305
        LT_WebSource.GET('MP01');
        MailIT.AppendHTML('<td style=''background:#009E0E;width="60%";padding:12.0pt''><p align=center>');
        MailIT.AppendHTML('<a href="'+ LT_WebSource.URL + PurchOrderHeaderV."No." +'&amp;hash='+ L_Hash +'">'+
          'Auftrag bestÑtigen und Dokumente <br> herunterladen </a></p></td>');
        LT_WebSource.GET('MP02');
        MailIT.AppendHTML('<td style=''background:#CC0000;padding:12.0pt''><p align=center>');
        MailIT.AppendHTML('<a href="'+ LT_WebSource.URL + PurchOrderHeaderV."No." +'&amp;hash='+ L_Hash +'">'+
          'Auftrag <br> ablehnen </a></p>');
        MailIT.AppendHTML('</td></tr></table>');
        //A/P0305
        MailIT.AppendHTML('<table width=590 border=0>');
        //E/P0305
        LT_WebSource.GET('MP03');
        MailIT.AppendHTML('<td style=''background:#FFE599;padding:12.0pt''><p align=center>');
        MailIT.AppendHTML('<a href="'+ LT_WebSource.URL + PurchOrderHeaderV."No." +'&amp;hash='+ L_Hash + '">'+
          'Auftrag aktualisieren/Lieferstatus/<br> Trackingnr. einpflegen </a></p></td>');
        MailIT.AppendHTML('</td></tr></table>');
      END;

      // Fusszeilen

      IF DropshipV AND (NOT MPV) THEN BEGIN
         //H0676 03.12.12 ARU +++++++
         MailIT.AppendHTML('<br />');
         //H0676 03.12.12 ARU -------
         MailIT.AppendHTML(L_Text012);
      END;

      MailIT.AppendHTML('<br />');

      IF DropshipV THEN BEGIN
        MailIT.AppendHTML(STRSUBSTNO(L_Text016,LT_WebSiteTransfer."Website Name") + '<br /><br />');

        //H3782, H2078, H0979 17.03.15 EHN +++++++++++++++++++++++++++++++++++
        MailIT.AppendHTML(CompanyInfo.Name +'<br />');
        IF IsSparePartOrderL THEN BEGIN
          MailIT.AppendHTML(STRSUBSTNO(L_Text018,LT_MailITSetup."Spare Part Phone No.",
            LT_MailITSetup."Purchase Fax No. (Direct)") + '<br />');
          MailIT.AppendHTML('E-Mail: ' + LT_MailITSetup."SparePart Order E-Mail" + '<br /><br />');
        END ELSE BEGIN
          MailIT.AppendHTML(STRSUBSTNO(L_Text018,LT_MailITSetup."Purchase Phone No. (Direct)",
            LT_MailITSetup."Purchase Fax No. (Direct)") + '<br />');
          MailIT.AppendHTML('E-Mail: ' + LT_MailITSetup."Special Order E-Mail" + '<br /><br />');
        END;
        //H3782, H2078, H0979 17.03.15 EHN -----------------------------------

        //H0676 03.12.12 ARU ++++++++++++++++++++
        MailIT.AppendHTML('<br />');
        MailIT.AppendHTML(L_Text017);
        MailIT.AppendHTML('<br /><br />');
        MailIT.AppendHTML(HMEText012);
        //H0676 03.12.12 ARU --------------------

      //H0575 24.10.13 ARU +++++++
      END;
      //H0575 24.10.13 ARU -------

      // read footer file

      //H1671 11.03.15  FF ++++++++++++++++++++++++++
      //IF NOT _Dropship THEN
      //MailIT.LoadHTMLBody('C:\Mailhtml\footer_stock order.html')
      IF NOT DropshipV THEN BEGIN
        IF MailITSetupL.GET THEN BEGIN
          IF PurchaseMailHTMLPathL.GET(MailITSetupL."Purchase Order Mail Code",PurchOrderHeaderV."Language Code",
             PurchaseMailHTMLPathL.Type::footer) THEN
            MailIT.LoadHTMLBody(PurchaseMailHTMLPathL.Path)
          ELSE
            IF PurchaseMailHTMLPathL.GET(MailITSetupL."Purchase Order Mail Code",'DEU',PurchaseMailHTMLPathL.Type::footer) THEN
              MailIT.LoadHTMLBody(PurchaseMailHTMLPathL.Path)
        END;
            //ELSE BEGIN
      END ELSE BEGIN
      //H1671 11.03.15  FF --------------------------

      //H0979 03.04.14  FF ++++++++++++++++++++++++++
      ///////English Dropship Mail - Start///////
        MailIT.AppendHTML('<br /><br />');
        MailIT.AppendHTML('<br /><br />');
        MailIT.AppendHTML('-------------------------------');
        MailIT.AppendHTML('<br /><br />');
        MailIT.AppendHTML('<br /><br />');
        MailIT.AppendHTML(STRSUBSTNO(HMEText014) + '<br /><br />');

        //H2078 04.02.15 EHN +++++++++++++++++++++++++++++++++++
        IF IsSparePartOrderL AND ContainsDefectLineL THEN BEGIN
          MailIT.AppendHTML('<b>'+ HMEText021 + '</b><br /><br />');
        END ELSE
          //T0098 19.02.15 CC-JGR +++++++++++++++++++++++++++++
          //MailIT.AppendHTML('<b>'+ HMEText001 +'</b>' + '<br />');
          MailIT.AppendHTML('<b>'+ STRSUBSTNO(HMEText001,MPDocMgt.CheckMPPartner(PurchOrderHeaderV,CompanyInfo)) +'</b>' + '<br />');
          //T0098 19.02.15 CC-JGR -----------------------------
        //H2078 04.02.15 EHN -----------------------------------
        MailIT.AppendHTML('<br />');

        MailIT.AppendHTML(STRSUBSTNO(HMEText003,PurchOrderHeaderV."No.") + ConditionalText + '<br /><br />');
        MailIT.AppendHTML(HMEText002 + '<br />');  //Versandaddresse

        FOR i := 1 TO 8 DO
          IF ShipAddr[i] <> '' THEN
            MailIT.AppendHTML(ShipAddr[i] + '<br />');
        IF Cust.GET(PurchOrderHeaderV."Sell-to Customer No.") AND (Cust."Phone No." <> '') THEN
          MailIT.AppendHTML('T: '+ Cust."Phone No.");

        MailIT.AppendHTML('<br /><br />');

        MailIT.AppendHTML(HMEText004 + '<br />');

        MailIT.AppendHTML('<br /><br />');

        MailIT.AppendHTML(CompanyInfo.Name + '<br />');
        MailIT.AppendHTML(STRSUBSTNO(HMEText007,LT_MailITSetup."Purchase Phone No. (Direct)",
          LT_MailITSetup."Purchase Fax No. (Direct)") + '<br />');
        //H2078 04.02.15 EHN +++++++++++++++++++++++++++++++++++
        IF IsSparePartOrderL THEN
          MailIT.AppendHTML('E-Mail: ' + LT_MailITSetup."SparePart Order E-Mail" + '<br /><br />')
        ELSE
          MailIT.AppendHTML('E-Mail: ' + LT_MailITSetup."Special Order E-Mail" + '<br /><br />');
        //H2078 04.02.15 EHN -----------------------------------

        MailIT.AppendHTML('<br />');
        MailIT.AppendHTML(HMEText005 + '<br />');
        MailIT.AppendHTML(HMEText006);
        MailIT.AppendHTML('<br /><br />');
        //H1671 09.01.15  FF ++++++++++++++++++++++++++
        {
        //H1671 09.01.15  FF --------------------------
        CASE PurchOrderHeaderV."Ship-to Country/Region Code" OF
          'DE' : BEGIN
            MailIT.LoadHTMLBody('C:\Mailhtml\footer_dropship mail_DE.html');
          END;
          'NL' : BEGIN
            MailIT.LoadHTMLBody('C:\Mailhtml\footer_dropship mail_NL.html');
          END;
          'FR' : BEGIN
            MailIT.LoadHTMLBody('C:\Mailhtml\footer_dropship mail_FR.html');
          END;
          'AT' : BEGIN
            MailIT.LoadHTMLBody('C:\Mailhtml\footer_dropship mail_AT.html');
          END;
          'CH' : BEGIN
            MailIT.LoadHTMLBody('C:\Mailhtml\footer_dropship mail_CH.html');
          END;
          //H1476,H1662 29.10.14  FF --------------------------
          'BE' : BEGIN
            MailIT.LoadHTMLBody('C:\Mailhtml\footer_dropship mail_BE.html');
          END;
          'IT' : BEGIN
            MailIT.LoadHTMLBody('C:\Mailhtml\footer_dropship mail_IT.html');
          END;
          //H1476,H1662 29.10.14  FF --------------------------
          ' ' : BEGIN
            MailIT.LoadHTMLBody('C:\Mailhtml\footer_dropship mail_DE.html');
          END;

        END;
        //H1671 23.01.15  FF ++++++++++++++++++++++++++
        }
        IF MailITSetupL.GET THEN BEGIN
          IF VendorL.GET(PurchOrderHeaderV."Buy-from Vendor No.") AND (VendorL."Crossborder VAT" = TRUE) AND
             PurchaseMailHTMLPathL.GET(MailITSetupL."Dropship Order Mail Code",SalesOrderHeaderV."Language Code",
                                         PurchaseMailHTMLPathL.Type::footer) THEN
            MailIT.LoadHTMLBody(PurchaseMailHTMLPathL.Path)
          ELSE
            IF PurchaseMailHTMLPathL.GET(MailITSetupL."Dropship Order Mail Code",'DEU',PurchaseMailHTMLPathL.Type::footer) THEN
              MailIT.LoadHTMLBody(PurchaseMailHTMLPathL.Path)
        END;
        //H1671 23.01.15  FF --------------------------

      ///////English Dropship Mail - End///////
      END;
      //H0979 03.04.14  FF --------------------------

      // Prepare to print it to PDF
      IF NOT MPV THEN BEGIN
        ClientPdfFileName := ClientTempFolder + '\' + DocName2 + '.pdf';
        IF ClientFso.FileExists(ClientPdfFileName) THEN
          ClientFso.DeleteFile(ClientPdfFileName);
        MailIT.PDFParameter('Output', ClientPdfFileName);
        MailIT.PDFParameter('ShowPDF', 'no');
        MailIT.PDFParameter('Title', DocName2);
        MailIT.PDFParameter('Author', USERID);
        MailIT.PDFPreparePrinter();
        //H1870, H1619 02.12.14 EHN +++++++++++++++++++++++++++
        IF NOT DefaultPrinterChanged THEN BEGIN
          IF OldDefaultPrinter = '' THEN
            OldDefaultPrinter := MailIT.GetDefaultPrinter();
          IF OldDefaultPrinter <> UserSetup."PDF Creator" THEN BEGIN
            MailIT.SetDefaultPrinter(UserSetup."PDF Creator");
            DefaultPrinterChanged := TRUE;
          END;
        END;
        //H1870, H1619 02.12.14 EHN ---------------------------
        //H1750 28.11.14 DMA +++++++++++++++++++++++
        FPCGeneralSetup.GET;
        SuppressDeliveryNoteL :=FALSE;
        //H1750 28.11.14 DMA -----------------------
        IF DropshipV THEN BEGIN
          //H1750 28.11.14 DMA +++++++++++++++++++++++
          PurchaseLineL.RESET;
          PurchaseLineL.SETRANGE("Document Type",PurchOrderHeaderV."Document Type");
          PurchaseLineL.SETRANGE("Document No.",PurchOrderHeaderV."No.");
          PurchaseLineL.SETRANGE(Type,Purchlineloc2.Type::Item);
          PurchaseLineL.SETFILTER("Purchasing Code",FPCGeneralSetup."Sup. Del. Note Channel Filter");
          ContainsChannelFromFilterL := NOT PurchaseLineL.ISEMPTY;
          SuppressDeliveryNoteL := FPCGeneralSetup."Suppress Delivery Note" AND ContainsChannelFromFilterL;
          IF NOT SuppressDeliveryNoteL THEN BEGIN
          //H1740 28.11.14 DMA -----------------------
            LR_SalesOrder.SetParameters(PurchOrderHeaderV."No.");
            LR_SalesOrder.SETTABLEVIEW(SalesOrderHeaderV);
            LR_SalesOrder.USEREQUESTFORM(FALSE);
            LR_SalesOrder.RUNMODAL;
          //H1750 28.11.14 DMA +++++++++++++++++++++++
          END;
          //H1740 28.11.14 DMA -----------------------
        END ELSE
          REPORT.RUNMODAL(ReportID,FALSE,TRUE,PurchOrderHeaderV);

        //H1750 28.11.14 DMA +++++++++++++++++++++++++++
        IF NOT SuppressDeliveryNoteL THEN BEGIN
        //H1750 28.11.14 DMA ---------------------------
          IF (MailIT.WaitForFile(ClientPdfFileName, 20000) = 0) THEN
            ERROR(Text040);
          MailIT.AddAttachment(ClientPdfFileName);
        //H1750 28.11.14 DMA +++++++++++++++++++++++++++
        END;
        //H1750 28.11.14 DMA ---------------------------
      END;

      LabelCounter := 0;
      IF PurchOrderHeaderV.Kommissionierung THEN BEGIN
        IF VendLoc.GET(PurchOrderHeaderV."Buy-from Vendor No.") THEN
          IF VendLoc."Create DS Label" THEN BEGIN
            PurchLineLoc.SETRANGE("Document Type",PurchOrderHeaderV."Document Type");
            PurchLineLoc.SETRANGE("Document No.",PurchOrderHeaderV."No.");
            PurchLineLoc.SETRANGE(Type,PurchLineLoc.Type::Item);
            //S/P0921/
            DHLSetup.GET;
            //A/P0978
            IF (PurchOrderHeaderV."Ship-to Country/Region Code" IN ['DE','']) THEN BEGIN
            //E/P0978
              DHLSetup.TESTFIELD("Filter DHL Label Chanels"); //NATIONAL
              PurchLineLoc.SETFILTER("Purchasing Code",DHLSetup."Filter DHL Label Chanels");
            END ELSE BEGIN
              DHLSetup.TESTFIELD("Filter Int. DHL Label Chanels"); //INTERNATIONAL
              PurchLineLoc.SETFILTER("Purchasing Code",DHLSetup."Filter Int. DHL Label Chanels");
            END;
            //E/P0921
            PurchLineLoc.SETFILTER("No.",'<>%1','');

            // Flag converted to the correct channel to NAV Connector adjustment
            IF PurchLineLoc.FIND('-') THEN BEGIN
              //S/P1243
              FPCGeneralSetup.GET;
              FPCGeneralSetup.TESTFIELD("Ship. Agent Code DHL");
              DPDSetup.GET;
              DPDSetup.TESTFIELD("Shipping Agent DPD");
                //H1390 25.08.14 MSL +++++++++++++++++++++++++++++++++++++
                SalesLineL.GET(SalesOrderHeaderV."Document Type",PurchLineLoc."Sales Order No.",PurchLineLoc."Sales Order Line No.");
                CASE SalesLineL."Shipping Agent Code" OF
                //H1390 25.08.14 MSL -------------------------------------
                //H1536 12.09.14 EHN +++++++++++++++++++++++++++++++++++
                FPCGeneralSetup."Ship. Agent Code DHL",'' :
                //H1536 12.09.14 EHN -----------------------------------
                  BEGIN
              //E/P1243
                    LabelCounter +=1;
                    // S/P1277
                    ClientPdfFileName := ClientTempFolder + '\DHL' + DocName +  '.pdf';
                    // E/P1277
                    IF ClientFso.FileExists(ClientPdfFileName) THEN
                      ClientFso.DeleteFile(ClientPdfFileName);
                    MailIT.PDFParameter('Output',ClientPdfFileName);
                    MailIT.PDFParameter('ShowPDF','no');
                    MailIT.PDFParameter('Title',DocName2);
                    MailIT.PDFParameter('Author',USERID);
                    //H1870 02.12.14 EHN +++++++++++++++++++++++++++
                    MailIT.PDFPreparePrinter();
                    IF NOT DefaultPrinterChanged THEN BEGIN
                      IF OldDefaultPrinter = '' THEN
                        OldDefaultPrinter := MailIT.GetDefaultPrinter();
                      IF OldDefaultPrinter <> UserSetup."PDF Creator" THEN BEGIN
                        MailIT.SetDefaultPrinter(UserSetup."PDF Creator");
                        DefaultPrinterChanged := TRUE;
                      END;
                    END;
                    //H1870 02.12.14 EHN ---------------------------
                    Purchlineloc2.RESET;
                    Purchlineloc2.SETRANGE("Document Type",PurchLineLoc."Document Type");
                    Purchlineloc2.SETRANGE("Document No.",PurchLineLoc."Document No.");
                    IF Purchlineloc2.FINDFIRST THEN
                      //H1619 31.10.14 EHN +++++++++++++++++++++++++++
                      BEGIN
                      //H1619 31.10.14 EHN ---------------------------
                        IF DropshipV THEN BEGIN
                          //S/P0921
                          IF NOT (PurchOrderHeaderV."Ship-to Country/Region Code" IN ['DE','']) THEN BEGIN
                            CLEAR(DHLPaketLabelReportINTDS);
                            DHLPaketLabelReportINTDS.SETTABLEVIEW(Purchlineloc2);
                            DHLPaketLabelReportINTDS.USEREQUESTFORM(FALSE);
                            DHLPaketLabelReportINTDS.RUNMODAL;
                          END ELSE BEGIN
                          //E/P0921
                            CLEAR(DHLPaketLabelReport);
                            DHLPaketLabelReport.SETTABLEVIEW(Purchlineloc2);
                            DHLPaketLabelReport.USEREQUESTFORM(FALSE);
                            DHLPaketLabelReport.RUNMODAL;
                          //S/P0921
                          END;
                          //E/P0921
                        END ELSE BEGIN
                          REPORT.RUNMODAL(50009,FALSE,TRUE,Purchlineloc2);
                        END;
                      //H1870,H1619 31.10.14 EHN +++++++++++++++++++++++++++
                      END;
                      //H1870,H1619 31.10.14 EHN ---------------------------
                    IF (MailIT.WaitForFile(ClientPdfFileName,20000) = 0) THEN
                      ERROR(Text040,ClientPdfFileName);
                    MailIT.AddAttachment(ClientPdfFileName);
                  END;
                //DPD Label Druck
                //S/P1243
                DPDSetup."Shipping Agent DPD" :
                  BEGIN
                    ClientPdfFileName := DPDGeneralMgt.FillDPDLabelWithData(PurchOrderHeaderV);
                    IF (MailIT.WaitForFile(ClientPdfFileName,20000) = 0) THEN
                      ERROR(Text040,ClientPdfFileName);
                    MailIT.AddAttachment(ClientPdfFileName);
                  END;
                END;
                //E/P1243
            END;
          END;
      END;
      //E/gob-rste/09.05.12/GOB1.00

      CreateOrderCSV(PurchOrderHeaderV,TempSalesHeader,ClientTempFolder,MPV,DropshipV);
      MailIT.AddAttachment(ClientTempFolder + '\order.csv');

      //H0575 24.10.13 ARU +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
      IF NOT DropshipV THEN BEGIN
        MailIT.AddAttachment('C:\MailAtt\Lagerbestellung\Home24_Avisierung_Richtlinien.pdf');
        MailIT.AddAttachment('C:\MailAtt\Lagerbestellung\Home24_Delivery_Notification_Guidelines.pdf');
      END;
      //H0575 24.10.13 ARU -------------------------------------------------------------------------------------------------

      // Restore the user's default printer selection
      IF DefaultPrinterChanged THEN
        MailIT.SetDefaultPrinter(OldDefaultPrinter);

      IF SendMailDirect THEN BEGIN
        MailIT.SetServer(LT_MailITSetup."Mail Server");
        IF LT_MailITSetup."Server Port" = '' THEN
          L_Port := 25
        ELSE
          EVALUATE(L_Port,LT_MailITSetup."Server Port");
        MailIT.SetPort(L_Port);
        //H0709 30.01.14 MBY +++++++++++++
        IF LT_MailITSetup.Authentication THEN BEGIN
        //H0709 30.01.14 MBY -------------
          IF DropshipV THEN BEGIN
            MailIT.SetLogin(LT_MailITSetup."User Name (Direct)");
            MailIT.SetPassword(LT_MailITSetup."Password (Direct)");
          END ELSE BEGIN
            MailIT.SetLogin(LT_MailITSetup."User Name (Location)");
            MailIT.SetPassword(LT_MailITSetup."Password (Location)");
          END;
        //H0709 30.01.14 MBY +++++++++++++
        END;
        //H0709 30.01.14 MBY -------------
        MailIT.Send;
      END ELSE
        MailIT.Display;

      //H2108 10.02.15 DMO +++++++++++++++++++++++++++++++++++
      PurchHeader.GET(PurchOrderHeaderV."Document Type",PurchOrderHeaderV."No.");
      PurchHeader."No. of Sent POs" += 1;
      PurchHeader.MODIFY;
      //H2108 10.02.15 DMO -----------------------------------

      // Remove the temporary folder and its content.
      // If you use MAPI and Thunderbird or other MAPI email clients the they may require that
      // the image files remain on the disk until the mail is sent.
      IF FORMAT(UserSetup."Mail Client") <> 'MAPI' THEN
        IF ClientFso.FolderExists(ClientTempFolder) THEN
          ClientFso.DeleteFolder(ClientTempFolder, FALSE);
      CLEAR(ClientFso);
      CLEAR(ClientUtil);
      CLEAR(DivUtil);
    END;

    PROCEDURE CreateSalesInvMail@1000000003(_SalesInvHeader@1000000030 : Record 112);
    VAR
      WebsiteNo@1100409007 : Integer;
      LT_MailITSetup@1000000028 : Record 75402;
      LT_WebSiteTransfer@1000000034 : Record 50033;
      LT_WebSource@1000000026 : Record 5059;
      LT_Location@1000000044 : Record 14;
      LT_LabelDHL@1000000045 : Record 50020;
      LR_SalesOrder@1000000050 : Report 50020;
      FormatAddr@1000000023 : Codeunit 365;
      ClientFso@1000000005 : Automation "{420B2830-E718-11CF-893D-00A0C9054228} 1.0:{0D43FE01-F093-11CF-8940-00A0C9054228}:'Microsoft Scripting Runtime'.FileSystemObject";
      ClientUtil@1000000003 : Automation "{1639594D-2135-4248-BE9B-FB55210F8AD8} 1.0:{D7CD856D-3889-4F19-BBBA-7608CF34EFB6}:'ExpandIT Dynamics Role Tailored Client Utility'.Utility";
      DivUtil@1000000054 : Automation "{2CD8D481-009C-4685-98EA-BC16452327B2} 1.0:{F1BBE10B-6E48-41B0-9EF6-F428C7A48655}:'Dynovus_SHA1Encryption'.SHA1EncryptAutomation";
      MailIT@1000000006 : OCX "{C8C4804C-89BA-4291-AB58-4C6050B65175}:'ExpandIT.MailIT2'";
      ShipAddr@1000000012 : ARRAY [8] OF Text[80];
      MailText@1000000032 : Text[250];
      DocName@1000000016 : Text[250];
      DocName2@1000000021 : Text[250];
      JobID@1000000007 : Text[50];
      ClientTempFolder@1000000004 : Text[250];
      ClientPdfFileName@1000000015 : Text[250];
      ClientFileName@1000000022 : Text[250];
      OldDefaultPrinter@1000000013 : Text[250];
      DefaultPrinterChanged@1000000014 : Boolean;
      ReportID@1000000001 : Integer;
      L_Text001@1000000002 : TextConst 'DEU=Vielen Dank fÅr Ihre Bestellung Nr.:;ENU=Order No.:;FRA=Merci pour votre commande n¯:;NLD=Bedankt voor uw bestelling nummer:';
      L_Text010@1000000010 : TextConst 'DEU=Sehr geehrte(r) %1,';
      L_Text010a@1000000063 : TextConst 'DEU=Sehr geehrte Damen und Herren,';
      L_Text016@1000000025 : TextConst 'DEU=Vielen Dank fÅr die Zusammenarbeit mit %1 !';
      L_Text017@1000000027 : TextConst 'DEU=Mit freundlichen GrÅ·en;FRA=Cordialement,;NLD=Met vriendelijke groet,';
      L_Text018@1000000033 : TextConst 'DEU=Tel: %1 | Fax: %2';
      L_TextI001@1000000035 : TextConst 'DEU=Impressum';
      L_TextI002@1000000036 : TextConst 'DEU=Eingetragen beim %1';
      L_TextI004@1000000038 : TextConst 'DEU=USt-ID: %1';
      L_TextI005@1000000039 : TextConst 'DEU=GeschÑftsfÅhrer %1, %2';
      L_TextI006@1000000040 : TextConst 'DEU=(Montag - Freitag 09:00 - 18:00 Uhr)';
      Text040@1000000019 : TextConst 'DAN=Der blev ikke dannet et PDF-dokument.;DEU=Es wurde kein PDF Dokument erzeugt.;ENU=No PDF Document was generated.;ESP=No se gener¢ ning£n documento PDF.;FRA=Aucun document PDF n''a ÇtÇ crÇÇ.;SVE=Inget PDF-dokument skapades.';
      LinkID@1000000043 : Code[10];
      L_MaxKW@1000000061 : Text[10];
      L_Hash@1000000062 : Text[250];
      L_Text011@1108200000 : TextConst 'DEU=anbei erhalten Sie Ihre Rechnung %1.';
      port@1108200001 : Integer;
      L_Port@1108200002 : Integer;
      GOBTextLoc001@1108200003 : TextConst 'DEU=Liebe/r Kunde/in,;FRA=Cher client / Chäre cliente,;NLD=Geachte klant,';
      GOBTextLoc002@1108200004 : TextConst 'DEU=herzlichen Dank fÅr Ihre Bestellung.;FRA=Nous vous remercions pour votre commande et vous transmettons la facture pour celle-ci;NLD=Bedankt voor uw bestelling.';
      GOBTextLoc003@1108200005 : TextConst 'DEU=Anbei erhalten Sie Ihre Rechnung Nr. %1.;FRA=(facture n¯ %1).;NLD=Hierbij ontvangt u uw rekening, nummer %1.';
      GOBTextLoc004@1108200006 : TextConst 'DEU=Vielen Dank fÅr Ihren Einkauf bei uns und viel Spa· mit den Produkten von home24.de!;FRA=Nous espÇrons que vous avez ÇtÇ satisfait du service de Home24 ainsi que de l''article commandÇ et espÇrons vous revoir bientìt sur hom24.fr !;NLD=Nogmaals dank voor uw aankoop bij ons en veel plezier met de produkten van home24.nl!';
      oldgloballang@1000000000 : Integer;
      GOBTextLoc005@1000000008 : TextConst 'DEU=_Rechnung_;FRA=_facture_;NLD=_rekening_';
      "***** H0067 ******"@1100409000 : Integer;
      MtLanguageCode@1100409006 : Code[10];
      TextConst@1100409005 : Integer;
      TableName@1100409004 : 'Standard Text,G/L Account,Item,Resource,,,,,,,Nonstock Item';
      LanguageCode@1100409003 : Code[10];
      TextType@1100409002 : 'Subject,Text';
      NoCode@1100409001 : Code[20];
    BEGIN
      //A/temp
      SendMailDirect := TRUE;
      //E/temp

      LT_MailITSetup.GET;
      //A/gob-rste/26.06.12/P0044
      //LT_MailITSetup.TESTFIELD("Sales E-Mail");
      //H0709 28.11.13 MBY +++++++++++++
      IF LT_MailITSetup."Authentication Home24" THEN BEGIN
      //H0709 28.11.13 MBY -------------
        LT_MailITSetup.TESTFIELD("User Name Home24 (Invoice)");
        LT_MailITSetup.TESTFIELD("Password Home24 (Invoice)");
      //H0709 28.11.13 MBY +++++++++++++
      END;
      //H0709 28.11.13 MBY -------------
      LT_MailITSetup.TESTFIELD("Invoice E-Mail Home24");
      LT_MailITSetup.TESTFIELD("Invoice E-Mail Home24 BCC");
      //H0135 02.01.13 ARU ++++++++++++++++++++
      LT_MailITSetup.TESTFIELD("MailText DEU");
      //H0135 02.01.13 ARU --------------------

      //A/p0237
      LT_MailITSetup.TESTFIELD("HTML Path Footer DEU");
      LT_MailITSetup.TESTFIELD("HTML Path Header DEU");
      //H0135 02.01.13 ARU +++++++++++++++++++++++++++++++
      {
      //H0135 02.01.13 ARU -------------------------------
      LT_MailITSetup.TESTFIELD("Invoice EMail Sender FR");
      LT_MailITSetup.TESTFIELD("Invoice EMail Sender NL");
      LT_MailITSetup.TESTFIELD("HTML Path Header FR");
      LT_MailITSetup.TESTFIELD("HTML Path Footer FR");
      LT_MailITSetup.TESTFIELD("HTML Path Footer NL");
      LT_MailITSetup.TESTFIELD("HTML Path Header NL");
      //H0135 02.01.13 ARU +++++++++++++++++++++++++++++++
      }
      //H0135 02.01.13 ARU -------------------------------

      //E/p0237
      //E/gob-rste/26.06.12/P0044
      //A/gob-mab/29.06.12/gob1.06/p0039
      LT_MailITSetup.TESTFIELD("Mail Server Home24");
      LT_MailITSetup.TESTFIELD("Server Port Home24");
      //E/gob-mab/29.06.12/gob1.06/p0039

      //H0135 02.01.13 ARU +++++++++++++++++++++++++++++++++++
      IF LT_MailITSetup."Enable Sales Invoice - FRA" THEN BEGIN
        LT_MailITSetup.TESTFIELD("MailText FRA");
        LT_MailITSetup.TESTFIELD("HTML Path Header FR");
        LT_MailITSetup.TESTFIELD("HTML Path Footer FR");
        //H0709 28.11.13 MBY +++++++++++++
        IF LT_MailITSetup."Authentication Home24" THEN BEGIN
        //H0709 28.11.13 MBY -------------
          LT_MailITSetup.TESTFIELD("Invoice EMail Sender FR");
          LT_MailITSetup.TESTFIELD("Invoice EMail Password FR");
        //H0709 28.11.13 MBY +++++++++++++
        END;
        //H0709 28.11.13 MBY -------------
      END;

      IF LT_MailITSetup."Enable Sales Invoice - NL" THEN BEGIN
        LT_MailITSetup.TESTFIELD("MailText NL");
        LT_MailITSetup.TESTFIELD("HTML Path Footer NL");
        LT_MailITSetup.TESTFIELD("HTML Path Header NL");
        //H0709 28.11.13 MBY +++++++++++++
        IF LT_MailITSetup."Authentication Home24" THEN BEGIN
        //H0709 28.11.13 MBY -------------
          LT_MailITSetup.TESTFIELD("Invoice EMail Sender NL");
          LT_MailITSetup.TESTFIELD("Invoice EMail Password NL");
        //H0709 28.11.13 MBY +++++++++++++
        END;
        //H0709 28.11.13 MBY -------------
      END;

      IF LT_MailITSetup."Enable Sales Invoice - AUT" THEN BEGIN
        LT_MailITSetup.TESTFIELD("HTML Path Footer AUT");
        LT_MailITSetup.TESTFIELD("HTML Path Header AUT");
        LT_MailITSetup.TESTFIELD("MailText AUT");
        //H0709 28.11.13 MBY +++++++++++++
        IF LT_MailITSetup."Authentication Home24" THEN BEGIN
        //H0709 28.11.13 MBY -------------
          LT_MailITSetup.TESTFIELD("Invoice EMail Password AUT");
          LT_MailITSetup.TESTFIELD("Invoice EMail Sender AUT");
        //H0709 28.11.13 MBY +++++++++++++
        END;
        //H0709 28.11.13 MBY -------------
      END;
      //H0135 02.01.13 ARU -----------------------------------

      //A/p0237
      //Sprache merken
      oldgloballang := GLOBALLANGUAGE;
      //E/p0237

      UserSetup.GET(USERID);
      UserSetup.TESTFIELD("PDF Creator");

      _SalesInvHeader.SETRECFILTER;

      // H0372       02.07.13    FX ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
      IF _SalesInvHeader."Website No." = 0 THEN BEGIN
        SalesHeader.SETRANGE("No.", _SalesInvHeader."Order No.");
        IF SalesHeader.FINDSET THEN BEGIN
          WebsiteNo := SalesHeader."Website No.";
        END ELSE BEGIN
          SalesHeaderArc.SETRANGE("No.", _SalesInvHeader."Order No.");
          IF SalesHeaderArc.FINDSET THEN BEGIN
            WebsiteNo := SalesHeaderArc."Website No.";
          END;
        END;
      END ELSE BEGIN
        WebsiteNo := _SalesInvHeader."Website No.";
      END;
      // //_SalesInvHeader.CALCFIELDS("Website No.");
      // LT_WebSiteTransfer.SETRANGE("Website No.",_SalesInvHeader."Website No.");
      // H0372       02.07.13    FX ------------------------------------------------------------------------------------------------------

      LT_WebSiteTransfer.SETRANGE("Website No.",WebsiteNo);
      LT_WebSiteTransfer.FINDLAST;
      LT_WebSiteTransfer.CALCFIELDS("Website Name");

      //H0067 30.01.12 ARU Standard Text Codes for E-Mailing Process (FRA & NL) +++++++++++++++++++++++++++++++++++++++++++++++++++++
      //A/p0237
      //Sprache setzen fÅr Textvariablen
      // ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
      {
      IF (_SalesInvHeader."Language Code" = 'DEU') OR (_SalesInvHeader."Language Code" = '') THEN
        GLOBALLANGUAGE(1031);
      IF _SalesInvHeader."Language Code" = 'NLD' THEN
        GLOBALLANGUAGE(1043);
      IF _SalesInvHeader."Language Code" = 'FRA' THEN
        GLOBALLANGUAGE(1036);
      }
      //E/p0237
      // ----------------------------------------------------------------------------------------

      //H0135 02.01.13 ARU ++++++++++++++++++++
      {
      //H0135 02.01.13 ARU --------------------
      LT_MailITSetup.TESTFIELD("MailText DEU");
      LT_MailITSetup.TESTFIELD("MailText FRA");
      LT_MailITSetup.TESTFIELD("MailText NL");
      //H0135 02.01.13 ARU ++++++++++++++++++++
      }
      //H0135 02.01.13 ARU --------------------

      //H0135 02.01.13 ARU ++++++++++++++++++++++++++++++++++++
      IF _SalesInvHeader."Language Code" = 'DEA' THEN BEGIN
        MailTextLanguageCode := LT_MailITSetup."MailText AUT";
        LanguageCode := 'DEA';
        Add2Filename := '_Rechnung_';

        IF NOT LT_MailITSetup."Enable Sales Invoice - AUT" THEN
          EXIT;
      END;
      //H0135 02.01.13 ARU ------------------------------------

      IF (_SalesInvHeader."Language Code" = 'DEU') OR (_SalesInvHeader."Language Code" = '') THEN BEGIN
        MailTextLanguageCode := LT_MailITSetup."MailText DEU";
        LanguageCode := 'DEU';
        Add2Filename := '_Rechnung_'
      END;

      IF _SalesInvHeader."Language Code" = 'NLD' THEN BEGIN
        MailTextLanguageCode := LT_MailITSetup."MailText NL";
        LanguageCode := 'NLD';
        Add2Filename := '_rekening_';
      //H0073 05.11.12 ARU Send SalesInvoice only if LanguageCode is enabled +++++++++++++++++++++++++++
        IF NOT LT_MailITSetup."Enable Sales Invoice - NL" THEN
          EXIT;
      //H0073 05.11.12 ARU Send SalesInvoice only if LanguageCode is enabled ---------------------------
      END;

      IF _SalesInvHeader."Language Code" = 'FRA' THEN BEGIN
        MailTextLanguageCode := LT_MailITSetup."MailText FRA";
        LanguageCode := 'FRA';
        Add2Filename := '_facture_';
      //H0073 05.11.12 ARU Send SalesInvoice only if LanguageCode is enabled +++++++++++++++++++++++++++
        IF NOT LT_MailITSetup."Enable Sales Invoice - FRA" THEN
          EXIT;
      //H0073 05.11.12 ARU Send SalesInvoice only if LanguageCode is enabled ---------------------------
      END;

      //MailText := LT_WebSiteTransfer."Website Name" +': '+ L_Text001 +' '+ _SalesInvHeader."External Document No.";
      DocName := LT_WebSiteTransfer."Website Name" + Add2Filename + _SalesInvHeader."No.";

      ExtTextLines.RESET;
      ExtTextLines.SETRANGE("Table Name",ExtTextLines."Table Name"::"Standard Text");
      ExtTextLines.SETRANGE("No.",MailTextLanguageCode);
      ExtTextLines.SETRANGE("Language Code",LanguageCode);
      ExtTextLines.SETRANGE("Text No.",1);

      //A/p0237
      //DocName := LT_WebSiteTransfer."Website Name" + '_Rechnung_' +  _SalesInvHeader."No.";
      //DocName := LT_WebSiteTransfer."Website Name" + GOBTextLoc005 +  _SalesInvHeader."No.";
      //E/p0237
      //H0067 30.01.12 ARU Standard Text Codes for E-Mailing Process (FRA & NL) -----------------------------------------------------

      ReportID := 50021;

      CREATE(ClientFso,TRUE,TRUE);
      CREATE(ClientUtil,TRUE,TRUE);
      CREATE(DivUtil,TRUE,TRUE);
      JobID := MailIT.CreateGUID();

      // Get folder for temporary files on the client
      ClientTempFolder := ClientUtil.GetTempPath();
      IF ClientTempFolder = '' THEN
        ERROR('Unable to create the path of the temporary folder.');
      ClientTempFolder := ClientTempFolder + 'ExpMail';
      IF NOT ClientFso.FolderExists(ClientTempFolder) THEN
        ClientFso.CreateFolder(ClientTempFolder);
      ClientTempFolder := ClientTempFolder + '\' + JobID;
      IF NOT ClientFso.FolderExists(ClientTempFolder) THEN
        ClientFso.CreateFolder(ClientTempFolder);

      // Locate bill to customer
      Cust.GET(_SalesInvHeader."Sell-to Customer No.");
      CompanyInfo.GET;

      // Initialize the email
      IF SendMailDirect THEN
        MailIT.SetService('SMTP')
      ELSE
        MailIT.SetService(FORMAT(UserSetup."Mail Client"));
      //A/gob-rste/26.06.12/P0044
      //MailIT.SetFrom(LT_MailITSetup."Accounting E-Mail");
      //A/p0237
      IF (_SalesInvHeader."Language Code" = 'DEU') OR (_SalesInvHeader."Language Code" = '') THEN
        MailIT.SetFrom(LT_MailITSetup."Invoice E-Mail Home24");

      IF _SalesInvHeader."Language Code" = 'NLD' THEN
        MailIT.SetFrom(LT_MailITSetup."Invoice EMail Sender NL");

      IF _SalesInvHeader."Language Code" = 'FRA' THEN
        MailIT.SetFrom(LT_MailITSetup."Invoice EMail Sender FR");
      //E/p0237

      //H0135 02.01.13 ARU ++++++++++++++++++++++++++++++++++++++++
      IF _SalesInvHeader."Language Code" = 'DEA' THEN
        MailIT.SetFrom(LT_MailITSetup."Invoice EMail Sender AUT");
      //H0135 02.01.13 ARU ----------------------------------------

      //E/gob-rste/26.06.12/P0044

      IF NOT LT_MailITSetup."Test Mode" THEN
        //A/gob-rste/26.06.12/P0044
        //MailIT.AddRecipientBCC(LT_MailITSetup."Accounting E-Mail",LT_MailITSetup."Accounting E-Mail")
        MailIT.AddRecipientBCC(LT_MailITSetup."Invoice E-Mail Home24 BCC",LT_MailITSetup."Invoice E-Mail Home24 BCC")
        //E/gob-rste/26.06.12/P0044
      ELSE
        MailIT.AddRecipientBCC(LT_MailITSetup."Test E-Mail BCC",LT_MailITSetup."Test E-Mail BCC");

      IF NOT LT_MailITSetup."Test Mode" THEN BEGIN
        Cust.TESTFIELD("E-Mail");
        IF Cust."E-Mail" <> '' THEN
          MailIT.AddRecipient(Cust."E-Mail",Cust."E-Mail");
      END ELSE
        MailIT.AddRecipient(LT_MailITSetup."Test E-Mail",LT_MailITSetup."Test E-Mail");


      // Add some HTML to the mail body
      //A/p0237
      IF (_SalesInvHeader."Language Code" = 'DEU') OR (_SalesInvHeader."Language Code" = '') THEN
      //MailIT.LoadHTMLBody('C:\Mailhtml\header.html');
        MailIT.LoadHTMLBody(LT_MailITSetup."HTML Path Header DEU");

      IF _SalesInvHeader."Language Code" = 'NLD' THEN
        MailIT.LoadHTMLBody(LT_MailITSetup."HTML Path Header NL");

      IF _SalesInvHeader."Language Code" = 'FRA' THEN
        MailIT.LoadHTMLBody(LT_MailITSetup."HTML Path Header FR");
      //E/p0237

      //H0135 02.01.13 ARU ++++++++++++++++++++++++++++++++++++++++
      IF _SalesInvHeader."Language Code" = 'DEA' THEN
        MailIT.LoadHTMLBody(LT_MailITSetup."HTML Path Header AUT");
      //H0135 02.01.13 ARU ----------------------------------------

      MailIT.AppendHTML('<br /><br />');

      //A/P0305
      //MailIT.AppendHTML('<table width=744 border=0>');
      MailIT.AppendHTML('<table width=590 border=0>');
      //E/P0305
      //A/gob-rste/24.07.12/GOB1.09
      //IF _SalesInvHeader."Sell-to Contact" <> '' THEN
        //MailIT.AppendHTML(STRSUBSTNO(L_Text010,_SalesInvHeader."Sell-to Contact") + '<br /><br />')
      //ELSE
        //MailIT.AppendHTML(STRSUBSTNO(L_Text010a) + '<br /><br />');

      //H0548 10.01.13 ARU ++++++++++
      MailIT.AppendHTML(TEXT0003HME);
      //H0548 10.01.13 ARU ----------

      //H0067 30.01.12 ARU Standard Text Codes for E-Mailing Process (FRA & NL) +++++++++++++++++++++++++++++++++++++++++++
      IF ExtTextLines.FIND('-') THEN REPEAT
        TxtStr   := ExtTextLines."Text (Long)";
        Position := STRPOS(TxtStr,'[');
         IF Position = 1 THEN BEGIN
           TXtType := COPYSTR(TxtStr,Position+1,STRPOS(TxtStr,']')-2);
           IF TXtType = 'Subject' THEN BEGIN
             TxtStr := STRSUBSTNO(DELSTR(ExtTextLines."Text (Long)",
                                  1,STRPOS(ExtTextLines."Text (Long)",']')),_SalesInvHeader."External Document No.") + ' ';
             SubjectTxtStr := SubjectTxtStr + TxtStr;
           END;
         END ELSE BEGIN
           TxtStr := STRSUBSTNO(DELSTR(ExtTextLines."Text (Long)",1,STRPOS(ExtTextLines."Text (Long)",']')),
                                _SalesInvHeader."No.");
           IF TxtStr = '' THEN
             TxtStr := '<br /><br />';
           MailIT.AppendHTML(TxtStr);
         END;
      UNTIL ExtTextLines.NEXT = 0;

      //H0548 10.01.13 ARU +++++++++++++++++++++++++++++++++++++++++++++++++++++++++
      //MailIT.SetSubject(LT_WebSiteTransfer."Website Name" + ': ' + SubjectTxtStr);
      MailIT.SetSubject(SubjectTxtStr);
      //H0548 10.01.13 ARU ---------------------------------------------------------

      //MailIT.AppendHTML(STRSUBSTNO(GOBTextLoc001) + '<br /><br />');
      //MailIT.AppendHTML(STRSUBSTNO(GOBTextLoc002) + '<br /><br />');
      //MailIT.AppendHTML(STRSUBSTNO(L_Text011,_SalesInvHeader."No.") + '<br /><br />');
      //MailIT.AppendHTML(STRSUBSTNO(GOBTextLoc003,_SalesInvHeader."No.") + '<br /><br />');
      //MailIT.AppendHTML(STRSUBSTNO(GOBTextLoc004) + '<br /><br />');
      //MailIT.AppendHTML(STRSUBSTNO(L_Text016,'Home24.de') + '<br />');
      //MailIT.AppendHTML(L_Text017 + '<br /><br />');
      //E/gob-rste/24.07.12/GOB1.09
      //H0067 30.01.12 ARU Standard Text Codes for E-Mailing Process (FRA & NL) -------------------------------------------


      // read footer file
      //A/p0237
      IF (_SalesInvHeader."Language Code" = 'DEU') OR (_SalesInvHeader."Language Code" = '') THEN
      //MailIT.LoadHTMLBody('C:\Mailhtml\footer.html');
        MailIT.LoadHTMLBody(LT_MailITSetup."HTML Path Footer DEU");

      IF _SalesInvHeader."Language Code" = 'NLD' THEN
        MailIT.LoadHTMLBody(LT_MailITSetup."HTML Path Footer NL");

      IF _SalesInvHeader."Language Code" = 'FRA' THEN
        MailIT.LoadHTMLBody(LT_MailITSetup."HTML Path Footer FR");
      //E/p0237

      //H0135 02.01.13 ARU +++++++++++++++++++++++++++++++++++++++
      IF _SalesInvHeader."Language Code" = 'DEA' THEN
        MailIT.LoadHTMLBody(LT_MailITSetup."HTML Path Footer AUT");
      //H0135 02.01.13 ARU ---------------------------------------


      // Prepare to print it to PDF
      ClientPdfFileName := ClientTempFolder + '\' + DocName + '.pdf';
      IF ClientFso.FileExists(ClientPdfFileName) THEN
        ClientFso.DeleteFile(ClientPdfFileName);
      MailIT.PDFParameter('Output',ClientPdfFileName);
      MailIT.PDFParameter('ShowPDF','no');
      MailIT.PDFParameter('Title',DocName);
      MailIT.PDFParameter('Author',USERID);
      MailIT.PDFPreparePrinter();
      IF NOT DefaultPrinterChanged THEN BEGIN
        IF OldDefaultPrinter = '' THEN
          OldDefaultPrinter := MailIT.GetDefaultPrinter();
        IF OldDefaultPrinter <> UserSetup."PDF Creator" THEN BEGIN
          MailIT.SetDefaultPrinter(UserSetup."PDF Creator");
          DefaultPrinterChanged := TRUE;
        END;
      END;

      REPORT.RUNMODAL(ReportID,FALSE,TRUE,_SalesInvHeader);
      IF (MailIT.WaitForFile(ClientPdfFileName,20000) = 0) THEN
        ERROR(Text040 + '2');
      MailIT.AddAttachment(ClientPdfFileName);

      // Restore the user's default printer selection
      IF DefaultPrinterChanged THEN
        MailIT.SetDefaultPrinter(OldDefaultPrinter);

      // chrmu MailIT.Display();
      SendMailDirect := TRUE;
      // chrmu
      IF SendMailDirect THEN BEGIN
        //A/gob-mab/29.06.12/gob1.06/p0039
        //MailIT.SetServer(LT_MailITSetup."Mail Server");
        MailIT.SetServer(LT_MailITSetup."Mail Server Home24");
        //E/gob-mab/29.06.12/gob1.06/p0039

        //A/gob-mab/29.06.12/gob1.06/p0039
        //IF LT_MailITSetup."Server Port" = '' THEN
        IF LT_MailITSetup."Server Port Home24" = '' THEN
        //E/gob-mab/29.06.12/gob1.06/p0039
          L_Port := 25
        ELSE
          //A/gob-mab/29.06.12/gob1.06/p0039
          //EVALUATE(L_Port,LT_MailITSetup."Server Port");
          EVALUATE(L_Port,LT_MailITSetup."Server Port Home24");
          //E/gob-mab/29.06.12/gob1.06/p0039

        MailIT.SetPort(L_Port);
        //A/gob-rste/26.06.12/P0044
        //MailIT.SetLogin(LT_MailITSetup."User Name (General)");
        //MailIT.SetPassword(LT_MailITSetup."Password (General)");
        //H0709 28.11.13 MBY +++++++++++++
        IF LT_MailITSetup."Authentication Home24" THEN BEGIN
        //H0709 28.11.13 MBY -------------
          //A/gob-mab/03.07.12/gob1.07
          MailIT.UseSSL(1);
          //E/gob-mab/03.07.12/gob1.07
          //A/p0237
          IF (_SalesInvHeader."Language Code" = 'DEU') OR (_SalesInvHeader."Language Code" = '') THEN BEGIN
            MailIT.SetLogin(LT_MailITSetup."User Name Home24 (Invoice)");
            MailIT.SetPassword(LT_MailITSetup."Password Home24 (Invoice)");
          END;

          IF _SalesInvHeader."Language Code" = 'NLD' THEN BEGIN
            MailIT.SetLogin(LT_MailITSetup."Invoice EMail Sender NL");
            MailIT.SetPassword(LT_MailITSetup."Invoice EMail Password NL");
          END;

          IF _SalesInvHeader."Language Code" = 'FRA' THEN BEGIN
            MailIT.SetLogin(LT_MailITSetup."Invoice EMail Sender FR");
            MailIT.SetPassword(LT_MailITSetup."Invoice EMail Password FR");
          END;
          //E/P0237

          //H0135 02.01.13 ARU +++++++++++++++++++++++++++++++++++++++
          IF _SalesInvHeader."Language Code" = 'DEA' THEN BEGIN
            MailIT.SetLogin(LT_MailITSetup."Invoice EMail Sender AUT");
            MailIT.SetPassword(LT_MailITSetup."Invoice EMail Password AUT");
          END;
          //H0135 02.01.13 ARU ---------------------------------------
        //H0709 28.11.13 MBY +++++++++++++
        END;
        //H0709 28.11.13 MBY -------------
        //E/gob-rste/26.06.12/P0044
        MailIT.Send();
      END ELSE
        MailIT.Display();

      //A/p0237
      // Language again changed back
      GLOBALLANGUAGE(oldgloballang);
      //E/p0237
      // Remove the temporary folder and its content.
      // If you use MAPI and Thunderbird or other MAPI email clints the they may require that
      // the image files remain on the disk until the mail is sent.
      IF FORMAT(UserSetup."Mail Client") <> 'MAPI' THEN
        IF ClientFso.FolderExists(ClientTempFolder) THEN
          ClientFso.DeleteFolder(ClientTempFolder, FALSE);
      CLEAR(ClientFso);
      CLEAR(ClientUtil);
      CLEAR(DivUtil);
    END;

    PROCEDURE CreateSalesCrMemoMail@1000000005(_SalesCrMemoHeader@1000000030 : Record 114);
    VAR
      LT_MailITSetup@1000000028 : Record 75402;
      LT_WebSiteTransfer@1000000034 : Record 50033;
      LT_WebSource@1000000026 : Record 5059;
      LT_Location@1000000044 : Record 14;
      LT_LabelDHL@1000000045 : Record 50020;
      LR_SalesOrder@1000000050 : Report 50020;
      FormatAddr@1000000023 : Codeunit 365;
      ClientFso@1000000005 : Automation "{420B2830-E718-11CF-893D-00A0C9054228} 1.0:{0D43FE01-F093-11CF-8940-00A0C9054228}:'Microsoft Scripting Runtime'.FileSystemObject";
      ClientUtil@1000000003 : Automation "{1639594D-2135-4248-BE9B-FB55210F8AD8} 1.0:{D7CD856D-3889-4F19-BBBA-7608CF34EFB6}:'ExpandIT Dynamics Role Tailored Client Utility'.Utility";
      DivUtil@1000000054 : Automation "{2CD8D481-009C-4685-98EA-BC16452327B2} 1.0:{F1BBE10B-6E48-41B0-9EF6-F428C7A48655}:'Dynovus_SHA1Encryption'.SHA1EncryptAutomation";
      MailIT@1000000006 : OCX "{C8C4804C-89BA-4291-AB58-4C6050B65175}:'ExpandIT.MailIT2'";
      ShipAddr@1000000012 : ARRAY [8] OF Text[80];
      MailText@1000000032 : Text[250];
      DocName@1000000016 : Text[250];
      DocName2@1000000021 : Text[250];
      JobID@1000000007 : Text[50];
      ClientTempFolder@1000000004 : Text[250];
      ClientPdfFileName@1000000015 : Text[250];
      ClientFileName@1000000022 : Text[250];
      OldDefaultPrinter@1000000013 : Text[250];
      DefaultPrinterChanged@1000000014 : Boolean;
      ReportID@1000000001 : Integer;
      L_Text001@1000000002 : TextConst 'DEU=Vielen Dank fÅr Ihre Bestellung Nr.:;ENU=Order No.:';
      L_Text002@1000000000 : TextConst 'DEU=Gutschrift;ENU=Gutschrift';
      L_Text010@1000000010 : TextConst 'DEU=Sehr geehrte(r) %1,';
      L_Text010a@1000000063 : TextConst 'DEU=Sehr geehrte Damen und Herren,';
      L_Text016@1000000025 : TextConst 'DEU=Vielen Dank fÅr die Zusammenarbeit mit %1 !';
      L_Text017@1000000027 : TextConst 'DEU=Mit freundlichen GrÅ·en';
      L_Text018@1000000033 : TextConst 'DEU=Tel: %1 | Fax: %2';
      L_TextI001@1000000035 : TextConst 'DEU=Impressum';
      L_TextI002@1000000036 : TextConst 'DEU=Eingetragen beim %1';
      L_TextI004@1000000038 : TextConst 'DEU=USt-ID: %1';
      L_TextI005@1000000039 : TextConst 'DEU=GeschÑftsfÅhrer %1, %2';
      L_TextI006@1000000040 : TextConst 'DEU=(Montag - Freitag 09:00 - 18:00 Uhr)';
      Text040@1000000019 : TextConst 'DAN=Der blev ikke dannet et PDF-dokument.;DEU=Es wurde kein PDF Dokument erzeugt.;ENU=No PDF Document was generated.;ESP=No se gener¢ ning£n documento PDF.;FRA=Aucun document PDF n''a ÇtÇ crÇÇ.;SVE=Inget PDF-dokument skapades.';
      LinkID@1000000043 : Code[10];
      L_MaxKW@1000000061 : Text[10];
      L_Hash@1000000062 : Text[250];
      L_Port@1000000008 : Integer;
      L_FPCGenSetup@1000000009 : Record 50055;
      WebsiteNo@1100409000 : Integer;
    BEGIN
      LT_MailITSetup.GET;
      LT_MailITSetup.TESTFIELD("Sales E-Mail");

      UserSetup.GET(USERID);
      UserSetup.TESTFIELD("PDF Creator");
      L_FPCGenSetup.GET;

      // H0355 >>
      //_SalesCrMemoHeader.TESTFIELD("Website No.");
      IF _SalesCrMemoHeader."Website No." = 0 THEN BEGIN
        SalesHeader.SETRANGE("No.", _SalesCrMemoHeader."External Document No.");
        IF SalesHeader.FIND('-') THEN BEGIN
          WebsiteNo := SalesHeader."Website No.";
        END ELSE BEGIN
          SalesHeaderArc.SETRANGE("No.", _SalesCrMemoHeader."External Document No.");
          IF SalesHeaderArc.FIND('-') THEN BEGIN
            WebsiteNo := SalesHeaderArc."Website No.";
          END;
        END;
      END ELSE
        WebsiteNo := _SalesCrMemoHeader."Website No.";
      // H0355 <<


      IF ((_SalesCrMemoHeader."Language Code" = 'DEU') OR (_SalesCrMemoHeader."Language Code" = '')) AND
         L_FPCGenSetup."Enable S. Credit M. Mail - DE" THEN BEGIN
        LT_MailITSetup.TESTFIELD("HTML Path Footer DEU");
        LT_MailITSetup.TESTFIELD("HTML Path Header DEU");
        L_FPCGenSetup.TESTFIELD("Credit Memo MailText DE");
      END;

      IF (_SalesCrMemoHeader."Language Code" = 'NLD') AND L_FPCGenSetup."Enable S. Credit M. Mail - NL" THEN BEGIN
        LT_MailITSetup.TESTFIELD("HTML Path Footer NL");
        LT_MailITSetup.TESTFIELD("HTML Path Header NL");
        L_FPCGenSetup.TESTFIELD("Credit Memo MailText NL");
      END;

      IF (_SalesCrMemoHeader."Language Code" = 'FRA') AND L_FPCGenSetup."Enable S. Credit M. Mail - FR" THEN BEGIN
        LT_MailITSetup.TESTFIELD("HTML Path Header FR");
        LT_MailITSetup.TESTFIELD("HTML Path Footer FR");
        L_FPCGenSetup.TESTFIELD("Credit Memo MailText FR");
      END;

      IF (_SalesCrMemoHeader."Language Code" = 'DEA') AND L_FPCGenSetup."Enable S. Credit M. Mail - AUT" THEN BEGIN
        LT_MailITSetup.TESTFIELD("HTML Path Footer AUT");
        LT_MailITSetup.TESTFIELD("HTML Path Header AUT");
        L_FPCGenSetup.TESTFIELD("Credit Memo MailText AUT");
      END;

      //H0784 04.02.14 ARU +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
      IF (_SalesCrMemoHeader."Language Code" = 'DES') AND L_FPCGenSetup."Enable S. Credit M. Mail - CH" THEN BEGIN
        L_FPCGenSetup.TESTFIELD("HTML Path Footer CH (DEU)");
        L_FPCGenSetup.TESTFIELD("HTML Path Header CH (DEU)");
        L_FPCGenSetup.TESTFIELD("Credit Memo MailText CH-DE");
      END;

      IF (_SalesCrMemoHeader."Language Code" = 'FRS') AND L_FPCGenSetup."Enable S. Credit M. Mail - CH" THEN BEGIN
        L_FPCGenSetup.TESTFIELD("HTML Path Footer CH (FR)");
        L_FPCGenSetup.TESTFIELD("HTML Path Header CH (FR)");
        L_FPCGenSetup.TESTFIELD("Credit Memo MailText CH-FR");
      END;
      //H0784 04.02.14 ARU ---------------------------------------------------------------------------------------



      CREATE(ClientFso,TRUE,TRUE);
      CREATE(ClientUtil,TRUE,TRUE);
      CREATE(DivUtil,TRUE,TRUE);
      JobID := MailIT.CreateGUID();

      // Get folder for temporary files on the client
      ClientTempFolder := ClientUtil.GetTempPath();
      IF ClientTempFolder = '' THEN
        ERROR('Unable to create the path of the temporary folder.');
      ClientTempFolder := ClientTempFolder + 'ExpMail';
      IF NOT ClientFso.FolderExists(ClientTempFolder) THEN
        ClientFso.CreateFolder(ClientTempFolder);
      ClientTempFolder := ClientTempFolder + '\' + JobID;
      IF NOT ClientFso.FolderExists(ClientTempFolder) THEN
        ClientFso.CreateFolder(ClientTempFolder);

      // Initialize the email
      SendMailDirect := TRUE;
      IF SendMailDirect THEN
        MailIT.SetService('SMTP')
      ELSE
        MailIT.SetService(FORMAT(UserSetup."Mail Client"));


      IF (_SalesCrMemoHeader."Language Code" = 'DEU') OR (_SalesCrMemoHeader."Language Code" = '') THEN BEGIN
        MailTextLanguageCode := L_FPCGenSetup."Credit Memo MailText DE";
        MailIT.LoadHTMLBody(LT_MailITSetup."HTML Path Header DEU");
        LanguageCode := 'DEU';
        Add2Filename := '_Gutschrift_';
        IF NOT L_FPCGenSetup."Enable S. Credit M. Mail - DE" THEN
          EXIT;
      END;

      IF _SalesCrMemoHeader."Language Code" = 'NLD' THEN BEGIN
        MailTextLanguageCode := L_FPCGenSetup."Credit Memo MailText NL";
        MailIT.LoadHTMLBody(LT_MailITSetup."HTML Path Header NL");
        LanguageCode := 'NLD';
        Add2Filename := '_Creditnota_';
        IF NOT L_FPCGenSetup."Enable S. Credit M. Mail - NL" THEN
          EXIT;
      END;

      IF _SalesCrMemoHeader."Language Code" = 'FRA' THEN BEGIN
        MailTextLanguageCode := L_FPCGenSetup."Credit Memo MailText FR";
        MailIT.LoadHTMLBody(LT_MailITSetup."HTML Path Header FR");
        LanguageCode := 'FRA';
        Add2Filename := '_Remboursement_';
        IF NOT L_FPCGenSetup."Enable S. Credit M. Mail - FR" THEN
          EXIT;
      END;

      IF _SalesCrMemoHeader."Language Code" = 'DEA' THEN BEGIN
        MailTextLanguageCode := L_FPCGenSetup."Credit Memo MailText AUT";
        MailIT.LoadHTMLBody(LT_MailITSetup."HTML Path Header AUT");
        LanguageCode := 'DEA';
        Add2Filename := '_Gutschrift_';

        IF NOT LT_MailITSetup."Enable Sales Invoice - AUT" THEN
          EXIT;
      END;

      //H0784 04.02.14 ARU ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
      IF _SalesCrMemoHeader."Language Code" = 'DES' THEN BEGIN
        MailTextLanguageCode := L_FPCGenSetup."Credit Memo MailText CH-DE";
        MailIT.LoadHTMLBody(L_FPCGenSetup."HTML Path Header CH (DEU)");
        LanguageCode := 'DES';
        Add2Filename := '_Gutschrift_';

        IF NOT L_FPCGenSetup."Enable S. Credit M. Mail - CH" THEN
          EXIT;
      END;

      IF _SalesCrMemoHeader."Language Code" = 'FRS' THEN BEGIN
        MailTextLanguageCode := L_FPCGenSetup."Credit Memo MailText CH-FR";
        MailIT.LoadHTMLBody(L_FPCGenSetup."HTML Path Header CH (FR)");
        LanguageCode := 'FRS';
        Add2Filename := '_Remboursement_';

        IF NOT L_FPCGenSetup."Enable S. Credit M. Mail - CH" THEN
          EXIT;
      END;
      //H0784 04.02.14 ARU ----------------------------------------------

      ExtTextLines.RESET;
      ExtTextLines.SETRANGE("Table Name",ExtTextLines."Table Name"::"Standard Text");
      ExtTextLines.SETRANGE("No.",MailTextLanguageCode);
      ExtTextLines.SETRANGE("Language Code",LanguageCode);
      ExtTextLines.SETRANGE("Text No.",1);

      _SalesCrMemoHeader.SETRECFILTER;
      // H0355 >>
      LT_WebSiteTransfer.SETRANGE("Website No.", WebsiteNo);
      // H0355 <<
      LT_WebSiteTransfer.FINDLAST;
      LT_WebSiteTransfer.CALCFIELDS("Website Name");

      MailIT.AppendHTML('<br /><br />');
      MailIT.AppendHTML('<table width=590 border=0>');
      //H0548 10.01.13 ARU ++++++++++
      MailIT.AppendHTML(TEXT0003HME);
      //H0548 10.01.13 ARU ----------

      IF ExtTextLines.FIND('-') THEN REPEAT
        TxtStr   := ExtTextLines."Text (Long)";
        Position := STRPOS(TxtStr,'[');
         IF Position = 1 THEN BEGIN
           TXtType := COPYSTR(TxtStr,Position+1,STRPOS(TxtStr,']')-2);
           IF TXtType = 'Subject' THEN BEGIN
             TxtStr := STRSUBSTNO(DELSTR(ExtTextLines."Text (Long)",
                                  1,STRPOS(ExtTextLines."Text (Long)",']')),_SalesCrMemoHeader."External Document No.") + ' ';
             SubjectTxtStr := SubjectTxtStr + TxtStr;
           END;
         END ELSE BEGIN
           TxtStr := STRSUBSTNO(DELSTR(ExtTextLines."Text (Long)",1,STRPOS(ExtTextLines."Text (Long)",']')),
                                _SalesCrMemoHeader."No.");
           IF TxtStr = '' THEN
             TxtStr := '<br /><br />';
           MailIT.AppendHTML(TxtStr);
         END;
      UNTIL ExtTextLines.NEXT = 0;

      //H0548 10.01.13 ARU +++++++++++++++++++++++++++++++++++++++++++++++++++++++++
      //MailIT.SetSubject(LT_WebSiteTransfer."Website Name" + ': ' + SubjectTxtStr);
      MailIT.SetSubject(SubjectTxtStr);
      //H0548 10.01.13 ARU ---------------------------------------------------------

      DocName := LT_WebSiteTransfer."Website Name" + Add2Filename + _SalesCrMemoHeader."No.";

      ReportID := 207;
      //E/P0677

      // Locate bill to customer
      Cust.GET(_SalesCrMemoHeader."Sell-to Customer No.");
      CompanyInfo.GET;

      IF NOT LT_MailITSetup."Test Mode" THEN
        //A/P0850
        //MailIT.AddRecipientBCC(LT_MailITSetup."Sales E-Mail",LT_MailITSetup."Sales E-Mail")
        MailIT.AddRecipientBCC(L_FPCGenSetup."Cr. Memo EMail BCC",L_FPCGenSetup."Cr. Memo EMail BCC")
        //E/P0850
      ELSE
        MailIT.AddRecipientBCC(LT_MailITSetup."Test E-Mail BCC",LT_MailITSetup."Test E-Mail BCC");
      IF NOT LT_MailITSetup."Test Mode" THEN BEGIN
        Cust.TESTFIELD("E-Mail");
        IF Cust."E-Mail" <> '' THEN
          MailIT.AddRecipient(Cust."E-Mail",Cust."E-Mail");
      END ELSE
        MailIT.AddRecipient(LT_MailITSetup."Test E-Mail",LT_MailITSetup."Test E-Mail");

      //S/p0677
      IF (_SalesCrMemoHeader."Language Code" = 'DEU') OR (_SalesCrMemoHeader."Language Code" = '') THEN
        MailIT.LoadHTMLBody(LT_MailITSetup."HTML Path Footer DEU");

      IF _SalesCrMemoHeader."Language Code" = 'NLD' THEN
        MailIT.LoadHTMLBody(LT_MailITSetup."HTML Path Footer NL");

      IF _SalesCrMemoHeader."Language Code" = 'FRA' THEN
        MailIT.LoadHTMLBody(LT_MailITSetup."HTML Path Footer FR");
      //E/p0677
      //S/P0677/04.02.13
      IF _SalesCrMemoHeader."Language Code" = 'DEA' THEN
        MailIT.LoadHTMLBody(LT_MailITSetup."HTML Path Footer AUT");

      //H0784 04.02.14 ARU ++++++++++++++++++++++++++++++++++++++++++++
      IF LanguageCode = 'DES' THEN
        MailIT.LoadHTMLBody(L_FPCGenSetup."HTML Path Footer CH (DEU)");

      IF LanguageCode = 'FRS' THEN
        MailIT.LoadHTMLBody(L_FPCGenSetup."HTML Path Footer CH (FR)");
      //H0784 04.02.14 ARU --------------------------------------------

      //E/P0677/04.02.13

      // Prepare to print it to PDF
      ClientPdfFileName := ClientTempFolder + '\' + DocName + '.pdf';
      IF ClientFso.FileExists(ClientPdfFileName) THEN
        ClientFso.DeleteFile(ClientPdfFileName);
      MailIT.PDFParameter('Output',ClientPdfFileName);
      MailIT.PDFParameter('ShowPDF','no');
      MailIT.PDFParameter('Title',DocName);
      MailIT.PDFParameter('Author',USERID);
      MailIT.PDFPreparePrinter();
      IF NOT DefaultPrinterChanged THEN BEGIN
        IF OldDefaultPrinter = '' THEN
          OldDefaultPrinter := MailIT.GetDefaultPrinter();
        IF OldDefaultPrinter <> UserSetup."PDF Creator" THEN BEGIN
          MailIT.SetDefaultPrinter(UserSetup."PDF Creator");
          DefaultPrinterChanged := TRUE;
        END;
      END;
      REPORT.RUNMODAL(ReportID,FALSE,TRUE,_SalesCrMemoHeader);
      IF (MailIT.WaitForFile(ClientPdfFileName,20000) = 0) THEN
        ERROR(Text040);
      MailIT.AddAttachment(ClientPdfFileName);

      // Restore the user's default printer selection
      IF DefaultPrinterChanged THEN
        MailIT.SetDefaultPrinter(OldDefaultPrinter);

      // MailIT.Display(); chrmu
      SendMailDirect := TRUE;

      IF SendMailDirect THEN BEGIN
        MailIT.SetServer(LT_MailITSetup."Mail Server Home24");
        IF LT_MailITSetup."Server Port Home24" = '' THEN
          L_Port := 25
        ELSE
          EVALUATE(L_Port,LT_MailITSetup."Server Port Home24");
        MailIT.SetPort(L_Port);
        //H0709 28.11.13 MBY +++++++++++++
        IF LT_MailITSetup."Authentication Home24" THEN
        //H0709 28.11.13 MBY -------------
          MailIT.UseSSL(1);

        IF (_SalesCrMemoHeader."Language Code" = 'DEU') OR (_SalesCrMemoHeader."Language Code" = '') THEN BEGIN
          MailIT.SetFrom(L_FPCGenSetup."Cr. Memo EMail Sender DE");
          //H0709 28.11.13 MBY +++++++++++++
          IF LT_MailITSetup."Authentication Home24" THEN BEGIN
          //H0709 28.11.13 MBY -------------
            MailIT.SetLogin(L_FPCGenSetup."Cr. Memo EMail Sender DE");
            MailIT.SetPassword(L_FPCGenSetup."Cr. Memo EMail Password DE");
          //H0709 28.11.13 MBY +++++++++++++
          END;
          //H0709 28.11.13 MBY -------------
        END;

        IF _SalesCrMemoHeader."Language Code" = 'NLD' THEN BEGIN
          MailIT.SetFrom(L_FPCGenSetup."Cr. Memo EMail Sender NL");
          //H0709 28.11.13 MBY +++++++++++++
          IF LT_MailITSetup."Authentication Home24" THEN BEGIN
          //H0709 28.11.13 MBY -------------
            MailIT.SetLogin(L_FPCGenSetup."Cr. Memo EMail Sender NL");
            MailIT.SetPassword(L_FPCGenSetup."Cr. Memo EMail Password NL");
          //H0709 28.11.13 MBY +++++++++++++
          END;
          //H0709 28.11.13 MBY -------------
        END;

        IF _SalesCrMemoHeader."Language Code" = 'FRA' THEN BEGIN
          MailIT.SetFrom(L_FPCGenSetup."Cr. Memo EMail Sender FR");
          //H0709 28.11.13 MBY +++++++++++++
          IF LT_MailITSetup."Authentication Home24" THEN BEGIN
          //H0709 28.11.13 MBY -------------
            MailIT.SetLogin(L_FPCGenSetup."Cr. Memo EMail Sender FR");
            MailIT.SetPassword(L_FPCGenSetup."Cr. Memo EMail Password FR");
          //H0709 28.11.13 MBY +++++++++++++
          END;
          //H0709 28.11.13 MBY -------------
        END;

        IF _SalesCrMemoHeader."Language Code" = 'DEA' THEN BEGIN
          MailIT.SetFrom(L_FPCGenSetup."Cr. Memo EMail Sender AUT");
          //H0709 28.11.13 MBY +++++++++++++
          IF LT_MailITSetup."Authentication Home24" THEN BEGIN
          //H0709 28.11.13 MBY -------------
            MailIT.SetLogin(L_FPCGenSetup."Cr. Memo EMail Sender AUT");
            MailIT.SetPassword(L_FPCGenSetup."Cr. Memo EMail Password AUT");
          //H0709 28.11.13 MBY +++++++++++++
          END;
          //H0709 28.11.13 MBY -------------
        END;

        //H0784 04.02.14 ARU +++++++++++++++++++++++++++++++++++++++++++++++
        IF (LanguageCode = 'DES') OR (LanguageCode = 'FRS') THEN BEGIN
          MailIT.SetFrom(L_FPCGenSetup."Cr. Memo EMail Sender CH");
          IF LT_MailITSetup."Authentication Home24" THEN BEGIN
            MailIT.SetLogin(L_FPCGenSetup."Cr. Memo EMail Sender CH");
            MailIT.SetPassword(L_FPCGenSetup."Cr. Memo EMail Password CH");
          END;
        END;
        //H0784 04.02.14 ARU -----------------------------------------------

        MailIT.Send();
      END ELSE
        MailIT.Display();

      // Remove the temporary folder and its content.
      // If you use MAPI and Thunderbird or other MAPI email clints the they may require that
      // the image files remain on the disk until the mail is sent.
      IF FORMAT(UserSetup."Mail Client") <> 'MAPI' THEN
        IF ClientFso.FolderExists(ClientTempFolder) THEN
          ClientFso.DeleteFolder(ClientTempFolder, FALSE);
      CLEAR(ClientFso);
      CLEAR(ClientUtil);
      CLEAR(DivUtil);
    END;

    LOCAL PROCEDURE CreateOrderCSV@1000000007(PurchOrderHeaderV@1000000002 : Record 38;SalesOrderHeaderV@1000000004 : Record 36;ExpFilePathV@1000000016 : Text[250];MPV@1000000014 : Boolean;DropShipV@1000000005 : Boolean);
    VAR
      LT_NavCSalesHeader@1000000009 : Record 5251571;
      LT_PaymMethode@1000000001 : Record 289;
      LT_BankAcc@1000000000 : Record 270;
      LT_Cust@1000000013 : Record 18;
      LT_Location@1000000015 : Record 14;
      LC_DHLMgt@1000000012 : Codeunit 50020;
      L_ShipAddr@1000000011 : ARRAY [11] OF Text[80];
      L_InvAddr@1000000010 : ARRAY [8] OF Text[80];
      L_DropShip@1000000017 : Boolean;
      L_Factoring@1000000003 : Text[1];
      L_SalesPrice@1000000006 : Decimal;
      L_FS@1000000007 : Text[1];
      L_TS@1000000008 : Text[1];
      "****HME*****************"@1000000033 : Integer;
      ParentItemL@1000000023 : Record 27;
      SparePartMgtL@1000000032 : Codeunit 50322;
      VATRegNoL@1000000031 : Text[20];
      CountryGLNNoL@1000000030 : Code[20];
      GlobalGLNNoL@1000000029 : Code[20];
      EDIPartnerGLNNoL@1000000028 : Code[20];
      ShippingAgentCodeL@1000000027 : Code[10];
      SalesOrderNoL@1000000026 : Code[20];
      BranchCodeL@1000000025 : Code[10];
      DSLabelBillingNoL@1000000024 : Code[20];
      OriginalPurchOrderNoL@1000000022 : Code[20];
      TrackingNoStringL@1000000020 : Text[1024];
      RHDBarcodeStringL@1000000019 : Text[1024];
      NoofCollisL@1000000018 : Integer;
      FileOutstreamL@1000000021 : OutStream;
      IsSparePartOrderL@1000000034 : Boolean;
    BEGIN
      ExpFilePathV := ExpFilePathV + '\order.csv';
      ExpFile.CREATE(ExpFilePathV);
      //H3782, H1731, H1619, H1218 17.03.15 EHN +++++++++++++++++++++++++++++++++++++++++++++++++++++++
      ExpFile.CREATEOUTSTREAM(FileOutstreamL);
      IF MPV THEN BEGIN
        FileOutstreamL.WRITETEXT('"Kommissionsnr.",');             //1
        FileOutstreamL.WRITETEXT('"Bestellnummer",');              //2
        FileOutstreamL.WRITETEXT('"Depotnummer",');                //3
        FileOutstreamL.WRITETEXT('"SKU",');                        //4
        FileOutstreamL.WRITETEXT('"Artikelnr_MP",');               //5
        FileOutstreamL.WRITETEXT('"Beschreibung",');               //6
        FileOutstreamL.WRITETEXT('"Brutto-VK",');                  //7
        FileOutstreamL.WRITETEXT('"Gesamtpreis",');                //8
        FileOutstreamL.WRITETEXT('"Versand_Anrede",');             //9
        FileOutstreamL.WRITETEXT('"Versand_Vorname",');            //10
        FileOutstreamL.WRITETEXT('"Versand_Nachname",');           //11
        FileOutstreamL.WRITETEXT('"Versand_Strasse",');            //12
        FileOutstreamL.WRITETEXT('"Versand_Hausnummer",');         //13
        FileOutstreamL.WRITETEXT('"Versand Strasse 2",');          //14
        FileOutstreamL.WRITETEXT('"Versand_PLZ",');                //15
        FileOutstreamL.WRITETEXT('"Versand_Stadt",');              //16
        FileOutstreamL.WRITETEXT('"Versand_Land",');               //17
        FileOutstreamL.WRITETEXT('"Versand_Kontakt",');            //18
        FileOutstreamL.WRITETEXT('"Versand_Telefon",');            //19
        FileOutstreamL.WRITETEXT('"Rechnung_Anrede",');            //20
        FileOutstreamL.WRITETEXT('"Rechnung_Vorname",');           //21
        FileOutstreamL.WRITETEXT('"Rechnung_Nachname",');          //22
        FileOutstreamL.WRITETEXT('"Rechnung_Strasse",');           //23
        FileOutstreamL.WRITETEXT('"Rechnung_Hausnummer",');        //24
        FileOutstreamL.WRITETEXT('"Rechnung_PLZ",');               //25
        FileOutstreamL.WRITETEXT('"Rechnung_Stadt",');             //26
        FileOutstreamL.WRITETEXT('"Rechnung_Land",');              //27
        FileOutstreamL.WRITETEXT('"Rechnung_Kontakt",');           //28
        FileOutstreamL.WRITETEXT('"Rechnung_Telefon",');           //29
        FileOutstreamL.WRITETEXT('"Rechnung_Firma",');             //30
        FileOutstreamL.WRITETEXT('"Billpay_Boolean",');            //31
        FileOutstreamL.WRITETEXT('"Billpay_Kontoinhaber",');       //32
        FileOutstreamL.WRITETEXT('"Billpay_Bank",');               //33
        FileOutstreamL.WRITETEXT('"Billpay_BLZ",');                //34
        FileOutstreamL.WRITETEXT('"Billpay_Kontonummer",');        //35
        FileOutstreamL.WRITETEXT('"Billpay_VerwZweck",');          //36
        FileOutstreamL.WRITETEXT('"Tracking_No",');                //37
        FileOutstreamL.WRITETEXT('"EAN",');                        //38
        FileOutstreamL.WRITETEXT('"Bestellmenge",');               //39
        FileOutstreamL.WRITETEXT('"Gesamtcollianzahl",');          //40
        FileOutstreamL.WRITETEXT('"Collianzahl Artikel",');        //41
        FileOutstreamL.WRITETEXT('"Barcode",');                    //42
        FileOutstreamL.WRITETEXT('"Gewicht",');                    //43
        FileOutstreamL.WRITETEXT('"Abrechnungsnummer Carrier",');       //44
        FileOutstreamL.WRITETEXT(ConvertText('"KÑufer GLN"') + ',');    //45
        FileOutstreamL.WRITETEXT('"Rechnungs GLN",');                   //46
        FileOutstreamL.WRITETEXT('"Sender GLN",');                      //47
        FileOutstreamL.WRITETEXT(ConvertText('"EmpfÑnger GLN"') + ','); //48
        FileOutstreamL.WRITETEXT('"Shipping Agent",');                  //49
        FileOutstreamL.WRITETEXT('"Ust_Id_Nr",');                       //50
        FileOutstreamL.WRITETEXT('"Mutter SKU",');                      //51
        FileOutstreamL.WRITETEXT('"Kulanz/Mangel",');                   //52
        FileOutstreamL.WRITETEXT('"UrsprungsbestellNr"');               //53
        FileOutstreamL.WRITETEXT;
      END ELSE BEGIN
        FileOutstreamL.WRITETEXT('"Kommissionsnr.",');             //1
        FileOutstreamL.WRITETEXT('"Bestellnummer",');              //2
        FileOutstreamL.WRITETEXT('"Depotnummer",');                //3
        FileOutstreamL.WRITETEXT('"SKU",');                        //4
        FileOutstreamL.WRITETEXT('"Artikelnr_MP",');               //5
        FileOutstreamL.WRITETEXT('"Beschreibung",');               //6
        FileOutstreamL.WRITETEXT('"Versand_Anrede",');             //7
        FileOutstreamL.WRITETEXT('"Versand_Vorname",');            //8
        FileOutstreamL.WRITETEXT('"Versand_Nachname",');           //9
        FileOutstreamL.WRITETEXT('"Versand_Strasse",');            //10
        FileOutstreamL.WRITETEXT('"Versand_Hausnummer",');         //11
        FileOutstreamL.WRITETEXT('"Versand Strasse 2",');          //12
        FileOutstreamL.WRITETEXT('"Versand_PLZ",');                //13
        FileOutstreamL.WRITETEXT('"Versand_Stadt",');              //14
        FileOutstreamL.WRITETEXT('"Versand_Land",');               //15
        FileOutstreamL.WRITETEXT('"Versand_Kontakt",');            //16
        FileOutstreamL.WRITETEXT('"Versand_Telefon",');            //17
        FileOutstreamL.WRITETEXT('"Tracking_No",');                //18
        FileOutstreamL.WRITETEXT('"EAN",');                        //19
        FileOutstreamL.WRITETEXT('"Bestellmenge",');               //20
        FileOutstreamL.WRITETEXT('"Gesamtcollianzahl",');          //21
        FileOutstreamL.WRITETEXT('"Collianzahl Artikel",');        //22
        FileOutstreamL.WRITETEXT('"Barcode",');                    //23
        FileOutstreamL.WRITETEXT('"Gewicht",');                    //24
        FileOutstreamL.WRITETEXT('"Abrechnungsnummer Carrier",');       //25
        FileOutstreamL.WRITETEXT(ConvertText('"KÑufer GLN"') + ',');    //26
        FileOutstreamL.WRITETEXT('"Rechnungs GLN",');                   //27
        FileOutstreamL.WRITETEXT('"Sender GLN",');                      //28
        FileOutstreamL.WRITETEXT(ConvertText('"EmpfÑnger GLN"') + ','); //29
        FileOutstreamL.WRITETEXT('"Shipping Agent",');                  //30
        FileOutstreamL.WRITETEXT('"Ust_Id_Nr",');                       //31
        FileOutstreamL.WRITETEXT('"Mutter SKU",');                      //32
        FileOutstreamL.WRITETEXT('"Kulanz/Mangel",');                   //33
        FileOutstreamL.WRITETEXT('"UrsprungsbestellNr"');               //34
        FileOutstreamL.WRITETEXT;
      END;
      //H3782, H1731, H1619, H1218 17.03.15 EHN -------------------------------------------------------

      L_Factoring := '0';
      CLEAR(LT_BankAcc);
      IF MPV THEN BEGIN
        LT_PaymMethode.GET(SalesOrderHeaderV."Payment Method Code");
        IF LT_PaymMethode.Factoring THEN BEGIN
          LT_BankAcc.SETRANGE("Payment Method Code",LT_PaymMethode.Code);
          LT_BankAcc.FINDFIRST;
          L_Factoring := '1';
        END;
      END;

      CLEAR(L_ShipAddr);
      CLEAR(L_InvAddr);
      IF DropShipV THEN BEGIN
        LT_NavCSalesHeader.RESET;
        LT_NavCSalesHeader.SETCURRENTKEY("Sales Document No.");
        LT_NavCSalesHeader.SETRANGE("Sales Document No.",SalesOrderHeaderV."No.");
        IF LT_NavCSalesHeader.FINDFIRST THEN BEGIN
          IF (SalesOrderHeaderV."Ship-to Name" = LT_NavCSalesHeader."Ship-to Name") AND
             (SalesOrderHeaderV."Ship-to Name 2" = LT_NavCSalesHeader."Ship-to Name 2") AND
             (LT_NavCSalesHeader."Ship-to Company Name" = '') THEN BEGIN
            L_ShipAddr[1] := LT_NavCSalesHeader."Ship-to Job Title";
            L_ShipAddr[2] := LT_NavCSalesHeader."Ship-to First Name";
            L_ShipAddr[3] := LT_NavCSalesHeader."Ship-to Surname";
          END ELSE BEGIN
            IF SalesOrderHeaderV."Ship-to Name 2" <> '' THEN BEGIN
              L_ShipAddr[2] := SalesOrderHeaderV."Ship-to Name";
              L_ShipAddr[3] := SalesOrderHeaderV."Ship-to Name 2";
            END ELSE
              L_ShipAddr[3] := SalesOrderHeaderV."Ship-to Name";
          END;
          IF LT_NavCSalesHeader."Ship-to Company Name" <> '' THEN
            L_ShipAddr[6] := SalesOrderHeaderV."Ship-to Contact"
          ELSE
            L_ShipAddr[6] := LT_NavCSalesHeader."Ship-to Name";
          L_ShipAddr[7] := LT_NavCSalesHeader."Ship-to Phone No.";
          IF MPV THEN BEGIN
            IF (SalesOrderHeaderV."Bill-to Name" = LT_NavCSalesHeader."Bill-to Name") AND
               (SalesOrderHeaderV."Bill-to Name 2" = LT_NavCSalesHeader."Bill-to Name 2") AND
               (LT_NavCSalesHeader."Bill-to Company Name" = '') THEN BEGIN
              L_InvAddr[1] := LT_NavCSalesHeader."Bill-to Job Title";
              L_InvAddr[2] := LT_NavCSalesHeader."Bill-to First Name";
              L_InvAddr[3] := LT_NavCSalesHeader."Bill-to Surname";
            END ELSE BEGIN
              IF SalesOrderHeaderV."Bill-to Name 2" <> '' THEN BEGIN
                L_InvAddr[2] := SalesOrderHeaderV."Bill-to Name";
                L_InvAddr[3] := SalesOrderHeaderV."Bill-to Name 2";
              END ELSE
                L_InvAddr[3] := SalesOrderHeaderV."Bill-to Name";
            END;
            IF LT_NavCSalesHeader."Bill-to Company Name" <> '' THEN
              L_InvAddr[6] := SalesOrderHeaderV."Bill-to Contact"
            ELSE
              L_InvAddr[6] := LT_NavCSalesHeader."Bill-to Name";
            L_InvAddr[7] := LT_NavCSalesHeader."Bill-to Phone No.";
            L_InvAddr[8] := LT_NavCSalesHeader."Bill-to Company Name";
          END;
        END ELSE BEGIN
          IF SalesOrderHeaderV."Ship-to Name 2" <> '' THEN BEGIN
            L_ShipAddr[2] := SalesOrderHeaderV."Ship-to Name";
            L_ShipAddr[3] := SalesOrderHeaderV."Ship-to Name 2";
          END ELSE
            L_ShipAddr[3] := SalesOrderHeaderV."Ship-to Name";
          IF LT_Cust.GET(SalesOrderHeaderV."Sell-to Customer No.") THEN
            L_ShipAddr[7] := LT_Cust."Phone No.";
          IF SalesOrderHeaderV."Ship-to Contact" = '' THEN
            L_ShipAddr[6] := SalesOrderHeaderV."Ship-to Contact"
          ELSE
            L_ShipAddr[6] := SalesOrderHeaderV."Ship-to Name";
          IF MPV THEN BEGIN
            IF SalesOrderHeaderV."Bill-to Name 2" <> '' THEN BEGIN
              L_InvAddr[2] := SalesOrderHeaderV."Bill-to Name";
              L_InvAddr[3] := SalesOrderHeaderV."Bill-to Name 2";
            END ELSE
              L_InvAddr[3] := SalesOrderHeaderV."Bill-to Name";
            IF LT_Cust.GET(SalesOrderHeaderV."Bill-to Customer No.") THEN
              L_InvAddr[7] := LT_Cust."Phone No.";
            IF SalesOrderHeaderV."Bill-to Contact" = '' THEN
              L_InvAddr[6] := SalesOrderHeaderV."Bill-to Contact"
            ELSE
              L_InvAddr[6] := SalesOrderHeaderV."Bill-to Name";
            END;
        END;
        LC_DHLMgt.ParseAddress(SalesOrderHeaderV."Ship-to Address",L_ShipAddr[4],L_ShipAddr[5]);
        IF MPV THEN
          LC_DHLMgt.ParseAddress(SalesOrderHeaderV."Bill-to Address",L_InvAddr[4],L_InvAddr[5]);
      END ELSE BEGIN
        IF PurchOrderHeaderV."Ship-to Name 2" <> '' THEN BEGIN
          L_ShipAddr[2] := PurchOrderHeaderV."Ship-to Name";
          L_ShipAddr[3] := PurchOrderHeaderV."Ship-to Name 2";
        END ELSE
          L_ShipAddr[3] := PurchOrderHeaderV."Ship-to Name";
        IF LT_Location.GET(PurchOrderHeaderV."Location Code") THEN
          L_ShipAddr[7] := LT_Location."Phone No. 2";
        LC_DHLMgt.ParseAddress(PurchOrderHeaderV."Ship-to Address",L_ShipAddr[4],L_ShipAddr[5]);
      END;

      //H3782, H1218, H1619 24.03.15 EHN ++++++++++++++++++++++++++++++++++++++++++++++
      PurchOrderHeaderV.GetVATandGLN(VATRegNoL,GlobalGLNNoL,CountryGLNNoL,EDIPartnerGLNNoL);
      BranchCodeL := PurchOrderHeaderV.GetBranchCode();
      NoofCollisL := PurchOrderHeaderV.GetNoofCollis();
      IsSparePartOrderL := SparePartMgtL.IsSparePartOrderFromPOrder(PurchOrderHeaderV);
      //H3782, H1218, H1619 24.03.15 EHN ----------------------------------------------

      L_FS := ',';
      L_TS := '"';
      IF MPV THEN BEGIN
        PurchLine.RESET;
        PurchLine.SETRANGE("Document Type",PurchOrderHeaderV."Document Type");
        PurchLine.SETRANGE("Document No.",PurchOrderHeaderV."No.");
        PurchLine.SETRANGE(Type,PurchLine.Type::Item);
        PurchLine.SETFILTER("No.",'<>%1','');
        PurchLine.SETFILTER(Quantity,'<>0');
        PurchLine.SETRANGE("Sales Order No.",SalesOrderHeaderV."No.");
        IF PurchLine.FINDSET THEN REPEAT
          IF (PurchLine.Type <> PurchLine.Type::Item) OR (NOT Item.GET(PurchLine."No.")) THEN
            CLEAR(Item);
          L_SalesPrice := 0;
          IF SalesLine.GET(SalesLine."Document Type"::Order,PurchLine."Sales Order No.",
             PurchLine."Sales Order Line No.") THEN
            L_SalesPrice := SalesLine."Line Amount" + SalesLine."Line Discount Amount";
          //H3782, H1731, H1892, H1619, H1218 17.03.15 EHN ++++++++++++++++++++++++++++++++++++++++++++++
          CLEAR(ParentItemL);
          IF IsSparePartOrderL AND (PurchLine.Type = PurchLine.Type::Item) THEN
            ParentItemL.GET(PurchLine."Description 2");
          Item.CALCFIELDS("Parcels Number");
          SalesOrderNoL := PurchLine.GetLongSalesOrderNo();
          ShippingAgentCodeL := PurchLine.GetShippingAgent(SalesOrderHeaderV);
          DSLabelBillingNoL := PurchLine.GetDSLabelBillingNo();
          TrackingNoStringL := PurchLine.GetTrackingNo;
          RHDBarcodeStringL := PurchLine.GetRHDBarcode;
          OriginalPurchOrderNoL := PurchLine.GetOriginalPurchOrderNo;
          FileOutstreamL.WRITETEXT(
          L_TS + PurchOrderHeaderV."No." + L_TS + L_FS);                                                  //1 Kommissionsnr.
          FileOutstreamL.WRITETEXT(
          L_TS + SalesOrderNoL + L_TS + L_FS);                                                            //2 Bestellnummer
          FileOutstreamL.WRITETEXT(
          L_TS + BranchCodeL + L_TS + L_FS);                                                              //3 Depotnummer
          FileOutstreamL.WRITETEXT(
          L_TS + Item."Vendor Item No." + Item."Vendor Item No. Add." + L_TS + L_FS);                     //4 SKU
          FileOutstreamL.WRITETEXT(
          L_TS + PurchLine."No." + L_TS + L_FS);                                                          //5 Artikelnr_MP
          IF Item."Vendor Description" <> '' THEN
            FileOutstreamL.WRITETEXT(
            L_TS + ConvertText(Item."Vendor Description") + L_TS + L_FS)                                  //6 Beschreibung
          ELSE
            FileOutstreamL.WRITETEXT(
            L_TS + ConvertText(PurchLine.Description +' '+ PurchLine."Description 2") + L_TS + L_FS);
          FileOutstreamL.WRITETEXT(
          ConvertAmt(ROUND(L_SalesPrice / PurchLine.Quantity,0.01)) + L_FS);                              //7 Brutto-VK
          FileOutstreamL.WRITETEXT(
          ConvertAmt(L_SalesPrice) + L_FS);                                                               //8 Gesamtpreis
          FileOutstreamL.WRITETEXT(
          L_TS + ConvertText(L_ShipAddr[1]) + L_TS + L_FS);                                               //9 Versand_Anrede
          FileOutstreamL.WRITETEXT(
          L_TS + ConvertText(L_ShipAddr[2]) + L_TS + L_FS);                                               //10 Versand_Vorname
          FileOutstreamL.WRITETEXT(
          L_TS + ConvertText(L_ShipAddr[3]) + L_TS + L_FS);                                               //11 Versand_Nachname
          FileOutstreamL.WRITETEXT(
          L_TS + ConvertText(L_ShipAddr[4]) + L_TS + L_FS);                                               //12 Versand_Strasse
          FileOutstreamL.WRITETEXT(
          L_TS + ConvertText(L_ShipAddr[5]) + L_TS + L_FS);                                               //13 Versand_Hausnummer
          FileOutstreamL.WRITETEXT(
          L_TS + ConvertText(SalesOrderHeaderV."Ship-to Address 2") + L_TS + L_FS);                       //14 Versand Strasse 2
          FileOutstreamL.WRITETEXT(
          L_TS + SalesOrderHeaderV."Ship-to Post Code" + L_TS + L_FS);                                    //15 Versand_PLZ
          FileOutstreamL.WRITETEXT(
          L_TS + ConvertText(SalesOrderHeaderV."Ship-to City") + L_TS + L_FS);                            //16 Versand_Stadt
          FileOutstreamL.WRITETEXT(
          L_TS + SalesOrderHeaderV."Ship-to Country/Region Code" + L_TS + L_FS);                          //17 Versand_Land
          FileOutstreamL.WRITETEXT(
          L_TS + L_ShipAddr[6] + L_TS + L_FS);                                                            //18 Versand_Kontakt
          FileOutstreamL.WRITETEXT(
          L_TS + L_ShipAddr[7] + L_TS + L_FS);                                                            //19 Versand_Telefon
          FileOutstreamL.WRITETEXT(
          L_TS + ConvertText(L_InvAddr[1]) + L_TS + L_FS);                                                //20 Rechnung_Anrede
          FileOutstreamL.WRITETEXT(
          L_TS + ConvertText(L_InvAddr[2]) + L_TS + L_FS);                                                //21 Rechnung_Vorname
          FileOutstreamL.WRITETEXT(
          L_TS + ConvertText(L_InvAddr[3]) + L_TS + L_FS);                                                //22 Rechnung_Nachname
          FileOutstreamL.WRITETEXT(
          L_TS + ConvertText(L_InvAddr[4]) + L_TS + L_FS);                                                //23 Rechnung_Strasse
          FileOutstreamL.WRITETEXT(
          L_TS + ConvertText(L_InvAddr[5]) + L_TS + L_FS);                                                //24 Rechnung_Hausnummer
          FileOutstreamL.WRITETEXT(
          L_TS + SalesOrderHeaderV."Bill-to Post Code" + L_TS + L_FS);                                    //25 Rechnung_PLZ
          FileOutstreamL.WRITETEXT(
          L_TS + ConvertText(SalesOrderHeaderV."Bill-to City") + L_TS + L_FS);                            //26 Rechnung_Stadt
          FileOutstreamL.WRITETEXT(
          L_TS + SalesOrderHeaderV."Bill-to Country/Region Code" + L_TS + L_FS);                          //27 Rechnung_Land
          FileOutstreamL.WRITETEXT(
          L_TS + ConvertText(L_InvAddr[6]) + L_TS + L_FS);                                                //28 Rechnung_Kontakt
          FileOutstreamL.WRITETEXT(
          L_TS + L_InvAddr[7] + L_TS + L_FS);                                                             //29 Rechnung_Telefon -7
          FileOutstreamL.WRITETEXT(
          L_TS + L_InvAddr[8] + L_TS + L_FS);                                                             //30 Rechnung_Firma  -8
          FileOutstreamL.WRITETEXT(
          L_TS + L_Factoring + L_FS);                                                                     //31 Billpay_Boolean
          FileOutstreamL.WRITETEXT(
          L_TS + LT_BankAcc."Account Owner" + L_TS + L_FS);                                               //32 Billpay_Kontoinhaber
          FileOutstreamL.WRITETEXT(
          L_TS + LT_BankAcc.Name + L_TS + L_FS);                                                          //33 Billpay_Bank
          FileOutstreamL.WRITETEXT(
          LT_BankAcc."Bank Branch No." + L_FS);                                                           //34 Billpay_BLZ
          FileOutstreamL.WRITETEXT(
          LT_BankAcc."Bank Account No." + L_FS);                                                          //35 Billpay_Kontonummer
          FileOutstreamL.WRITETEXT(
          L_TS + LT_BankAcc.Name + L_TS + L_FS);                                                          //36 Billpay_VerwZweck
          FileOutstreamL.WRITETEXT(
          L_TS + TrackingNoStringL + L_TS + L_FS);                                                        //37 Tracking_No
          FileOutstreamL.WRITETEXT(
          L_TS + FORMAT(Item.EAN) + L_TS + L_FS);                                                         //38 EAN
          FileOutstreamL.WRITETEXT(
          FORMAT(PurchLine.Quantity) + L_FS);                                                             //39 Bestellmenge
          FileOutstreamL.WRITETEXT(
          L_TS + FORMAT(NoofCollisL) + L_TS + L_FS);                                                      //40 Gesamtcollianzahl
          FileOutstreamL.WRITETEXT(
          L_TS + FORMAT(Item."Parcels Number" * PurchLine.Quantity) + L_TS + L_FS);                       //41 Collianzahl Artikel
          FileOutstreamL.WRITETEXT(
          L_TS + RHDBarcodeStringL + L_TS + L_FS);                                                        //42 Barcode
          FileOutstreamL.WRITETEXT(
          L_TS + FORMAT(PurchLine."Gross Weight") + L_TS + L_FS);                                         //43 Gewicht
          FileOutstreamL.WRITETEXT(
          L_TS + DSLabelBillingNoL + L_TS + L_FS);                                                        //44 Abrechnungsnummer Carrier
          FileOutstreamL.WRITETEXT(
          L_TS + GlobalGLNNoL + L_TS + L_FS);                                                             //45 KÑufer GLN
          FileOutstreamL.WRITETEXT(
          L_TS + CountryGLNNoL + L_TS + L_FS);                                                            //46 Rechnungs GLN
          FileOutstreamL.WRITETEXT(
          L_TS + GlobalGLNNoL + L_TS + L_FS);                                                             //47 Sender GLN
          FileOutstreamL.WRITETEXT(
          L_TS + EDIPartnerGLNNoL + L_TS + L_FS);                                                         //48 EmpfÑnger GLN
          FileOutstreamL.WRITETEXT(
          L_TS + ShippingAgentCodeL + L_TS + L_FS);                                                       //49 Shipping Agent
          FileOutstreamL.WRITETEXT(
          L_TS + VATRegNoL + L_TS + L_FS);                                                                //50 Ust_Id_Nr
          FileOutstreamL.WRITETEXT(                                                                       //51 Mutter SKU
          L_TS + ParentItemL."Vendor Item No." + L_TS + L_FS);
          FileOutstreamL.WRITETEXT(                                                                       //52 Kulanz/Mangel
          L_TS + FORMAT(PurchLine."Spare Part Reason") + L_TS + L_FS);
          FileOutstreamL.WRITETEXT(                                                                       //53 UrsprungsbestellNr
          L_TS + OriginalPurchOrderNoL + L_TS + L_FS);
          FileOutstreamL.WRITETEXT(
          L_TS + '' + L_TS + L_FS);
          FileOutstreamL.WRITETEXT;
          //H3782, H1731, H1892, H1619, H1218 17.03.15 EHN ----------------------------------------------
        UNTIL PurchLine.NEXT = 0;
      END ELSE BEGIN
        PurchLine.RESET;
        PurchLine.SETRANGE("Document Type",PurchOrderHeaderV."Document Type");
        PurchLine.SETRANGE("Document No.",PurchOrderHeaderV."No.");
        PurchLine.SETRANGE(Type,PurchLine.Type::Item);
        PurchLine.SETFILTER("No.",'<>%1','');
        PurchLine.SETFILTER(Quantity,'<>0');
        IF PurchLine.FINDSET THEN REPEAT
          IF (PurchLine.Type <> PurchLine.Type::Item) OR (NOT Item.GET(PurchLine."No.")) THEN
            CLEAR(Item);
          //H3782, H1731, H1892, H1619, H1218 17.03.15 EHN ++++++++++++++++++++++++++++++++++++++++++++++
          CLEAR(ParentItemL);
          IF IsSparePartOrderL AND (PurchLine.Type = PurchLine.Type::Item) THEN
            ParentItemL.GET(PurchLine."Description 2");
          Item.CALCFIELDS("Parcels Number");
          SalesOrderNoL := PurchLine.GetLongSalesOrderNo();
          ShippingAgentCodeL := PurchLine.GetShippingAgent(SalesOrderHeaderV);
          DSLabelBillingNoL := PurchLine.GetDSLabelBillingNo();
          TrackingNoStringL := PurchLine.GetTrackingNo;
          RHDBarcodeStringL := PurchLine.GetRHDBarcode;
          OriginalPurchOrderNoL := PurchLine.GetOriginalPurchOrderNo;
          FileOutstreamL.WRITETEXT(
          L_TS + PurchOrderHeaderV."No." + L_TS + L_FS);                                                  //1 Kommissionsnr.
          FileOutstreamL.WRITETEXT(
          L_TS + SalesOrderNoL + L_TS + L_FS);                                                            //2 Bestellnummer
          FileOutstreamL.WRITETEXT(
          L_TS + BranchCodeL + L_TS + L_FS);                                                              //3 Depotnummer
          FileOutstreamL.WRITETEXT(
          L_TS + Item."Vendor Item No." + Item."Vendor Item No. Add." + L_TS + L_FS);                     //4 SKU
          FileOutstreamL.WRITETEXT(
          L_TS + PurchLine."No." + L_TS + L_FS);                                                          //5 Artikelnr_MP
          IF Item."Vendor Description" <> '' THEN
            FileOutstreamL.WRITETEXT(
            L_TS + ConvertText(Item."Vendor Description") + L_TS + L_FS)                                  //6 Beschreibung
          ELSE
            FileOutstreamL.WRITETEXT(
            L_TS + ConvertText(PurchLine.Description +' '+ PurchLine."Description 2") + L_TS + L_FS);
          FileOutstreamL.WRITETEXT(
          L_TS + ConvertText(L_ShipAddr[1]) + L_TS + L_FS);                                               //7 Versand_Anrede
          FileOutstreamL.WRITETEXT(
          L_TS + ConvertText(L_ShipAddr[2]) + L_TS + L_FS);                                               //8 Versand_Vorname
          FileOutstreamL.WRITETEXT(
          L_TS + ConvertText(L_ShipAddr[3]) + L_TS + L_FS);                                               //9 Versand_Nachname
          FileOutstreamL.WRITETEXT(
          L_TS + ConvertText(L_ShipAddr[4]) + L_TS + L_FS);                                               //10 Versand_Strasse
          FileOutstreamL.WRITETEXT(
          L_TS + ConvertText(L_ShipAddr[5]) + L_TS + L_FS);                                               //11 Versand_Hausnummer
          FileOutstreamL.WRITETEXT(
          L_TS + ConvertText(SalesOrderHeaderV."Ship-to Address 2") + L_TS + L_FS);                       //12 Versand Strasse 2
          FileOutstreamL.WRITETEXT(
          L_TS + SalesOrderHeaderV."Ship-to Post Code" + L_TS + L_FS);                                    //13 Versand_PLZ
          FileOutstreamL.WRITETEXT(
          L_TS + ConvertText(SalesOrderHeaderV."Ship-to City") + L_TS + L_FS);                            //14 Versand_Stadt
          FileOutstreamL.WRITETEXT(
          L_TS + SalesOrderHeaderV."Ship-to Country/Region Code" + L_TS + L_FS);                          //15 Versand_Land
          FileOutstreamL.WRITETEXT(
          L_TS + L_ShipAddr[6] + L_TS + L_FS);                                                            //16 Versand_Kontakt
          FileOutstreamL.WRITETEXT(
          L_TS + L_ShipAddr[7] + L_TS + L_FS);                                                           //17 Versand_Telefon
          FileOutstreamL.WRITETEXT(
          L_TS + TrackingNoStringL + L_TS + L_FS);                                                        //18 Tracking_No
          FileOutstreamL.WRITETEXT(
          L_TS + FORMAT(Item.EAN) + L_TS + L_FS);                                                         //19 EAN
          FileOutstreamL.WRITETEXT(
          FORMAT(PurchLine.Quantity) + L_FS);                                                             //20 Bestellmenge
          FileOutstreamL.WRITETEXT(
          L_TS + FORMAT(NoofCollisL) + L_TS + L_FS);                                                      //21 Gesamtcollianzahl
          FileOutstreamL.WRITETEXT(
          L_TS + FORMAT(Item."Parcels Number" * PurchLine.Quantity) + L_TS + L_FS);                       //22 Collianzahl Artikel
          FileOutstreamL.WRITETEXT(
          L_TS + RHDBarcodeStringL + L_TS + L_FS);                                                        //23 Barcode
          FileOutstreamL.WRITETEXT(
          L_TS + FORMAT(PurchLine."Gross Weight") + L_TS + L_FS);                                         //24 Gewicht
          FileOutstreamL.WRITETEXT(
          L_TS + DSLabelBillingNoL + L_TS + L_FS);                                                        //25 Abrechnungsnummer Carrier
          FileOutstreamL.WRITETEXT(
          L_TS + GlobalGLNNoL + L_TS + L_FS);                                                             //26 KÑufer GLN
          FileOutstreamL.WRITETEXT(
          L_TS + CountryGLNNoL + L_TS + L_FS);                                                            //27 Rechnungs GLN
          FileOutstreamL.WRITETEXT(
          L_TS + GlobalGLNNoL + L_TS + L_FS);                                                             //28 Sender GLN
          FileOutstreamL.WRITETEXT(
          L_TS + EDIPartnerGLNNoL + L_TS + L_FS);                                                         //29 EmpfÑnger GLN
          FileOutstreamL.WRITETEXT(
          L_TS + ShippingAgentCodeL + L_TS + L_FS);                                                       //30 Shipping Agent
          FileOutstreamL.WRITETEXT(
          L_TS + VATRegNoL + L_TS + L_FS);                                                                //31 Ust_Id_Nr
          FileOutstreamL.WRITETEXT(                                                                       //32 Mutter SKU
          L_TS + ParentItemL."Vendor Item No." + L_TS + L_FS);
          FileOutstreamL.WRITETEXT(                                                                       //33 Kulanz/Mangel
          L_TS + FORMAT(PurchLine."Spare Part Reason") + L_TS + L_FS);
          FileOutstreamL.WRITETEXT(                                                                       //34 UrsprungsbestellNr
          L_TS + OriginalPurchOrderNoL + L_TS + L_FS);
          FileOutstreamL.WRITETEXT(
          L_TS + '' + L_TS + L_FS);
          FileOutstreamL.WRITETEXT;
          //H3782, H1731, H1892, H1619, H1218 17.03.15 EHN ----------------------------------------------
        UNTIL PurchLine.NEXT = 0;
      END;
      ExpFile.CLOSE;
    END;

    LOCAL PROCEDURE ConvertAmt@1000000009(_Amt@1000000000 : Decimal) : Text[30];
    VAR
      L_AmtText@1000000001 : Text[30];
    BEGIN
      L_AmtText := DELCHR(FORMAT(_Amt,0,'<Precision,2:2><Standard Format,0>'),'=','.');
      L_AmtText := CONVERTSTR(L_AmtText,',','.');
      EXIT(L_AmtText);
    END;

    PROCEDURE ConvertText@1000000006(_Text@1000000000 : Text[250]) : Text[250];
    BEGIN
      EXIT(CONVERTSTR(GeneralMgt.Ascii2Ansi(_Text),',',' '));
    END;

    LOCAL PROCEDURE NewLine@1000000057() : Text[30];
    VAR
      CR@1000000000 : Char;
      LF@1000000001 : Char;
      SPACE@1000000002 : Char;
    BEGIN
      CR := 13;
      LF := 10;
      EXIT(FORMAT(CR)+FORMAT(LF));
    END;

    PROCEDURE SetParameters@1000000004();
    BEGIN
      SendMailDirect := TRUE;
    END;

    PROCEDURE CreateSpecialOrderMail@1108200017(_PurchOrderHeader@1000000029 : Record 38;_SalesOrderHeader@1000000030 : Record 36);
    VAR
      LT_MailITSetup@1000000028 : Record 75402;
      LT_WebSiteTransfer@1000000034 : Record 50033;
      LT_WebSource@1000000026 : Record 5059;
      LT_Location@1000000044 : Record 14;
      LT_LabelDHL@1000000045 : Record 50020;
      LT_ExtTextLine@1000000065 : Record 280;
      LR_SalesOrder@1000000050 : Report 50020;
      FormatAddr@1000000023 : Codeunit 365;
      ClientFso@1000000005 : Automation "{420B2830-E718-11CF-893D-00A0C9054228} 1.0:{0D43FE01-F093-11CF-8940-00A0C9054228}:'Microsoft Scripting Runtime'.FileSystemObject";
      ClientUtil@1000000003 : Automation "{1639594D-2135-4248-BE9B-FB55210F8AD8} 1.0:{D7CD856D-3889-4F19-BBBA-7608CF34EFB6}:'ExpandIT Dynamics Role Tailored Client Utility'.Utility";
      DivUtil@1000000054 : Automation "{2CD8D481-009C-4685-98EA-BC16452327B2} 1.0:{F1BBE10B-6E48-41B0-9EF6-F428C7A48655}:'Dynovus_SHA1Encryption'.SHA1EncryptAutomation";
      MailIT@1000000006 : OCX "{C8C4804C-89BA-4291-AB58-4C6050B65175}:'ExpandIT.MailIT2'";
      ShipAddr@1000000012 : ARRAY [8] OF Text[80];
      MailText@1000000032 : Text[250];
      DocName@1000000016 : Text[250];
      DocName2@1000000021 : Text[250];
      JobID@1000000007 : Text[50];
      ClientTempFolder@1000000004 : Text[250];
      ClientPdfFileName@1000000015 : Text[250];
      ClientFileName@1000000022 : Text[250];
      OldDefaultPrinter@1000000013 : Text[250];
      DefaultPrinterChanged@1000000014 : Boolean;
      ReportID@1000000001 : Integer;
      L_Text001@1000000002 : TextConst 'DEU=Bestellung Nr.:;ENU=Order No.:';
      L_Text002@1000000017 : TextConst 'DEU=Kunde:;ENU=Seller:';
      L_Text010@1000000010 : TextConst 'DEU=Sehr geehrte(r) %1,';
      L_Text010a@1000000063 : TextConst 'DEU=Sehr geehrte Damen und Herren,';
      L_Text011@1000000009 : TextConst 'DEU=anbei erhalten Sie eine Bestellung auf Rechnung %1';
      L_Text012@1000000000 : TextConst 'DEU=Anbei der Lieferschein, der der Sendung beigefÅgt werden kann.';
      L_Text013@1000000008 : TextConst 'DEU=Unsere Bestellnummer: %1';
      L_Text014@1000000011 : TextConst 'DEU=Versandadresse:';
      L_Text015@1000000064 : TextConst 'DEU=Bitte schicken Sie uns eine AuftragsbestÑtigung innerhalb von 24h mit dem geplanten Liefertermin und der bestÑtigten Anzahl als Antwort auf diese E-Mail.';
      L_Text016@1000000025 : TextConst 'DEU=Vielen Dank fÅr die Zusammenarbeit mit %1 !';
      L_Text017@1000000027 : TextConst 'DEU=Mit freundlichen GrÅ·en';
      L_Text018@1000000033 : TextConst 'DEU=Tel: %1 | Fax: %2';
      L_Text019@1000000037 : TextConst 'DEU="anbei erhalten Sie eine Bestellung von Lagerartikeln fÅr unser Lager. "';
      L_Text020@1000000041 : TextConst 'DEU="Bitte beachten Sie, dass es eine neue Lieferaddresse in Berlin und einen neuen Ansprechpartner fÅr Avisierungen gibt. "';
      L_Text021@1000000042 : TextConst 'DEU=Bitte beachten Sie auch, dass Sie spÑtestens %1 vor Anlieferung Ihre Anlieferung avisieren.';
      L_Text022@1000000031 : TextConst 'DEU=Die neue Lieferadresse ist:';
      L_Text023@1000000046 : TextConst 'DEU=Entladezeit: %1';
      L_Text024@1000000047 : TextConst 'DEU=Ansprechpartner fÅr die Lieferavisierung ist %1.';
      L_Text025@1000000048 : TextConst 'DEU=Bitte folgenden Verteiler wÑhlen, wenn es um die Avisierung geht:';
      L_Text026@1000000049 : TextConst 'DEU=Bitte stellen Sie sicher, dass unsere Bestell-Referenz und die Bestellnummer auf dem Lieferschein hinterlegt sind.';
      L_Text027@1000000051 : TextConst 'DEU=anbei eine Bestellung aus dem %1 Marketplace, welche Sie bitte auf eigene Rechnung versenden.';
      L_Text028@1000000052 : TextConst 'DEU=Den vollen Bruttobetrag haben wir bereits eingezogen/reserviert und sichern Ihnen hiermit verbindlich die Auszahlung zu vereinbarten Konditionen zu.';
      L_Text029@1000000053 : TextConst 'DEU=Bitte beachten Sie, dass Sie mindestens die Liefer-KW eintragen und auf Aktualisieren klicken mÅssen, damit der Lieferschein erzeugt wird. Sie brauchen dafÅr fortan keine AuftragsbestÑtigungen mehr auf anderem Wege zusenden.';
      L_Text030@1000000060 : TextConst 'DEU=Kunde:';
      L_TextT001@1000000058 : TextConst 'DEU=Menge;ENU=Quantity';
      L_TextT002@1000000057 : TextConst 'DEU=Beschreibung (Artikelnr.);ENU=Description';
      L_TextT003@1000000056 : TextConst 'DEU=VK-Preis;ENU=Sales Price';
      L_TextT004@1000000055 : TextConst 'DAN=Enhed;DEU=Ihre SKU;ENU=Unit;ESP=Unidad;FRA=UnitÇ;SVE=Enhet';
      L_TextT005@1000000059 : TextConst 'DEU=Max. Liefer-KW';
      L_TextI001@1000000035 : TextConst 'DEU=Impressum';
      L_TextI002@1000000036 : TextConst 'DEU=Eingetragen beim %1';
      L_TextI004@1000000038 : TextConst 'DEU=USt-ID: %1';
      L_TextI005@1000000039 : TextConst 'DEU=GeschÑftsfÅhrer %1, %2';
      L_TextI006@1000000040 : TextConst 'DEU=(Montag - Freitag 09:00 - 18:00 Uhr)';
      Text040@1000000019 : TextConst 'DAN=Der blev ikke dannet et PDF-dokument.;DEU=Es wurde kein PDF Dokument erzeugt.;ENU=No PDF Document was generated.;ESP=No se gener¢ ning£n documento PDF.;FRA=Aucun document PDF n''a ÇtÇ crÇÇ.;SVE=Inget PDF-dokument skapades.';
      LinkID@1000000043 : Code[10];
      L_MaxKW@1000000061 : Text[10];
      L_Hash@1000000062 : Text[250];
      L_Port@1000000024 : Integer;
      PurchLineLoc@1108200000 : Record 39;
      DHLHDLabelReport@1108200001 : Report 50008;
      VendLoc@1108200002 : Record 23;
      SKUOK@1108200003 : Boolean;
      LabelCounter@1108200004 : Integer;
      Purchlineloc2@1108200005 : Record 39;
      L_Text031@1000000067 : TextConst 'ENU="Artikel-Bezeichnung: "';
      L_Text032@1000000066 : TextConst 'ENU="Unsere Artikelnr.: "';
      L_Text033@1000000020 : TextConst 'ENU="Ihre Artikelnr.: "';
      L_Text034@1000000018 : TextConst 'ENU="Menge: "';
      L_Text035@1000000068 : TextConst 'ENU=Unsere Kundennr.: %1';
      L_Text036@1000000069 : TextConst 'ENU="Versandart: "';
      L_Text037@1000000070 : TextConst 'ENU=Auftragsdatum: %1';
      SalesLineLoc@1000000071 : Record 37;
      "**** HME ********************"@1000000072 : Integer;
      SparPartMgtL@1000000075 : Codeunit 50322;
      IsSparePartOrderL@1000000074 : Boolean;
      ContainsDefectLineL@1000000073 : Boolean;
    BEGIN
      //A/gob-rste/28.06.12/GOB1.07
      LT_MailITSetup.GET;
      LT_MailITSetup.TESTFIELD("User Name (Special Order)");
      LT_MailITSetup.TESTFIELD("Password (Special Order)");
      LT_MailITSetup.TESTFIELD("Special Order E-Mail");
      LT_MailITSetup.TESTFIELD("Special Order E-Mail BCC");
      UserSetup.GET(USERID);
      UserSetup.TESTFIELD("PDF Creator");
      //H2078 04.02.15 EHN +++++++++++++++++++++++++++++++++++
      IsSparePartOrderL := SparPartMgtL.IsSparePartOrderFromPOrder(_PurchOrderHeader);
      ContainsDefectLineL := SparPartMgtL.CheckForDefectLine(_PurchOrderHeader);
      //H2078 04.02.15 EHN -----------------------------------

      _PurchOrderHeader.SETRECFILTER;
      _SalesOrderHeader.SETRECFILTER;
      LT_WebSiteTransfer.SETRANGE("Website No.",_SalesOrderHeader."Website No.");
      LT_WebSiteTransfer.FINDFIRST;
      LT_WebSiteTransfer.CALCFIELDS("Website Name");
      MailText := LT_WebSiteTransfer."Website Name" +': '+ L_Text001 +' '+ _PurchOrderHeader."No." +' '+
        L_Text002 +' '+ _SalesOrderHeader."Ship-to Name";

      // H0773 22.01.14 FX +++++++++++++++++++++++++++++++++++++++++++++++++
        IF (PurchHeader.CheckSecondEMail(_PurchOrderHeader) <> '') AND
          (PurchHeader.CheckSecondEMail(_PurchOrderHeader) <> '!') THEN
        MailText += TEXT0004HME;
      // H0773 22.01.14 FX -----------------------------------------------

      DocName := LT_WebSiteTransfer."Website Name" +'_Labels_'+  _PurchOrderHeader."No.";
      DocName2 := LT_WebSiteTransfer."Website Name" +'_Packzettel_'+  _PurchOrderHeader."No.";
      ReportID := 50020;
      CREATE(ClientFso,TRUE,TRUE);
      CREATE(ClientUtil,TRUE,TRUE);
      CREATE(DivUtil,TRUE,TRUE);
      JobID := MailIT.CreateGUID();

      // Get folder for temporary files on the client
      ClientTempFolder := ClientUtil.GetTempPath();
      IF ClientTempFolder = '' THEN
        ERROR('Unable to create the path of the temporary folder.');
      ClientTempFolder := ClientTempFolder + 'ExpMail';
      IF NOT ClientFso.FolderExists(ClientTempFolder) THEN
        ClientFso.CreateFolder(ClientTempFolder);
      ClientTempFolder := ClientTempFolder + '\' + JobID;
      IF NOT ClientFso.FolderExists(ClientTempFolder) THEN
        ClientFso.CreateFolder(ClientTempFolder);

      // Locate bill to Vendor
      Vend.GET(_PurchOrderHeader."Buy-from Vendor No.");
      CompanyInfo.GET;

      // Initialize the email
      IF SendMailDirect THEN
        MailIT.SetService('SMTP')
      ELSE
        MailIT.SetService(FORMAT(UserSetup."Mail Client"));

      //H2078 10.02.15 EHN +++++++++++++++++++++++++++++++++++
      IF IsSparePartOrderL THEN
        MailIT.SetFrom(LT_MailITSetup."SparePart Order E-Mail")
      ELSE
        MailIT.SetFrom(LT_MailITSetup."User Name (Direct)");
      //H2078 10.02.15 EHN -----------------------------------

      IF NOT LT_MailITSetup."Test Mode" THEN
        MailIT.AddRecipientBCC(LT_MailITSetup."Purchase E-Mail BCC (Direct)",LT_MailITSetup."Purchase E-Mail BCC (Direct)")
      ELSE
        MailIT.AddRecipientBCC(LT_MailITSetup."Test E-Mail BCC",LT_MailITSetup."Test E-Mail BCC");

      IF (Vend."Primary Contact No. (Direct)" <> '') AND Cont.GET(Vend."Primary Contact No. (Direct)") AND (Cont."E-Mail" <> '') THEN
        Vend."E-Mail" := Cont."E-Mail";

      Vend.TESTFIELD("E-Mail");

      IF Vend."E-Mail" <> '' THEN
        IF LT_MailITSetup."Test Mode" THEN
          MailIT.AddRecipient(LT_MailITSetup."Test E-Mail",LT_MailITSetup."Test E-Mail")
        ELSE
          MailIT.AddRecipient(Vend."E-Mail",Vend."E-Mail");

      MailIT.SetSubject(MailText);


      _PurchOrderHeader."Ship-to Country/Region Code" := '';
      FormatAddr.SalesHeaderShipTo(ShipAddr,_SalesOrderHeader);
      MailIT.LoadHTMLBody('C:\Mailhtml\header.html');
      MailIT.AppendHTML('<font face="Arial","sans-serif">');
      //A/P0305
      MailIT.AppendHTML('<table width=590 border=0>');
      //E/P0305
      IF _PurchOrderHeader."Buy-from Contact" <> '' THEN
        MailIT.AppendHTML(STRSUBSTNO(L_Text010,_PurchOrderHeader."Buy-from Contact") + '<br /><br />')
      ELSE
        MailIT.AppendHTML(STRSUBSTNO(L_Text010a) + '<br /><br />');

      //H2078 05.02.15 EHN +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
      IF IsSparePartOrderL AND ContainsDefectLineL THEN
        MailIT.AppendHTML('<b>'+ HMEText020 + '</b><br /><br />')
      ELSE
        MailIT.AppendHTML('<b>'+ STRSUBSTNO(L_Text011,CompanyInfo.Name) + '</b><br /><br />');
      //H2078 05.02.15 EHN -----------------------------------------------------------------

      //A/gob-rste/30.07.12/GOB1.14

      // H0773 23.01.14 FX +++++++++++++++++++++++++++++++++++++++++
        IF (PurchHeader.CheckSecondEMail(_PurchOrderHeader) <> '') AND
          (PurchHeader.CheckSecondEMail(_PurchOrderHeader) <> '!') THEN
          ConditionalText := TEXT0004HME
        ELSE
          ConditionalText := '';
      MailIT.AppendHTML('<font size="5">' + STRSUBSTNO(L_Text013,_PurchOrderHeader."No.") + ConditionalText +
        '</font>' + '<br /><br />');
      // H0773 23.01.14 FX -------------------------------------------------------------------------------------------------

      //E/gob-rste/30.07.12/GOB1.14
      //a/gob-sfe/05.07.2012
      IF CheckAlternativeEMail(_PurchOrderHeader) THEN BEGIN
        IF Vend."Our Account No."<>'' THEN
          MailIT.AppendHTML(STRSUBSTNO(L_Text035,Vend."Our Account No.") + '<br />');
        //A/gob-rste/25.07.12/GOB1.11
        MailIT.AppendHTML(STRSUBSTNO(L_Text037,_PurchOrderHeader."DHL HD Transfer Date") + '<br /><br />');
        //E/gob-rste/25.07.12/GOB1.11

        Purchlineloc2.RESET;
        Purchlineloc2.SETRANGE("Document Type",_PurchOrderHeader."Document Type");
        Purchlineloc2.SETRANGE("Document No.",_PurchOrderHeader."No.");
        Purchlineloc2.SETRANGE(Type,Purchlineloc2.Type::Item);
        IF Purchlineloc2.FINDSET THEN
          REPEAT
            Item.GET(Purchlineloc2."No.");
            //H4267, H3847 20.05.15 EHN +++++++++++++++++++++++++++++
            IF (Item."Vendor Description" <> '') THEN BEGIN
              IF IsSparePartOrderL THEN
                MailIT.AppendHTML(L_Text031 + Item."Vendor Description" + Purchlineloc2."Description 2" + '<br />')
              ELSE
                MailIT.AppendHTML(L_Text031 + Item."Vendor Description" +'<br />')
            END ELSE
            //H4267, H3847 20.05.15 EHN -----------------------------
              MailIT.AppendHTML(L_Text031 + Purchlineloc2.Description + Purchlineloc2."Description 2" +'<br />');
            MailIT.AppendHTML(L_Text032 + Purchlineloc2."No." +'<br />');
            MailIT.AppendHTML(L_Text033 + Item."Vendor Item No." + Item."Vendor Item No. Add." +'<br />');
            MailIT.AppendHTML(L_Text034 + FORMAT(Purchlineloc2.Quantity) +'<br />');
            IF SalesLineLoc.GET(Purchlineloc2."Document Type"::Order,
                                Purchlineloc2."Special Order Sales No.",Purchlineloc2."Special Order Sales Line No.") THEN
              MailIT.AppendHTML(L_Text036 + FORMAT(SalesLineLoc."Transp. Type") +'<br /><br />');
          UNTIL Purchlineloc2.NEXT=0;

        MailIT.AppendHTML(L_Text014 + '<br />');  //Versandaddresse
        MailIT.AppendHTML(_PurchOrderHeader."Ship-to Name" + '<br />');
        MailIT.AppendHTML(_PurchOrderHeader."Ship-to Address" + '<br />');
        MailIT.AppendHTML(_PurchOrderHeader."Ship-to Post Code" + ' ');
        MailIT.AppendHTML(_PurchOrderHeader."Ship-to City" + '<br />');
      END ELSE BEGIN
      //e/gob-sfe/05.07.2012
        //A,gob-dst,29.08.2012,P0252
        IF _PurchOrderHeader."Location Code" = 'RHE-CD-GER' THEN BEGIN
          MailIT.AppendHTML(L_Text014 + '<br />');  //Versandaddresse
          MailIT.AppendHTML(_PurchOrderHeader."Ship-to Name" + '<br />');
          MailIT.AppendHTML(_PurchOrderHeader."Ship-to Address" + '<br />');
          MailIT.AppendHTML(_PurchOrderHeader."Ship-to Post Code" + ' ');
          MailIT.AppendHTML(_PurchOrderHeader."Ship-to City" + '<br />');
        END ELSE BEGIN
        //E,gob-dst,29.08.2012,P0252
          MailIT.AppendHTML(L_Text014 + '<br />');
          FOR i := 1 TO 8 DO
            IF ShipAddr[i] <> '' THEN
              MailIT.AppendHTML(ShipAddr[i] + '<br />');
        //A,gob-dst,29.08.2012,P0252
        END;
        //E,gob-dst,29.08.2012,P0252
      END; //gob-sfe/05.07.2012

      MailIT.AppendHTML('</table>');
      MailIT.AppendHTML(L_Text015 + '<br /><br />');

      // Fusszeilen
      //A/P0305
      MailIT.AppendHTML('<table width=590 border=0>');
      //E/P0305
      MailIT.AppendHTML(L_Text012 + '<br /><br />');
      MailIT.AppendHTML('<br />');
      MailIT.AppendHTML('<p style=''background:#B3C5C5''>');
      MailIT.AppendHTML(STRSUBSTNO(L_Text016,LT_WebSiteTransfer."Website Name") + '<br /><br />');
      MailIT.AppendHTML(L_Text017 + '<br />');
      MailIT.AppendHTML(LT_MailITSetup."Purchase Group (Direct)" + '<br />');
      MailIT.AppendHTML(STRSUBSTNO(L_Text018,LT_MailITSetup."Purchase Phone No. (Direct)",
                        LT_MailITSetup."Purchase Fax No. (Direct)") + '<br />');
      //H2078 04.02.15 EHN +++++++++++++++++++++++++++++++++++
      IF IsSparePartOrderL THEN
        MailIT.AppendHTML('E-Mail: ' + LT_MailITSetup."SparePart Order E-Mail" + '<br /><br />')
      ELSE
        MailIT.AppendHTML('E-Mail: ' + LT_MailITSetup."Purchase E-Mail BCC (Direct)" + '<br /><br />');
      //H2078 04.02.15 EHN -----------------------------------
      MailIT.AppendHTML('</p>');

      MailIT.LoadHTMLBody('C:\Mailhtml\footer.html');

      ClientPdfFileName := ClientTempFolder + '\' + DocName2 + '.pdf';
      IF ClientFso.FileExists(ClientPdfFileName) THEN
        ClientFso.DeleteFile(ClientPdfFileName);
      MailIT.PDFParameter('Output',ClientPdfFileName);
      MailIT.PDFParameter('ShowPDF','no');
      MailIT.PDFParameter('Title',DocName2);
      MailIT.PDFParameter('Author',USERID);
      MailIT.PDFPreparePrinter();
      IF NOT DefaultPrinterChanged THEN BEGIN
        IF OldDefaultPrinter = '' THEN
          OldDefaultPrinter := MailIT.GetDefaultPrinter();
        IF OldDefaultPrinter <> UserSetup."PDF Creator" THEN BEGIN
          MailIT.SetDefaultPrinter(UserSetup."PDF Creator");
          DefaultPrinterChanged := TRUE;
        END;
      END;

      LR_SalesOrder.SetParameters(_PurchOrderHeader."No.");
      LR_SalesOrder.SETTABLEVIEW(_SalesOrderHeader);
      LR_SalesOrder.USEREQUESTFORM(FALSE);
      LR_SalesOrder.RUNMODAL;

      IF (MailIT.WaitForFile(ClientPdfFileName,20000) = 0) THEN
        ERROR(Text040);
      MailIT.AddAttachment(ClientPdfFileName);

      LabelCounter := 0;
      IF _PurchOrderHeader.Kommissionierung THEN BEGIN
      PurchLineLoc.SETRANGE("Document Type",_PurchOrderHeader."Document Type");
      PurchLineLoc.SETRANGE("Document No.",_PurchOrderHeader."No.");
      //A,gob-dst,15.08.2012,P0199
      PurchLineLoc.SETRANGE("Purchasing Code",'GER-4');
      //E,gob-dst,15.08.2012,P0199
        IF PurchLineLoc.FIND('-') THEN BEGIN
          //REPEAT
            LabelCounter +=1;
            ClientPdfFileName := ClientTempFolder + '\' + DocName + '.pdf';

            IF ClientFso.FileExists(ClientPdfFileName) THEN
              ClientFso.DeleteFile(ClientPdfFileName);
            MailIT.PDFParameter('Output',ClientPdfFileName);
            MailIT.PDFParameter('ShowPDF','no');
            MailIT.PDFParameter('Title',DocName2);
            MailIT.PDFParameter('Author',USERID);
            MailIT.PDFPreparePrinter();
            IF NOT DefaultPrinterChanged THEN BEGIN
              IF OldDefaultPrinter = '' THEN
                OldDefaultPrinter := MailIT.GetDefaultPrinter();
              IF OldDefaultPrinter <> UserSetup."PDF Creator" THEN BEGIN
                MailIT.SetDefaultPrinter(UserSetup."PDF Creator");
                DefaultPrinterChanged := TRUE;
              END;
            END;
            Purchlineloc2.RESET;
            Purchlineloc2.SETRANGE("Document Type",PurchLineLoc."Document Type");
            Purchlineloc2.SETRANGE("Document No.",PurchLineLoc."Document No.");
            //A,gob-dst,15.08.2012,P0199
            Purchlineloc2.SETRANGE("Purchasing Code",'GER-4');
            //E,gob-dst,15.08.2012,P0199
            IF Purchlineloc2.FIND('-') THEN BEGIN
              CLEAR(DHLHDLabelReport);
              DHLHDLabelReport.SETTABLEVIEW(Purchlineloc2);
              DHLHDLabelReport.USEREQUESTFORM(FALSE);
              DHLHDLabelReport.RUNMODAL;
            END;
            IF (MailIT.WaitForFile(ClientPdfFileName,20000) = 0) THEN
              ERROR(Text040);

            MailIT.AddAttachment(ClientPdfFileName);
          //UNTIL PurchLineLoc.NEXT = 0;
        END;
      END;

      CreateSpecialOrderCSV(_PurchOrderHeader,TempSalesHeader,ClientTempFolder);

      MailIT.AddAttachment(ClientTempFolder + '\order.csv');
      IF DefaultPrinterChanged THEN
        MailIT.SetDefaultPrinter(OldDefaultPrinter);

      IF SendMailDirect THEN BEGIN
        MailIT.SetServer(LT_MailITSetup."Mail Server");
        IF LT_MailITSetup."Server Port" = '' THEN
          L_Port := 25
        ELSE
          EVALUATE(L_Port,LT_MailITSetup."Server Port");
        MailIT.SetPort(L_Port);
        //H0709 30.01.14 MBY +++++++++++++
        IF LT_MailITSetup.Authentication THEN BEGIN
        //H0709 30.01.14 MBY -------------
          MailIT.SetLogin(LT_MailITSetup."User Name (Direct)");
          MailIT.SetPassword(LT_MailITSetup."Password (Direct)");
        //H0709 30.01.14 MBY +++++++++++++
        END;
        //H0709 30.01.14 MBY -------------
        MailIT.Send;
      END ELSE
        MailIT.Display;

      //H2108 10.02.15 DMO +++++++++++++++++++++++++++++++++++
      PurchHeader.GET(_PurchOrderHeader."Document Type",_PurchOrderHeader."No.");
      PurchHeader."No. of Sent POs" += 1;
      PurchHeader.MODIFY;
      //H2108 10.02.15 DMO -----------------------------------

      IF FORMAT(UserSetup."Mail Client") <> 'MAPI' THEN
        IF ClientFso.FolderExists(ClientTempFolder) THEN
          ClientFso.DeleteFolder(ClientTempFolder, FALSE);
      CLEAR(ClientFso);
      CLEAR(ClientUtil);
      CLEAR(DivUtil);
      //E/gob-rste/28.06.12/GOB1.07
    END;

    LOCAL PROCEDURE CreateSpecialOrderCSV@1108200002(_PurchOrderHeader@1000000002 : Record 38;_SalesOrderHeader@1000000004 : Record 36;_ExpFilePath@1000000016 : Text[250]);
    VAR
      LT_NavCSalesHeader@1000000009 : Record 5251571;
      LT_PaymMethode@1000000001 : Record 289;
      LT_BankAcc@1000000000 : Record 270;
      LT_Cust@1000000013 : Record 18;
      LT_Location@1000000015 : Record 14;
      LC_DHLMgt@1000000012 : Codeunit 50020;
      L_ShipAddr@1000000011 : ARRAY [14] OF Text[80];
      L_InvAddr@1000000010 : ARRAY [14] OF Text[80];
      L_DropShip@1000000017 : Boolean;
      L_Factoring@1000000003 : Text[1];
      L_SalesPrice@1000000006 : Decimal;
      L_FS@1000000007 : Text[1];
      L_TS@1000000008 : Text[1];
      Cust@1108200000 : Record 18;
      "****HME*****************"@1000000019 : Integer;
      ItemDescrL@1000000005 : Text[250];
    BEGIN
      //A/gob-rste/28.06.12/GOB1.07
      _ExpFilePath := _ExpFilePath + '\order.csv';
      ExpFile.CREATE(_ExpFilePath);
      ExpFile.WRITEMODE(TRUE);
      ExpFile.TEXTMODE(TRUE);
      ExpFile.OPEN(_ExpFilePath);
      ExpFile.WRITE(
        '"Kommissionsnr.","Menge","Artikelnr_MP","SKU","Beschreibung","Versand_Anrede","Versand_Vorname","Versand_Nachname",' +
        '"Versand_Strasse","Versand_Hausnummer","Versand Strasse 2","Versand_PLZ",' +
        '"Versand_Stadt","Versand_Land","Versand_Kontakt","Versand_Telefon"');

      L_Factoring := '0';
      CLEAR(LT_BankAcc);
      CLEAR(L_ShipAddr);
      CLEAR(L_InvAddr);
      LT_NavCSalesHeader.RESET;
      LT_NavCSalesHeader.SETCURRENTKEY("Sales Document No.");
      LT_NavCSalesHeader.SETRANGE("Sales Document No.",_SalesOrderHeader."No.");
      IF LT_NavCSalesHeader.FINDFIRST THEN BEGIN
        L_ShipAddr[1] := LT_NavCSalesHeader."Ship-to Job Title";
        L_ShipAddr[2] := LT_NavCSalesHeader."Ship-to First Name";
        L_ShipAddr[3] := LT_NavCSalesHeader."Ship-to Surname";
        L_ShipAddr[4] := LT_NavCSalesHeader."Ship-to Address";
        L_ShipAddr[5] := '';
        L_ShipAddr[6] := _SalesOrderHeader."Ship-to Address 2";
        L_ShipAddr[7] := LT_NavCSalesHeader."Ship-to Post Code";
        L_ShipAddr[8] := LT_NavCSalesHeader."Ship-to City";
        L_ShipAddr[9] := LT_NavCSalesHeader."Ship-to Country Code";
        L_ShipAddr[10] := _SalesOrderHeader."Ship-to Contact";
        IF Cust.GET(_SalesOrderHeader."Sell-to Customer No.") THEN
          L_ShipAddr[11] := Cust."Phone No.";
        L_ShipAddr[12] := _SalesOrderHeader."No.";
        L_ShipAddr[13] := LT_NavCSalesHeader."Ship-to Company Name";
        L_ShipAddr[14] := '';

      END;

      L_FS := ',';
      L_TS := '"';
      PurchLine.RESET;
      PurchLine.SETRANGE("Document Type",_PurchOrderHeader."Document Type");
      PurchLine.SETRANGE("Document No.",_PurchOrderHeader."No.");
      PurchLine.SETRANGE(Type,PurchLine.Type::Item);
      PurchLine.SETFILTER("No.",'<>%1','');
      PurchLine.SETFILTER(Quantity,'<>0');
      IF PurchLine.FINDSET THEN REPEAT
        IF (PurchLine.Type <> PurchLine.Type::Item) OR (NOT Item.GET(PurchLine."No.")) THEN
          CLEAR(Item);
        //H3847 07.04.15 DMO +++++++++++++++++++++++++++++
        Item.GET(PurchLine."No.");
        IF Item."Vendor Description" <> '' THEN
          ItemDescrL := Item."Vendor Description"
        ELSE
          ItemDescrL := PurchLine.Description + ' ' + PurchLine."Description 2";
        //H3847 07.04.15 DMO -----------------------------
        ExpFile.WRITE(
          L_TS + _PurchOrderHeader."No." + L_TS + L_FS +
          FORMAT(PurchLine.Quantity) + L_FS +
          L_TS + PurchLine."No." + L_TS + L_FS +
          //A/gob-rste/06.09.12/GOB1.22
          //L_TS + Item."Vendor Item No." + L_TS + L_FS +
          L_TS + Item."Vendor Item No." + Item."Vendor Item No. Add." + L_TS + L_FS +
          //E/gob-rste/06.09.12/GOB1.22
          //H3847 07.04.15 DMO +++++++++++++++++++++++++++++
          L_TS + ConvertText(ItemDescrL) + L_TS + L_FS +
          //H3847 07.04.15 DMO -----------------------------
          L_TS + ConvertText(L_ShipAddr[1]) + L_TS + L_FS +
          L_TS + ConvertText(L_ShipAddr[2]) + L_TS + L_FS +
          L_TS + ConvertText(L_ShipAddr[3]) + L_TS + L_FS +
          L_TS + ConvertText(L_ShipAddr[4]) + L_TS + L_FS +
          L_TS + ConvertText(L_ShipAddr[5]) + L_TS + L_FS +
          L_TS + ConvertText(L_ShipAddr[6]) + L_TS + L_FS +
          L_TS + ConvertText(L_ShipAddr[7]) + L_TS + L_FS +
          L_TS + ConvertText(L_ShipAddr[8]) + L_TS + L_FS +
          L_TS + ConvertText(L_ShipAddr[9]) + L_TS + L_FS +
          L_TS + ConvertText(L_ShipAddr[10]) + L_TS + L_FS +
          L_TS + ConvertText(L_ShipAddr[11]) + L_TS + L_FS +
          L_TS + ConvertText(L_ShipAddr[12]) + L_TS + L_FS +
          L_TS + ConvertText(L_ShipAddr[13]) + L_TS + L_FS +
          L_TS + ConvertText(L_ShipAddr[14]));

      UNTIL PurchLine.NEXT = 0;
      ExpFile.CLOSE;
      //E/gob-rste/28.06.12/GOB1.07
    END;

    PROCEDURE CheckAlternativeEMail@1000000010(PurchHeader@1000000000 : Record 38) : Boolean;
    VAR
      Vendor@1000000001 : Record 23;
    BEGIN
      //a/gob-sfe/04.07.2012
      Vendor.GET(PurchHeader."Buy-from Vendor No.");
      EXIT(Vendor."Alternative E-Mail");
      //e/gob-sfe/04.07.2012
    END;

    PROCEDURE CreateSplittedPurchOrderMail@1000000008(OriginalDocNo@1000000000 : Code[20]);
    VAR
      LT_MailITSetup@1000000001 : Record 75402;
      L_Text001@1000000002 : TextConst 'DEU=Umlegung der Bestellung';
      MailText@1000000003 : Text[250];
      DocName2@1000000004 : Text[250];
      PurchOrderHeader@1000000005 : Record 38;
      ReportID@1000000006 : Integer;
      ClientFso@1000000010 : Automation "{420B2830-E718-11CF-893D-00A0C9054228} 1.0:{0D43FE01-F093-11CF-8940-00A0C9054228}:'Microsoft Scripting Runtime'.FileSystemObject";
      ClientUtil@1000000009 : Automation "{1639594D-2135-4248-BE9B-FB55210F8AD8} 1.0:{D7CD856D-3889-4F19-BBBA-7608CF34EFB6}:'ExpandIT Dynamics Role Tailored Client Utility'.Utility";
      DivUtil@1000000008 : Automation "{2CD8D481-009C-4685-98EA-BC16452327B2} 1.0:{F1BBE10B-6E48-41B0-9EF6-F428C7A48655}:'Dynovus_SHA1Encryption'.SHA1EncryptAutomation";
      MailIT@1000000007 : OCX "{C8C4804C-89BA-4291-AB58-4C6050B65175}:'ExpandIT.MailIT2'";
      JobID@1000000011 : Text[50];
      ClientTempFolder@1000000014 : Text[250];
      ClientPdfFileName@1000000013 : Text[250];
      ClientFileName@1000000012 : Text[250];
      FormatAddr@1000000015 : Codeunit 365;
      ShipAddr@1000000016 : ARRAY [8] OF Text[80];
      L_Text010@1000000049 : TextConst 'DEU=Sehr geehrte(r) %1,';
      L_Text010a@1000000048 : TextConst 'DEU=Sehr geehrte Damen und Herren,';
      L_Text011@1000000047 : TextConst 'DEU=anbei erhalten Sie eine Bestellung auf Rechnung %1';
      L_Text012@1000000046 : TextConst 'DEU=Anbei der Lieferschein, der der Sendung beigefÅgt werden kann.';
      L_Text013@1000000045 : TextConst 'DEU=Unsere Bestellnummer: %1';
      L_Text014@1000000044 : TextConst 'DEU=Versandadresse:';
      L_Text015@1000000043 : TextConst 'DEU=Bitte schicken Sie uns eine AuftragsbestÑtigung innerhalb von 24h mit dem geplanten Liefertermin und der bestÑtigten Anzahl als Antwort auf diese E-Mail.';
      L_Text016@1000000042 : TextConst 'DEU=Vielen Dank fÅr die Zusammenarbeit mit %1 !';
      L_Text017@1000000041 : TextConst 'DEU=Mit freundlichen GrÅ·en';
      L_Text018@1000000040 : TextConst 'DEU=Tel: %1 | Fax: %2';
      L_Text019@1000000039 : TextConst 'DEU=die Bestellung %1 wurde aufgrund Ihrer AuftragsbestÑtigung/Avisierung in mehrere Einzelbestellungen gesplittet. Die neuen Bestellnummern lauten wie folgt:';
      L_Text020@1000000038 : TextConst 'DEU=Bitte beachten Sie, dass es fÅr eine reibungslose Anlieferung notwendig ist, die o.g. Bestellnummern auf den entsprechenden Lieferscheinen zu hinterlegen.';
      L_Text021@1000000037 : TextConst 'DEU=Bitte beachten Sie auch, dass Sie spÑtestens %1 vor Anlieferung Ihre Anlieferung avisieren.';
      L_Text022@1000000036 : TextConst 'DEU=Bitte liefern Sie an folgende Adresse:';
      L_Text023@1000000035 : TextConst 'DEU=Entladezeit: %1';
      L_Text024@1000000034 : TextConst 'DEU=Ansprechpartner fÅr die Lieferavisierung ist %1.';
      L_Text025@1000000033 : TextConst 'DEU="Bitte setzen Sie sich zwecks Avisierung rechtzeitig mit unserem Team in Verbindung: "';
      L_TextI006@1000000018 : TextConst 'DEU=(Montag - Freitag 09:00 - 18:00 Uhr)';
      Text040@1000000017 : TextConst 'DAN=Der blev ikke dannet et PDF-dokument.;DEU=Es wurde kein PDF Dokument erzeugt.;ENU=No PDF Document was generated.;ESP=No se gener¢ ning£n documento PDF.;FRA=Aucun document PDF n''a ÇtÇ crÇÇ.;SVE=Inget PDF-dokument skapades.';
      LT_Location@1000000050 : Record 14;
      LT_ExtTextLine@1000000051 : Record 280;
      DefaultPrinterChanged@1000000052 : Boolean;
      OldDefaultPrinter@1000000053 : Text[250];
      L_Port@1000000054 : Integer;
      PurchOrderHeader2@1000000055 : Record 38;
      ReportLoc@1000000056 : Report 405;
      PurchOrderHeader3@1000000057 : Record 38;
      L_Text030@1000000019 : TextConst 'DEU=Die neuen PO-Nummern lauten wie folgt:';
      OrderNo@1000000020 : ARRAY [20] OF Code[20];
      NoOfOrders@1000000021 : Integer;
      "*HME**********"@1000000023 : Integer;
      PurchaseMailHTMLPathL@1000000022 : Record 50339;
      MailITSetupL@1000000024 : Record 75402;
    BEGIN
      //A/gob-mab/p0072/23.07.12
      LT_MailITSetup.GET;
      LT_MailITSetup.TESTFIELD("User Name (General)");
      LT_MailITSetup.TESTFIELD("Password (General)");
      LT_MailITSetup.TESTFIELD("Mail Server");
      UserSetup.GET(USERID);
      UserSetup.TESTFIELD("PDF Creator");

      PurchOrderHeader.RESET;
      PurchOrderHeader.SETRANGE("Document Type",PurchOrderHeader."Document Type" :: Order);
      PurchOrderHeader.SETRANGE("No.",OriginalDocNo);
      PurchOrderHeader.FINDFIRST;

      LT_Location.GET(PurchOrderHeader."Location Code");
      MailText := L_Text001 + ' ' + PurchOrderHeader."No.";

      CREATE(ClientFso,TRUE,TRUE);
      CREATE(ClientUtil,TRUE,TRUE);
      CREATE(DivUtil,TRUE,TRUE);
      JobID := MailIT.CreateGUID();

      // Get folder for temporary files on the client
      ClientTempFolder := ClientUtil.GetTempPath();
      IF ClientTempFolder = '' THEN
        ERROR('Unable to create the path of the temporary folder.');
      ClientTempFolder := ClientTempFolder + 'ExpMail';
      IF NOT ClientFso.FolderExists(ClientTempFolder) THEN
        ClientFso.CreateFolder(ClientTempFolder);
      ClientTempFolder := ClientTempFolder + '\' + JobID;
      IF NOT ClientFso.FolderExists(ClientTempFolder) THEN
        ClientFso.CreateFolder(ClientTempFolder);

      // Locate bill to customer
      Vend.GET(PurchOrderHeader."Buy-from Vendor No.");
      CompanyInfo.GET;

      // Initialize the email
      IF SendMailDirect THEN
        MailIT.SetService('SMTP')
      ELSE
        MailIT.SetService(FORMAT(UserSetup."Mail Client"));

      MailIT.SetFrom(LT_MailITSetup."Purchase E-Mail BCC (Location)");

      //EmpfÑnger... BCC...
      IF NOT LT_MailITSetup."Test Mode" THEN
        MailIT.AddRecipientBCC(LT_MailITSetup."Purchase E-Mail BCC (Location)",LT_MailITSetup."Purchase E-Mail BCC (Location)")
      ELSE
        MailIT.AddRecipientBCC(LT_MailITSetup."Test E-Mail BCC",LT_MailITSetup."Test E-Mail BCC");

      IF (Vend."Primary Contact No. (Order)" <> '') AND Cont.GET(Vend."Primary Contact No. (Order)") AND (Cont."E-Mail" <> '') THEN
        Vend."E-Mail" := Cont."E-Mail";

      Vend.TESTFIELD("E-Mail");
      IF Vend."E-Mail" <> '' THEN
        IF LT_MailITSetup."Test Mode" THEN
          MailIT.AddRecipient(LT_MailITSetup."Test E-Mail",LT_MailITSetup."Test E-Mail")
        ELSE
          MailIT.AddRecipient(Vend."E-Mail",Vend."E-Mail");

      MailIT.SetSubject(MailText);

      // Add some HTML to the mail body
      PurchOrderHeader."Ship-to Contact" := '';
      PurchOrderHeader."Ship-to Country/Region Code" := '';
      FormatAddr.PurchHeaderShipTo(ShipAddr,PurchOrderHeader);

      MailIT.AppendHTML('<font face="Arial","sans-serif">');
      //MailIT.AppendHTML('<table width=744 border=0>');
      IF PurchOrderHeader."Buy-from Contact" <> '' THEN
        MailIT.AppendHTML(STRSUBSTNO(L_Text010,PurchOrderHeader."Buy-from Contact") + '<br /><br />')
      ELSE
        MailIT.AppendHTML(STRSUBSTNO(L_Text010a) + '<br /><br />');

      // text fÅr Umlegung
      MailIT.AppendHTML(STRSUBSTNO(L_Text019,PurchOrderHeader."No.") + '<br /><br />');
      //MailIT.AppendHTML('<b>'+ L_Text020 + '</b><br /><br />');
      //Neue PO Nummer:
      SetOrderNo(OrderNo,OriginalDocNo,NoOfOrders);

      //MailIT.AppendHTML(L_Text030 + '<br /><br />');

      FOR i := 1 TO NoOfOrders DO
        IF OrderNo[i] <> '' THEN
          //A/P0169
          //IF NoOfOrders <> i THEN
          //E/P0169
          MailIT.AppendHTML('- ' + OrderNo[i] + '<br /><br />');

      MailIT.AppendHTML(L_Text020 + '<br /><br />');

      MailIT.AppendHTML(L_Text022 + '<br /> <br />');


      //FormatAddr.PurchHeaderShipTo(ShipAddr,PurchOrderHeader);

        FOR i := 1 TO 8 DO
          IF ShipAddr[i] <> '' THEN
            MailIT.AppendHTML(ShipAddr[i] + '<br />');


        //Verteiler Avisierung Text
        //a/gob-sfe/P0092
        {
        MailIT.AppendHTML('<br /><br />' + L_Text025 + '<br /><br />');
        MailIT.AppendHTML(STRSUBSTNO(L_Text018,LT_Location."Phone No. 2",LT_Location."Fax No.") + '<br />');
        MailIT.AppendHTML('E-Mail: ' + LT_Location."E-Mail" + '<br /><br />');
        }
        MailIT.AppendHTML('<br /><br />');
        LT_ExtTextLine.SETRANGE("Table Name",LT_ExtTextLine."Table Name"::"Standard Text");
        LT_ExtTextLine.SETRANGE("No.",'BESTAVI');
        IF LT_ExtTextLine.FINDSET THEN REPEAT
          MailIT.AppendHTML(LT_ExtTextLine."Text (Long)" + '<br />');
        UNTIL LT_ExtTextLine.NEXT = 0;
        MailIT.AppendHTML('<br /><br />');
        //e/gob-sfe/P0099

        LT_ExtTextLine.SETRANGE("Table Name",LT_ExtTextLine."Table Name"::"Standard Text");
        LT_ExtTextLine.SETRANGE("No.",'BESTTEXT');
        IF LT_ExtTextLine.FINDSET THEN REPEAT
          MailIT.AppendHTML(LT_ExtTextLine."Text (Long)" + '<br />');
        UNTIL LT_ExtTextLine.NEXT = 0;

        MailIT.AppendHTML(L_Text017 + '<br />');
        MailIT.AppendHTML(LT_MailITSetup."Purchase Group (Direct)" + '<br />');
      MailIT.AppendHTML('</p>');

      // read footer file
      //H1671 11.03.15 ++++++++++++++++++++++++++++++++++++++
      //MailIT.LoadHTMLBody('C:\Mailhtml\footer.html');
      IF MailITSetupL.GET THEN BEGIN
        IF PurchaseMailHTMLPathL.GET(MailITSetupL."Splitted Order Mail Code",PurchOrderHeader."Language Code",
                                       PurchaseMailHTMLPathL.Type::footer) THEN
          MailIT.LoadHTMLBody(PurchaseMailHTMLPathL.Path)
        ELSE
          IF PurchaseMailHTMLPathL.GET(MailITSetupL."Splitted Order Mail Code",'DEU',PurchaseMailHTMLPathL.Type::footer) THEN
            MailIT.LoadHTMLBody(PurchaseMailHTMLPathL.Path)
      END;
      //H1671 11.03.15 --------------------------------------

      // Prepare to print it to PDF
      ClientPdfFileName := ClientTempFolder + '\' + DocName2 + '.pdf';
      IF ClientFso.FileExists(ClientPdfFileName) THEN
        ClientFso.DeleteFile(ClientPdfFileName);
      MailIT.PDFParameter('Output',ClientPdfFileName);
      MailIT.PDFParameter('ShowPDF','no');
      MailIT.PDFParameter('Title',DocName2);
      MailIT.PDFParameter('Author',USERID);
      MailIT.PDFPreparePrinter();
      IF NOT DefaultPrinterChanged THEN BEGIN
        IF OldDefaultPrinter = '' THEN
          OldDefaultPrinter := MailIT.GetDefaultPrinter();
        IF OldDefaultPrinter <> UserSetup."PDF Creator" THEN BEGIN
          MailIT.SetDefaultPrinter(UserSetup."PDF Creator");
          DefaultPrinterChanged := TRUE;
        END;
      END;

      PurchOrderHeader2.RESET;
      PurchOrderHeader2.SETRANGE("Document Type",PurchOrderHeader2."Document Type" :: Order);
      PurchOrderHeader2.SETFILTER("No.",OriginalDocNo + '*');
      IF PurchOrderHeader2.FIND('-') THEN BEGIN
        DocName2 := 'umgelegte Bestellung_'+  PurchOrderHeader2."No.";

        ClientPdfFileName := ClientTempFolder + '\' + DocName2 + '.pdf';
        IF ClientFso.FileExists(ClientPdfFileName) THEN
          ClientFso.DeleteFile(ClientPdfFileName);
        MailIT.PDFParameter('Output',ClientPdfFileName);
        MailIT.PDFParameter('ShowPDF','no');
        MailIT.PDFParameter('Title',DocName2);
        MailIT.PDFParameter('Author',USERID);
        MailIT.PDFPreparePrinter();
        IF NOT DefaultPrinterChanged THEN BEGIN
          IF OldDefaultPrinter = '' THEN
            OldDefaultPrinter := MailIT.GetDefaultPrinter();
          IF OldDefaultPrinter <> UserSetup."PDF Creator" THEN BEGIN
            MailIT.SetDefaultPrinter(UserSetup."PDF Creator");
            DefaultPrinterChanged := TRUE;
          END;
        END;
        CLEAR(ReportLoc);
        ReportLoc.SETTABLEVIEW(PurchOrderHeader2);
        ReportLoc.USEREQUESTFORM(FALSE);
        ReportLoc.RUNMODAL;

        //REPORT.RUN(ReportID,FALSE,TRUE,PurchOrderHeader2);
        IF (MailIT.WaitForFile(ClientPdfFileName,20000) = 0) THEN
          ERROR(Text040);
        MailIT.AddAttachment(ClientPdfFileName);
      END;

      PurchOrderHeader3.RESET;
      PurchOrderHeader3.SETRANGE("Document Type", PurchOrderHeader3."Document Type" :: Order);
      PurchOrderHeader3.SETRANGE("No.",OriginalDocNo + '*');
      IF PurchOrderHeader3.FIND('-') THEN BEGIN
        REPEAT
          PurchOrderHeader3."Split Email sent" := TRUE;
          PurchOrderHeader3.MODIFY;
        UNTIL PurchOrderHeader3.NEXT = 0;
      END;

      //MailIT.AddAttachment('D:\Lagerbestellungen\Anhang\20120413_FPCommerce_Avisierungsrichtlinien.pdf');

      // Restore the user's default printer selection
      IF DefaultPrinterChanged THEN
        MailIT.SetDefaultPrinter(OldDefaultPrinter);

      IF SendMailDirect THEN BEGIN
        MailIT.SetServer(LT_MailITSetup."Mail Server");
        IF LT_MailITSetup."Server Port" = '' THEN
          L_Port := 25
        ELSE
          EVALUATE(L_Port,LT_MailITSetup."Server Port");
        MailIT.SetPort(L_Port);
        //H0709 30.01.14 MBY +++++++++++++
        IF LT_MailITSetup.Authentication THEN BEGIN
        //H0709 30.01.14 MBY -------------
          MailIT.SetLogin(LT_MailITSetup."User Name (Location)");
          MailIT.SetPassword(LT_MailITSetup."Password (Location)");
        //H0709 30.01.14 MBY +++++++++++++
        END;
        //H0709 30.01.14 MBY -------------
        MailIT.Send();
      END ELSE
        MailIT.Display();

      // Remove the temporary folder and it's content.
      // If you use MAPI and Thunderbird or other MAPI email clints the they may require that
      // the image files remain on the disk until the mail is sent.
      IF FORMAT(UserSetup."Mail Client") <> 'MAPI' THEN
        IF ClientFso.FolderExists(ClientTempFolder) THEN
          ClientFso.DeleteFolder(ClientTempFolder, FALSE);
      CLEAR(ClientFso);
      CLEAR(ClientUtil);
      CLEAR(DivUtil);

      //E/gob-mab/p0072/23.07.12
    END;

    PROCEDURE SetOrderNo@1000000015(VAR OrderNo@1000000000 : ARRAY [20] OF Code[20];OriginalOrderNo@1000000001 : Code[20];VAR counter@1000000003 : Integer);
    VAR
      PurchOrderHeader@1000000002 : Record 38;
    BEGIN
      counter := 0;
      PurchOrderHeader.RESET;
      PurchOrderHeader.SETRANGE("Document Type", PurchOrderHeader."Document Type" :: Order);
      PurchOrderHeader.SETFILTER("No.",OriginalOrderNo + '*');
      IF PurchOrderHeader.FIND('-') THEN BEGIN
        counter := 0;
        REPEAT
          counter := counter + 1;
          OrderNo[counter] := PurchOrderHeader."No.";
        UNTIL PurchOrderHeader.NEXT = 0;
      END;
    END;

    PROCEDURE RealizePaymentAdviseMail@1000000011(VAR PmtLedgEntr@1000000000 : Record 5001902);
    VAR
      PmtLine@1000000001 : Record 5001903;
      LastAccNo@1000000002 : Code[20];
      LocVend@1000000003 : Record 23;
      GOB001@1000000004 : TextConst 'DEU=Payment Avis already sent per Mail. Do you want to send again?';
      UpdatePaymentLedgerEntry@1000000005 : Codeunit 50117;
    BEGIN
      LastAccNo := '';

      //CreatePaymentAdviseMail(PmtLedgEntr."Entry No.",'70110');

      IF PmtLedgEntr."Avis sent per Mail" THEN
        IF NOT CONFIRM(GOB001) THEN EXIT;

      PmtLine.RESET;
      PmtLine.SETCURRENTKEY("Payment No.","Account No.");
      PmtLine.SETRANGE("Payment No.",PmtLedgEntr."Payment No.");
      PmtLine.SETRANGE("Account Type",PmtLine."Account Type"::Vendor);
      PmtLine.SETRANGE("AVIS Letter",TRUE);
      IF PmtLine.FIND('-') THEN REPEAT
        IF PmtLine."Account No." <> LastAccNo THEN BEGIN
          LocVend.GET(PmtLine."Account No.");
          IF (LocVend."E-Mail Payment Advise" <> '') THEN
            CreatePaymentAdviseMail(PmtLedgEntr."Entry No.",PmtLine."Account No.");
          LastAccNo := PmtLine."Account No.";
          END;
        UNTIL PmtLine.NEXT = 0;

      //S/P1125
      //PmtLedgEntr."Avis sent per Mail" := TRUE;
      //PmtLedgEntr.MODIFY;
      UpdatePaymentLedgerEntry.RUN(PmtLedgEntr);
      //E/P1125
    END;

    PROCEDURE CreatePaymentAdviseMail@1000000012(PmtLedgEntryNo@1000000030 : Integer;VendNo@1000000000 : Code[20]);
    VAR
      LT_MailITSetup@1000000028 : Record 75402;
      LT_WebSiteTransfer@1000000034 : Record 50033;
      LT_WebSource@1000000026 : Record 5059;
      LT_Location@1000000044 : Record 14;
      LT_LabelDHL@1000000045 : Record 50020;
      FormatAddr@1000000023 : Codeunit 365;
      ClientFso@1000000005 : Automation "{420B2830-E718-11CF-893D-00A0C9054228} 1.0:{0D43FE01-F093-11CF-8940-00A0C9054228}:'Microsoft Scripting Runtime'.FileSystemObject";
      ClientUtil@1000000003 : Automation "{1639594D-2135-4248-BE9B-FB55210F8AD8} 1.0:{D7CD856D-3889-4F19-BBBA-7608CF34EFB6}:'ExpandIT Dynamics Role Tailored Client Utility'.Utility";
      DivUtil@1000000054 : Automation "{2CD8D481-009C-4685-98EA-BC16452327B2} 1.0:{F1BBE10B-6E48-41B0-9EF6-F428C7A48655}:'Dynovus_SHA1Encryption'.SHA1EncryptAutomation";
      MailIT@1000000006 : OCX "{C8C4804C-89BA-4291-AB58-4C6050B65175}:'ExpandIT.MailIT2'";
      ShipAddr@1000000012 : ARRAY [8] OF Text[80];
      MailText@1000000032 : Text[250];
      DocName@1000000016 : Text[250];
      DocName2@1000000021 : Text[250];
      JobID@1000000007 : Text[50];
      ClientTempFolder@1000000004 : Text[250];
      ClientPdfFileName@1000000015 : Text[250];
      ClientFileName@1000000022 : Text[250];
      OldDefaultPrinter@1000000013 : Text[250];
      DefaultPrinterChanged@1000000014 : Boolean;
      ReportID@1000000001 : Integer;
      L_Text001@1000000002 : TextConst 'DEU=Vielen Dank fÅr Ihre Bestellung Nr.:;ENU=Order No.:';
      L_Text010@1000000010 : TextConst 'DEU=Sehr geehrte(r) %1,';
      L_Text010a@1000000063 : TextConst 'DEU=Sehr geehrte Damen und Herren,';
      L_Text016@1000000025 : TextConst 'DEU=Vielen Dank fÅr die Zusammenarbeit mit %1 !';
      L_Text017@1000000027 : TextConst 'DEU=Mit freundlichen GrÅ·en';
      L_Text018@1000000033 : TextConst 'DEU=Tel: %1 | Fax: %2';
      L_TextI001@1000000035 : TextConst 'DEU=Impressum';
      L_TextI002@1000000036 : TextConst 'DEU=Eingetragen beim %1';
      L_TextI004@1000000038 : TextConst 'DEU=USt-ID: %1';
      L_TextI005@1000000039 : TextConst 'DEU=GeschÑftsfÅhrer %1, %2';
      L_TextI006@1000000040 : TextConst 'DEU=(Montag - Freitag 09:00 - 18:00 Uhr)';
      Text040@1000000019 : TextConst 'DAN=Der blev ikke dannet et PDF-dokument.;DEU=Es wurde kein PDF Dokument erzeugt.;ENU=No PDF Document was generated.;ESP=No se gener¢ ning£n documento PDF.;FRA=Aucun document PDF n''a ÇtÇ crÇÇ.;SVE=Inget PDF-dokument skapades.';
      LinkID@1000000043 : Code[10];
      L_MaxKW@1000000061 : Text[10];
      L_Hash@1000000062 : Text[250];
      L_Text011@1108200000 : TextConst 'DEU=anbei erhalten Sie Ihre Rechnung %1.';
      port@1108200001 : Integer;
      L_Port@1108200002 : Integer;
      LocPmtLedgEntr@1000000018 : Record 5001902;
      LocPmtLine@1000000008 : Record 5001903;
      GOBLocText001@1000000009 : TextConst 'DEU=Zahlungsavis';
      GOBLocText002@1000000011 : TextConst 'DEU=anbei Åbersenden wir das Avis zu unserer Zahlung vom %1.';
      GOBLocText003@1000000017 : TextConst 'DEU=FÅr RÅckfragen stehen wir gerne zur VerfÅgung.';
    BEGIN
      //A/temp
      SendMailDirect := TRUE;
      //E/temp

      LT_MailITSetup.GET;
      {***
      LT_MailITSetup.TESTFIELD("User Name Home24 (Invoice)");
      LT_MailITSetup.TESTFIELD("Password Home24 (Invoice)");
      LT_MailITSetup.TESTFIELD("Invoice E-Mail Home24");
      LT_MailITSetup.TESTFIELD("Invoice E-Mail Home24 BCC");
      ***}
      //H0709 28.11.13 MBY +++++++++++++
      IF LT_MailITSetup."Authentication Home24" THEN BEGIN
        LT_MailITSetup.TESTFIELD(LT_MailITSetup."User Name Home24 (Paymt Avise)");
        LT_MailITSetup.TESTFIELD(LT_MailITSetup."Password Home24 (Paymt Avise)");
      END;
      //H0709 28.11.13 MBY -------------
      LT_MailITSetup.TESTFIELD(LT_MailITSetup."Payment Avise E-Mail Home24");

      LT_MailITSetup.TESTFIELD("Mail Server Home24");
      LT_MailITSetup.TESTFIELD("Server Port Home24");

      Vend.GET(VendNo);
      LocPmtLedgEntr.GET(PmtLedgEntryNo);

      UserSetup.GET(USERID);
      UserSetup.TESTFIELD("PDF Creator");


      MailText := GOBLocText001;

      ReportID := 50040;

      CREATE(ClientFso,TRUE,TRUE);
      CREATE(ClientUtil,TRUE,TRUE);
      CREATE(DivUtil,TRUE,TRUE);
      JobID := MailIT.CreateGUID();

      // Get folder for temporary files on the client
      ClientTempFolder := ClientUtil.GetTempPath();
      IF ClientTempFolder = '' THEN
        ERROR('Unable to create the path of the temporary folder.');
      ClientTempFolder := ClientTempFolder + 'ExpMail';
      IF NOT ClientFso.FolderExists(ClientTempFolder) THEN
        ClientFso.CreateFolder(ClientTempFolder);
      ClientTempFolder := ClientTempFolder + '\' + JobID;
      IF NOT ClientFso.FolderExists(ClientTempFolder) THEN
        ClientFso.CreateFolder(ClientTempFolder);

      CompanyInfo.GET;

      // Initialize the email
      IF SendMailDirect THEN
        MailIT.SetService('SMTP')
      ELSE
        MailIT.SetService(FORMAT(UserSetup."Mail Client"));

      {
      IF LT_MailITSetup."Accounting E-Mail" <> ''
        THEN MailIT.SetFrom(LT_MailITSetup."Accounting E-Mail")
        ELSE MailIT.SetFrom(LT_MailITSetup."Sales E-Mail");
      }

      MailIT.SetFrom(LT_MailITSetup."Accounting E-Mail");
      //A/gob-ko/P0391/GOB1.32/27.09.12
      {
      //E/gob-ko/P0391/GOB1.32/27.09.12
      IF NOT LT_MailITSetup."Test Mode" THEN
        MailIT.AddRecipientBCC(LT_MailITSetup."Accounting E-Mail",LT_MailITSetup."Accounting E-Mail")
      ELSE
        MailIT.AddRecipientBCC(LT_MailITSetup."Test E-Mail BCC",LT_MailITSetup."Test E-Mail BCC");
      //A/gob-ko/P0391/GOB1.32/27.09.12
      }
      //E/gob-ko/P0391/GOB1.32/27.09.12

      IF NOT LT_MailITSetup."Test Mode" THEN BEGIN
        Vend.TESTFIELD("E-Mail Payment Advise");
        IF Vend."E-Mail Payment Advise" <> '' THEN
          MailIT.AddRecipient(Vend."E-Mail Payment Advise",Vend."E-Mail Payment Advise");
      END ELSE BEGIN
        MailIT.AddRecipient(LT_MailITSetup."Test E-Mail",LT_MailITSetup."Test E-Mail");
        END;

      MailIT.SetSubject(MailText);

      // Add some HTML to the mail body
      MailIT.LoadHTMLBody('C:\Mailhtml\header.html');
      MailIT.AppendHTML('<br /><br />');

      //A/P0305
      //MailIT.AppendHTML('<table width=744 border=0>');
      MailIT.AppendHTML('<table width=590 border=0>');
      //E/P0305
      MailIT.AppendHTML(STRSUBSTNO(L_Text010a) + '<br /><br />');
      MailIT.AppendHTML('<br /><br />');
      MailIT.AppendHTML(STRSUBSTNO(GOBLocText002,LocPmtLedgEntr."Payment Date") + '<br /><br />');
      MailIT.AppendHTML(STRSUBSTNO(GOBLocText003) + '<br /><br />');

      // read footer file
      MailIT.LoadHTMLBody('C:\Mailhtml\footer.html');

      // Prepare to print it to PDF
      ClientPdfFileName := ClientTempFolder + '\' + DocName + '.pdf';
      IF ClientFso.FileExists(ClientPdfFileName) THEN
        ClientFso.DeleteFile(ClientPdfFileName);
      MailIT.PDFParameter('Output',ClientPdfFileName);
      MailIT.PDFParameter('ShowPDF','no');
      MailIT.PDFParameter('Title',DocName);
      MailIT.PDFParameter('Author',USERID);
      MailIT.PDFPreparePrinter();
      IF NOT DefaultPrinterChanged THEN BEGIN
        IF OldDefaultPrinter = '' THEN
          OldDefaultPrinter := MailIT.GetDefaultPrinter();
        IF OldDefaultPrinter <> UserSetup."PDF Creator" THEN BEGIN
          MailIT.SetDefaultPrinter(UserSetup."PDF Creator");
          DefaultPrinterChanged := TRUE;
        END;
      END;

      LocPmtLine.RESET;
      LocPmtLine.SETFILTER("Payment No.",STRSUBSTNO('%1',PmtLedgEntryNo));
      LocPmtLine.SETRANGE("Account No.",VendNo);
      LocPmtLine.SETRANGE("AVIS Letter",TRUE);

      REPORT.RUNMODAL(ReportID,FALSE,TRUE,LocPmtLine);
      IF (MailIT.WaitForFile(ClientPdfFileName,20000) = 0) THEN
        ERROR(Text040 + '2');
      MailIT.AddAttachment(ClientPdfFileName);

      // Restore the user's default printer selection
      IF DefaultPrinterChanged THEN
        MailIT.SetDefaultPrinter(OldDefaultPrinter);

      IF SendMailDirect THEN BEGIN
        MailIT.SetServer(LT_MailITSetup."Mail Server Home24");

        IF LT_MailITSetup."Server Port Home24" = '' THEN
          L_Port := 25
        ELSE
          EVALUATE(L_Port,LT_MailITSetup."Server Port Home24");

        MailIT.SetPort(L_Port);
        //H0709 28.11.13 MBY +++++++++++++
        IF LT_MailITSetup."Authentication Home24" THEN BEGIN
          MailIT.UseSSL(1);
          MailIT.SetLogin(LT_MailITSetup."User Name Home24 (Paymt Avise)");
          MailIT.SetPassword(LT_MailITSetup."Password Home24 (Paymt Avise)");
        END;
        //H0709 28.11.13 MBY -------------
        MailIT.Send();
      END ELSE
        MailIT.Display();

      // Remove the temporary folder and it's content.
      // If you use MAPI and Thunderbird or other MAPI email clints the they may require that
      // the image files remain on the disk until the mail is sent.
      IF FORMAT(UserSetup."Mail Client") <> 'MAPI' THEN
        IF ClientFso.FolderExists(ClientTempFolder) THEN
          ClientFso.DeleteFolder(ClientTempFolder, FALSE);
      CLEAR(ClientFso);
      CLEAR(ClientUtil);
      CLEAR(DivUtil);
    END;

    PROCEDURE CreateContainerOrderMail@1000000013(DocNo@1000000002 : Code[20]);
    VAR
      LT_MailITSetup@1000000000 : Record 75402;
      PurchOrderHeader@1000000001 : Record 38;
      MailText@1000000003 : Text[250];
      L_Text001@1000000004 : TextConst 'DEU=Bestellung Nr.:;ENU=Order No.:';
      ClientFso@1000000008 : Automation "{420B2830-E718-11CF-893D-00A0C9054228} 1.0:{0D43FE01-F093-11CF-8940-00A0C9054228}:'Microsoft Scripting Runtime'.FileSystemObject";
      ClientUtil@1000000007 : Automation "{1639594D-2135-4248-BE9B-FB55210F8AD8} 1.0:{D7CD856D-3889-4F19-BBBA-7608CF34EFB6}:'ExpandIT Dynamics Role Tailored Client Utility'.Utility";
      DivUtil@1000000006 : Automation "{2CD8D481-009C-4685-98EA-BC16452327B2} 1.0:{F1BBE10B-6E48-41B0-9EF6-F428C7A48655}:'Dynovus_SHA1Encryption'.SHA1EncryptAutomation";
      MailIT@1000000005 : OCX "{C8C4804C-89BA-4291-AB58-4C6050B65175}:'ExpandIT.MailIT2'";
      JobID@1000000012 : Text[50];
      ClientTempFolder@1000000011 : Text[250];
      ClientPdfFileName@1000000010 : Text[250];
      ClientFileName@1000000009 : Text[250];
      LT_ExtTextLine@1000000013 : Record 280;
      DocName@1000000014 : Text[250];
      DefaultPrinterChanged@1000000015 : Boolean;
      OldDefaultPrinter@1000000016 : Text[250];
      ReportLoc@1000000017 : Report 50069;
      Text002@1000000018 : TextConst 'DAN=Der blev ikke dannet et PDF-dokument.;DEU=Es wurde kein PDF Dokument erzeugt.;ENU=No PDF Document was generated.;ESP=No se gener¢ ning£n documento PDF.;FRA=Aucun document PDF n''a ÇtÇ crÇÇ.;SVE=Inget PDF-dokument skapades.';
      L_Port@1000000019 : Integer;
      MailITSetupL@1000000020 : Record 75402;
      PurchaseMailHTMLPathL@1000000021 : Record 50339;
    BEGIN
      //A/p0282
      LT_MailITSetup.GET;
      //A/p0492
      //LT_MailITSetup.TESTFIELD("User Name (General)");
      //LT_MailITSetup.TESTFIELD("Password (General)");
      //H0709 28.11.13 MBY +++++++++++++
      IF LT_MailITSetup."Authentication Home24" THEN BEGIN
      //H0709 28.11.13 MBY -------------
        LT_MailITSetup.TESTFIELD("Container Email Sender");
        LT_MailITSetup.TESTFIELD("Container Email Password");
      //H0709 28.11.13 MBY +++++++++++++
      END;
      //H0709 28.11.13 MBY -------------
      //LT_MailITSetup.TESTFIELD("Mail Server");
      //wird home24 Mail Adresse...
      LT_MailITSetup.TESTFIELD("Mail Server Home24");
      LT_MailITSetup.TESTFIELD("Server Port Home24");
      //E/p0492
      UserSetup.GET(USERID);
      UserSetup.TESTFIELD("PDF Creator");

      PurchOrderHeader.RESET;
      PurchOrderHeader.SETRANGE("Document Type",PurchOrderHeader."Document Type" :: Order);
      PurchOrderHeader.SETRANGE("No.",DocNo);
      PurchOrderHeader.FINDFIRST;

      // Email geht an Agentur - Pay-to Vendor
      Vend.GET(PurchOrderHeader."Pay-to Vendor No.");
      Vend.TESTFIELD("Text for Container EMail");
      CompanyInfo.GET;

      MailText := L_Text001 + ' ' + PurchOrderHeader."No.";

      CREATE(ClientFso,TRUE,TRUE);
      CREATE(ClientUtil,TRUE,TRUE);
      CREATE(DivUtil,TRUE,TRUE);
      JobID := MailIT.CreateGUID();

      // Get folder for temporary files on the client
      ClientTempFolder := ClientUtil.GetTempPath();
      IF ClientTempFolder = '' THEN
        ERROR('Unable to create the path of the temporary folder.');
      ClientTempFolder := ClientTempFolder + 'ExpMail';
      IF NOT ClientFso.FolderExists(ClientTempFolder) THEN
        ClientFso.CreateFolder(ClientTempFolder);
      ClientTempFolder := ClientTempFolder + '\' + JobID;
      IF NOT ClientFso.FolderExists(ClientTempFolder) THEN
        ClientFso.CreateFolder(ClientTempFolder);


      // Initialize the email
      IF SendMailDirect THEN
        MailIT.SetService('SMTP')
      ELSE
        MailIT.SetService(FORMAT(UserSetup."Mail Client"));

      MailIT.SetFrom(LT_MailITSetup."Purchase E-Mail BCC (Location)");

      //EmpfÑnger... BCC...
      IF NOT LT_MailITSetup."Test Mode" THEN
        MailIT.AddRecipientBCC(LT_MailITSetup."Purchase E-Mail BCC (Location)",LT_MailITSetup."Purchase E-Mail BCC (Location)")
      ELSE
        MailIT.AddRecipientBCC(LT_MailITSetup."Test E-Mail BCC",LT_MailITSetup."Test E-Mail BCC");

      //EmpfÑnger (Agentur)
      Vend.TESTFIELD("E-Mail");

      IF LT_MailITSetup."Test Mode" THEN
        MailIT.AddRecipient(LT_MailITSetup."Test E-Mail",LT_MailITSetup."Test E-Mail")
      ELSE
        MailIT.AddRecipient(Vend."E-Mail",Vend."E-Mail");

      MailIT.SetSubject(MailText);

      // Add some HTML to the mail body

      MailIT.AppendHTML('<font face="Arial","sans-serif">');

      //Textbaustein fÅr Container Order Mail / Am Kreditor hinterlegt
      //TESTFIELD
      MailIT.AppendHTML('<br /><br />');
      LT_ExtTextLine.SETRANGE("Table Name",LT_ExtTextLine."Table Name"::"Standard Text");
      LT_ExtTextLine.SETRANGE("No.",Vend."Text for Container EMail");
      IF LT_ExtTextLine.FIND('-') THEN
        REPEAT
          MailIT.AppendHTML(LT_ExtTextLine."Text (Long)" + '<br />');
        UNTIL LT_ExtTextLine.NEXT = 0;
      MailIT.AppendHTML('<br /><br />');


      MailIT.AppendHTML('</p>');

      // read footer file
      //H1671 23.01.15 ++++++++++++++++++++++++++++++++++++++
      //MailIT.LoadHTMLBody('C:\Mailhtml\footer.html');
      IF MailITSetupL.GET THEN BEGIN
        IF PurchaseMailHTMLPathL.GET(MailITSetupL."Container Order Mail Code",PurchOrderHeader."Language Code",
                                       PurchaseMailHTMLPathL.Type::footer) THEN
          MailIT.LoadHTMLBody(PurchaseMailHTMLPathL.Path)
        ELSE
          IF PurchaseMailHTMLPathL.GET(MailITSetupL."Container Order Mail Code",'DEU',PurchaseMailHTMLPathL.Type::footer) THEN
            MailIT.LoadHTMLBody(PurchaseMailHTMLPathL.Path)
      END;

      //H1671 23.01.15 --------------------------------------

      DocName := 'Order' + '_' + PurchOrderHeader."No.";
      // Prepare to print it to PDF
      ClientPdfFileName := ClientTempFolder + '\' + DocName + '.pdf';
      IF ClientFso.FileExists(ClientPdfFileName) THEN
        ClientFso.DeleteFile(ClientPdfFileName);
      MailIT.PDFParameter('Output',ClientPdfFileName);
      MailIT.PDFParameter('ShowPDF','no');
      MailIT.PDFParameter('Title',DocName);
      MailIT.PDFParameter('Author',USERID);
      MailIT.PDFPreparePrinter();
      IF NOT DefaultPrinterChanged THEN BEGIN
        IF OldDefaultPrinter = '' THEN
          OldDefaultPrinter := MailIT.GetDefaultPrinter();
        IF OldDefaultPrinter <> UserSetup."PDF Creator" THEN BEGIN
          MailIT.SetDefaultPrinter(UserSetup."PDF Creator");
          DefaultPrinterChanged := TRUE;
        END;
      END;

      CLEAR(ReportLoc);
      ReportLoc.SETTABLEVIEW(PurchOrderHeader);
      ReportLoc.USEREQUESTFORM(FALSE);
      ReportLoc.RUNMODAL;

      IF (MailIT.WaitForFile(ClientPdfFileName,20000) = 0) THEN
        ERROR(Text002);
      MailIT.AddAttachment(ClientPdfFileName);

      // Restore the user's default printer selection
      IF DefaultPrinterChanged THEN
        MailIT.SetDefaultPrinter(OldDefaultPrinter);

      IF SendMailDirect THEN BEGIN

        //A/p0492/Code auf Home24 umgestellt und gelîscht
        MailIT.SetServer(LT_MailITSetup."Mail Server Home24");
        IF LT_MailITSetup."Server Port Home24" = '' THEN
          L_Port := 25
        ELSE
          EVALUATE(L_Port,LT_MailITSetup."Server Port Home24");

        MailIT.SetPort(L_Port);
        //H0709 28.11.13 MBY +++++++++++++
        IF LT_MailITSetup."Authentication Home24" THEN BEGIN
        //H0709 28.11.13 MBY -------------
          MailIT.SetLogin(LT_MailITSetup."Container Email Sender");
          MailIT.SetPassword(LT_MailITSetup."Container Email Password");
          MailIT.UseSSL(1);
        //H0709 28.11.13 MBY +++++++++++++
        END;
        //H0709 28.11.13 MBY -------------
        MailIT.Send();
      END ELSE
        MailIT.Display();
        //E/p0492

      // Remove the temporary folder and it's content.
      // If you use MAPI and Thunderbird or other MAPI email clints the they may require that
      // the image files remain on the disk until the mail is sent.
      IF FORMAT(UserSetup."Mail Client") <> 'MAPI' THEN
        IF ClientFso.FolderExists(ClientTempFolder) THEN
          ClientFso.DeleteFolder(ClientTempFolder, FALSE);
      CLEAR(ClientFso);
      CLEAR(ClientUtil);
      CLEAR(DivUtil);

      //E/p0282
    END;

    PROCEDURE CreateReturnChangeOrderMail@1000000014(_SalesHeader@1000000030 : Record 36);
    VAR
      LT_MailITSetup@1000000028 : Record 75402;
      LT_WebSiteTransfer@1000000034 : Record 50033;
      LT_WebSource@1000000026 : Record 5059;
      LT_Location@1000000044 : Record 14;
      LT_LabelDHL@1000000045 : Record 50020;
      LR_SalesOrder@1000000050 : Report 50020;
      FormatAddr@1000000023 : Codeunit 365;
      ClientFso@1000000005 : Automation "{420B2830-E718-11CF-893D-00A0C9054228} 1.0:{0D43FE01-F093-11CF-8940-00A0C9054228}:'Microsoft Scripting Runtime'.FileSystemObject";
      ClientUtil@1000000003 : Automation "{1639594D-2135-4248-BE9B-FB55210F8AD8} 1.0:{D7CD856D-3889-4F19-BBBA-7608CF34EFB6}:'ExpandIT Dynamics Role Tailored Client Utility'.Utility";
      DivUtil@1000000054 : Automation "{2CD8D481-009C-4685-98EA-BC16452327B2} 1.0:{F1BBE10B-6E48-41B0-9EF6-F428C7A48655}:'Dynovus_SHA1Encryption'.SHA1EncryptAutomation";
      MailIT@1000000006 : OCX "{C8C4804C-89BA-4291-AB58-4C6050B65175}:'ExpandIT.MailIT2'";
      ShipAddr@1000000012 : ARRAY [8] OF Text[80];
      MailText@1000000032 : Text[250];
      DocName@1000000016 : Text[250];
      DocName2@1000000021 : Text[250];
      JobID@1000000007 : Text[50];
      ClientTempFolder@1000000004 : Text[250];
      ClientPdfFileName@1000000015 : Text[250];
      ClientFileName@1000000022 : Text[250];
      OldDefaultPrinter@1000000013 : Text[250];
      DefaultPrinterChanged@1000000014 : Boolean;
      ReportID@1000000001 : Integer;
      L_Text001@1000000002 : TextConst 'DEU=Vielen Dank fÅr Ihre Bestellung Nr.:;ENU=Order No.:';
      L_Text010@1000000010 : TextConst 'DEU=Liebe(r) %1,';
      L_Text010a@1000000063 : TextConst 'DEU=Sehr geehrte Damen und Herren,';
      L_Text016@1000000025 : TextConst 'DEU=Vielen Dank fÅr die Zusammenarbeit mit %1 !';
      L_Text017@1000000027 : TextConst 'DEU=Mit freundlichen GrÅ·en';
      L_Text018@1000000033 : TextConst 'DEU=Tel: %1 | Fax: %2';
      L_TextI001@1000000035 : TextConst 'DEU=Impressum';
      L_TextI002@1000000036 : TextConst 'DEU=Eingetragen beim %1';
      L_TextI004@1000000038 : TextConst 'DEU=USt-ID: %1';
      L_TextI005@1000000039 : TextConst 'DEU=GeschÑftsfÅhrer %1, %2';
      L_TextI006@1000000040 : TextConst 'DEU=(Montag - Freitag 09:00 - 18:00 Uhr)';
      Text040@1000000019 : TextConst 'DAN=Der blev ikke dannet et PDF-dokument.;DEU=Es wurde kein PDF Dokument erzeugt.;ENU=No PDF Document was generated.;ESP=No se gener¢ ning£n documento PDF.;FRA=Aucun document PDF n''a ÇtÇ crÇÇ.;SVE=Inget PDF-dokument skapades.';
      LinkID@1000000043 : Code[10];
      L_MaxKW@1000000061 : Text[10];
      L_Hash@1000000062 : Text[250];
      locSalesHeaderArchive@1108200000 : Record 5107;
      locGOBText001@1108200001 : TextConst 'DEU=Lieber Kunde,';
      locGOBText002@1108200002 : TextConst 'DEU="wir haben fÅr Sie die Neulieferung der bestellten Ware ausgelîst. Die Auftragsnummer der "';
      locGOBText003@1108200003 : TextConst 'DEU=Neulieferung ist: %1. Bitte geben Sie diese bei weiteren RÅckfragen an.';
      locGOBText004@1108200004 : TextConst 'DEU=Ihre Umtauschware wird voraussichtlich in Kalenderwoche %1 geliefert.';
      locGOBText005@1108200005 : TextConst 'DEU=FÅr weitere RÅckfragen wenden Sie sich gerne an unseren Kundenservice';
      locGOBText006@1108200006 : TextConst 'DEU=mit einer Nachricht Åber das Kontaktformular http://www.home24.de/contact.';
      locGOBText007@1108200007 : TextConst 'DEU=Ihr Team von home24.de';
      locSalesReturnLine@1108200010 : Record 37;
      SalesReturnHeaderPrint@1108200011 : Record 36;
      GeneralMgt2@1108200012 : Codeunit 50040;
      L_Port@1108200013 : Integer;
      LoopCounter@1000000000 : Integer;
      locSalesLine@1000000008 : Record 37;
      FPCGenSetup@1000000009 : Record 50055;
      AnredeRecipient1@1000000011 : Text[150];
      AnredeRecipient2@1000000017 : Text[150];
    BEGIN
      //A/P0600

      LT_MailITSetup.GET;
      LT_MailITSetup.TESTFIELD("Sales E-Mail");
      UserSetup.GET(USERID);
      UserSetup.TESTFIELD("PDF Creator");

      //S/P0921
      // Betreff
      //MailText := 'Ihr Umtausch';
      FPCGenSetup.GET;
      FPCGenSetup.TESTFIELD("Return Order Change MailText");

      IF ((_SalesHeader."Language Code" = 'DEU') OR (_SalesHeader."Language Code" = '')) THEN BEGIN
        LT_MailITSetup.TESTFIELD("HTML Path Footer DEU");
        LT_MailITSetup.TESTFIELD("HTML Path Header DEU");
        LanguageCode := 'DEU';
        //H0604 06.11.13 ARU +++++++++++++++++++++++
        //AnredeRecipient1 := 'Sehr geehrte(r) %1,';
        AnredeRecipient1 := 'Liebe/r %1,';
        //H0604 06.11.13 ARU -----------------------
        AnredeRecipient2 := 'Sehr geehrte Damen und Herren,'
      END;

      IF (_SalesHeader."Language Code" = 'NLD') THEN BEGIN
        LT_MailITSetup.TESTFIELD("HTML Path Footer NL");
        LT_MailITSetup.TESTFIELD("HTML Path Header NL");
        LanguageCode := 'NLD';
        AnredeRecipient1 := 'Beste %1,';
        AnredeRecipient2 := 'Beste dames en heren,';
      END;

      IF (_SalesHeader."Language Code" = 'FRA') THEN BEGIN
        LT_MailITSetup.TESTFIELD("HTML Path Header FR");
        LT_MailITSetup.TESTFIELD("HTML Path Footer FR");
        LanguageCode := 'FRA';
        AnredeRecipient1 := 'Cher/chäre %1,';
        AnredeRecipient2 := 'Mesdames, Messieurs,';
      END;

      IF (_SalesHeader."Language Code" = 'DEA') THEN BEGIN
        LT_MailITSetup.TESTFIELD("HTML Path Footer AUT");
        LT_MailITSetup.TESTFIELD("HTML Path Header AUT");
        LanguageCode := 'DEA';
        //H0604 06.11.13 ARU +++++++++++++++++++++++
        //AnredeRecipient1 := 'Sehr geehrte(r) %1,';
        AnredeRecipient1 := 'Liebe/r %1,';
        //H0604 06.11.13 ARU -----------------------
        AnredeRecipient2 := 'Sehr geehrte Damen und Herren,';
      END;

      //H0784 04.02.14 ARU ++++++++++++++++++++++++++++++++++
      IF (_SalesHeader."Language Code" = 'DES') THEN BEGIN
        FPCGenSetup.TESTFIELD("HTML Path Footer CH (DEU)");
        FPCGenSetup.TESTFIELD("HTML Path Header CH (DEU)");
        LanguageCode := 'DES';
        AnredeRecipient1 := 'Liebe/r %1,';
        AnredeRecipient2 := 'Sehr geehrte Damen und Herren,';
      END;

      IF (_SalesHeader."Language Code" = 'FRS') THEN BEGIN
        FPCGenSetup.TESTFIELD("HTML Path Footer CH (FR)");
        FPCGenSetup.TESTFIELD("HTML Path Header CH (FR)");
        LanguageCode := 'FRS';
        AnredeRecipient1 := 'Cher/chäre %1,';
        AnredeRecipient2 := 'Mesdames, Messieurs,';
      END;
      //H0784 04.02.14 ARU ----------------------------------
      //E/P0921

      CREATE(ClientFso,TRUE,TRUE);
      CREATE(ClientUtil,TRUE,TRUE);
      CREATE(DivUtil,TRUE,TRUE);
      JobID := MailIT.CreateGUID();

      // Locate bill to customer
      Cust.GET(_SalesHeader."Sell-to Customer No.");
      CompanyInfo.GET;

      // Initialize the email
      SendMailDirect := TRUE;
      IF SendMailDirect THEN
        MailIT.SetService('SMTP')
      ELSE
        MailIT.SetService(FORMAT(UserSetup."Mail Client"));

      //S/P0921
      IF (_SalesHeader."Language Code" = 'DEU') OR (_SalesHeader."Language Code" = '') THEN BEGIN
        MailIT.SetFrom(LT_MailITSetup."User Name Home24 (Return)");
        //H0709 17.01.14 MBY +++++++++++++
        IF LT_MailITSetup."Authentication Home24 (Return)" THEN BEGIN
        //H0709 17.01.14 MBY -------------
          MailIT.SetLogin(LT_MailITSetup."User Name Home24 (Return)");
          MailIT.SetPassword(LT_MailITSetup."Password Home24 (Return)");
        //H0709 17.01.14 MBY +++++++++++++
        END;
        //H0709 17.01.14 MBY -------------
        MailIT.LoadHTMLBody(LT_MailITSetup."HTML Path Header DEU");
      END;

      IF (_SalesHeader."Language Code" = 'NLD') THEN BEGIN
        MailIT.SetFrom(FPCGenSetup."Return Oder E-Mail NL");
        //H0709 17.01.14 MBY +++++++++++++
        IF LT_MailITSetup."Authentication Home24 (Return)" THEN BEGIN
        //H0709 17.01.14 MBY -------------
          MailIT.SetLogin(FPCGenSetup."User Name Home24 NL (Return)");
          MailIT.SetPassword(FPCGenSetup."Password Home24 NL (Return)");
        //H0709 17.01.14 MBY +++++++++++++
        END;
        //H0709 17.01.14 MBY -------------
        MailIT.LoadHTMLBody(LT_MailITSetup."HTML Path Header NL");
      END;

      IF (_SalesHeader."Language Code" = 'FRA') THEN BEGIN
        MailIT.SetFrom(FPCGenSetup."Return Oder E-Mail FR");
        //H0709 17.01.14 MBY +++++++++++++
        IF LT_MailITSetup."Authentication Home24 (Return)" THEN BEGIN
        //H0709 17.01.14 MBY -------------
          MailIT.SetLogin(FPCGenSetup."User Name Home24 FR (Return)");
          MailIT.SetPassword(FPCGenSetup."Password Home24 FR (Return)");
        //H0709 17.01.14 MBY +++++++++++++
        END;
        //H0709 17.01.14 MBY -------------
        MailIT.LoadHTMLBody(LT_MailITSetup."HTML Path Header FR");

      END;

      IF (_SalesHeader."Language Code" = 'DEA') THEN BEGIN
        MailIT.SetFrom(FPCGenSetup."Return Oder E-Mail AT");
        //H0709 17.01.14 MBY +++++++++++++
        IF LT_MailITSetup."Authentication Home24 (Return)" THEN BEGIN
        //H0709 17.01.14 MBY -------------
          MailIT.SetLogin(FPCGenSetup."User Name Home24 AT (Return)");
          MailIT.SetPassword(FPCGenSetup."Password Home24 AT (Return)");
        //H0709 17.01.14 MBY +++++++++++++
        END;
        //H0709 17.01.14 MBY -------------
        MailIT.LoadHTMLBody(LT_MailITSetup."HTML Path Header AUT");
      END;

      //H0784 04.02.14 ARU +++++++++++++++++++++++++++++++++++++++++++++
      IF (_SalesHeader."Language Code" = 'DES') OR
         (_SalesHeader."Language Code" = 'FRS')THEN BEGIN
        MailIT.SetFrom(FPCGenSetup."Return Oder E-Mail CH");
        IF LT_MailITSetup."Authentication Home24 (Return)" THEN BEGIN
          MailIT.SetLogin(FPCGenSetup."User Name Home24 CH (Return)");
          MailIT.SetPassword(FPCGenSetup."Password Home24 CH (Return)");
        END;

        IF (_SalesHeader."Language Code" = 'DES') THEN
          MailIT.LoadHTMLBody(FPCGenSetup."HTML Path Header CH (DEU)");

        IF (_SalesHeader."Language Code" = 'FRS') THEN
          MailIT.LoadHTMLBody(FPCGenSetup."HTML Path Header CH (FR)");
      END;
      //H0784 04.02.14 ARU ---------------------------------------------
      //E/P0921

      IF NOT LT_MailITSetup."Test Mode" THEN BEGIN
        Cust.TESTFIELD("E-Mail");
        IF Cust."E-Mail" <> '' THEN
          MailIT.AddRecipient(Cust."E-Mail",Cust."E-Mail");
        //A/P0921
        MailIT.AddRecipientBCC(LT_MailITSetup."Return Oder E-Mail BCC",LT_MailITSetup."Return Oder E-Mail BCC");
        //E/P0921
      END ELSE BEGIN
        //A/P0921
        MailIT.AddRecipient(LT_MailITSetup."Test E-Mail",LT_MailITSetup."Test E-Mail");
        MailIT.AddRecipientBCC(LT_MailITSetup."Test E-Mail BCC",LT_MailITSetup."Test E-Mail BCC");
        //E/P0921
      END;

      MailIT.SetSubject(MailText);
      // Add some HTML to the mail body
      //A/P0921
      //MailIT.LoadHTMLBody('C:\Mailhtml\header.html');
      //EP0921
      MailIT.AppendHTML('<font face="Arial","sans-serif">');
      //A/P0305
      //MailIT.AppendHTML('<table width=744 border=0>');
      MailIT.AppendHTML('<table width=590 border=0>');
      //E/P0305

      //H0604 06.11.13 ARU +++++++++++++++++++++
      MailIT.AppendHTML('<font color="black">');
      //H0604 06.11.13 ARU ---------------------

      // A/gob-lku/25.09.12/P0376
      RecipientName := '';
      IF _SalesHeader."Search Name" <> '' THEN BEGIN
        RecipientName := LOWERCASE(_SalesHeader."Search Name");
        FOR LoopCounter := 1 TO STRLEN(RecipientName) DO BEGIN
          IF LoopCounter = 1 THEN
            RecipientName := UPPERCASE(COPYSTR(RecipientName,1,1)) + COPYSTR(RecipientName,2,STRLEN(RecipientName));
          IF LoopCounter > 1 THEN
            IF COPYSTR(RecipientName,LoopCounter-1,1) = ' ' THEN
              RecipientName := COPYSTR(RecipientName,1,LoopCounter-1)
                               + UPPERCASE(COPYSTR(RecipientName,LoopCounter,1))
                               + COPYSTR(RecipientName,LoopCounter+1,STRLEN(RecipientName));
        END;
      END;

      //IF _SalesReturnHeader."Sell-to Customer Name" <> '' THEN
      //  MailIT.AppendHTML(STRSUBSTNO(L_Text010,_SalesReturnHeader."Sell-to Customer Name") + '<br /><br />')

      locSalesLine.RESET;
      locSalesLine.SETRANGE("Document Type",_SalesHeader."Document Type");
      locSalesLine.SETRANGE("Document No.",_SalesHeader."No.");
      locSalesLine.SETRANGE(Type,locSalesLine.Type::Item);
      IF locSalesLine.FINDFIRST THEN;

      MailIT.AppendHTML('<br /><br />');

      IF RecipientName <> '' THEN
        //A/P0921
        //MailIT.AppendHTML(STRSUBSTNO(L_Text010,RecipientName) + '<br /><br />')
        MailIT.AppendHTML(STRSUBSTNO(AnredeRecipient1,RecipientName) + '<br /><br />')
        //E/P0921
      // E/gob-lku/25.09.12/P0376
      ELSE
        //A/P0921
        //MailIT.AppendHTML(STRSUBSTNO(L_Text010a) + '<br />');
        MailIT.AppendHTML(STRSUBSTNO(AnredeRecipient2) + '<br /><br />');
        //E/P0921

      //S/P0921
      ExtTextLines.RESET;
      ExtTextLines.SETRANGE("Table Name",ExtTextLines."Table Name"::"Standard Text");
      ExtTextLines.SETRANGE("No.",FPCGenSetup."Return Order Change MailText");
      ExtTextLines.SETRANGE("Language Code",LanguageCode);
      ExtTextLines.SETRANGE("Text No.",1);
      IF ExtTextLines.FIND('-') THEN BEGIN
        REPEAT
          TxtStr   := ExtTextLines."Text (Long)";
          Position := STRPOS(TxtStr,'[');
           IF Position = 1 THEN BEGIN
             TXtType := COPYSTR(TxtStr,Position+1,STRPOS(TxtStr,']')-2);
             IF TXtType = 'Subject' THEN BEGIN
               TxtStr := STRSUBSTNO(DELSTR(ExtTextLines."Text (Long)",
                                    1,STRPOS(ExtTextLines."Text (Long)",']')),_SalesHeader."External Document No.") + ' ';
               SubjectTxtStr := SubjectTxtStr + TxtStr;
             END;
            IF TXtType = 'OrderNo' THEN BEGIN
              TxtStr := STRSUBSTNO(DELSTR(ExtTextLines."Text (Long)",
                                   1,STRPOS(ExtTextLines."Text (Long)",']')),_SalesHeader."No.") + ' ';
              MailIT.AppendHTML(TxtStr);
            END;
            IF TXtType = 'KW' THEN BEGIN
              TxtStr := STRSUBSTNO(DELSTR(ExtTextLines."Text (Long)",
                                   1,STRPOS(ExtTextLines."Text (Long)",']')),FORMAT(locSalesLine."Max. Order Date",0,'<Week>')) + ' ';
              MailIT.AppendHTML(TxtStr);
            END;


           END ELSE BEGIN
             TxtStr := STRSUBSTNO(DELSTR(ExtTextLines."Text (Long)",1,STRPOS(ExtTextLines."Text (Long)",']')),
                                  _SalesHeader."No.");
             IF TxtStr = '' THEN
               TxtStr := '<br /><br />';
             MailIT.AppendHTML(TxtStr);
           END;
        UNTIL ExtTextLines.NEXT = 0;

        //S/P0921
        MailIT.SetSubject(SubjectTxtStr);
      END ELSE
        ERROR(GOBText001,FPCGenSetup."Return Order Change MailText",LanguageCode);

      {******************** durch Textbausteine ersetzt ^^
      MailIT.AppendHTML(STRSUBSTNO(locGOBText002) + '<br />');
      MailIT.AppendHTML(STRSUBSTNO(locGOBText003,_SalesHeader."No.") + '<br /><br />');
      MailIT.AppendHTML(STRSUBSTNO(locGOBText004,FORMAT(locSalesLine."Max. Order Date",0,'<Week>')) + '<br /><br />');

      //H0219 25.02.13 ARU >> Changes in Textconst locGOBText005 and locGOBText006
      MailIT.AppendHTML(STRSUBSTNO(locGOBText005) + '<br />');
      MailIT.AppendHTML(STRSUBSTNO(locGOBText006) + '<br />');
      *********************}
      //E/P0921
      //A/P0921
      IF (_SalesHeader."Language Code" = 'DEU') OR (_SalesHeader."Language Code" = '') THEN
        MailIT.LoadHTMLBody(LT_MailITSetup."HTML Path Footer DEU");

      IF _SalesHeader."Language Code" = 'NLD' THEN
        MailIT.LoadHTMLBody(LT_MailITSetup."HTML Path Footer NL");

      IF _SalesHeader."Language Code" = 'FRA' THEN
        MailIT.LoadHTMLBody(LT_MailITSetup."HTML Path Footer FR");

      IF _SalesHeader."Language Code" = 'DEA' THEN
        MailIT.LoadHTMLBody(LT_MailITSetup."HTML Path Footer AUT");

      //H0784 04.02.14 ARU ++++++++++++++++++++++++++++++++++++++++++
      IF _SalesHeader."Language Code" = 'DES' THEN
        MailIT.LoadHTMLBody(FPCGenSetup."HTML Path Footer CH (DEU)");

      IF _SalesHeader."Language Code" = 'FRS' THEN
        MailIT.LoadHTMLBody(FPCGenSetup."HTML Path Footer CH (FR)");
      //H0784 04.02.14 ARU ------------------------------------------
      //E/P0921

      // MailIT.Display(); chrmu
      SendMailDirect := TRUE;

      IF SendMailDirect THEN BEGIN
        MailIT.SetServer(LT_MailITSetup."Mail Server Home24 (Return)");
        //H0709 17.01.14 MBY +++++++++++++
        IF LT_MailITSetup."Authentication Home24 (Return)" THEN
        //H0709 17.01.14 MBY -------------
          MailIT.UseSSL(1);

        IF LT_MailITSetup."Server Port Home24 (Return)" = '' THEN
          L_Port := 25
        ELSE
          EVALUATE(L_Port,LT_MailITSetup."Server Port Home24 (Return)");
        MailIT.SetPort(L_Port);
        //A/P0921
        //MailIT.SetLogin(LT_MailITSetup."User Name Home24 (Return)");
        //MailIT.SetPassword(LT_MailITSetup."Password Home24 (Return)");
        //E/P0921
        MailIT.Send();
      END ELSE
        MailIT.Display();

      // Remove the temporary folder and it's content.
      // If you use MAPI and Thunderbird or other MAPI email clints the they may require that
      // the image files remain on the disk until the mail is sent.
      IF FORMAT(UserSetup."Mail Client") <> 'MAPI' THEN
        IF ClientFso.FolderExists(ClientTempFolder) THEN
          ClientFso.DeleteFolder(ClientTempFolder, FALSE);
      CLEAR(ClientFso);
      CLEAR(ClientUtil);
      CLEAR(DivUtil);

      //E/P0600
    END;

    PROCEDURE FillBatchPostforPaymentAdvise@1000000019(PaymProposal@1000000000 : Record 5157895);
    VAR
      PaymPropHeaderL@1000000001 : Record 5157896;
      VendorL@1000000002 : Record 23;
      BatchPostDocumentL@1000000003 : Record 50043;
      BatchPostDocumentLineL@1000000004 : Record 50190;
    BEGIN
      //H1475 12.09.14 ARI ++++++++++++++++++++++++++++++++++++
      PaymPropHeaderL.RESET;
      PaymPropHeaderL.SETRANGE("Gen. Journal Template",PaymProposal."Journal Template Name");
      PaymPropHeaderL.SETRANGE("Gen. Journal Batch",PaymProposal."Journal Batch Name");
      PaymPropHeaderL.SETRANGE("Print Payment Advice",TRUE);
      PaymPropHeaderL.SETRANGE("Account Type", PaymPropHeaderL."Account Type"::Vendor);

      IF PaymPropHeaderL.FINDSET(FALSE,FALSE) THEN BEGIN
        //Insert Header Data
        BatchPostDocumentL.INIT;
        BatchPostDocumentL."Entry No." := 0;
        BatchPostDocumentL."Journal Template Name" := PaymPropHeaderL."Gen. Journal Template";
        BatchPostDocumentL."Action Type" := BatchPostDocumentL."Action Type"::"Send Payment Advise";
        BatchPostDocumentL."Document Type" := BatchPostDocumentL."Document Type"::"Payment Advise";
        BatchPostDocumentL."Scheduled at" := CURRENTDATETIME;
        BatchPostDocumentL."Scheduled by" := USERID;
        BatchPostDocumentL."Document No." := PaymPropHeaderL."Gen. Journal Batch";
        BatchPostDocumentL.INSERT;
        REPEAT
        //InsertLines
          VendorL.GET(PaymPropHeaderL."Account No.");
          IF VendorL."E-Mail Payment Advise" <> '' THEN BEGIN
            BatchPostDocumentLineL.INIT;
            BatchPostDocumentLineL."Assigned to Entry No." := BatchPostDocumentL."Entry No.";
            BatchPostDocumentLineL."Line No." := PaymPropHeaderL."Gen. Journal Line";
            BatchPostDocumentLineL."Action Type" := BatchPostDocumentL."Action Type"::"Send Payment Advise";
            BatchPostDocumentLineL."Document Type" := BatchPostDocumentL."Document Type"::"Payment Advise";
            BatchPostDocumentLineL."Document No." := PaymPropHeaderL."Gen. Journal Batch";
            BatchPostDocumentLineL."Document Line No." := PaymPropHeaderL."Gen. Journal Line";
            BatchPostDocumentLineL.INSERT;
            //H2159 19.02.15 TST +++++++++++++++++++++++++++++++++++++
            PaymPropHeaderL.TESTFIELD("Payment Advice Status",0);
            PaymPropHeaderL."Payment Advice Status" := PaymPropHeaderL."Payment Advice Status"::Triggered;
            PaymPropHeaderL.MODIFY;
            //H2159 19.02.15 TST -------------------------------------
          END;
        UNTIL PaymPropHeaderL.NEXT = 0;
      END;
      //H1475 12.09.14 ARI ------------------------------------
    END;

    PROCEDURE CreatePaymentAdviseMailHME@1000000025(PaymProposalHeadV@1000000020 : Record 5157896);
    VAR
      MailITSetupL@1000000028 : Record 75402;
      WebSiteTransferL@1000000034 : Record 50033;
      WebSourceL@1000000026 : Record 5059;
      LocationL@1000000044 : Record 14;
      FormatAddrL@1000000023 : Codeunit 365;
      UserSetupL@1000000008 : Record 91;
      ClientFsoL@1000000005 : Automation "{420B2830-E718-11CF-893D-00A0C9054228} 1.0:{0D43FE01-F093-11CF-8940-00A0C9054228}:'Microsoft Scripting Runtime'.FileSystemObject";
      ClientUtilL@1000000003 : Automation "{1639594D-2135-4248-BE9B-FB55210F8AD8} 1.0:{D7CD856D-3889-4F19-BBBA-7608CF34EFB6}:'ExpandIT Dynamics Role Tailored Client Utility'.Utility";
      DivUtilL@1000000054 : Automation "{2CD8D481-009C-4685-98EA-BC16452327B2} 1.0:{F1BBE10B-6E48-41B0-9EF6-F428C7A48655}:'Dynovus_SHA1Encryption'.SHA1EncryptAutomation";
      MailITL@1000000006 : OCX "{C8C4804C-89BA-4291-AB58-4C6050B65175}:'ExpandIT.MailIT2'";
      ShipAddrL@1000000012 : ARRAY [8] OF Text[80];
      MailTextL@1000000032 : Text[250];
      DocNameL@1000000016 : Text[250];
      JobIDL@1000000007 : Text[50];
      ClientTempFolderL@1000000004 : Text[250];
      ClientPdfFileNameL@1000000015 : Text[250];
      ClientFileNameL@1000000022 : Text[250];
      OldDefaultPrinterL@1000000013 : Text[250];
      DefaultPrinterChangedL@1000000014 : Boolean;
      ReportIDL@1000000001 : Integer;
      L_Text001@1000000002 : TextConst 'DEU=Vielen Dank fÅr Ihre Bestellung Nr.:;ENU=Order No.:';
      L_Text010@1000000010 : TextConst 'DEU=Sehr geehrte(r) %1,';
      L_Text010a@1000000063 : TextConst 'DEU=Sehr geehrte Damen und Herren,';
      L_Text016@1000000025 : TextConst 'DEU=Vielen Dank fÅr die Zusammenarbeit mit %1 !';
      L_Text017@1000000027 : TextConst 'DEU=Mit freundlichen GrÅ·en';
      L_Text018@1000000033 : TextConst 'DEU=Tel: %1 | Fax: %2';
      L_TextI001@1000000035 : TextConst 'DEU=Impressum';
      L_TextI002@1000000036 : TextConst 'DEU=Eingetragen beim %1';
      L_TextI004@1000000038 : TextConst 'DEU=USt-ID: %1';
      L_TextI005@1000000039 : TextConst 'DEU=GeschÑftsfÅhrer %1, %2';
      L_TextI006@1000000040 : TextConst 'DEU=(Montag - Freitag 09:00 - 18:00 Uhr)';
      Text040@1000000019 : TextConst 'DAN=Der blev ikke dannet et PDF-dokument.;DEU=Es wurde kein PDF Dokument erzeugt.;ENU=No PDF Document was generated.;ESP=No se gener¢ ning£n documento PDF.;FRA=Aucun document PDF n''a ÇtÇ crÇÇ.;SVE=Inget PDF-dokument skapades.';
      LinkIDL@1000000043 : Code[10];
      L_Text011@1108200000 : TextConst 'DEU=anbei erhalten Sie Ihre Rechnung %1.';
      PortL@1108200001 : Integer;
      GOBLocText001@1000000009 : TextConst 'DEU=Zahlungsavis';
      GOBLocText002@1000000011 : TextConst 'DEU=anbei Åbersenden wir das Avis zu unserer Zahlung vom %1.';
      GOBLocText003@1000000017 : TextConst 'DEU=FÅr RÅckfragen stehen wir gerne zur VerfÅgung.';
      PaymPropHeader@1000000024 : Record 5157896;
      PaymProposalL@1000000000 : Record 5157895;
      PaymAdviceReportL@1000000018 : Report 5157893;
      VendorL@1000000031 : Record 23;
    BEGIN
      //H1475 29.08.14 ARI +++++++++++++++++++++++++++++++++++

      MailITSetupL.GET;

      IF MailITSetupL."Authentication Home24" THEN BEGIN
        MailITSetupL.TESTFIELD(MailITSetupL."User Name Home24 (Paymt Avise)");
        MailITSetupL.TESTFIELD(MailITSetupL."Password Home24 (Paymt Avise)");
      END;

      MailITSetupL.TESTFIELD(MailITSetupL."Payment Avise E-Mail Home24");

      MailITSetupL.TESTFIELD("Mail Server Home24");
      MailITSetupL.TESTFIELD("Server Port Home24");

      VendorL.GET(PaymProposalHeadV."Account No.");

      UserSetupL.GET(USERID);
      UserSetupL.TESTFIELD("PDF Creator");
      MailTextL := HMEText009;
      ReportIDL := 5157893;
      CREATE(ClientFsoL,TRUE,TRUE);
      CREATE(ClientUtilL,TRUE,TRUE);
      CREATE(DivUtilL,TRUE,TRUE);
      JobIDL := MailITL.CreateGUID();

      // Get folder for temporary files on the client
      ClientTempFolderL := ClientUtilL.GetTempPath();
      IF ClientTempFolderL = '' THEN
        ERROR('Unable to create the path of the temporary folder.');
      ClientTempFolderL := ClientTempFolderL + 'ExpMail';
      IF NOT ClientFsoL.FolderExists(ClientTempFolderL) THEN
        ClientFsoL.CreateFolder(ClientTempFolderL);
      ClientTempFolderL := ClientTempFolderL + '\' + JobIDL;
      IF NOT ClientFsoL.FolderExists(ClientTempFolderL) THEN
        ClientFsoL.CreateFolder(ClientTempFolderL);

      CompanyInfo.GET;

      // Initialize the email
      IF SendMailDirect THEN
        MailITL.SetService('SMTP')
      ELSE
        MailITL.SetService(FORMAT(UserSetupL."Mail Client"));

      MailITL.SetFrom(MailITSetupL."Accounting E-Mail");
      IF NOT MailITSetupL."Test Mode" THEN BEGIN
        VendorL.TESTFIELD("E-Mail Payment Advise");
        IF VendorL."E-Mail Payment Advise" <> '' THEN
          MailITL.AddRecipient(VendorL."E-Mail Payment Advise",VendorL."E-Mail Payment Advise");
      END ELSE BEGIN
        MailITL.AddRecipient(MailITSetupL."Test E-Mail",MailITSetupL."Test E-Mail");
      END;

      MailITL.SetSubject(MailTextL);
      MailITL.LoadHTMLBody('C:\Mailhtml\header.html');
      MailITL.AppendHTML('<br /><br />');
      MailITL.AppendHTML('<table width=590 border=0>');
      MailITL.AppendHTML(STRSUBSTNO(L_Text010a) + '<br /><br />');
      MailITL.AppendHTML('<br /><br />');
      MailITL.AppendHTML(STRSUBSTNO(GOBLocText003) + '<br /><br />');

      // read footer file
      MailITL.LoadHTMLBody('C:\Mailhtml\footer.html');

      //H1629 09.10.14 ARI +++++++++++++++++++++++++++++++++
      DocNameL := HMEText009 +'_'+ FORMAT(TODAY,0,'<Year4><Month,2><Day,2>');
      //H1629 09.10.14 ARI ---------------------------------

      ClientPdfFileNameL := ClientTempFolderL + '\' + DocNameL + '.pdf';
      IF ClientFsoL.FileExists(ClientPdfFileNameL) THEN
        ClientFsoL.DeleteFile(ClientPdfFileNameL);
      MailITL.PDFParameter('Output',ClientPdfFileNameL);
      MailITL.PDFParameter('ShowPDF','no');
      MailITL.PDFParameter('Title',DocNameL);
      MailITL.PDFParameter('Author',USERID);
      MailITL.PDFPreparePrinter();
      IF NOT DefaultPrinterChangedL THEN BEGIN
        IF OldDefaultPrinterL = '' THEN
          OldDefaultPrinterL := MailITL.GetDefaultPrinter();
        IF OldDefaultPrinterL <> UserSetupL."PDF Creator" THEN BEGIN
          MailITL.SetDefaultPrinter(UserSetupL."PDF Creator");
          DefaultPrinterChangedL := TRUE;
        END;
      END;

      PaymProposalL.RESET;
      PaymProposalL.SETRANGE("Journal Template Name",PaymProposalHeadV."Gen. Journal Template");
      PaymProposalL.SETRANGE("Journal Batch Name",PaymProposalHeadV."Gen. Journal Batch");

      //H1629 09.10.14 ARI +++++++++++++++++++++++++++++++++
      CLEAR(PaymAdviceReportL);
      PaymAdviceReportL.SETTABLEVIEW(PaymProposalL);
      PaymAdviceReportL.USEREQUESTFORM(FALSE);
      PaymAdviceReportL.SetParameter(FALSE,PaymProposalHeadV);
      PaymAdviceReportL.RUNMODAL;
      //H1629 09.10.14 ARI ---------------------------------

      IF (MailITL.WaitForFile(ClientPdfFileNameL,20000) = 0) THEN
        ERROR(Text040);
      MailITL.AddAttachment(ClientPdfFileNameL);

      // Restore the user's default printer selection
      IF DefaultPrinterChangedL THEN
        MailITL.SetDefaultPrinter(OldDefaultPrinterL);

      IF SendMailDirect THEN BEGIN
        MailITL.SetServer(MailITSetupL."Mail Server Home24");

        IF MailITSetupL."Server Port Home24" = '' THEN
          PortL := 25
        ELSE
          EVALUATE(PortL,MailITSetupL."Server Port Home24");

        MailITL.SetPort(PortL);
        IF MailITSetupL."Authentication Home24" THEN BEGIN
          MailITL.UseSSL(1);
          MailITL.SetLogin(MailITSetupL."User Name Home24 (Paymt Avise)");
          MailITL.SetPassword(MailITSetupL."Password Home24 (Paymt Avise)");
        END;
        MailITL.Send();
      END ELSE
        MailITL.Display();

      // Remove the temporary folder and it's content.
      // If you use MAPI and Thunderbird or other MAPI email clints the they may require that
      // the image files remain on the disk until the mail is sent.

      IF FORMAT(UserSetupL."Mail Client") <> 'MAPI' THEN
        IF ClientFsoL.FolderExists(ClientTempFolderL) THEN
          ClientFsoL.DeleteFolder(ClientTempFolderL, FALSE);

      CLEAR(ClientFsoL);
      CLEAR(ClientUtilL);
      CLEAR(DivUtilL);
      //H1475 29.08.14 ARI -----------------------------------
    END;

    PROCEDURE "---FTTC---"@1000000016();
    BEGIN
      //S/P1010
      //E/P1010
    END;

    PROCEDURE Proceed_FTTC_TriggerMsg@1000000017(p_SalesHeader@1000000000 : Record 36;manuallyTriggeredV@1000000003 : Boolean);
    VAR
      SalesLineLoc@1000000001 : Record 37;
      SIIFillLog@1000000002 : Codeunit 50123;
    BEGIN
      //S/P1010
      CLEAR(SalesLineLoc);
      SalesLineLoc.SETRANGE("Document Type",p_SalesHeader."Document Type");
      SalesLineLoc.SETRANGE("Document No.",p_SalesHeader."No.");
      SalesLineLoc.SETRANGE(Type,SalesLineLoc.Type::Item);
      SalesLineLoc.SETFILTER(Quantity,'<>%1',0);
      SalesLineLoc.SETRANGE("Return Type",SalesLineLoc."Return Type"::"Spare Part");
      IF SalesLineLoc.FINDFIRST THEN BEGIN
        REPEAT
          CLEAR(SIIFillLog);
          //T0044 28.08.14 tec-cs +++++++++++++++++++++++++++++
          IF manuallyTriggeredV THEN BEGIN
            SIIFillLog.Triggered_SetManually(manuallyTriggeredV);
          END;
          //T0044 28.08.14 tec-cs -----------------------------
          SIIFillLog.Triggered_Sparepart(SalesLineLoc);
        UNTIL SalesLineLoc.NEXT = 0;
      END;
      //E/P1010
    END;

    BEGIN
    {
      chrmu - new mail header and footer 14.02.2012
      chrmu 03.04.12 - mail never use "display"
      1.00  15.05.12  eich  - e-mail address for direct location

      +-----------------------------------------------------+
      |               GOB Software & Systeme                |
      +-----------------------------------------------------+
      |                FP Commerce Anpassungen              |
      -------------------------------------------------------

      Version        Bemerkung
      -------------------------------------------------------
      P0011     GOB-MNO     23.05.12  Anpassung "ONRUN" Trigger fÅr die Abwicklung von Reklamationen
      GOB1.00   gob-rste    09.05.12  New Code Function CreateOrderMail for DHL Labels
      GOB1.01   gob-rste    14.05.12  New Code for Label Counter for multiple Purchase Lines
      GOB1.02   gob-rste    29.05.12  New Code for Chanel GER-7
      GOB1.03   gob-rste    13.06.12  New Code for correct print
      GOB1.04   gob-rste    14.06.12  New PDF Document for Warehouseorders
      GOB1.05   gob-mab     25.06.12  KEIN EMAIL VERSAND, wenn in Liste von Breitkreuz
      GOB1.06   gob-rste    26.06.12  New Code for Ship-to Address in Mail Subject
      GOB1.07   gob-rste    28.06.12  New Code for Special Order Purch E-Mail
      GOB1.08   gob-mab     23.07.12  Versand aller gesplitten EK-Bestellungen in einer Mail  (P0072)
      GOB1.09   gob-rste    24.07.12  Neue Texte fÅr Rechnungsversand (P0084)
      gob1.10   gob-mab     25.07.12  Locale Variable in CreateOrderMail geÑndert
      GOB1.11   gob-rste    25.07.12  New Code for DHL Shipment Date
      GOB1.12   gob-sfe     27.07.12  Purchase Email Text (P0099)
      GOB1.13   gob-rste    30.07.12  New Code for all Labels GER-7 in one PDF (P0104)
      GOB1.14   gob-rste    30.07.12  New Order Date for Dropshipments, HMTL Format Dropship Mails (P0112)
      GOB1.15   gob-jvi     07.08.12  New Functions Create Payment Advise Mails (P0091)
      gob1.16   gob-mab     09.08.12  Korrektur EK Email (p0169)
      gob1.17   gob-dst     15.08.12  Anpassung Kanal 99 (P0199)
      gob1.18   gob-mab     28.08.12  div. Anpassung bzgl. RG Mail NL/FR
      gob1.19   gob-dst     29.08.12  Anpassung Kanal 99 (P0252)
      gob1.20   gob-mno     03.09.12  P0267 - Fix doppelte Labels
      gob1.21   gob-mno     05.09.12  P0281 - Fix E-Mail Text
      GOB1.22   gob-rste    05.09.12  P0286 - Vendor Item No. Add. Order CSV
      GOB1.23   gob-fve     11.09.12  P0305 - Anpassung Email-Layout
      GOB1.24   gob-mno     12.09.12  P0311 - Anpassung E-Mail Texte
      GOB1.15   gob-rste    12.09.12  P0316 - Change Webshop from Flwofield to Integer
      gob1.16   gob-mab     14.09.12  p0282 - CreateContainerOrderMail
      gob1.17   gob-mab     17.09.12  p0237 - LOGIN PW fÅr Email Konto Fr Holland
      gob1.18   gob-mab     17.09.12  p0282 - neue Optionswerte EK integrieren
      gob1.19   gob-mab     24.09.12  p0368 - NL/FR TextÑnderung + p0282 deaktivieren bis LIVE
      gob1.30   gob-lku     25.09.12  P0376 - Anrede in Reklamationsmail auf "Search Name" anpassen
      gob1.31   gob-lku     25.09.12  P0380 - Anpassung des Textes der ReklamationsbestÑtigungs (alter Text = locGOBText003old)
      gob1.32   gob-ko      27.09.12  P0391 - Modify permission fÅr Zahlungsposten, BCC Kreditor Zahlungsavise herausgenommen
      gob1.33   gob-mab     22.10.12  p0474 - Purch Email Anp. fÅr Container
      gob1.34   gob-mab     24.10.12  p0508 - Report Container Mail geÑndert
      GOB1.35   gob-rste    30.10.12  P0538 - New Filter for GER-12, Function CreateOrderEMail
      GOB1.36   gob-mno     20.11.12  P0600 - New Function for Return Change Order Mail

      GOB1.38   gob-rste    05.12.12  P0642 - PO98 Mail
      GOB1.39   gob-mno     12.12.12  P0673 - External Document No. in E-Mail subject
      GOB1.40   gob-mno     18.12.12  P0688 - New Text Codes in Return Confirmation E-Mail
      GOB1.41   gob-mab     19.12.12  P0677 - Gutschriftversand
      GOB1.43   gob-mab     04.03.13  P0677 - Korrektur AUT + testfield website no
      GOB1.44   gob-mab     12.03.13  P0850 - Gutschrift Versand BCC
      GOB1.45   gob-mab     17.05.13  P0921 - Code simplification "CreateOrderMail"
      GOB1.46   gob-mab     17.05.13  P0921 - Print DS Label
      GOB1.47   gob-mab     21.05.13  P0921 - get Label Filter from DHL Setup
      GOB1.48   gob-ael     28.05.13  P0903 - only clear ship-to country/region code if not dropshipment
      GOB1.49   gob-mab     04.06.13  P0921 - Return mail International
      GOB1.50   gob-mab     11.06.13  P0921 - Return confirmation International / flexible ext. Texts
      GOB1.51   gob-mab     17.06.13  P0921 - CreateReturnChangeOrderMail International / flexibel ext. Text
      GOB1.52   gob-mab     19.06.13  P0978 - Hotfix Int. DS
      GOB1.53   gob-mab     09.07.13  P1017 - Order Email to further Recipients (CC)
      GOB1.55   gob-mab     15.07.13  P1029 - Fix Furniture Shipping Retourenlable
      GOB1.57   gob-sil     17.10.13  P1128 - Sending Return Labels as Parcels are necessary
      GOB1.58   gob-rste    23.12.13  P1092 - Send Real Crossdocking Mails
      GOB1.59   gob-kmi     10.06.14  P1243 - Send DPD Label

      GOB1.61   gob-kmi     11.09.14  P1277 - Edit DHL PDF File Name

      +--------------------------------------------+
      |                                            |
      |                  Home24                    |
      |     Cooperation Tectura & Home24 NAV Team  |
      |                                            |
      +--------------------------------------------+

      Project No. Date      Shortcut  Description
      _____________________________________________
      T0044       27.08.14  tec-cs    send "return confirmation mail" from return order card
      T0098       18.03.15  CC-JGR    MP - Mail to Marketplace Partner
      T0098       20.03.15  CC_GHE    Change TC HMEText001 (Remove Home 24, add %1)

      +--------------------------------------------+
      |                                            |
      |                  Home24                    |
      |       Internal Customizing by NAV-Team     |
      |                                            |
      +--------------------------------------------+

      Project No. Date        Shortcut  Description
      _____________________________________________
      H0006       27.09.12   rho       New Function CreateOrderUpdateMail Change Channel 8->7; 8->4; 8->99; Send new or updated Labels
      H0067       30.10.12   ARU       Standard Text Codes for E-Mailing Invoice Process (FRA & NL)
      H0073       05.11.12   ARU       Send SalesInvoice only if LanguageCode is enabled
      H0676       03.12.12   ARU       DS-Order mail uses customer mail template - wrong format
      H0135       02.01.13   ARU       Standard Text Codes for E-Mailing Invoice Process (AUT)
      H0548       10.01.13   ARU       Assimilation Customer-Mails
      H0219       25.02.13   ARU       Eliminate PhoneNo in ReturnOrderMail etc.
      H0355       22.05.13   FX        Correction Website No. error
      H0332       03.05.13   FX        Bug correction in EMail process
      H0372       02.07.13   FX        Manually posted orders also receive e-mail
      H0575       24.10.13   ARU       Update Mail PO-to-repository incl. attachment AVISE-guidelines
      H0604       06.11.13   ARU       CreateSalesRefundConfirm > Update of 6 further customer mails - text edits and new headers etc.
                                        > Change type and size of font
      H0773       22.01.14   FX        Confirmation Request for second sending of a Purchase Order email
      H0709       30.01.14   MBY       Add Mail Server Authorization Setup
      H0979       04.04.14   FF        Changed Layout for Dropship Mail
      H0784       04.02.14   ARU       Switzerland: Prepare all customer mails in NAV
      H1218       10.07.14   EHN       Export crossborder VAT Registration No. via EDI and CSV File
      H0829       21.07.14   EHN       Add the Order-/Returnorder number to international returnlabels
      H1476       20.08.14   FF        Add BE Dropship Footer CreateOrderMail
      H1390       22.08.14   MSL       Carrier via SMT: 4) Consolidation of Carriers
      H1475       29.08.14   ARI       Deploy Payment Advise per E-Mail -> New Function
      H1536       12.09.14   EHN       Bugfix for Label Creation DHL via EDI
      H1626       08.10.14   TST       Bugfix CrossDocking
      H1629       09.10.14   ARI       Bugfix: Send Payment Advise via Email -> Send separated Advises
      H1662       29.10.14   FF        Added IT Dropship Footer CreateOrderMail
      H1619       31.10.14   EHN       Extend CSV in Purchase Order Email
      H1750       28.11.14   DMA       BUG: EDI Delivery Note is missing for EDI Crossdock Orders,CODECHANGE
      H1870       02.12.14   EHN       HOTFIX: Purchasing email print fix
      H1892       08.12.14   EHN       BUGFIX: CSV File missing CD Shipping Address
      H1783       19.11.14   MIK       SII Redesign for the Return&Change messages (Label&Instruction). Code cleanup.
      H1731       09.12.14   EHN       Phase 2: spare part - EDI & CSV adjustment
      H1534       26.01.15   RST       Phase 2: Vendor E-Mail for Spare Part
      H2078       04.02.15   EHN       Spare Part: Adjust purchase mail address & spare part reason
      H1671       11.02.15   FF        Dropship/Purchase Mail Footer/Header Setup
      H2108       11.02.15   DMO       PO Line Tracking Improvements,update counter of sent emails on purchase header
      H2159       19.02.15   TST       Check Status when triggering payment advice email
      H3782       17.03.15   EHN       Spare Part Process: Improvement Vendor Mail/EDI & delivery note
      H4267       20.05.15   EHN       Bugfix - H3847 - Description 2 is overwritten in Purchase Line
      +--------------------------------------------+
      |                                            |
      |                  Home24                    |
      |     Cooperation GOB & Home24 NAV Team      |
      |                                            |
      +--------------------------------------------+

      Project No. Date      Shortcut  Description
      _____________________________________________

      P1010       23.07.13  gob-mlan  FTTC Phase 2: Triggered Msg.
      P1111       23.09.13  gob-mlan  FTTC Phase 2: Triggered Msg.
    }
    END.
  }
}

