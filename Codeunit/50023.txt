OBJECT Codeunit 50023 DHL Crossdock Mgt.
{
  OBJECT-PROPERTIES
  {
    Date=05.11.13;
    Time=14:58:41;
    Modified=Yes;
    Version List=GOB;
  }
  PROPERTIES
  {
    OnRun=VAR
            DHLCrossDockingImportExportLoc@1108200003 : Record 50052;
          BEGIN
            CASE RunType OF
              RunType::Download: BEGIN
                DownloadFiles;
              END;
              RunType::Import: BEGIN
                ImportFiles(GlobalFileName);
              END;
              RunType::Export: BEGIN
                ExportFiles(GlobalBatchLogEntryNo);
              END;
              RunType::Upload: BEGIN
                UploadFiles;
              END;
              RunType::Process: BEGIN
                ProcessDHLResponses(GlobalBatchLogEntryNo);
              END;
            END;
          END;

  }
  CODE
  {
    VAR
      GlobalCollyCounter@1108200000 : Integer;
      TransmissionCreationDateGLOB@1108200001 : Text[30];
      TransmissionControlNumberGLOB@1108200002 : Text[30];
      SendingPartyIDGLOB@1108200003 : Text[30];
      ReceivingPartyIDGLOB@1108200004 : Text[30];
      GlobalEntryNo@1108200009 : Integer;
      RunType@1108200005 : ' ,Download,Import,Export,Upload,Process';
      GlobalBatchLogEntryNo@1108200006 : Integer;
      GlobalFileName@1108200007 : Text[1024];
      GlobalBigIntID@1000000000 : BigInteger;
      CUParcelStatusHistoryMgmt@1000000001 : Codeunit 80011;

    PROCEDURE CreateDHLOrder@1108200024(p_PurchOrderNo@1108200012 : Code[20]);
    VAR
      xmlMgt@1108200000 : Codeunit 6224;
      xmlProcessingInst@1108200001 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      CurrNode@1108200002 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      NewChild@1108200003 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      CurrNode2@1108200004 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      CurrNode3@1108200005 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      CurrNode4@1108200006 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      CurrNode5@1108200007 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      CurrNode6@1108200008 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      CurrNode7@1108200009 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      CurrNode8@1108200010 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      XMLDoc@1108200011 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{F6D90F11-9C73-11D3-B32E-00C04F990BB4}:'Microsoft XML, v6.0'.DOMDocument";
      TempFileName@1108200013 : Text[30];
      CustLoc@1108200014 : Record 18;
      SalesLineLoc@1108200015 : Record 37;
      ItemLoc@1108200016 : Record 27;
      j@1108200018 : Integer;
      VendLoc@1108200021 : Record 23;
      PurchLineLoc@1108200019 : Record 39;
      SalesHeaderLoc@1108200023 : Record 36;
      DHLCrossdockHeader@1108200017 : Record 50052;
      FileNameLoc@1108200020 : Text[1024];
      PurchHeader@1108200024 : Record 38;
    BEGIN
      GlobalEntryNo := 0;
      PurchHeader.GET(1,p_PurchOrderNo);
      IF CREATE(XMLDoc) THEN BEGIN
        DHLCrossdockHeader.INIT;
        DHLCrossdockHeader."Entry No." := DHLCrossdockHeader.GetNextEntryNo;
        GlobalEntryNo := DHLCrossdockHeader."Entry No.";
        //A/gob-rste/08.08.12/GOB1.10
        DHLCrossdockHeader."DHL Order ID" := DHLCrossdockHeader.GetNextDHLOrderID;
        GlobalBigIntID := DHLCrossdockHeader."DHL Order ID";
        //E/gob-rste/08.08.12/GOB1.10
        DHLCrossdockHeader.Type := DHLCrossdockHeader.Type::Order;
        DHLCrossdockHeader.Inserted := CURRENTDATETIME;
        DHLCrossdockHeader.Processed := TRUE;
        DHLCrossdockHeader."Processed on" := CURRENTDATETIME;
        DHLCrossdockHeader.Direction := DHLCrossdockHeader.Direction::Out;
        xmlMgt.SetNormalCase;
        PurchLineLoc.SETRANGE("Document Type",PurchHeader."Document Type");
        PurchLineLoc.SETRANGE("Document No.",PurchHeader."No.");
        PurchLineLoc.SETRANGE(Type,PurchLineLoc.Type::Item);
        PurchLineLoc.SETFILTER("No.",'<>%1','');
        PurchLineLoc.FINDFIRST;
        SalesHeaderLoc.GET(1,PurchLineLoc."Order No.");
        xmlProcessingInst := XMLDoc.createProcessingInstruction('xml','version="1.0" encoding="utf-8"');
        CurrNode := XMLDoc.appendChild(xmlProcessingInst);

        CurrNode := XMLDoc.createElement('ns5:Transmission');
        CurrNode := XMLDoc.appendChild(CurrNode);
        xmlMgt.AddAttribute(CurrNode,'xmlns:ns5','http://www.it4logistics.de/i4ldata/ext');
        xmlMgt.AddAttribute(CurrNode,'xmlns:ns2','http://www.it4logistics.de/i4ldata/i4l');
        xmlMgt.AddAttribute(CurrNode,'xmlns:ns3','http://www.it4logistics.de/i4ldata/scm');
        xmlMgt.AddAttribute(CurrNode,'xmlns:ns4','http://www.it4logistics.de/i4ldata/wms');

        DHLCrossdockHeader.TransmissionCreationDate := SetDateTimeAsText(TODAY,TIME);
        DHLCrossdockHeader.TransmissionControlNumber := GetTransmissionControlNumber;
        DHLCrossdockHeader.SendingPartyID := 'FPC';
        DHLCrossdockHeader.ReceivingPartyID := 'DELIVERIT';
        //A/gob-rste/18.06.12/GOB1.01
        DHLCrossdockHeader.TESTFIELD(TransmissionCreationDate);
        DHLCrossdockHeader.TESTFIELD(TransmissionControlNumber);
        DHLCrossdockHeader.TESTFIELD(SendingPartyID);
        DHLCrossdockHeader.TESTFIELD(ReceivingPartyID);
        //E/gob-rste/18.06.12/GOB1.01

        xmlMgt.AddElement(CurrNode,'TransmissionCreationDate',DHLCrossdockHeader.TransmissionCreationDate,'',CurrNode2);
        xmlMgt.AddElement(CurrNode,'TransmissionControlNumber',DHLCrossdockHeader.TransmissionControlNumber,'',CurrNode2);
        xmlMgt.AddElement(CurrNode,'SendingPartyID',DHLCrossdockHeader.SendingPartyID,'',CurrNode2);
        xmlMgt.AddElement(CurrNode,'ReceivingPartyID',DHLCrossdockHeader.ReceivingPartyID,'',CurrNode2);
        xmlMgt.AddElement(CurrNode,'MessageCount','1','',CurrNode2);

        DHLCrossdockHeader.MessageCreationDate := SetDateTimeAsText(TODAY,TIME);
        DHLCrossdockHeader.MessageControlNumber := GetMessageControlNumber;
        //A/gob-rste/18.06.12/GOB1.01
        DHLCrossdockHeader.TESTFIELD(MessageCreationDate);
        DHLCrossdockHeader.TESTFIELD(MessageControlNumber);
        //E/gob-rste/18.06.12/GOB1.01
        xmlMgt.AddElement(CurrNode,'Messages','','',CurrNode2);
        xmlMgt.AddElement(CurrNode2,'MessageStructureVersion','1.00','',CurrNode3);
        xmlMgt.AddElement(CurrNode2,'MessageCreationDate',DHLCrossdockHeader.MessageCreationDate,'',CurrNode3);
        xmlMgt.AddElement(CurrNode2,'MessageControlNumber',DHLCrossdockHeader.MessageControlNumber,'',CurrNode3);
        xmlMgt.AddElement(CurrNode2,'MessageContent','','',CurrNode3);

        AddElement2(CurrNode3,'ns5:Order','',CurrNode4);

        xmlMgt.AddElement(CurrNode4,'OrderId','','',CurrNode5);
        xmlMgt.AddElement(CurrNode5,'System','FPC','',CurrNode6);
        //A/gob-rste/08.08.12/GOB1.10
        //DHLCrossdockHeader.OrderID := FORMAT(DHLCrossdockHeader."Entry No.");
        DHLCrossdockHeader.OrderID := FORMAT(DHLCrossdockHeader."DHL Order ID");
        //E/gob-rste/08.08.12/GOB1.10
        DHLCrossdockHeader.OrderNr := PurchHeader."No.";
        //A/gob-rste/24.07.12/GOB1.06
        IF PurchHeader."DHL HD Transfer Date" = 0D THEN BEGIN
          PurchHeader."DHL HD Transfer Date" := TODAY;
          PurchHeader.MODIFY;
        END;
        //DHLCrossdockHeader.OrderDate := FORMAT(TODAY,0,'<Year4>-<Month,2>-<Day,2>');
        DHLCrossdockHeader.OrderDate := FORMAT(PurchHeader."DHL HD Transfer Date",0,'<Year4>-<Month,2>-<Day,2>');
        //E/gob-rste/24.07.12/GOB1.06
        DHLCrossdockHeader.OrderType := 'LIEF_KK';
        DHLCrossdockHeader.ProductType := 'ZH';
        DHLCrossdockHeader.FreightTerms := 'FV';
        DHLCrossdockHeader.Client := 'FPC';
        //A/gob-rste/18.06.12/GOB1.01
        DHLCrossdockHeader.TESTFIELD(OrderID);
        DHLCrossdockHeader.TESTFIELD(OrderNr);
        DHLCrossdockHeader.TESTFIELD(OrderDate);
        DHLCrossdockHeader.TESTFIELD(OrderType);
        DHLCrossdockHeader.TESTFIELD(ProductType);
        DHLCrossdockHeader.TESTFIELD(FreightTerms);
        DHLCrossdockHeader.TESTFIELD(Client);
        //E/gob-rste/18.06.12/GOB1.01
        //A/gob-rste/08.08.12/GOB1.10
        //xmlMgt.AddElement(CurrNode5,'Id',FORMAT(DHLCrossdockHeader."Entry No."),'',CurrNode6);
        xmlMgt.AddElement(CurrNode5,'Id',FORMAT(DHLCrossdockHeader."DHL Order ID"),'',CurrNode6);
        //E/gob-rste/08.08.12/GOB1.10

        xmlMgt.AddElement(CurrNode4,'OrderNr',PurchHeader."No.",'',CurrNode5);
        xmlMgt.AddElement(CurrNode4,'Client',DHLCrossdockHeader.Client,'',CurrNode5);

        xmlMgt.AddElement(CurrNode4,'Sender','','',CurrNode5);
        CurrNode6 := CurrNode5.ownerDocument.createAttribute('xsi:type');
        CurrNode6.nodeValue := 'ns5:Supplier';
        CurrNode5.attributes.setNamedItem(CurrNode6);
        CurrNode4.appendChild(CurrNode5);

        CurrNode6 := CurrNode6.ownerDocument.createAttribute('xmlns:xsi');
        CurrNode6.nodeValue := 'http://www.w3.org/2001/XMLSchema-instance';
        CurrNode5.attributes.setNamedItem(CurrNode6);
        CurrNode4.appendChild(CurrNode5);

        xmlMgt.AddElement(CurrNode5,'PartnerId','','',CurrNode6);
        xmlMgt.AddElement(CurrNode6,'System','FPC','',CurrNode7);
        //A/gob-rste/18.06.12/GOB1.01
        PurchHeader.TESTFIELD("Buy-from Vendor No.");
        PurchHeader.TESTFIELD("Buy-from Vendor Name");
        PurchHeader.TESTFIELD("Buy-from Country/Region Code");
        PurchHeader.TESTFIELD("Buy-from Post Code");
        PurchHeader.TESTFIELD("Buy-from City");
        PurchHeader.TESTFIELD("Buy-from Address");

        //E/gob-rste/18.06.12/GOB1.01
        //A/gob-rste/11.07.12/GOB1.04
        //xmlMgt.AddElement(CurrNode6,'Id',PurchHeader."Buy-from Vendor No.",'',CurrNode7);
        VendLoc.GET(PurchHeader."Buy-from Vendor No.");
        VendLoc.TESTFIELD("DHL HD Partner ID");
        xmlMgt.AddElement(CurrNode6,'Id',VendLoc."DHL HD Partner ID",'',CurrNode7);
        //E/gob-rste/11.07.12/GOB1.04
        xmlMgt.AddElement(CurrNode5,'Name',PurchHeader."Buy-from Vendor Name",'',CurrNode6);
        xmlMgt.AddElement(CurrNode5,'Address','','',CurrNode6);
        xmlMgt.AddElement(CurrNode6,'Name1',PurchHeader."Buy-from Vendor Name",'',CurrNode7);
        IF PurchHeader."Buy-from Vendor Name 2" <> '' THEN
          xmlMgt.AddElement(CurrNode6,'Name2',PurchHeader."Buy-from Vendor Name 2",'',CurrNode7);
        xmlMgt.AddElement(CurrNode6,'CountryCode',PurchHeader."Buy-from Country/Region Code",'',CurrNode7);
        xmlMgt.AddElement(CurrNode6,'PostalCode',PurchHeader."Buy-from Post Code",'',CurrNode7);
        xmlMgt.AddElement(CurrNode6,'City',PurchHeader."Buy-from City",'',CurrNode7);
        xmlMgt.AddElement(CurrNode6,'Street',PurchHeader."Buy-from Address",'',CurrNode7);
        IF VendLoc."Phone No." <> '' THEN
          xmlMgt.AddElement(CurrNode6,'PhoneNumber1',VendLoc."Phone No.",'',CurrNode7);
        IF VendLoc."E-Mail" <> '' THEN
        xmlMgt.AddElement(CurrNode6,'EMail',VendLoc."E-Mail",'',CurrNode7);

        xmlMgt.AddElement(CurrNode4,'Receiver','','',CurrNode5);

        CurrNode6 := CurrNode5.ownerDocument.createAttribute('xsi:type');
        CurrNode6.nodeValue := 'ns5:Customer';
        CurrNode5.attributes.setNamedItem(CurrNode6);
        CurrNode4.appendChild(CurrNode5);
        CurrNode6 := CurrNode5.ownerDocument.createAttribute('xmlns:xsi');
        CurrNode6.nodeValue := 'http://www.w3.org/2001/XMLSchema-instance';
        CurrNode5.attributes.setNamedItem(CurrNode6);
        CurrNode4.appendChild(CurrNode5);


        xmlMgt.AddElement(CurrNode5,'PartnerId','','',CurrNode6);
        xmlMgt.AddElement(CurrNode6,'System','FPC','',CurrNode7);
        //A/gob-rste/08.08.12/GOB1.10
        //xmlMgt.AddElement(CurrNode6,'Id',FORMAT(DHLCrossdockHeader."Entry No."),'',CurrNode7);
        xmlMgt.AddElement(CurrNode6,'Id',FORMAT(DHLCrossdockHeader."DHL Order ID"),'',CurrNode7);
        //E/gob-rste/08.08.12/GOB1.10

        //A/gob-rste/18.06.12/GOB1.01
        SalesHeaderLoc.TESTFIELD("Ship-to Name");
        SalesHeaderLoc.TESTFIELD("Ship-to Country/Region Code");
        SalesHeaderLoc.TESTFIELD("Ship-to Post Code");
        SalesHeaderLoc.TESTFIELD("Ship-to City");
        SalesHeaderLoc.TESTFIELD("Ship-to Address");
        SalesHeaderLoc.TESTFIELD("Sell-to Customer No.");
        //E/gob-rste/18.06.12/GOB1.01
        xmlMgt.AddElement(CurrNode5,'Name',SalesHeaderLoc."Ship-to Name",'',CurrNode6);
        xmlMgt.AddElement(CurrNode5,'Address','','',CurrNode6);
        xmlMgt.AddElement(CurrNode6,'Name1',SalesHeaderLoc."Ship-to Name",'',CurrNode7);
        IF SalesHeaderLoc."Ship-to Name 2" <> '' THEN
          xmlMgt.AddElement(CurrNode6,'Name2',SalesHeaderLoc."Ship-to Name 2",'',CurrNode7);
        xmlMgt.AddElement(CurrNode6,'CountryCode',SalesHeaderLoc."Ship-to Country/Region Code",'',CurrNode7);
        xmlMgt.AddElement(CurrNode6,'PostalCode',SalesHeaderLoc."Ship-to Post Code",'',CurrNode7);
        xmlMgt.AddElement(CurrNode6,'City',SalesHeaderLoc."Ship-to City",'',CurrNode7);
        xmlMgt.AddElement(CurrNode6,'Street',SalesHeaderLoc."Ship-to Address",'',CurrNode7);
        CustLoc.GET(SalesHeaderLoc."Sell-to Customer No.");
        //A/gob-rste/18.08.12/GOB1.01
        CustLoc.TESTFIELD("Phone No.");
        CustLoc.TESTFIELD("E-Mail");
        //E/gob-rste/18.06.12/GOB1.01
        xmlMgt.AddElement(CurrNode6,'PhoneNumber1',CustLoc."Phone No.",'',CurrNode7);
        xmlMgt.AddElement(CurrNode6,'EMail',CustLoc."E-Mail",'',CurrNode7);


        xmlMgt.AddElement(CurrNode4,'OrderType',DHLCrossdockHeader.OrderType,'',CurrNode5);
        xmlMgt.AddElement(CurrNode4,'ProductType',DHLCrossdockHeader.ProductType,'',CurrNode5);
        xmlMgt.AddElement(CurrNode4,'FreightTerms',DHLCrossdockHeader.FreightTerms,'',CurrNode5);
        xmlMgt.AddElement(CurrNode4,'OrderDate',DHLCrossdockHeader.OrderDate,'',CurrNode5);

        CreateDHLOrderLines(PurchHeader,
                            CurrNode,
                            CurrNode2,
                            CurrNode3,
                            CurrNode4,
                            CurrNode5,
                            CurrNode6,
                            CurrNode7,
                            CurrNode8);
        FileNameLoc := CreateFileName(PurchHeader."No.",FALSE);
        DHLCrossdockHeader.Filename := GetFileName(FileNameLoc);
        XMLDoc.save(FileNameLoc);
        //A/gob-rste/10.07.12/GOB1.02
        DHLCrossdockHeader."XML File".IMPORT(FileNameLoc);
        //E/gob-rste/10.07.12/GOB1.02
        DHLCrossdockHeader.INSERT;
      END;
    END;

    PROCEDURE CreateDHLOrderLines@1108200000(p_PurchHeader@1108200000 : Record 38;VAR CurrNode@1108200008 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";VAR CurrNode2@1108200007 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";VAR CurrNode3@1108200006 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";VAR CurrNode4@1108200005 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";VAR CurrNode5@1108200004 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";VAR CurrNode6@1108200003 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNod;
    VAR
      xmlMgt@1108200010 : Codeunit 6224;
      ItemLoc@1108200011 : Record 27;
      i@1108200012 : Integer;
      PurchLineLoc@1108200009 : Record 39;
      SalesLineLoc@1108200013 : Record 37;
      NextLineNo@1108200014 : Integer;
      DHLCrossdockLine@1108200015 : Record 50053;
      ServiceMatchCodeLoc@1108200016 : Code[10];
      ServiceWorkunitLoc@1108200017 : Text[30];
      ServiceInformationLoc@1108200018 : Text[50];
    BEGIN
      xmlMgt.SetNormalCase;
      PurchLineLoc.SETRANGE("Document Type",p_PurchHeader."Document Type");
      PurchLineLoc.SETRANGE("Document No.",p_PurchHeader."No.");
      PurchLineLoc.SETRANGE(Type,PurchLineLoc.Type::Item);
      PurchLineLoc.SETRANGE("Purchasing Code",'GER-4');
      IF PurchLineLoc.FIND('-') THEN BEGIN
        REPEAT
          IF ItemLoc.GET(PurchLineLoc."No.") THEN BEGIN
            SalesLineLoc.GET(1,PurchLineLoc."Order No.",PurchLineLoc."Order Line No.");
            NextLineNo := NextLineNo + 10000;
            DHLCrossdockLine.INIT;
            DHLCrossdockLine."Entry No." := GlobalEntryNo;
            DHLCrossdockLine."Entry Line No." := NextLineNo;
            DHLCrossdockLine."PO No." := PurchLineLoc."Document No.";
            DHLCrossdockLine."PO Line No. (Catalognr)" := PurchLineLoc."Line No.";
            DHLCrossdockLine.ProductName := SalesLineLoc.Description + SalesLineLoc."Description 2";
            DHLCrossdockLine.ProductNr := SalesLineLoc."No.";
            DHLCrossdockLine.Quantitty := FORMAT(SalesLineLoc.Quantity,0,9);

            //A/gob-rste/18.06.12/GOB1.01
            DHLCrossdockLine.TESTFIELD("PO No.");
            DHLCrossdockLine.TESTFIELD("PO Line No. (Catalognr)");
            DHLCrossdockLine.TESTFIELD(ProductName);
            DHLCrossdockLine.TESTFIELD(ProductNr);
            DHLCrossdockLine.TESTFIELD(Quantitty);
            //E/gob-rste/18.06.12/GOB1.01
            ItemLoc.CALCFIELDS("Parcels Number");
            IF ItemLoc."Parcels Number" <> 0 THEN
              DHLCrossdockLine.Packages := FORMAT(ItemLoc."Parcels Number")
            ELSE
              DHLCrossdockLine.Packages := FORMAT(1);

            DHLCrossdockLine."Volume Amount" := GetItemVolume(ItemLoc);
            DHLCrossdockLine."Volume Unit" := 'CBM';
            DHLCrossdockLine."Weight Amount" := GetItemWeight(ItemLoc);
            DHLCrossdockLine."Weight Unit" := 'KG';

            xmlMgt.AddElement(CurrNode4,'Items','','',CurrNode5);
            xmlMgt.AddElement(CurrNode5,'CatalogNr',FORMAT(DHLCrossdockLine."PO Line No. (Catalognr)"),'',CurrNode6);
            xmlMgt.AddElement(CurrNode5,'ProductNr',DHLCrossdockLine.ProductNr,'',CurrNode6);
            xmlMgt.AddElement(CurrNode5,'ProductName',DHLCrossdockLine.ProductName,'',CurrNode6);
            xmlMgt.AddElement(CurrNode5,'Quantity',DHLCrossdockLine.Quantitty,'',CurrNode6);
            xmlMgt.AddElement(CurrNode5,'Packages',DHLCrossdockLine.Packages,'',CurrNode6);
            xmlMgt.AddElement(CurrNode5,'Volume','','',CurrNode6);
            xmlMgt.AddElement(CurrNode6,'Amount',DHLCrossdockLine."Volume Amount",'',CurrNode7);
            xmlMgt.AddElement(CurrNode6,'Unit',DHLCrossdockLine."Volume Unit",'',CurrNode7);
            xmlMgt.AddElement(CurrNode5,'Weight','','',CurrNode6);
            xmlMgt.AddElement(CurrNode6,'Amount',DHLCrossdockLine."Weight Amount",'',CurrNode7);
            xmlMgt.AddElement(CurrNode6,'Unit',DHLCrossdockLine."Weight Unit",'',CurrNode7);
            ServiceMatchCodeLoc := '';
            ServiceWorkunitLoc := '';
            ServiceInformationLoc := '';
            IF GetServiceLine(SalesLineLoc,ServiceMatchCodeLoc,ServiceWorkunitLoc,ServiceInformationLoc) THEN BEGIN
              DHLCrossdockLine.ServiceMatchCode := ServiceMatchCodeLoc;
              DHLCrossdockLine.ServiceWorkUnit := ServiceWorkunitLoc;
              DHLCrossdockLine.ServiceInformation := ServiceInformationLoc;
              xmlMgt.AddElement(CurrNode5,'Services','','',CurrNode6);
              xmlMgt.AddElement(CurrNode6,'MatchCode',DHLCrossdockLine.ServiceMatchCode,'',CurrNode7);
              xmlMgt.AddElement(CurrNode6,'WorkUnit',DHLCrossdockLine.ServiceWorkUnit,'',CurrNode7);
              xmlMgt.AddElement(CurrNode6,'Information',DHLCrossdockLine.ServiceInformation,'',CurrNode7);
            END;
            IF ItemLoc."Parcels Number" = 0 THEN
              xmlMgt.AddElement(CurrNode5,'Barcodes',CreateBCDHLOrder(SalesLineLoc,ItemLoc),'',CurrNode6)
            ELSE
              FOR i := 1 TO ItemLoc."Parcels Number" DO BEGIN
                xmlMgt.AddElement(CurrNode5,'Barcodes',CreateBCDHLOrder(SalesLineLoc,ItemLoc),'',CurrNode6);
            END;
          END;
          DHLCrossdockLine.INSERT;
          //A/gob-rste/25.07.12/GOB1.07
          UpdateSalesLines(PurchLineLoc,0);
          //E/gob-rste/25.07.12/GOB1.07
        UNTIL PurchLineLoc.NEXT = 0;
      END;
    END;

    PROCEDURE GetServiceLine@1108200046(p_SalesLine@1108200000 : Record 37;VAR p_ServiceMatchCode@1108200001 : Code[10];VAR p_ServiceWorkunit@1108200002 : Text[30];VAR p_ServiceInformation@1108200003 : Text[50]) : Boolean;
    VAR
      SalesLineLoc@1108200004 : Record 37;
      ItemLoc@1108200005 : Record 27;
    BEGIN
      SalesLineLoc.RESET;
      SalesLineLoc.SETRANGE("Document Type",p_SalesLine."Document Type");
      SalesLineLoc.SETRANGE("Document No.",p_SalesLine."Document No.");
      SalesLineLoc.SETRANGE("Parent ID",p_SalesLine.ID);
      SalesLineLoc.SETRANGE(Type,SalesLineLoc.Type::Resource);
      SalesLineLoc.SETRANGE("Resource Type",SalesLineLoc."Resource Type"::Assembly);
      IF SalesLineLoc.FINDFIRST THEN BEGIN
        IF ItemLoc.GET(p_SalesLine."No.") THEN
          p_ServiceMatchCode := 'MM';
          p_ServiceWorkunit :=  FORMAT(ROUND(ItemLoc."Assembly Service Amount",1,'>'));
          p_ServiceInformation := 'Mîbelmontage';
          IF (p_ServiceMatchCode <> '') AND (p_ServiceWorkunit <> '') AND (p_ServiceInformation <> '') THEN
            EXIT(TRUE);
      END;
      EXIT(FALSE);
    END;

    PROCEDURE CreateDHLOrderCanceled@1108200011(p_PurchOrderNo@1108200012 : Code[20]);
    VAR
      xmlMgt@1108200000 : Codeunit 6224;
      xmlProcessingInst@1108200001 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      CurrNode@1108200002 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      NewChild@1108200003 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      CurrNode2@1108200004 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      CurrNode3@1108200005 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      CurrNode4@1108200006 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      CurrNode5@1108200007 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      CurrNode6@1108200008 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      CurrNode7@1108200009 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      CurrNode8@1108200010 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      XMLDoc@1108200011 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{F6D90F11-9C73-11D3-B32E-00C04F990BB4}:'Microsoft XML, v6.0'.DOMDocument";
      TempFileName@1108200013 : Text[30];
      CustLoc@1108200014 : Record 18;
      SalesLineLoc@1108200015 : Record 37;
      ItemLoc@1108200016 : Record 27;
      i@1108200017 : Integer;
      j@1108200018 : Integer;
      VendLoc@1108200021 : Record 23;
      DHLCrossdockHeader@1108200022 : Record 50052;
      FileNameLoc@1108200019 : Text[1024];
      DHLCrossdockHeader2@1108200020 : Record 50052;
    BEGIN
      IF CREATE(XMLDoc) THEN BEGIN
        xmlMgt.SetNormalCase;

        DHLCrossdockHeader.INIT;
        DHLCrossdockHeader."Entry No." := DHLCrossdockHeader.GetNextEntryNo;
        //A/gob-rste/08.08.12/GOB1.10
        DHLCrossdockHeader."DHL Order ID" := DHLCrossdockHeader.GetNextDHLOrderID;
        //E/gob-rste/08.08.12/GOB1.10
        DHLCrossdockHeader.Type := DHLCrossdockHeader.Type::OrderCanceledOut;
        DHLCrossdockHeader.Inserted := CURRENTDATETIME;
        DHLCrossdockHeader.Processed := TRUE;
        DHLCrossdockHeader."Processed on" := CURRENTDATETIME;
        DHLCrossdockHeader.Direction := DHLCrossdockHeader.Direction::Out;

        xmlProcessingInst := XMLDoc.createProcessingInstruction('xml','version="1.0" encoding="utf-8"');
        CurrNode := XMLDoc.appendChild(xmlProcessingInst);
        CurrNode := XMLDoc.createElement('ns5:Transmission');
        CurrNode := XMLDoc.appendChild(CurrNode);
        xmlMgt.AddAttribute(CurrNode,'xmlns:ns5','http://www.it4logistics.de/i4ldata/ext');
        xmlMgt.AddAttribute(CurrNode,'xmlns:ns2','http://www.it4logistics.de/i4ldata/i4l');
        xmlMgt.AddAttribute(CurrNode,'xmlns:ns3','http://www.it4logistics.de/i4ldata/scm');
        xmlMgt.AddAttribute(CurrNode,'xmlns:ns4','http://www.it4logistics.de/i4ldata/wms');

        DHLCrossdockHeader.TransmissionCreationDate := SetDateTimeAsText(TODAY,TIME);
        DHLCrossdockHeader.TransmissionControlNumber := GetTransmissionControlNumber;
        DHLCrossdockHeader.SendingPartyID := 'FPC';
        DHLCrossdockHeader.ReceivingPartyID := 'DELIVERIT';
        //A/gob-rste/18.06.12/GOB1.01
        DHLCrossdockHeader.TESTFIELD(TransmissionCreationDate);
        DHLCrossdockHeader.TESTFIELD(TransmissionControlNumber);
        DHLCrossdockHeader.TESTFIELD(SendingPartyID);
        DHLCrossdockHeader.TESTFIELD(ReceivingPartyID);
        //E/gob-rste/18.06.12/GOB1.01
        xmlMgt.AddElement(CurrNode,'TransmissionCreationDate',DHLCrossdockHeader.TransmissionCreationDate,'',CurrNode2);
        xmlMgt.AddElement(CurrNode,'TransmissionControlNumber',DHLCrossdockHeader.TransmissionControlNumber,'',CurrNode2);
        xmlMgt.AddElement(CurrNode,'SendingPartyID',DHLCrossdockHeader.SendingPartyID,'',CurrNode2);
        xmlMgt.AddElement(CurrNode,'ReceivingPartyID',DHLCrossdockHeader.ReceivingPartyID,'',CurrNode2);
        xmlMgt.AddElement(CurrNode,'MessageCount','1','',CurrNode2);

        DHLCrossdockHeader.MessageCreationDate := SetDateTimeAsText(TODAY,TIME);
        DHLCrossdockHeader.MessageControlNumber := GetMessageControlNumber;
        //A/gob-rste/18.06.12/GOB1.01
        DHLCrossdockHeader.TESTFIELD(MessageCreationDate);
        DHLCrossdockHeader.TESTFIELD(MessageControlNumber);
        //E/gob-rste/18.06.12/GOB1.01
        xmlMgt.AddElement(CurrNode,'Messages','','',CurrNode2);
        xmlMgt.AddElement(CurrNode2,'MessageStructureVersion','1.00','',CurrNode3);
        xmlMgt.AddElement(CurrNode2,'MessageCreationDate',DHLCrossdockHeader.MessageCreationDate,'',CurrNode3);
        xmlMgt.AddElement(CurrNode2,'MessageControlNumber',DHLCrossdockHeader.MessageControlNumber,'',CurrNode3);
        xmlMgt.AddElement(CurrNode2,'MessageContent','','',CurrNode3);

        AddElement2(CurrNode3,'ns5:Status','',CurrNode4);

        CurrNode5 := CurrNode4.ownerDocument.createAttribute('xsi:type');
        CurrNode5.nodeValue := 'ns5:OrderCanceled';
        CurrNode4.attributes.setNamedItem(CurrNode5);
        CurrNode3.appendChild(CurrNode4);


        CurrNode5 := CurrNode4.ownerDocument.createAttribute('xmlns:xsi');
        CurrNode5.nodeValue := 'http://www.w3.org/2001/XMLSchema-instance';
        CurrNode4.attributes.setNamedItem(CurrNode5);
        CurrNode3.appendChild(CurrNode4);
        //A/gob-rste/18.06.12/GOB1.01
        //A/gob-rste/08.08.12/GOB.10
        //DHLCrossdockHeader.OrderID := FORMAT(DHLCrossdockHeader."Entry No.");
        DHLCrossdockHeader.OrderID := FORMAT(DHLCrossdockHeader."DHL Order ID");
        //E/gob-rste/08.08.12/GOB1.10
        DHLCrossdockHeader.TESTFIELD(OrderID);
        DHLCrossdockHeader.OrderNr := p_PurchOrderNo;
        //E/gob-rste/18.06.12/GOB1.01

        xmlMgt.AddElement(CurrNode4,'StatusId','','',CurrNode5);
        xmlMgt.AddElement(CurrNode5,'System','FPC','',CurrNode6);
        //A/gob-rste/08.08.12/GOB1.10
        //xmlMgt.AddElement(CurrNode5,'Id',FORMAT(DHLCrossdockHeader."Entry No."),'',CurrNode6);
        xmlMgt.AddElement(CurrNode5,'Id',FORMAT(DHLCrossdockHeader."DHL Order ID"),'',CurrNode6);
        //E/gob-rste/08.08.12/GOB1.10
        DHLCrossdockHeader.StatusDate := SetDateTimeAsText(TODAY,TIME);
        DHLCrossdockHeader.Stamp := SetDateTimeAsText(TODAY,TIME);
        //A/gob-rste/18.06.12/GOB1.01
        DHLCrossdockHeader.TESTFIELD(StatusDate);
        DHLCrossdockHeader.TESTFIELD(Stamp);
        //E/gob-rste/18.06.12/GOB1.01
        xmlMgt.AddElement(CurrNode4,'StatusDate',DHLCrossdockHeader.StatusDate,'',CurrNode5);
        xmlMgt.AddElement(CurrNode4,'Stamp',DHLCrossdockHeader.Stamp,'',CurrNode5);

        xmlMgt.AddElement(CurrNode4,'OrderId','','',CurrNode5);
        xmlMgt.AddElement(CurrNode5,'System','FPC','',CurrNode6);
        //A/gob-rste/10.07.12/GOB1.2
        DHLCrossdockHeader2.SETRANGE(OrderNr,p_PurchOrderNo);
        IF NOT DHLCrossdockHeader2.FINDLAST THEN
          ERROR('PO wurde nicht Åbertragen');
        //A/gob-rste/08.08.12/GOB1.10
        //DHLCrossdockHeader2.TESTFIELD("Entry No.");
        //xmlMgt.AddElement(CurrNode5,'Id',FORMAT(DHLCrossdockHeader2."Entry No."),'',CurrNode6);
        IF DHLCrossdockHeader."DHL Order ID" <> 0 THEN
          xmlMgt.AddElement(CurrNode5,'Id',FORMAT(DHLCrossdockHeader2."DHL Order ID"),'',CurrNode6)
        ELSE
          xmlMgt.AddElement(CurrNode5,'Id',FORMAT(DHLCrossdockHeader2."Entry No."),'',CurrNode6);
        //E/gob-rste/08.08.12/GOB1.10

        //A/gob-rste/10.07.12/GOB1.02
        xmlMgt.AddElement(CurrNode4,'OrderNr',DHLCrossdockHeader.OrderNr,'',CurrNode5);
        //E/gob-rste/10.07.12/GOB1.02
        DHLCrossdockHeader.Cause := 'CUSTOMER_REQUEST';
        xmlMgt.AddElement(CurrNode4,'Cause',DHLCrossdockHeader.Cause,'',CurrNode5);

        FileNameLoc := CreateFileName(p_PurchOrderNo,TRUE);
        DHLCrossdockHeader.Filename := GetFileName(FileNameLoc);
        XMLDoc.save(FileNameLoc);
        //A/gob-rste/10.07.12/GOB1.02
        DHLCrossdockHeader."XML File".IMPORT(FileNameLoc);
        //E/gob-rste/10.07.12/GOB1.02
        DHLCrossdockHeader.INSERT;
      END;
    END;

    PROCEDURE DecimalToDotString@1108200014(p_DecimalValue@1108200000 : Decimal) : Text[30];
    VAR
      DecAsText@1108200001 : Text[30];
    BEGIN
      DecAsText := FORMAT(p_DecimalValue);
      IF STRPOS(DecAsText,',') <> 0 THEN BEGIN
        IF STRPOS(DecAsText,'.') <> 0 THEN
          DecAsText := DELCHR(DecAsText,'=','.');
        DecAsText := CONVERTSTR(DecAsText,',','.');
      END ELSE BEGIN
        IF STRPOS(DecAsText,'.') <> 0 THEN
          DecAsText := DELCHR(DecAsText,'=','.');
        DecAsText := DecAsText + '.0';
      END;

      EXIT(DecAsText);
    END;

    PROCEDURE DotTextToDecimal@1108200029(p_DotDecAsText@1108200000 : Text[30]) : Decimal;
    VAR
      DecimalValue@1108200001 : Decimal;
      helpText@1108200002 : Text[30];
    BEGIN
      IF STRPOS(p_DotDecAsText,'.') <> 0 THEN BEGIN
        p_DotDecAsText := DELCHR(p_DotDecAsText,'=','.');
        p_DotDecAsText := CONVERTSTR(p_DotDecAsText,'.',',');
      END ELSE BEGIN
        p_DotDecAsText := DELCHR(p_DotDecAsText,'=','.');
        p_DotDecAsText := CONVERTSTR(p_DotDecAsText,'.',',');
        IF EVALUATE(DecimalValue,p_DotDecAsText) THEN;
      END;
      EXIT(DecimalValue);
    END;

    PROCEDURE GetItemWeight@1108200033(p_Item@1108200000 : Record 27) : Text[30];
    BEGIN
      //A/gob-rste/31.08.12/GOB1.14
      //EXIT(DecimalToDotString(p_Item."Net Weight" / 10));
      EXIT(DecimalToDotString(p_Item."Net Weight" / 100));
      //E/gob-rste/31.08.12/GOB1.14
    END;

    PROCEDURE GetItemVolume@1108200034(p_Item@1108200000 : Record 27) : Text[30];
    BEGIN
      EXIT(DecimalToDotString(p_Item."Unit Volume" / 10000000));
    END;

    PROCEDURE AddElement2@1108200016(VAR XMLNode@1108200002 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";NodeName@1108200001 : Text[260];NodeValue@1108200000 : Text[260];VAR CreatedXMLNode@1108200003 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode");
    VAR
      NewChildNode@1108200004 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
    BEGIN
      // adapted from Codeunit 6224
      NewChildNode := XMLNode.ownerDocument.createElement(NodeName);

      IF NodeValue <> '' THEN
        NewChildNode.text := NodeValue;

      XMLNode.appendChild(NewChildNode);
      CreatedXMLNode := NewChildNode;
    END;

    PROCEDURE CreateBCDHLOrder@1108200025(p_SaleLine@1108200001 : Record 37;p_Item@1108200002 : Record 27) : Text[30];
    VAR
      Barcode@1108200018 : Code[30];
      OrderType@1108200017 : Code[2];
      DateString@1108200016 : Code[6];
      Day@1108200015 : Integer;
      Month@1108200014 : Integer;
      Year@1108200013 : Integer;
      DocNo13@1108200012 : Code[13];
      Colli3@1108200011 : Code[3];
      CollyCounter@1108200000 : Integer;
      SalesHeader@1108200003 : Record 36;
      PurchHeader@1108200004 : Record 38;
    BEGIN
      Barcode := '';
      OrderType := '';
      DateString := '';
      SalesHeader.GET(p_SaleLine."Document Type",p_SaleLine."Document No.");
      OrderType := 'L4'; //Immer L4 lt. Mail Herr Wallraff//Herr Steffen
      //A/gob-rste/13.07.12/GOB.105
      PurchHeader.GET(1,p_SaleLine."Special Order Purchase No.");
      //E/gob-rste/13.07.12/GOB.105
      //Day := DATE2DMY(SalesHeader."Order Date",1);
      //Month := DATE2DMY(SalesHeader."Order Date",2);
      //Year := DATE2DMY(SalesHeader."Order Date",3);
      //A/gob-rste/14.08.12/GOB1.11 - P0179
      //Day := DATE2DMY(PurchHeader."Order Date",1);
      //Month := DATE2DMY(PurchHeader."Order Date",2);
      //Year := DATE2DMY(PurchHeader."Order Date",3);
      Day := DATE2DMY(PurchHeader."DHL HD Transfer Date",1);
      Month := DATE2DMY(PurchHeader."DHL HD Transfer Date",2);
      Year := DATE2DMY(PurchHeader."DHL HD Transfer Date",3);
      //E/gob-rste/14.08.12/GOB1.11 -P0179

      IF STRLEN(FORMAT(Day)) = 1 THEN
        DateString := '0' + FORMAT(Day)
      ELSE
        DateString := FORMAT(Day);
      IF STRLEN(FORMAT(Month)) = 1 THEN
        DateString := DateString + '0' + FORMAT(Month)
      ELSE
        DateString := DateString + FORMAT(Month);

      DateString := DateString + COPYSTR(FORMAT(Year),3,4);
      //A/gob-rste/13.07.12/GOB1.05
      IF STRLEN(p_SaleLine."Special Order Purchase No.") >= 13 THEN
      //IF STRLEN(SalesHeader."No.") >=13 THEN BEGIN
        //DocNo13 := COPYSTR(SalesHeader."No.",1,13)
        DocNo13 := COPYSTR(p_SaleLine."Special Order Purchase No.",1,13)
      ELSE BEGIN
        //DocNo13 := SalesHeader."No.";
        DocNo13 := p_SaleLine."Special Order Purchase No.";
      //E/gob-rste/13.07.12/GOB1.05
        REPEAT
          DocNo13 := '0' + DocNo13;
        UNTIL STRLEN(DocNo13) = 13;
      END;
      GlobalCollyCounter +=1;
      Colli3 := FORMAT(GlobalCollyCounter);

      IF STRLEN(Colli3) < 3 THEN
        REPEAT
          Colli3 := '0' + Colli3;
        UNTIL STRLEN(Colli3) = 3;

      Barcode := 'FPC' + OrderType + DateString + DocNo13 + Colli3;
      EXIT(Barcode);
    END;

    PROCEDURE SetDateTimeAsText@1108200013(p_Date@1108200000 : Date;p_Time@1108200008 : Time) r_DateTimeAsText : Text[100];
    VAR
      HelpTextLoc@1108200001 : Text[30];
      DateToRound@1108200002 : Date;
      TimeToRound@1108200003 : Time;
      DateTimeToRound@1108200004 : DateTime;
      Precision@1108200005 : BigInteger;
      FormatString@1108200006 : Text[100];
      Result@1108200007 : DateTime;
    BEGIN
      DateToRound := p_Date;
      TimeToRound := p_Time;
      DateTimeToRound := CREATEDATETIME(DateToRound,TimeToRound);
      FormatString := '<Year4>-<Month,2>-<Day,2>T<Hours24,2>:<Minutes,2>:<Seconds,2>.<Thousands,3>+01:00';
      r_DateTimeAsText := FORMAT(DateTimeToRound,0,FormatString);
      EXIT(r_DateTimeAsText);
    END;

    PROCEDURE DateTextToDate@1108200001(p_DateTimeText@1108200000 : Text[100]) r_Date : Date;
    VAR
      HelpText@1108200001 : Text[30];
      YearText@1108200002 : Text[30];
      MonthText@1108200003 : Text[30];
      DayText@1108200004 : Text[30];
    BEGIN
      HelpText := COPYSTR(p_DateTimeText,1,10);
      YearText := COPYSTR(HelpText,1,4);
      MonthText := COPYSTR(HelpText,6,2);
      DayText := COPYSTR(HelpText,9,2);
      HelpText := DayText + MonthText + YearText;
      EVALUATE(r_Date,HelpText);
      EXIT(r_Date);

      EXIT(0D);
    END;

    PROCEDURE DateTimeTextToTime@1108200004(p_DateTimeText@1108200000 : Text[100]) r_Time : Time;
    VAR
      HelpText@1108200001 : Text[30];
      TimeZone@1108200002 : Text[30];
      TimeZoneTime@1108200003 : Time;
    BEGIN
      HelpText := COPYSTR(p_DateTimeText,1,8);
      EVALUATE(r_Time,HelpText);
      EXIT(r_Time);

      EXIT(0T);
    END;

    PROCEDURE ReadDHLResponses@1108200007(p_FileName@1108200020 : Text[1024]);
    VAR
      XMLDoc@1108200000 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{F6D90F11-9C73-11D3-B32E-00C04F990BB4}:'Microsoft XML, v6.0'.DOMDocument";
      RootNodeListLoc@1108200001 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF82-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNodeList";
      NodeListLoc2@1108200002 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF82-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNodeList";
      RootNode@1108200003 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      RootNode2@1108200004 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      CurrNode@1108200011 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      CurrNode2@1108200010 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      CurrNode3@1108200009 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      CurrNode4@1108200008 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      CurrNode5@1108200007 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      CurrNode6@1108200006 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      CurrNode7@1108200005 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      NodeCount@1108200012 : Integer;
      DHLCrossdockHeader@1108200013 : Record 50052;
      LocText001@1108200014 : TextConst 'DEU=Fehler beim lesen der Datei %1.;ENU=Error read File %1.';
    BEGIN
      CLEAR(XMLDoc);
      CREATE(XMLDoc);
      IF XMLDoc.load(p_FileName) THEN BEGIN
        //A/gob-rste/10.07.12/GOB1.02
        IF NOT ISCLEAR(XMLDoc) THEN BEGIN
        //E/gob-rste/10.07.12/GOB1.02
          RootNodeListLoc := XMLDoc.selectNodes('ns5:Transmission');
          IF NOT ISCLEAR(RootNodeListLoc) THEN BEGIN
            RootNode := RootNodeListLoc.item(0);
            //A/gob-rste/10.07.12/GOB1.02
            IF NOT ISCLEAR(RootNode) THEN BEGIN
            //E/gob-rste/10.07.12/GOB1.02
              IF RootNode.hasChildNodes THEN BEGIN
                CurrNode := RootNode.selectSingleNode('TransmissionCreationDate');
                IF NOT ISCLEAR(CurrNode) THEN
                  TransmissionCreationDateGLOB := CurrNode.text;

                CurrNode := RootNode.selectSingleNode('TransmissionControlNumber');
                IF NOT ISCLEAR(CurrNode) THEN
                  TransmissionControlNumberGLOB := CurrNode.text;

                CurrNode := RootNode.selectSingleNode('SendingPartyID');
                IF NOT ISCLEAR(CurrNode) THEN
                  SendingPartyIDGLOB := CurrNode.text;

                CurrNode := RootNode.selectSingleNode('ReceivingPartyID');
                IF NOT ISCLEAR(CurrNode) THEN
                  ReceivingPartyIDGLOB := CurrNode.text;

                CurrNode := RootNode.selectSingleNode('MessageCount');
                IF NOT ISCLEAR(CurrNode) THEN; // need?

                NodeListLoc2 := RootNode.selectNodes('Messages');
                IF NOT ISCLEAR(NodeListLoc2) THEN BEGIN
                  FOR NodeCount := 0 TO NodeListLoc2.length-1 DO BEGIN
                    DHLCrossdockHeader.INIT;
                    DHLCrossdockHeader."Entry No." := DHLCrossdockHeader.GetNextEntryNo;
                    DHLCrossdockHeader.INSERT;
                    DHLCrossdockHeader.Inserted := CURRENTDATETIME;
                    DHLCrossdockHeader.TransmissionCreationDate := TransmissionCreationDateGLOB;
                    DHLCrossdockHeader.TransmissionControlNumber := TransmissionControlNumberGLOB;
                    DHLCrossdockHeader.SendingPartyID := SendingPartyIDGLOB;
                    DHLCrossdockHeader.ReceivingPartyID := ReceivingPartyIDGLOB;
                    DHLCrossdockHeader.Filename := GetFileName(p_FileName);
                    DHLCrossdockHeader.Direction := DHLCrossdockHeader.Direction::"In";
                    CurrNode := NodeListLoc2.item(NodeCount);

                    IF NOT ISCLEAR(CurrNode) THEN BEGIN
                      CurrNode2 := CurrNode.selectSingleNode('MessageCreationDate');

                      IF NOT ISCLEAR(CurrNode2) THEN
                        DHLCrossdockHeader.MessageCreationDate := CurrNode2.text;

                      CurrNode2 := CurrNode.selectSingleNode('MessageControlNumber');
                      IF NOT ISCLEAR(CurrNode2) THEN
                        DHLCrossdockHeader.MessageControlNumber := CurrNode2.text;

                      CurrNode2 := CurrNode.selectSingleNode('MessageContent');
                      IF NOT ISCLEAR(CurrNode2) THEN BEGIN
                        CurrNode3 := CurrNode2.selectSingleNode('ns5:Status');
                        IF NOT ISCLEAR(CurrNode3) THEN BEGIN
                          CurrNode4 := CurrNode3.selectSingleNode('StatusId');
                          IF NOT ISCLEAR(CurrNode4) THEN BEGIN
                            CurrNode5 := CurrNode4.selectSingleNode('System');
                            IF NOT ISCLEAR(CurrNode5) THEN; // wird system gebraucht?
                            CurrNode5 := CurrNode4.selectSingleNode('Id');
                            IF NOT ISCLEAR(CurrNode5) THEN
                              DHLCrossdockHeader.StatusID := CurrNode5.text;
                          END; // CurrNode4 Status

                          CurrNode4 := CurrNode3.selectSingleNode('StatusDate');
                          IF NOT ISCLEAR(CurrNode4) THEN
                            DHLCrossdockHeader.StatusDate := CurrNode4.text;
                          CurrNode4 := CurrNode3.selectSingleNode('Stamp');
                          IF NOT ISCLEAR(CurrNode4) THEN
                            DHLCrossdockHeader.Stamp := CurrNode4.text;

                          CurrNode4 := CurrNode3.selectSingleNode('OrderId');
                          IF NOT ISCLEAR(CurrNode4) THEN BEGIN
                            CurrNode5 := CurrNode4.selectSingleNode('System');
                            IF NOT ISCLEAR(CurrNode5) THEN;
                            CurrNode5 := CurrNode4.selectSingleNode('Id');
                            IF NOT ISCLEAR(CurrNode5) THEN
                              DHLCrossdockHeader.OrderID := CurrNode5.text;
                            DHLCrossdockHeader.MODIFY;
                          END; // CurrNode4 - Order-ID
                          CurrNode4 := CurrNode3.selectSingleNode('OrderNr');
                          IF NOT ISCLEAR(CurrNode4) THEN BEGIN
                            DHLCrossdockHeader.OrderNr := CurrNode4.text;
                            DHLCrossdockHeader.MODIFY;
                          //A/gob-rste/07.09.12/GOB1.01
                          //END;
                          //A/gob-rste/24.07.12/GOB1,06
                          //END ELSE BEGIN
                            //ERROR('Magento Order');
                          //E/gob-rste/24.07.12/GOB1,06
                          END;
                          //E/gob-rste/07.09.12/GOB1.01
                          //Check If DateChanged
                          CurrNode4 := CurrNode3.selectSingleNode('DeliveryDate');
                          IF NOT ISCLEAR(CurrNode4) THEN BEGIN
                            DHLCrossdockHeader.Type := DHLCrossdockHeader.Type::DateChanged;
                            ReadDHLResponseDateChanged(CurrNode4,DHLCrossdockHeader);
                          END; // CurrNode4 -DateChanged

                          //Check If AddressChanged
                          CurrNode4 := CurrNode3.selectSingleNode('Address');
                          IF NOT ISCLEAR(CurrNode4) THEN BEGIN
                            DHLCrossdockHeader.Type := DHLCrossdockHeader.Type::AddressChanged;
                            ReadDHLResponseAddressChanged(CurrNode4,DHLCrossdockHeader);
                          END; // CurrNode4 -AddressChanged

                          //Check If Transport
                          CurrNode4 := CurrNode3.selectSingleNode('TransportType');
                          IF NOT ISCLEAR(CurrNode4) THEN BEGIN
                            ReadDHLResponseTransport(CurrNode3,DHLCrossdockHeader);
                          END; // CurrNode4 -Transport

                          //Check If Fulfillment
                          CurrNode4 := CurrNode3.selectSingleNode('FulfillmentType');
                          IF NOT ISCLEAR(CurrNode4) THEN BEGIN
                            DHLCrossdockHeader.Type := DHLCrossdockHeader.Type::Fulfillment;
                            ReadDHLResponseFulfillment(CurrNode3,DHLCrossdockHeader);
                          END; // CurrNode4 -Fulfillment

                          //Check If OrderCanceled
                          CurrNode4 := CurrNode3.selectSingleNode('Cause');
                          IF NOT ISCLEAR(CurrNode4) THEN BEGIN
                            DHLCrossdockHeader.Type := DHLCrossdockHeader.Type::OrderCanceledIn;
                            ReadDHLResponseOrderCanceled(CurrNode3,DHLCrossdockHeader);
                          END; // CurrNode4 -OrderCanceled
                        //A/gob-rste/24.07.12/GOB1,06
                        //END ELSE
                        END;
                          //ERROR('No ns5:Status. Magento Order'); // CurrNode3
                        //E/gob-rste/24.07.12/GOB1,06
                      END; // CurrNode2
                    END; // CurrNode
                  END; // FOR
                END; // NoteList
              //A/gob-rste/09.07.12/GOB1.01
              END; // RootNodeChildList
              //E/gob-rste/09.07.12/GOB1.01
            //A/gob-rste/11.07.12/GOB1.04
            //END
            END ELSE BEGIN
              RootNodeListLoc := XMLDoc.selectNodes('ns5:TransmissionAcknowledgement');
              IF NOT ISCLEAR(RootNodeListLoc) THEN BEGIN
                ReadDHLAcknowledgementAndError(RootNodeListLoc,DHLCrossdockHeader);
              END;
            //E/gob-rste/11.07.12/GOB1.04
            END; // RootNode
          END; //RootNodeList
        //A/gob-rste/09.07.12/GOB1.01
        END; // XML Doc
        //E/gob-rste/09.07.12/GOB1.01
      END ELSE BEGIN
        ERROR(LocText001,p_FileName);
      END; // XML Load
    END;

    PROCEDURE ReadDHLResponseDateChanged@1108200003(p_DateChangedNode@1108200002 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";VAR p_DHLCrossdockHeader@1108200001 : Record 50052);
    VAR
      NodeLoc@1108200000 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
    BEGIN
      IF NOT ISCLEAR(p_DateChangedNode) THEN BEGIN
        NodeLoc := p_DateChangedNode.selectSingleNode('FromDay');
        IF NOT ISCLEAR(NodeLoc) THEN
          p_DHLCrossdockHeader."Old Delivery Date" := DateTextToDate(NodeLoc.text);

        NodeLoc := p_DateChangedNode.selectSingleNode('FromHour');
        IF NOT ISCLEAR(NodeLoc) THEN
          p_DHLCrossdockHeader."Old Delivery Time" := DateTimeTextToTime(NodeLoc.text);

        NodeLoc:= p_DateChangedNode.selectSingleNode('ToDay');
        IF NOT ISCLEAR(NodeLoc) THEN
          p_DHLCrossdockHeader."New Delivery Date" := DateTextToDate(NodeLoc.text);

        NodeLoc := p_DateChangedNode.selectSingleNode('ToHour');
        IF NOT ISCLEAR(NodeLoc) THEN
          p_DHLCrossdockHeader."New Delivery Time" := DateTimeTextToTime(NodeLoc.text);

        NodeLoc := p_DateChangedNode.selectSingleNode('AppointmentType');
        IF NOT ISCLEAR(NodeLoc) THEN
          p_DHLCrossdockHeader.AppointmentType := NodeLoc.text;
      END;

      p_DHLCrossdockHeader.MODIFY;
    END;

    PROCEDURE ReadDHLResponseAddressChanged@1108200002(p_AddressChangedNode@1108200002 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";VAR p_DHLCrossdockHeader@1108200014 : Record 50052);
    VAR
      NodeLoc@1108200000 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
    BEGIN
      IF NOT ISCLEAR(p_AddressChangedNode) THEN BEGIN
        NodeLoc := p_AddressChangedNode.selectSingleNode('Title');
        IF NOT ISCLEAR(NodeLoc) THEN
          p_DHLCrossdockHeader.Titel := NodeLoc.text;

        NodeLoc := p_AddressChangedNode.selectSingleNode('Name1');
        IF NOT ISCLEAR(NodeLoc) THEN
          p_DHLCrossdockHeader.Name1 := NodeLoc.text;

        NodeLoc := p_AddressChangedNode.selectSingleNode('Name2');
        IF NOT ISCLEAR(NodeLoc) THEN
          p_DHLCrossdockHeader.Name2 := NodeLoc.text;

        NodeLoc := p_AddressChangedNode.selectSingleNode('CountryCode');
        IF NOT ISCLEAR(NodeLoc) THEN
          p_DHLCrossdockHeader.CountryCode := NodeLoc.text;

        NodeLoc := p_AddressChangedNode.selectSingleNode('PostalCode');
        IF NOT ISCLEAR(NodeLoc) THEN
          p_DHLCrossdockHeader.PostalCode := NodeLoc.text;

        NodeLoc := p_AddressChangedNode.selectSingleNode('City');
        IF NOT ISCLEAR(NodeLoc) THEN
          p_DHLCrossdockHeader.City := NodeLoc.text;

        NodeLoc := p_AddressChangedNode.selectSingleNode('Street');
        IF NOT ISCLEAR(NodeLoc) THEN
          p_DHLCrossdockHeader.Street := NodeLoc.text;

        NodeLoc := p_AddressChangedNode.selectSingleNode('PhoneNumber1');
        IF NOT ISCLEAR(NodeLoc) THEN
          p_DHLCrossdockHeader.PhoneNumber1 := NodeLoc.text;

        NodeLoc := p_AddressChangedNode.selectSingleNode('PhoneNumber2');
        IF NOT ISCLEAR(NodeLoc) THEN
          p_DHLCrossdockHeader.PhoneNumber2 := NodeLoc.text;

        NodeLoc := p_AddressChangedNode.selectSingleNode('EMail');
        IF NOT ISCLEAR(NodeLoc) THEN
          p_DHLCrossdockHeader.EMail := NodeLoc.text;
      END;

      p_DHLCrossdockHeader.MODIFY;
    END;

    PROCEDURE ReadDHLResponseTransport@1108200006(p_TransportNode@1108200014 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";VAR p_DHLCrossdockHeader@1108200002 : Record 50052);
    VAR
      NodeLoc@1108200000 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
    BEGIN
      IF NOT ISCLEAR(p_TransportNode) THEN BEGIN
        NodeLoc := p_TransportNode.selectSingleNode('TransportType');
        IF NOT ISCLEAR(NodeLoc) THEN BEGIN
          p_DHLCrossdockHeader.TransportType := NodeLoc.text;
          IF UPPERCASE(NodeLoc.text) = 'INCOMING' THEN
            p_DHLCrossdockHeader.Type := p_DHLCrossdockHeader.Type::TransportIN
          ELSE
            p_DHLCrossdockHeader.Type := p_DHLCrossdockHeader.Type::TransportOUT;
        END;
        NodeLoc := p_TransportNode.selectSingleNode('TransportDirection');
        IF NOT ISCLEAR(NodeLoc) THEN
          p_DHLCrossdockHeader.TransportDirection := NodeLoc.text;
      END;
      p_DHLCrossdockHeader.MODIFY;
    END;

    PROCEDURE ReadDHLResponseFulfillment@1108200008(p_FulfillmentNode@1108200014 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";VAR p_DHLCrossdockHeader@1108200002 : Record 50052);
    VAR
      NodeLoc@1108200000 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      NodeLoc2@1108200001 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      NodeLoc3@1108200003 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
    BEGIN
      IF NOT ISCLEAR(p_FulfillmentNode) THEN BEGIN
        NodeLoc := p_FulfillmentNode.selectSingleNode('FulfillmentType');
        IF NOT ISCLEAR(NodeLoc) THEN
          p_DHLCrossdockHeader.FulfillmentType := NodeLoc.text;

        NodeLoc := p_FulfillmentNode.selectSingleNode('Completed');
        IF NOT ISCLEAR(NodeLoc) THEN
          IF UPPERCASE(NodeLoc.text) = 'TRUE' THEN
            p_DHLCrossdockHeader.Completed := TRUE
          ELSE
            p_DHLCrossdockHeader.Completed := FALSE;

        NodeLoc := p_FulfillmentNode.selectSingleNode('FulfilledItems');
        IF NOT ISCLEAR(NodeLoc) THEN BEGIN
          NodeLoc2 := NodeLoc.selectSingleNode('ItemId');
          IF NOT ISCLEAR(NodeLoc2) THEN BEGIN
            NodeLoc3 := NodeLoc2.selectSingleNode('System');
            IF NOT ISCLEAR(NodeLoc3) THEN; // need?

            NodeLoc3 := NodeLoc2.selectSingleNode('Id');
            IF NOT ISCLEAR(NodeLoc3) THEN
              p_DHLCrossdockHeader.ItemId := NodeLoc3.text;

            NodeLoc2 := NodeLoc.selectSingleNode('QuantityAccepted');
            IF NOT ISCLEAR(NodeLoc2) THEN
              EVALUATE(p_DHLCrossdockHeader.QuantityAccepted,NodeLoc2.text);

            NodeLoc2 := NodeLoc.selectSingleNode('QuantityRefused');
            IF NOT ISCLEAR(NodeLoc2) THEN
              EVALUATE(p_DHLCrossdockHeader.QuantityRefused,NodeLoc2.text);
          END;
        END;
      END;

      p_DHLCrossdockHeader.MODIFY;
    END;

    PROCEDURE ReadDHLResponseOrderCanceled@1108200012(p_FulfillmentNode@1108200014 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";VAR p_DHLCrossdockHeader@1108200002 : Record 50052);
    VAR
      NodeLoc@1108200000 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
    BEGIN
      IF NOT ISCLEAR(p_FulfillmentNode) THEN BEGIN
        NodeLoc := p_FulfillmentNode.selectSingleNode('Cause');
        IF NOT ISCLEAR(NodeLoc) THEN
          p_DHLCrossdockHeader.Cause := NodeLoc.text;
      END;

      p_DHLCrossdockHeader.MODIFY;
    END;

    PROCEDURE GetFileName@1108200010(p_Path@1108200000 : Text[1024]) : Text[1024];
    BEGIN
      IF STRLEN(p_Path) <> 0 THEN BEGIN
        IF STRPOS(p_Path,'\') <> 0 THEN
          REPEAT
            p_Path := COPYSTR(p_Path,STRPOS(p_Path,'\') + 1,STRLEN(p_Path));
          UNTIL STRPOS(p_Path,'\') = 0;
      END;
      EXIT(p_Path);
    END;

    PROCEDURE CreateFileName@1108200015(p_OrderNo@1108200000 : Code[20];p_Canceled@1108200006 : Boolean) : Text[1024];
    VAR
      Year@1108200002 : Integer;
      Month@1108200003 : Integer;
      Day@1108200004 : Integer;
      DateString@1108200005 : Text[30];
      FPCInterfaceSetup@1108200007 : Record 50014;
    BEGIN
      FPCInterfaceSetup.GET('DHLCROSSDO');
      Day := DATE2DMY(TODAY,1);
      Month := DATE2DMY(TODAY,2);
      Year := DATE2DMY(TODAY,3);

      DateString := FORMAT(Year);

      IF STRLEN(FORMAT(Month)) = 1 THEN
        DateString := DateString + '0' + FORMAT(Month)
      ELSE
        DateString := DateString + FORMAT(Month);

      IF STRLEN(FORMAT(Day)) = 1 THEN
        DateString := DateString + '0' + FORMAT(Day)
      ELSE
        DateString := DateString + FORMAT(Day);

      IF p_Canceled THEN
        EXIT(FPCInterfaceSetup."Export Folder" +
         '\' + 'OrderCanceled' + '_' + p_OrderNo + '_'  + DateString+'_' + COPYSTR(DELCHR(FORMAT(TIME),'=',':'),1,4) + '.xml')
      ELSE
        EXIT(FPCInterfaceSetup."Export Folder" +
          '\' + 'Order' + '_' + p_OrderNo + '_'  + DateString+'_' + COPYSTR(DELCHR(FORMAT(TIME),'=',':'),1,4) + '.xml');
    END;

    PROCEDURE ProcessDHLResponses@1108200009(p_CrossdockHeaderEntryNo@1000000000 : Integer);
    VAR
      SalesHeaderLoc@1108200001 : Record 36;
      ReleaseSalesDocument@1108200002 : Codeunit 414;
      SalesLineLoc@1108200003 : Record 37;
      CustLoc@1108200004 : Record 18;
      LocText001@1108200005 : TextConst 'DEU=Bestellung %1 wurde nicht gefunden.;ENU=Order %1 not found.';
      PurchLineLoc@1108200007 : Record 39;
      PurchHeaderLoc@1108200008 : Record 38;
      LocText002@1108200009 : TextConst 'DEU=Liefern Buchen fÅr EK-Bestellung %1 war nicht erfolgreich.;ENU=Post Ship for PO %1 was unsuccessful.';
      PurchPost@1108200006 : Codeunit 90;
      SalesPost@1108200010 : Codeunit 80;
      LocText003@1108200011 : TextConst 'DEU=Liefern Buchen fÅr VK-Auftrag %1 war nicht erfolgreich.;ENU=Post Ship for Sales Order %1 was unsuccessful.';
      DHLCrossdockHeader@1108200000 : Record 50052;
      DHLSetup@1108200012 : Record 50022;
      LocText004@1108200013 : TextConst 'DEU=Verarbeitungsfehler. Kein gÅltiger Typ vorhanden.;ENU=Processing error. No valid Type found.';
      PostingDateLoc@1000000001 : Date;
      YYYY@1000000002 : Text[30];
      MM@1000000003 : Text[30];
      DD@1000000004 : Text[30];
      YYYYInt@1000000005 : Integer;
      MMInt@1000000006 : Integer;
      DDInt@1000000007 : Integer;
    BEGIN
      DHLSetup.GET;
      //A/gob-rste/31.07.12/GOB1.09
      //DHLCrossdockHeader.SETRANGE(Processed,FALSE);
      //A/gob-rste/24.07.12/GOB1.06
      //DHLCrossdockHeader.SETRANGE(Error,FALSE);
      //E/gob-rste/24.07.12/GOB1.06
      //DHLCrossdockHeader.SETRANGE(Direction,DHLCrossdockHeader.Direction::"In");
      //IF DHLCrossdockHeader.FIND('-') THEN BEGIN
      IF DHLCrossdockHeader.GET(p_CrossdockHeaderEntryNo) THEN BEGIN
        //REPEAT
          CLEAR(ReleaseSalesDocument);
          SalesHeaderLoc.RESET;
          PurchLineLoc.RESET;
          CASE DHLCrossdockHeader.Type OF
            DHLCrossdockHeader.Type::" ": BEGIN
              DHLCrossdockHeader.Errortext := LocText004;
              DHLCrossdockHeader.Error := TRUE;
              DHLCrossdockHeader."Processed on" := CURRENTDATETIME;
              DHLCrossdockHeader.Processed := TRUE;
              DHLCrossdockHeader.MODIFY;
            END;

            DHLCrossdockHeader.Type::DateChanged: BEGIN
              PurchLineLoc.SETRANGE("Document Type",1);
              //A/gob-rste/24.07.12/GOB1.06
              //PurchLineLoc.SETRANGE("Document No.",DHLCrossdockHeader.OrderNr);
              //A/gob-rste/08.08.12/GOB1.10
              PurchLineLoc.SETRANGE("Document No.",GetPONoFromOrderID(DHLCrossdockHeader.OrderID));
              //E/gob-rste/08.08.12/GOB1.10
              //E/gob-rste/24.07.12/GOB1.06
              IF PurchLineLoc.FIND('-') THEN BEGIN
                REPEAT
                //SalesHeaderLoc.SETRANGE("Document Type",1);
                //A/gob-rste/24.07.12/GOB1.06
                //SalesHeaderLoc.SETRANGE("No.",PurchLineLoc."Order No.");
                //E/gob-rste/24.07.12/GOB1.06
                //IF SalesHeaderLoc.FINDFIRST THEN BEGIN
                  //SalesLineLoc.SETRANGE("Document Type",1);
                  //SalesLineLoc.SETRANGE("Document No.",SalesHeaderLoc."No.");
                  //SalesLineLoc.SETRANGE(Type,SalesLineLoc.Type::Item);
                  //IF SalesLineLoc.FIND('-') THEN BEGIN
                    //REPEAT
                   IF SalesLineLoc.GET(1,PurchLineLoc."Special Order Sales No.",PurchLineLoc."Special Order Sales Line No.") THEN
                   BEGIN
                      SalesLineLoc."Promised Delivery Date" := DHLCrossdockHeader."New Delivery Date";
                      SalesLineLoc."Promised Delivery Time" := DHLCrossdockHeader."New Delivery Time";
                      SalesLineLoc.MODIFY;
                    //UNTIL SalesLineLoc.NEXT = 0;
                     DHLCrossdockHeader.Processed := TRUE;
                     DHLCrossdockHeader."Processed on" := CURRENTDATETIME;
                     DHLCrossdockHeader.MODIFY;
                   END;
                  //END;
                  //A/gob-rste/25.07.12/GOB1.07
                  UpdateSalesLines(PurchLineLoc,3);
                  //E/gob-rste/25.07.12/GOB1.07
                UNTIL PurchLineLoc.NEXT = 0;
              END ELSE BEGIN
                DHLCrossdockHeader.Errortext := STRSUBSTNO(LocText001,DHLCrossdockHeader.OrderNr);
                DHLCrossdockHeader.Processed := TRUE;
                DHLCrossdockHeader."Processed on" := CURRENTDATETIME;
                DHLCrossdockHeader.Error := TRUE;
                DHLCrossdockHeader.MODIFY;
              END;
            END;

            DHLCrossdockHeader.Type::AddressChanged: BEGIN
              PurchLineLoc.SETRANGE("Document Type",1);
              //A/gob-rste/24.07.12/GOB1.06
              //PurchLineLoc.SETRANGE("Document No.",DHLCrossdockHeader.OrderNr);
              PurchLineLoc.SETRANGE("Document No.",GetPONoFromOrderID(DHLCrossdockHeader.OrderID));
              //E/gob-rste/24.07.12/GOB1.06
              IF PurchLineLoc.FIND('-') THEN BEGIN
                SalesHeaderLoc.SETRANGE("Document Type",1);
                SalesHeaderLoc.SETRANGE("No.",PurchLineLoc."Order No.");
                IF SalesHeaderLoc.FIND('-') THEN BEGIN
                  SalesHeaderLoc."Ship-to Name" := DHLCrossdockHeader.Name1;
                  SalesHeaderLoc."Ship-to Name 2" := DHLCrossdockHeader.Name2;
                  SalesHeaderLoc."Ship-to Address" := DHLCrossdockHeader.Street;
                  IF CustLoc.GET(SalesHeaderLoc."Sell-to Customer No.") THEN BEGIN
                    CustLoc."Phone No." := DHLCrossdockHeader.PhoneNumber1;
                    CustLoc."E-Mail" := DHLCrossdockHeader.EMail;
                    CustLoc.MODIFY;
                  END;
                  SalesHeaderLoc."Ship-to City" := DHLCrossdockHeader.City;
                  SalesHeaderLoc."Ship-to Post Code" := DHLCrossdockHeader.PostalCode;
                  SalesHeaderLoc.MODIFY;
                  //A/gob-rste/25.07.12/GOB1.07
                  REPEAT
                    UpdateSalesLines(PurchLineLoc,2);
                  UNTIL PurchLineLoc.NEXT = 0;
                  //E/gob-rste/25.07.12/GOB1.07
                  DHLCrossdockHeader.Processed := TRUE;
                  DHLCrossdockHeader."Processed on" := CURRENTDATETIME;
                  DHLCrossdockHeader.MODIFY;
                END ELSE BEGIN
                  DHLCrossdockHeader.Errortext := STRSUBSTNO(LocText001,DHLCrossdockHeader.OrderNr);
                  DHLCrossdockHeader.Error := TRUE;
                  DHLCrossdockHeader.Processed := TRUE;
                  DHLCrossdockHeader."Processed on" := CURRENTDATETIME;
                  DHLCrossdockHeader.MODIFY;
                END;
              //A/gob-rste/25.07.12/GOB1.07
              //END;
              END ELSE BEGIN
                DHLCrossdockHeader.Errortext := STRSUBSTNO(LocText001,DHLCrossdockHeader.OrderNr);
                DHLCrossdockHeader.Error := TRUE;
                DHLCrossdockHeader.Processed := TRUE;
                DHLCrossdockHeader."Processed on" := CURRENTDATETIME;
                DHLCrossdockHeader.MODIFY;
              END;
              //E/gob-rste/25.07.12/GOB1.07
            END;

            DHLCrossdockHeader.Type::TransportIN: BEGIN
                //A/gob-rste/24.07.12/GOB1.06
                //IF PurchHeaderLoc.GET(1,DHLCrossdockHeader.OrderNr) THEN BEGIN
                IF PurchHeaderLoc.GET(1,GetPONoFromOrderID(DHLCrossdockHeader.OrderID)) THEN BEGIN
                //E/gob-rste/24.07.12/GOB1.06
                  ShipPurchLines(PurchHeaderLoc);
                  COMMIT;
                  PurchHeaderLoc.Receive := TRUE;
                  PurchHeaderLoc.Invoice := FALSE;
                  CLEAR(PurchPost);
                  //A/P0405
                  PostingDateLoc := 0D;
                  YYYY := '';
                  MM := '';
                  DD := '';
                  YYYYInt := 0;
                  MMInt := 0;
                  DDInt := 0;
                  //2012-09-14T00:00:00.000+02:00
                  IF DHLCrossdockHeader.StatusDate <> '' THEN BEGIN
                    IF STRLEN(DHLCrossdockHeader.StatusDate) >= 19 THEN BEGIN
                      YYYY := COPYSTR(DHLCrossdockHeader.StatusDate,1,4);
                      MM := COPYSTR(DHLCrossdockHeader.StatusDate,6,2);
                      DD := COPYSTR(DHLCrossdockHeader.StatusDate,9,2);
                      IF EVALUATE(DDInt,DD) THEN;
                      IF EVALUATE(MMInt,MM) THEN;
                      IF EVALUATE(YYYYInt,YYYY) THEN;
                      IF (DDInt <> 0) AND (DDInt <= 31) AND
                         (MMInt <> 0) AND (MMInt <= 12) AND
                         (YYYYInt <> 0) AND (YYYYInt >= 1753)
                      THEN
                        PostingDateLoc := DMY2DATE(DDInt,MMInt,YYYYInt);
                    END;
                  END;
                  IF PostingDateLoc = 0D THEN
                    PostingDateLoc := TODAY;
                  //PurchPost.SetPostingDate(TRUE,FALSE,TODAY);
                  PurchPost.SetPostingDate(TRUE,FALSE,PostingDateLoc);
                  //E/P0405
                  IF PurchPost.RUN(PurchHeaderLoc) THEN BEGIN
                    DHLCrossdockHeader.Processed  := TRUE;
                    DHLCrossdockHeader."Processed on" := CURRENTDATETIME;
                    DHLCrossdockHeader.MODIFY;
                    //A/gob-rste/25.07.12/GOB1.07
                    PurchLineLoc.RESET;
                    PurchLineLoc.SETRANGE("Document Type",PurchHeaderLoc."Document Type");
                    PurchLineLoc.SETRANGE("Document No.",PurchHeaderLoc."No.");
                    IF PurchLineLoc.FIND('-') THEN
                      REPEAT
                        UpdateSalesLines(PurchLineLoc,4);
                      UNTIL PurchLineLoc.NEXT = 0;
                    //E/gob-rste/25.07.12/GOB1.07
                  END ELSE BEGIN
                    DHLCrossdockHeader.Errortext := GETLASTERRORTEXT;
                    DHLCrossdockHeader.Processed := TRUE;
                    DHLCrossdockHeader."Processed on" := CURRENTDATETIME;
                    DHLCrossdockHeader.Error := TRUE;
                    DHLCrossdockHeader.MODIFY;
                  END;
                END ELSE BEGIN
                  DHLCrossdockHeader.Errortext := STRSUBSTNO(LocText001,DHLCrossdockHeader.OrderNr);
                  DHLCrossdockHeader.Processed := TRUE;
                  DHLCrossdockHeader.Error := TRUE;
                  DHLCrossdockHeader.MODIFY;
                END;
              END;

            DHLCrossdockHeader.Type::TransportOUT: BEGIN
              PurchLineLoc.SETRANGE("Document Type",1);
              //A/gob-rste/24.07.12/GOB1.06
              //PurchLineLoc.SETRANGE("Document No.",DHLCrossdockHeader.OrderNr);7
              PurchLineLoc.SETRANGE("Document No.",GetPONoFromOrderID(DHLCrossdockHeader.OrderID));
              //E/gob-rste/24.07.12/GOB1.06
              IF PurchLineLoc.FIND('-') THEN BEGIN
                REPEAT
                  IF SalesHeaderLoc.GET(1,PurchLineLoc."Special Order Sales No.") THEN BEGIN
                      ShipSalesLines(PurchLineLoc);
                      SalesHeaderLoc.Ship := TRUE;
                      SalesHeaderLoc.Invoice := FALSE;
                      //A/gob-rste/05.10.12/P0412
                      CheckAndPostPurchOrder(DHLCrossdockHeader);
                      //E/gob-rste/05.10.12/P0412
                      COMMIT;
                      CLEAR(SalesPost);
                      //A/P0405
                      PostingDateLoc := 0D;
                      YYYY := '';
                      MM := '';
                      DD := '';
                      YYYYInt := 0;
                      MMInt := 0;
                      DDInt := 0;
                      //2012-09-14T00:00:00.000+02:00
                      IF DHLCrossdockHeader.StatusDate <> '' THEN BEGIN
                        IF STRLEN(DHLCrossdockHeader.StatusDate) >= 19 THEN BEGIN
                          YYYY := COPYSTR(DHLCrossdockHeader.StatusDate,1,4);
                          MM := COPYSTR(DHLCrossdockHeader.StatusDate,6,2);
                          DD := COPYSTR(DHLCrossdockHeader.StatusDate,9,2);
                          IF EVALUATE(DDInt,DD) THEN;
                          IF EVALUATE(MMInt,MM) THEN;
                          IF EVALUATE(YYYYInt,YYYY) THEN;
                          IF (DDInt <> 0) AND (DDInt <= 31) AND
                             (MMInt <> 0) AND (MMInt <= 12) AND
                             (YYYYInt <> 0) AND (YYYYInt >= 1753)
                          THEN
                            PostingDateLoc := DMY2DATE(DDInt,MMInt,YYYYInt);
                        END;
                      END;
                      IF PostingDateLoc = 0D THEN
                        PostingDateLoc := TODAY;
                      //SalesPost.SetPostingDate(TRUE,FALSE,TODAY);
                      SalesPost.SetPostingDate(TRUE,FALSE,PostingDateLoc);
                      //E/P0405
                      IF SalesPost.RUN(SalesHeaderLoc) THEN BEGIN
                        DHLCrossdockHeader.Processed := TRUE;
                        DHLCrossdockHeader."Processed on" := CURRENTDATETIME;
                        DHLCrossdockHeader.MODIFY;
                        //A/gob-rste/25.07.12/GOB1.07
                        //UpdateSalesLines(PurchLineLoc,'TRANSPORT_OUT');
                        UpdateSalesLines(PurchLineLoc,5);
                        //E/gob-rste/25.07.12/GOB1.07
                      END ELSE BEGIN
                        DHLCrossdockHeader.Errortext := GETLASTERRORTEXT;
                        DHLCrossdockHeader."Processed on" := CURRENTDATETIME;
                        DHLCrossdockHeader.Processed := TRUE;
                        DHLCrossdockHeader.Error := TRUE;
                        DHLCrossdockHeader.MODIFY;
                      END;
                  END;
                UNTIL PurchLineLoc.NEXT = 0;
              //A/gob-rste/25.07.12/GOB1.07
              //END;
              END ELSE BEGIN
                DHLCrossdockHeader.Errortext := GETLASTERRORTEXT;
                DHLCrossdockHeader."Processed on" := CURRENTDATETIME;
                DHLCrossdockHeader.Processed := TRUE;
                DHLCrossdockHeader.Error := TRUE;
                DHLCrossdockHeader.MODIFY;
              END;
              //E/gob-rste/25.07.12/GOB1.07
            END;

            DHLCrossdockHeader.Type::Fulfillment: BEGIN
              PurchLineLoc.SETRANGE("Document Type",1);
              //A/gob-rste/24.07.12/GOB1.06
              //PurchLineLoc.SETRANGE("Document No.",DHLCrossdockHeader.OrderNr);
              PurchLineLoc.SETRANGE("Document No.",GetPONoFromOrderID(DHLCrossdockHeader.OrderID));
              //E/gob-rste/24.07.12/GOB1.06
              IF PurchLineLoc.FIND('-') THEN BEGIN
                REPEAT
                  //A/gob-rste/25.07.12/GOB1.07
                  //UpdateSalesLines(PurchLineLoc,'FULFILLED);
                  UpdateSalesLines(PurchLineLoc,6);
                  //E/gob-rste/25.07.12/GOB1.07
                UNTIL PurchLineLoc.NEXT = 0;
                DHLCrossdockHeader.Processed := TRUE;
                DHLCrossdockHeader."Processed on" := CURRENTDATETIME;
                DHLCrossdockHeader.MODIFY;
              END ELSE BEGIN
                DHLCrossdockHeader.Errortext := STRSUBSTNO(LocText001,DHLCrossdockHeader.OrderNr);
                DHLCrossdockHeader.Processed := TRUE;
                DHLCrossdockHeader."Processed on" := CURRENTDATETIME;
                DHLCrossdockHeader.Error := TRUE;
                DHLCrossdockHeader.MODIFY;
              END;
            END;

            DHLCrossdockHeader.Type::OrderCanceledIn: BEGIN
              PurchLineLoc.SETRANGE("Document Type",1);
              //A/gob-rste/24.07.12/GOB1.06
              //PurchLineLoc.SETRANGE("Document No.",DHLCrossdockHeader.OrderNr);
              PurchLineLoc.SETRANGE("Document No.",GetPONoFromOrderID(DHLCrossdockHeader.OrderID));
              //E/gob-rste/24.07.12/GOB1.06
              IF PurchLineLoc.FINDFIRST THEN BEGIN
                REPEAT
                //SalesHeaderLoc.SETRANGE("Document Type",1);
                //SalesHeaderLoc.SETRANGE("No.",PurchLineLoc."Order No.");
                //IF SalesHeaderLoc.FINDFIRST THEN BEGIN
                  //SalesLineLoc.SETRANGE("Document Type",1);
                  //SalesLineLoc.SETRANGE("Document No.",SalesHeaderLoc."No.");
                  //IF SalesLineLoc.FIND('-') THEN BEGIN
                    IF SalesLineLoc.GET(1,PurchLineLoc."Special Order Sales No.",PurchLineLoc."Special Order Sales Line No.") THEN BEGIN
                      DHLSetup.TESTFIELD("Cancelation Reason Cross Dock");
                      //REPEAT
                        //SalesLineLoc."Line Status" := 'ORDERCANCELED';
                        SalesLineLoc."Cancellation Reason Code" := DHLSetup."Cancelation Reason Cross Dock";
                        SalesLineLoc.MODIFY;
                        SalesLineLoc.MagentoCancel(TRUE,FALSE);
                        //A/gob-rste/25.07.12/GOB1.07
                        UpdateSalesLines(PurchLineLoc,7);
                        //E/gob-rste/25.07.12/GOB1.07
                      END;
                      //UNTIL SalesLineLoc.NEXT = 0;
                    //END;
                    //SalesHeaderLoc.MagentoCancel;
                    //SalesHeaderLoc.MODIFY;
                UNTIL PurchLineLoc.NEXT = 0;
                DHLCrossdockHeader.Processed := TRUE;
                DHLCrossdockHeader."Processed on" := CURRENTDATETIME;
                DHLCrossdockHeader.MODIFY;
              END ELSE BEGIN
                DHLCrossdockHeader.Processed := TRUE;
                DHLCrossdockHeader.Error := TRUE;
                DHLCrossdockHeader.Errortext := STRSUBSTNO(LocText001,DHLCrossdockHeader.OrderNr);
                DHLCrossdockHeader."Processed on" := CURRENTDATETIME;
                DHLCrossdockHeader.MODIFY;
              END;
              //END;
            END;
          END; //CASE
          COMMIT;
        //A/gob-rste/31.07.12/GOB1.09
        //UNTIL DHLCrossdockHeader.NEXT = 0;
        //E/gob-rste/31.07.12/GOB1.09
      END;
    END;

    PROCEDURE GetMessageControlNumber@1108200017() r_MessageControlNo : Text[30];
    VAR
      DHLSetupLoc@1108200000 : Record 50022;
    BEGIN
      DHLSetupLoc.GET;
      DHLSetupLoc."Message Control Number" := DHLSetupLoc."Message Control Number" + 1;
      DHLSetupLoc.MODIFY;
      r_MessageControlNo := FORMAT(DHLSetupLoc."Message Control Number");
      CASE STRLEN(r_MessageControlNo) OF
        1: r_MessageControlNo := 'FPC_000000000' + r_MessageControlNo;
        2: r_MessageControlNo := 'FPC_00000000' + r_MessageControlNo;
        3: r_MessageControlNo := 'FPC_0000000' + r_MessageControlNo;
        4: r_MessageControlNo := 'FPC_000000' + r_MessageControlNo;
        5: r_MessageControlNo := 'FPC_00000' + r_MessageControlNo;
        6: r_MessageControlNo := 'FPC_0000' + r_MessageControlNo;
        7: r_MessageControlNo := 'FPC_000' + r_MessageControlNo;
        8: r_MessageControlNo := 'FPC_00' + r_MessageControlNo;
        9: r_MessageControlNo := 'FPC_0' + r_MessageControlNo;
       10: r_MessageControlNo := 'FPC_' + r_MessageControlNo;
      END;
      EXIT(r_MessageControlNo);
    END;

    PROCEDURE GetTransmissionControlNumber@1108200022() r_TransmissionControlNo : Text[30];
    VAR
      DHLSetupLoc@1108200000 : Record 50022;
    BEGIN
      DHLSetupLoc.GET;
      DHLSetupLoc."Transmission Control Number" := DHLSetupLoc."Transmission Control Number" + 1;
      DHLSetupLoc.MODIFY;
      r_TransmissionControlNo := FORMAT(DHLSetupLoc."Transmission Control Number");
      CASE STRLEN(r_TransmissionControlNo) OF
         1: r_TransmissionControlNo := 'FPC_000000000' + r_TransmissionControlNo;
         2: r_TransmissionControlNo := 'FPC_00000000' + r_TransmissionControlNo;
         3: r_TransmissionControlNo := 'FPC_0000000' + r_TransmissionControlNo;
         4: r_TransmissionControlNo := 'FPC_000000' + r_TransmissionControlNo;
         5: r_TransmissionControlNo := 'FPC_00000' + r_TransmissionControlNo;
         6: r_TransmissionControlNo := 'FPC_0000' + r_TransmissionControlNo;
         7: r_TransmissionControlNo := 'FPC_000' + r_TransmissionControlNo;
         8: r_TransmissionControlNo := 'FPC_00' + r_TransmissionControlNo;
         9: r_TransmissionControlNo := 'FPC_0' + r_TransmissionControlNo;
        10: r_TransmissionControlNo := 'FPC_' + r_TransmissionControlNo;
      END;
      EXIT(r_TransmissionControlNo);
    END;

    PROCEDURE DownloadFiles@1108200019();
    VAR
      FTPClient@1108200000 : Automation "{42A8A505-1CD3-4CA4-A7EA-E6EBCC481DDC} 1.0:{B32A3669-654B-4CEF-980E-C7753F1FA524}:'FTPNav'.FTPNavClass";
      Interface@1108200001 : Record 50014;
      DHLCrossDockingBatchLog@1108200002 : Record 50054;
      LocText001@1108200003 : TextConst 'DEU=FTP ist nicht aktiviert fÅr Schnittstelle ''DHLCROSSDO'';ENU=FTP not activated for ''DHLCROSSDO'' interface.';
    BEGIN
      Interface.GET('DHLCROSSDO');
      IF Interface."Use FTP" THEN BEGIN
        Interface.TESTFIELD("FTP Import Address");
        Interface.TESTFIELD("FTP Import User");
        Interface.TESTFIELD("FTP Import Password");
        Interface.TESTFIELD("FTP Import Folder");
        Interface.TESTFIELD("Import Folder");

        IF ISCLEAR(FTPClient) THEN
          CREATE(FTPClient);
        FTPClient.DownloadDirectory(Interface."FTP Import Address",
                                    Interface."FTP Import User",
                                    Interface."FTP Import Password",
                                    Interface."FTP Import Folder",
                                    Interface."Import Folder",
                                    TRUE,FALSE);
        //A/gob-rste/25.07.12/GOB1.08
        IF FTPClient.GetLastErrorText <> '' THEN
          ERROR(FTPClient.GetLastErrorText);
        //E/gob-rste/25.07.13/GOB1.08
      END ELSE
        ERROR(LocText001);
    END;

    PROCEDURE ImportFiles@1108200020(p_FileName@1108200003 : Text[1024]);
    VAR
      FileRec@1108200000 : Record 2000000022;
      Interface@1108200001 : Record 50014;
      LocText001@1108200002 : TextConst 'DEU=Datei %1 konnte nicht in das Archiv verschoben werden.;ENU=File %1 could not be moved to the archive.';
    BEGIN
      ReadDHLResponses(p_FileName);
    END;

    PROCEDURE ExportFiles@1108200021(p_GlobalBatchLogEntryNo@1108200000 : Integer);
    VAR
      DHLCrossdockBatchLogLoc@1108200001 : Record 50054;
    BEGIN
      IF DHLCrossdockBatchLogLoc.GET(GlobalBatchLogEntryNo) THEN BEGIN
        CASE DHLCrossdockBatchLogLoc.Type OF
          DHLCrossdockBatchLogLoc.Type::CreateOrderXML: BEGIN
            CreateDHLOrder(DHLCrossdockBatchLogLoc."PO No.");
          END;
          DHLCrossdockBatchLogLoc.Type::CreateOrderCanceledXML: BEGIN
            CreateDHLOrderCanceled(DHLCrossdockBatchLogLoc."PO No.");
          END;
        END;
      END;
    END;

    PROCEDURE UploadFiles@1108200023();
    VAR
      FTPClient@1108200002 : Automation "{42A8A505-1CD3-4CA4-A7EA-E6EBCC481DDC} 1.0:{B32A3669-654B-4CEF-980E-C7753F1FA524}:'FTPNav'.FTPNavClass";
      Interface@1108200001 : Record 50014;
      DHLCrossDockingBatchLog@1108200000 : Record 50054;
      LocText001@1108200003 : TextConst 'DEU=FTP ist nicht aktiviert fÅr Schnittstelle ''DHLCROSSDO'';ENU=FTP not activated for ''DHLCROSSDO'' interface.';
    BEGIN
      Interface.GET('DHLCROSSDO');
      IF Interface."Use FTP" THEN BEGIN
        Interface.TESTFIELD("FTP Export Address");
        Interface.TESTFIELD("FTP Export User");
        Interface.TESTFIELD("FTP Export Password");
        Interface.TESTFIELD("FTP Export Folder");
        Interface.TESTFIELD("Export Folder");
        IF ISCLEAR(FTPClient) THEN
          CREATE(FTPClient);
        //A/gob-rste/25.07.12/GOB.08
        //IF NOT FTPClient.UploadTempFileAndRename(Interface."FTP Export Address",
        IF NOT FTPClient.UploadTempFilesFromDirectory(Interface."FTP Export Address",
                                                      Interface."FTP Export User",
                                                      Interface."FTP Export Password",
                                                      Interface."FTP Export Folder",
                                                      Interface."Export Folder",
                                                      TRUE,FALSE,FALSE) THEN
          IF FTPClient.GetLastErrorText <> '' THEN
            ERROR(FORMAT(FTPClient.GetLastErrorText));
         //E/gob-rste/25.07.12/GOB.08
      END ELSE
        ERROR(LocText001);
    END;

    PROCEDURE CreatePOtoBatch@1108200018(p_PurchaseOrderNo@1108200000 : Code[20]);
    VAR
      DHLCrossDockingBatchLog@1108200001 : Record 50054;
      PurchHeader@1108200002 : Record 38;
    BEGIN
      DHLCrossDockingBatchLog.INIT;
      DHLCrossDockingBatchLog."Entry No." := DHLCrossDockingBatchLog.GetNextLineNo;
      DHLCrossDockingBatchLog.Type := DHLCrossDockingBatchLog.Type::CreateOrderXML;
      DHLCrossDockingBatchLog."Inserted On" := CURRENTDATETIME;
      DHLCrossDockingBatchLog."PO No." := p_PurchaseOrderNo;
      DHLCrossDockingBatchLog.INSERT;
      PurchHeader.GET(1,p_PurchaseOrderNo);
      PurchHeader."DHL HD Transfer Date" := TODAY;
      PurchHeader.MODIFY;
    END;

    PROCEDURE CreatePOCanceltoBatch@1108200027(p_PurchaseOrderNo@1108200000 : Code[20]);
    VAR
      DHLCrossDockingBatchLog@1108200001 : Record 50054;
    BEGIN
      DHLCrossDockingBatchLog.INIT;
      DHLCrossDockingBatchLog."Entry No." := DHLCrossDockingBatchLog.GetNextLineNo;
      DHLCrossDockingBatchLog.Type := DHLCrossDockingBatchLog.Type::CreateOrderCanceledXML;
      DHLCrossDockingBatchLog."Inserted On" := CURRENTDATETIME;
      DHLCrossDockingBatchLog."PO No." := p_PurchaseOrderNo;
      DHLCrossDockingBatchLog.INSERT;
    END;

    PROCEDURE SetRunType@1108200026(p_RunType@1108200000 : ' ,Download,Import,Export,Upload,Process';p_BatchLogEntryNo@1108200001 : Integer;p_GlobalFileName@1108200002 : Text[1024]);
    BEGIN
      CLEAR(RunType);
      GlobalBatchLogEntryNo := 0;
      GlobalFileName := '';
      RunType := p_RunType;
      GlobalBatchLogEntryNo := p_BatchLogEntryNo;
      //A/gob-rste/10.07.12/GOB1.02
      GlobalFileName := p_GlobalFileName;
      //E/gob-rste/10.07.12/GOB1.02
    END;

    PROCEDURE ShipPurchLines@1108200028(p_PurchHeader@1108200000 : Record 38);
    VAR
      PurchLineLoc@1108200001 : Record 39;
    BEGIN
      PurchLineLoc.RESET;
      PurchLineLoc.SETRANGE("Document Type",p_PurchHeader."Document Type");
      PurchLineLoc.SETRANGE("Document No.",p_PurchHeader."No.");
      PurchLineLoc.SETFILTER(Type,'>0');
      IF PurchLineLoc.FIND('-') THEN
        REPEAT
          //A/gob-rste/31.07.12/GOB1.09
          IF PurchLineLoc."Qty. to Receive" <> (PurchLineLoc.Quantity - PurchLineLoc."Quantity Received") THEN BEGIN
          //E/gob-rste/31.07.12/GOB1.09
            PurchLineLoc.VALIDATE("Qty. to Receive",PurchLineLoc.Quantity - PurchLineLoc."Quantity Received");
            PurchLineLoc.MODIFY;
          //A/gob-rste/31.07.12/GOB1.09
          END;
          //E/gob-rste/31.07.12/GOB1.09
        UNTIL PurchLineLoc.NEXT = 0;
    END;

    PROCEDURE ShipSalesLines@1108200038(p_PurchLine@1108200000 : Record 39);
    VAR
      SalesLineLoc@1108200001 : Record 37;
    BEGIN
      //A/gob-rste/30.08.12/GOB1.13
      SalesLineLoc.RESET;
      SalesLineLoc.SETRANGE("Document Type",1);
      SalesLineLoc.SETRANGE("Document No.",p_PurchLine."Special Order Sales No.");
      IF SalesLineLoc.FIND('-') THEN
        REPEAT
          SalesLineLoc.VALIDATE("Qty. to Ship",0);
          SalesLineLoc.MODIFY;
        UNTIL SalesLineLoc.NEXT = 0;
      //E/gob-rste/30.08.12/GOB1.13
      SalesLineLoc.RESET;
      SalesLineLoc.SETRANGE("Document Type",1);
      SalesLineLoc.SETRANGE("Document No.",p_PurchLine."Special Order Sales No.");
      SalesLineLoc.SETRANGE("Line No.",p_PurchLine."Special Order Sales Line No.");
      IF SalesLineLoc.FIND('-') THEN BEGIN
        REPEAT
          //A/gob-rste/31.07.12/GOB1.09
          IF SalesLineLoc."Qty. to Ship" <> (SalesLineLoc.Quantity - SalesLineLoc."Quantity Shipped") THEN BEGIN
          //E/gob-rste/31.07.12/GOB1.09
            SalesLineLoc.VALIDATE("Qty. to Ship",SalesLineLoc.Quantity - SalesLineLoc."Quantity Shipped");
            SalesLineLoc.MODIFY;
          //A/gob-rste/31.07.12/GOB1.09
          END;
          //E/gob-rste/31.07.12/GOB1.09
        UNTIL SalesLineLoc.NEXT = 0;
      END;
    END;

    PROCEDURE UpdateSalesLines@1108200042(p_PurchLine@1108200000 : Record 39;p_UpdateType@1108200002 : 'Send,Accep,Addr,Date,In,Out,Fulfilled,Canceled');
    VAR
      SalesLineLoc@1108200001 : Record 37;
      DHLParcelsStatusHistory@1108200003 : Record 50021;
      StatusCode@1108200004 : Code[20];
      StatusDescription@1108200005 : Text[50];
      FPCGeneralSetup@1000000000 : Record 50055;
    BEGIN
      //S/P1133
      FPCGeneralSetup.GET;
      //E/P1133

      //A/gob-rste/26.07.12/GOB1.07
      StatusCode := '';
      StatusDescription := '';
      SalesLineLoc.RESET;
      SalesLineLoc.SETRANGE("Document Type",1);
      SalesLineLoc.SETRANGE("Document No.",p_PurchLine."Special Order Sales No.");
      SalesLineLoc.SETRANGE("Line No.",p_PurchLine."Special Order Sales Line No.");
      IF SalesLineLoc.FIND('-') THEN BEGIN
        CASE p_UpdateType OF
          p_UpdateType::Send : BEGIN
            StatusCode := 'DHLHD_FILE_SEND';
            StatusDescription := 'File send';
          END;
          p_UpdateType::Accep : BEGIN
            StatusCode := 'DHLHD_FILE_ACCEPT';
            StatusDescription := 'File Accepted';
          END;
          p_UpdateType::Addr : BEGIN
            StatusCode := 'DHLHD_ADDR_CHANGED';
            StatusDescription := 'Shipment Address Changed';
          END;
          p_UpdateType::Date : BEGIN
            StatusCode := 'DHLHD_DATE_CHANGED';
            StatusDescription := 'Shipment Date Changed';
          END;
          p_UpdateType::"In" : BEGIN
            StatusCode := 'DHLHD_TRANSP_IN';
            StatusDescription := 'Transport In DHL HUB';
          END;
          p_UpdateType::Out : BEGIN
            StatusCode := 'DHLHD_TRANSP_OUT';
            StatusDescription := 'Transport Out DHL HUB';
          END;
          p_UpdateType::Fulfilled : BEGIN
            StatusCode := 'DHLHD_FULFILLED';
            StatusDescription := 'Order Fulfilled';
          END;
          p_UpdateType::Canceled : BEGIN
            StatusCode := 'DHLHD_Cancel_SEND';
            StatusDescription := 'Order Canceled Send';
          END;
        END;
        REPEAT
          //S/P1117
          //S/P1133
          IF FPCGeneralSetup."Active Parcel Status History" IN
            [FPCGeneralSetup."Active Parcel Status History"::"Use Only Old DHL Parcel Status History",
            FPCGeneralSetup."Active Parcel Status History"::"Fill Both But Show And Use Old",
            FPCGeneralSetup."Active Parcel Status History"::"Fill Both But Show And Use New"]
          THEN
          //E/P113
            DHLParcelsStatusHistory.InsertOrderStatus(0,
                                                      SalesLineLoc."Document No.",
                                                      SalesLineLoc."Line No.",
                                                      StatusCode,
                                                      StatusDescription);
          //S/P1133
          IF FPCGeneralSetup."Active Parcel Status History" IN
            [FPCGeneralSetup."Active Parcel Status History"::"Fill Both But Show And Use Old",
            FPCGeneralSetup."Active Parcel Status History"::"Fill Both But Show And Use New",
            FPCGeneralSetup."Active Parcel Status History"::"Use Only New Parcel Status History"]
          THEN
          //E/P113
            CUParcelStatusHistoryMgmt.FillHistoryByDocInfos(
              0,                            // p_DocType
              SalesLineLoc."Document No.",  // p_OrderNo
              SalesLineLoc."Line No.",      // p_LineNo
              StatusCode,                   // p_StatusCode
              StatusDescription,            // p_Comment
              1);                           // p_HowToHandleStatusDescription
          //E/P1117
          //SalesLineLoc."Line Status" := p_LineStatus;
          SalesLineLoc.MODIFY;
        UNTIL SalesLineLoc.NEXT = 0;
      END;
      //SalesLineLoc.RESET;
      //SalesLineLoc.SETRANGE("Document Type",1);
      //SalesLineLoc.SETRANGE("Document No.",p_PurchLine."Special Order Sales No.");
      //SalesLineLoc.SETRANGE("Line No.",p_PurchLine."Special Order Sales Line No.");
      //IF SalesLineLoc.FIND('-') THEN BEGIN
        //REPEAT
          //SalesLineLoc."Line Status" := p_LineStatus;
          //SalesLineLoc.MODIFY;
        //UNTIL SalesLineLoc.NEXT = 0;
      //END;
      //E/gob-rste/26.07.12/GOB1.07
    END;

    PROCEDURE ReadDHLAcknowledgementAndError@1108200032(p_ErrorNodeList@1108200014 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF82-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNodeList";VAR p_DHLCrossdockHeader@1108200002 : Record 50052);
    VAR
      NodeLoc@1108200000 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      NodeLoc2@1108200001 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      NodeLoc3@1108200003 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      NodeLoc4@1108200004 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      NodeLoc5@1108200005 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      NodeLoc6@1108200006 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      NodeLoc7@1108200007 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      LocInt@1108200008 : Integer;
      DHLCrossDockHeaderLoc@1108200009 : Record 50052;
      PurchLineLoc@1108200010 : Record 39;
      LocBigInt@1000000000 : BigInteger;
    BEGIN
      //A/gob-rste/11.07.12/GOB1.04
      IF NOT ISCLEAR(p_ErrorNodeList) THEN BEGIN
      NodeLoc := p_ErrorNodeList.item(0);
        IF NOT ISCLEAR(NodeLoc) THEN BEGIN
          IF NodeLoc.hasChildNodes THEN BEGIN
            NodeLoc2 := NodeLoc.selectSingleNode('AcknowledgementDetails');
            IF NOT ISCLEAR(NodeLoc2) THEN BEGIN
              NodeLoc3 := NodeLoc2.selectSingleNode('ErrorCode');
              IF NOT ISCLEAR(NodeLoc3) THEN BEGIN
                p_DHLCrossdockHeader.INIT;
                p_DHLCrossdockHeader."Entry No." := p_DHLCrossdockHeader.GetNextEntryNo;
                p_DHLCrossdockHeader.INSERT;
                p_DHLCrossdockHeader.Inserted := CURRENTDATETIME;
                p_DHLCrossdockHeader.Filename := GetFileName(GlobalFileName);
                p_DHLCrossdockHeader.Direction := p_DHLCrossdockHeader.Direction::"In";
                p_DHLCrossdockHeader.Error := TRUE;
                p_DHLCrossdockHeader.Type := p_DHLCrossdockHeader.Type::"Error DHL/Magento";
                p_DHLCrossdockHeader."XML File".IMPORT(GlobalFileName);
                p_DHLCrossdockHeader.Errortext := NodeLoc3.text;
                NodeLoc3 := NodeLoc2.selectSingleNode('ErrorResponse');
                IF NOT ISCLEAR(NodeLoc3) THEN
                  p_DHLCrossdockHeader.Errortext := p_DHLCrossdockHeader.Errortext + '_' + NodeLoc3.text;
                p_DHLCrossdockHeader.MODIFY;
              END ELSE BEGIN
                NodeLoc3 := NodeLoc2.selectSingleNode('Message');
                IF NOT ISCLEAR(NodeLoc3) THEN BEGIN
                  NodeLoc4 := NodeLoc3.selectSingleNode('MessageContent');
                  IF NOT ISCLEAR(NodeLoc4) THEN BEGIN
                    NodeLoc5 := NodeLoc4.selectSingleNode('ns5:Order');
                    IF NOT ISCLEAR(NodeLoc5) THEN BEGIN
                      NodeLoc6 := NodeLoc5.selectSingleNode('OrderId');
                      IF NOT ISCLEAR(NodeLoc6) THEN BEGIN
                        NodeLoc7 := NodeLoc6.selectSingleNode('Id');
                        IF NOT ISCLEAR(NodeLoc7) THEN BEGIN
                          IF NodeLoc7.text <> '' THEN BEGIN
                            LocInt := 0;
                            //A/gob-rste/08.08.12/GOB1.10
                            LocBigInt := 0;
                            //A/gob-rste/08.08.12/GOB1.10
                            //A/gob-rste/16.08.12/GOB1.12
                            //IF STRLEN(NodeLoc7.text) >= 9 THEN BEGIN
                            IF STRLEN(NodeLoc7.text) <= 9 THEN BEGIN
                            //E/gob-rste/16.08.12/GOB1.12
                            //E/gob-rste/08.08.12/GOB1.10
                            //A/gob-rste/24.07.12/GOB1.06
                              IF EVALUATE(LocInt,NodeLoc7.text) THEN;
                            //A/gob-rste/08.08.12/GOB1.10
                            END ELSE BEGIN
                              IF EVALUATE(LocBigInt,NodeLoc7.text) THEN BEGIN
                                DHLCrossDockHeaderLoc.SETCURRENTKEY("DHL Order ID");
                                DHLCrossDockHeaderLoc.SETRANGE("DHL Order ID",LocBigInt);
                                IF DHLCrossDockHeaderLoc.FINDFIRST THEN
                                  LocInt := DHLCrossDockHeaderLoc."Entry No.";
                              END;
                            END;
                            //EVALUATE(LocInt,NodeLoc7.text);
                            IF LocInt <> 0 THEN
                            //E/gob-rste/24.07.12/GOB1.06
                            IF DHLCrossDockHeaderLoc.GET(LocInt) THEN BEGIN
                              DHLCrossDockHeaderLoc."Acknowledgement DHL" := TRUE;
                              DHLCrossDockHeaderLoc.MODIFY;
                              //A/gob-rste/25.07.12/GOB1.07
                              PurchLineLoc.SETRANGE("Document Type",PurchLineLoc."Document Type"::Order);
                              PurchLineLoc.SETRANGE("Document No.",DHLCrossDockHeaderLoc.OrderNr);
                              IF PurchLineLoc.FIND('-') THEN
                                REPEAT
                                  UpdateSalesLines(PurchLineLoc,1);
                                UNTIL PurchLineLoc.NEXT = 0;
                              //E/gob-rste/25.07.12/GOB1.07
                            END;
                          END;
                        END;
                      END;
                    END;
                  END;
                END;
              END;
            END;
          END;
        END;
      END;
      //E/gob-rste/11.07.12/GOB1.04
    END;

    PROCEDURE GetPONoFromOrderID@1108200031(p_OrderID@1108200000 : Code[20]) : Code[20];
    VAR
      DHLCrossdockHeader@1108200001 : Record 50052;
      LocInt@1108200002 : Integer;
      LocBigInt@1000000000 : BigInteger;
    BEGIN
      IF p_OrderID <> '' THEN
      //A/gob-rste/08.08.12/GOB1.10
      IF STRLEN(p_OrderID) >= 9 THEN BEGIN
        IF EVALUATE(LocBigInt,p_OrderID) THEN
          IF LocBigInt <> 0 THEN BEGIN
            DHLCrossdockHeader.SETRANGE("DHL Order ID",LocBigInt);
            IF DHLCrossdockHeader.FINDFIRST THEN
              EXIT(DHLCrossdockHeader.OrderNr);
          END;
      END ELSE BEGIN
        IF EVALUATE(LocInt,p_OrderID) THEN
          IF LocInt <> 0 THEN BEGIN
            DHLCrossdockHeader.SETRANGE("Entry No.",LocInt);
            IF DHLCrossdockHeader.FINDFIRST THEN
              EXIT(DHLCrossdockHeader.OrderNr)
          END;
      END;
      EXIT('');
        //IF EVALUATE(LocInt,p_OrderID) THEN
          //IF LocInt <> 0 THEN BEGIN
            //DHLCrossdockHeader.SETRANGE("Entry No.",LocInt);
            //IF DHLCrossdockHeader.FINDFIRST THEN
              //EXIT(DHLCrossdockHeader.OrderNr)
            //ELSE
              //EXIT('');
          //END;
      //E/gob-rste/08.08.12/GOB1.10
    END;

    PROCEDURE CheckAndPostPurchOrder@1000000002(p_CrossDockHeader@1000000000 : Record 50052);
    VAR
      PurchHeaderLoc@1000000001 : Record 38;
      PurchPost@1000000002 : Codeunit 90;
      PostingDateLoc@1000000003 : Date;
      YYYY@1000000004 : Text[30];
      YYYYInt@1000000005 : Integer;
      MM@1000000006 : Text[30];
      MMInt@1000000007 : Integer;
      DD@1000000008 : Text[30];
      DDInt@1000000009 : Integer;
      PurchLineLoc@1000000010 : Record 39;
    BEGIN
      //A/gob-rste/05.10.12/P0412
      IF PurchHeaderLoc.GET(1,GetPONoFromOrderID(p_CrossDockHeader.OrderID)) THEN BEGIN
        PurchLineLoc.RESET;
        PurchLineLoc.SETRANGE("Document Type",PurchHeaderLoc."Document Type");
        PurchLineLoc.SETRANGE("Document No.",PurchHeaderLoc."No.");
        PurchLineLoc.SETRANGE("Quantity Received",0);
        IF NOT PurchLineLoc.ISEMPTY THEN BEGIN
          ShipPurchLines(PurchHeaderLoc);
          COMMIT;
          PurchHeaderLoc.Receive := TRUE;
          PurchHeaderLoc.Invoice := FALSE;
          CLEAR(PurchPost);
          PostingDateLoc := 0D;
          YYYY := '';
          MM := '';
          DD := '';
          YYYYInt := 0;
          MMInt := 0;
          DDInt := 0;
          IF p_CrossDockHeader.StatusDate <> '' THEN BEGIN
            IF STRLEN(p_CrossDockHeader.StatusDate) >= 19 THEN BEGIN
              YYYY := COPYSTR(p_CrossDockHeader.StatusDate,1,4);
              MM := COPYSTR(p_CrossDockHeader.StatusDate,6,2);
              DD := COPYSTR(p_CrossDockHeader.StatusDate,9,2);
              IF EVALUATE(DDInt,DD) THEN;
              IF EVALUATE(MMInt,MM) THEN;
              IF EVALUATE(YYYYInt,YYYY) THEN;
              IF (DDInt <> 0) AND (DDInt <= 31) AND
                 (MMInt <> 0) AND (MMInt <= 12) AND
                 (YYYYInt <> 0) AND (YYYYInt >= 1753)
              THEN
                PostingDateLoc := DMY2DATE(DDInt,MMInt,YYYYInt);
            END;
          END;
          IF PostingDateLoc = 0D THEN
            PostingDateLoc := TODAY;
          PurchPost.SetPostingDate(TRUE,FALSE,PostingDateLoc);
          IF PurchPost.RUN(PurchHeaderLoc) THEN BEGIN
            PurchLineLoc.RESET;
            PurchLineLoc.SETRANGE("Document Type",PurchHeaderLoc."Document Type");
            PurchLineLoc.SETRANGE("Document No.",PurchHeaderLoc."No.");
            IF PurchLineLoc.FIND('-') THEN
              REPEAT
                UpdateSalesLines(PurchLineLoc,4);
              UNTIL PurchLineLoc.NEXT = 0;
          END;
        END;
      END;
      //E/gob-rste/05.10.12/P0412
    END;

    BEGIN
    {
      +--------------------------------------------------+
      |                   ∏  Copyright                   |
      |       GOB Software & Systeme GmbH & Co. KG       |
      +--------------------------------------------------+
      |                     FP Commerce                  |
      +--------------------------------------------------+

      Version   Date      Consultant  Comment
      ____________________________________________________________________________________________________________________________________
      GOB1.00   15.05.12  gob-rste    Object created
      GOB1.01   18.06.12  gob-rste    Testfields for OrderValues
      GOB1.02   10.07.12  gob-rste    Save XML in Blob, Bugfix
      GOB1.03   10.07.12  gob-rste    New Code for ErrorFiles
      GOB1.04   11.07.12  gob-rste    Add DHL HD Partner ID to XML, Read Acknowledgement and Errors
      GOB1.05   13.07.12  gob-rste    New Barcode for XML Files
      GOB1.06   24.07.12  gob-rste    Error Code Removed for mixed XML Files with Magento an NAV Orders, Div. Bugfixes
      GOB1.07   25.07.12  gob-rste    New Status Updates
      GOB1.08   25.07.12  gob-rste    New FTP Upload (P0094)
      GOB1.09   31.07.12  gob-rste    Process One Single File (P0116)
      GOB1.10   08.08.12  gob-rste    New Entry No BigInteger for all DHL ID(Receiver, Order)
      GOB1.11   14.08.12  gob-rste    BC for XML to DHL HD Transfer Date
      GOB1.12   15.08.12  gob-rste    New Code for Acknowledgement, Dates
      GOB1.13   30.08.12  gob-rste    New Code for Shipping Code Names
      GOB1.14   31.08.12  gob-rste    GetWeight / 100 (P0279)
      GOB1.15   04.10.12  gob-rste    Status Stemp Date as Posting Date (P0405)
      GOB1.16   05.10.12  gob-rste    Post Purch. Order if not Posted on sales post (P0412)
      P1117     01.10.13  gob-mlan    - Redesign of "DHL Parcel Status History"
                                      - Code within with //S/P1117/++S+++++++ and //E/P1117/--E-------
                                        will be replaced by the new code and/or it will be deactivated
      P1133     05.11.13  gob-mlan    - Redesign of "DHL Parcel Status History"
    }
    END.
  }
}

