OBJECT Codeunit 50120 SII General Management
{
  OBJECT-PROPERTIES
  {
    Date=17.11.14;
    Time=22:45:16;
    Modified=Yes;
    Version List=SII,HME2008,T0009;
  }
  PROPERTIES
  {
    OnRun=VAR
            LocText001@1000000000 : TextConst 'ENU=Codeunit 50120 not initialized';
          BEGIN
            CASE GlobalRunType OF
              GlobalRunType::SIIActive :
                BEGIN
                  CheckIfSIIIsActive(GlobalSetupTemp);
                END;
              GlobalRunType::TestMessageConnection :
                BEGIN
                  TestMessageConnection(GlobalMessageTemp);
                END;
              GlobalRunType::TestStructureVersion :
                BEGIN
                  CheckMessageStructureVersion(GlobalMessageTemp);
                END;
              ELSE
                ERROR(LocText001);
            END;
          END;

  }
  CODE
  {
    VAR
      GlobalRunType@1000000000 : ' ,SIIActive,TestMessageConnection,TestStructureVersion';
      GlobalMessageCode@1000000001 : Code[30];
      GlobalWebsiteNo@1000000002 : Integer;
      GlobalSetupTemp@1000000004 : TEMPORARY Record 50140;
      Text001@1000000005 : TextConst 'ENU=There''s no matching order to the request.';
      GlobalMessageTemp@1000000006 : TEMPORARY Record 50141;
      GlobalNoOfRecs@1000000009 : Integer;
      GlobalStartTime@1000000008 : Time;
      GlobalFactor@1000000007 : Decimal;
      GlobalWindow@1000000003 : Dialog;
      GlobFieldNoDifferent@1000000011 : Boolean;
      GlobalFieldNo@1000000010 : Integer;

    PROCEDURE ClearAllGlobals@1000000006();
    BEGIN
      // Clear all Global Vars
      GlobalRunType := GlobalRunType::" ";
      GlobalMessageCode := '';
      GlobalWebsiteNo := 0;
      GlobalSetupTemp.DELETEALL;
      GlobalMessageTemp.DELETEALL;
    END;

    PROCEDURE InitIfSIIIsActive@1000000005(p_SIISetup@1000000000 : Record 50140);
    BEGIN
      // Init Globals to check if SII is Active
      ClearAllGlobals;
      GlobalRunType := GlobalRunType::SIIActive;
      GlobalSetupTemp := p_SIISetup;
    END;

    PROCEDURE CheckIfSIIIsActive@1000000000(p_TEMP_SIISetup@1000000008 : Record 50140);
    VAR
      LocText001@1000000001 : TextConst 'ENU=%1 %2 is not %3.';
      SoapWinHttpConnector@1000000006 : Automation "{46BF17C2-9257-11D5-87EA-00B0D0BE6479} 3.0:{0AF40C55-9257-11D5-87EA-00B0D0BE6479}:'Microsoft Soap WinHttp Connector Type Library (v3.0)'.WinHttpConnector30";
      SoapSerializer@1000000005 : Automation "{91147A58-DFE4-47C0-8E76-987FC1A6001B} 3.0:{B76585B0-9257-11D5-87EA-00B0D0BE6479}:'Microsoft Soap Type Library v3.0'.SoapSerializer30";
      DOMDocument@1000000004 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 3.0:{F6D90F11-9C73-11D3-B32E-00C04F990BB4}:'Microsoft XML, v3.0'.DOMDocument";
      IXMLDOMNode@1000000003 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 3.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v3.0'.IXMLDOMNode";
      IXMLDOMParseError@1000000007 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{3EFAA426-272F-11D2-836F-0000F87A7782}:'Microsoft XML, v6.0'.IXMLDOMParseError";
      XMLSchemaCache@1000000002 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{373984C9-B845-449B-91E7-45AC83036ADE}:'Microsoft XML, v6.0'.XMLSchemaCache";
      SIISetup@1000000000 : Record 50140;
    BEGIN
      // Checks All Setup Fields for FTTC, used in OnRun Trigger for TRUE/FALSE
      SIISetup := p_TEMP_SIISetup;
      // Check if Mode is active
      IF SIISetup.Mode <> SIISetup.Mode::Active THEN
        ERROR(LocText001,SIISetup.TABLECAPTION,SIISetup.FIELDCAPTION(Mode),SIISetup.Mode::Active);

      // Check External Components
      IF NOT ISCLEAR(SoapWinHttpConnector) THEN
        CLEAR(SoapWinHttpConnector);
      IF NOT ISCLEAR(SoapSerializer) THEN
        CLEAR(SoapSerializer);
      IF NOT ISCLEAR(DOMDocument) THEN
        CLEAR(DOMDocument);
      IF NOT ISCLEAR(IXMLDOMNode) THEN
        CLEAR(IXMLDOMNode);
      IF NOT ISCLEAR(IXMLDOMParseError) THEN
        CLEAR(IXMLDOMParseError);
      IF NOT ISCLEAR(XMLSchemaCache) THEN
        CLEAR(XMLSchemaCache);
      CREATE(SoapWinHttpConnector);
      CREATE(SoapSerializer);
      CREATE(DOMDocument);
      CREATE(XMLSchemaCache);

      //H2008  16.01.15  MIK  +++++++++++++++++++++++++
      //H2008  16.01.15  MIK  -------------------------

      IF SIISetup."Archive Files on Harddisk" THEN
        SIISetup.TESTFIELD("Archive Path on Harddisk");

      SIISetup.TESTFIELD("JQ Parameter Fill Log");
      SIISetup.TESTFIELD("JQ Parameter Process Log");
      SIISetup.TESTFIELD("JQ Param. Mon. Fill Statistic");

      IF SIISetup."Send E-Mails JQ Fill Log" THEN
        SIISetup.TESTFIELD("E-Mail Sent From");
    END;

    PROCEDURE InitTestMessageConnection@1000000016(p_SII_Message@1000000000 : Record 50141);
    BEGIN
      // Init Globals to check WS Connection per Message
      ClearAllGlobals;
      GlobalRunType := GlobalRunType::TestMessageConnection;
      GlobalMessageTemp := p_SII_Message;
    END;

    PROCEDURE TestMessageConnection@1000000017(p_SII_Message@1000000000 : Record 50141);
    VAR
      SIIMessage@1000000001 : Record 50141;
      LocText001@1000000002 : TextConst 'ENU=Message %1 must be Active.';
    BEGIN
      // Call Test Connection
      SIIMessage := p_SII_Message;
      //S/P0923
      //IF SIIMessage.Mode <> SIIMessage.Mode::Active THEN
        //ERROR(LocText001);
      //E/P0923

      SIIMessage.TESTFIELD("Website No.");
      SIIMessage.TESTFIELD("Message Code NAV");
      SIIMessage.TESTFIELD("Message Code Shop");

      //H2008  16.01.15  MIK  +++++++++++++++++++++++++
      //H2008  16.01.15  MIK  -------------------------

      //S/P1111
      {************************
      SIIMessage.TESTFIELD("Web Service Address");
      SIIMessage.TESTFIELD("Web Service Action");
      IF SIIMessage."User Authorization Active" THEN BEGIN
        SIIMessage.TESTFIELD("Authorization User");
        SIIMessage.TESTFIELD("Authorization Password");
      END;
      ************************}

      IF SIIMessage.Mode = SIIMessage.Mode::Active THEN BEGIN
        SIIMessage.TESTFIELD("Web Service Address");
        SIIMessage.TESTFIELD("Web Service Action");
        IF SIIMessage."User Authorization Active" THEN BEGIN
          SIIMessage.TESTFIELD("Authorization User");
          SIIMessage.TESTFIELD("Authorization Password");
        END;
      END ELSE BEGIN
        SIIMessage.TESTFIELD("Web Service Address Test");
        SIIMessage.TESTFIELD("Web Service Action Test");
        IF SIIMessage."User Authorization Active Test" THEN BEGIN
          SIIMessage.TESTFIELD("Authorization User Test");
          SIIMessage.TESTFIELD("Authorization Password Test");
        END;
      END;
      //E/P1111

      SIIMessage.CALCFIELDS("Active Actions");
      SIIMessage.CALCFIELDS("Active Channels");

      SIIMessage.TESTFIELD("Active Actions");

      IF SIIMessage."Belongs to" = SIIMessage."Belongs to"::Lines THEN
        SIIMessage.TESTFIELD("Active Channels");

      IF SIIMessage.Mode = SIIMessage.Mode::Active THEN
        EXIT;
    END;

    PROCEDURE ExportXMLFromLog@1000000001(p_SIIXMLLog@1000000000 : Record 50145;p_ExportDoc@1000000001 : 'Request,Response');
    VAR
      FileName@1000000002 : Text[1024];
    BEGIN
      // Export XML from Blog with Dialog
      CASE p_ExportDoc OF
        p_ExportDoc::Request :
          BEGIN
            p_SIIXMLLog.CALCFIELDS("Request Document");
            p_SIIXMLLog."Request Document".EXPORT('Request_' +
              FORMAT(p_SIIXMLLog."Attached to Entry No.") +
              '_' +
              FORMAT(p_SIIXMLLog."Line No.") +
              '.xml',
              TRUE);
          END;
        p_ExportDoc::Response :
          BEGIN
            p_SIIXMLLog.CALCFIELDS("Response Document");
            p_SIIXMLLog."Response Document".EXPORT('Response_' +
              FORMAT(p_SIIXMLLog."Attached to Entry No.") +
              '_' +
              FORMAT(p_SIIXMLLog."Line No.") +
              '.xml',
              TRUE);
          END;
      END;
    END;

    PROCEDURE ExportXMLFromLogArc@1000000031(p_SIIXMLLog@1000000000 : Record 50134;p_ExportDoc@1000000001 : 'Request,Response');
    VAR
      FileName@1000000002 : Text[1024];
    BEGIN
      //S/P0951
      // Export XML from Blog with Dialog
      CASE p_ExportDoc OF
        p_ExportDoc::Request :
          BEGIN
            p_SIIXMLLog.CALCFIELDS("Request Document");
            p_SIIXMLLog."Request Document".EXPORT('Request_' +
              FORMAT(p_SIIXMLLog."Attached to Entry No.") +
              '_' +
              FORMAT(p_SIIXMLLog."Line No.") +
              '.xml',
              TRUE);
          END;
        p_ExportDoc::Response :
          BEGIN
            p_SIIXMLLog.CALCFIELDS("Response Document");
            p_SIIXMLLog."Response Document".EXPORT('Response_' +
              FORMAT(p_SIIXMLLog."Attached to Entry No.") +
              '_' +
              FORMAT(p_SIIXMLLog."Line No.") +
              '.xml',
              TRUE);
          END;
      END;
      //E/P0951
    END;

    PROCEDURE HyperLinkXMLFromLog@1000000002(p_SIIXMLLog@1000000000 : Record 50145;p_ExportDoc@1000000001 : 'Request,Response');
    VAR
      eBayEditor@1000000003 : Codeunit 5095849;
      Filename@1000000002 : Text[1024];
      FileVar@1000000004 : File;
    BEGIN
      // Open XML File with Explorer
      Filename := '';
      FileVar.CREATETEMPFILE;
      Filename := FileVar.NAME;
      FileVar.CLOSE;
      Filename := Filename + '.xml';
      CASE p_ExportDoc OF
        p_ExportDoc::Request :
          BEGIN
            p_SIIXMLLog.CALCFIELDS("Request Document");
            IF p_SIIXMLLog."Request Document".HASVALUE THEN
              p_SIIXMLLog."Request Document".EXPORT(Filename);
            eBayEditor.RunEditor(Filename,2,FALSE);
          END;
        p_ExportDoc::Response :
          BEGIN
            p_SIIXMLLog.CALCFIELDS("Response Document");
            IF p_SIIXMLLog."Response Document".HASVALUE THEN
              p_SIIXMLLog."Response Document".EXPORT(Filename);
            eBayEditor.RunEditor(Filename,2,FALSE);
          END;
      END;
    END;

    PROCEDURE HyperLinkXMLFromLogArc@1000000010(p_SIIXMLLog@1000000000 : Record 50134;p_ExportDoc@1000000001 : 'Request,Response');
    VAR
      eBayEditor@1000000003 : Codeunit 5095849;
      Filename@1000000002 : Text[1024];
      FileVar@1000000004 : File;
    BEGIN
      // Open XML File with Explorer
      Filename := '';
      FileVar.CREATETEMPFILE;
      Filename := FileVar.NAME;
      FileVar.CLOSE;
      Filename := Filename + '.xml';
      CASE p_ExportDoc OF
        p_ExportDoc::Request :
          BEGIN
            p_SIIXMLLog.CALCFIELDS("Request Document");
            IF p_SIIXMLLog."Request Document".HASVALUE THEN
              p_SIIXMLLog."Request Document".EXPORT(Filename);
            eBayEditor.RunEditor(Filename,2,FALSE);
          END;
        p_ExportDoc::Response :
          BEGIN
            p_SIIXMLLog.CALCFIELDS("Response Document");
            IF p_SIIXMLLog."Response Document".HASVALUE THEN
              p_SIIXMLLog."Response Document".EXPORT(Filename);
            eBayEditor.RunEditor(Filename,2,FALSE);
          END;
      END;
    END;

    PROCEDURE GetDocTypeCaptionRecRef@1000000003(p_TableNo@1000000000 : Integer;p_OptionValue@1000000001 : Integer) r_OptionCaption : Text[30];
    VAR
      Field@1000000004 : Record 2000000041;
      RecRef@1000000002 : RecordRef;
      FieldRef@1000000003 : FieldRef;
      OptionCaptionTotal@1000000005 : Text[1024];
      i@1000000006 : Integer;
    BEGIN
      //S/P1161
      IF NOT GlobFieldNoDifferent THEN
        GlobalFieldNo := 1;
      //E/P1161

      // Get Option Caption from RecRef
      OptionCaptionTotal := '';
      r_OptionCaption := '';
      CLEAR(RecRef);
      CLEAR(FieldRef);
      IF p_TableNo <> 0 THEN BEGIN
        RecRef.OPEN(p_TableNo);
        //S/P1161
        //FieldRef := RecRef.FIELD(1);
        //IF Field.GET(p_TableNo,1) AND (Field.Type = Field.Type::Option) THEN BEGIN
        FieldRef := RecRef.FIELD(GlobalFieldNo);
        IF Field.GET(p_TableNo,GlobalFieldNo) AND (Field.Type = Field.Type::Option) THEN BEGIN
        //E/P1161
          FieldRef.VALUE := p_OptionValue;
          OptionCaptionTotal := FieldRef.OPTIONCAPTION;
          IF p_OptionValue = 0 THEN BEGIN
            IF STRPOS(OptionCaptionTotal,',') <> 0 THEN
              r_OptionCaption := COPYSTR(OptionCaptionTotal,1,STRPOS(OptionCaptionTotal,',') - 1)
            ELSE
              r_OptionCaption := COPYSTR(OptionCaptionTotal,1,30);
          END ELSE BEGIN
            FOR i := 1 TO p_OptionValue DO BEGIN
              OptionCaptionTotal := COPYSTR(OptionCaptionTotal,STRPOS(OptionCaptionTotal,',') + 1,STRLEN(OptionCaptionTotal));
            END;
            IF STRPOS(OptionCaptionTotal,',') <> 0 THEN
              r_OptionCaption := COPYSTR(OptionCaptionTotal,1,STRPOS(OptionCaptionTotal,',') - 1)
            ELSE
              r_OptionCaption := COPYSTR(OptionCaptionTotal,1,30);
          END;
        END;
      END;

      //S/P1161
      CLEAR(GlobFieldNoDifferent);
      //E/P1161

      EXIT(r_OptionCaption);
    END;

    PROCEDURE ShowDocumentFromLog@1000000004(p_TableNo@1000000000 : Integer;p_DocumentType@1000000001 : Integer;p_DocumentNo@1000000002 : Code[20]);
    VAR
      SalesHeader@1000000003 : Record 36;
      SalesHeaderArchive@1000000004 : Record 5107;
    BEGIN
      // Show Sales Order of Log Entry
      CASE p_TableNo OF
        36:
          BEGIN
            SalesHeader.RESET;
            SalesHeader.SETRANGE("Document Type",p_DocumentType);
            SalesHeader.SETRANGE("No.",p_DocumentNo);
            //S/P0923
            //IF SalesHeader.FIND('-') THEN
            IF SalesHeader.FINDSET THEN BEGIN
            //E/P0923
              //S/P1010
              //FORM.RUN(42,SalesHeader);
              //S/P1055
              {*******
              CASE SalesHeader."Document Type" OF
                SalesHeader."Document Type"::Order:
                  FORM.RUN(42,SalesHeader);
                SalesHeader."Document Type"::"Return Order":
                  FORM.RUN(6630,SalesHeader);
                ELSE
                  FORM.RUN(0,SalesHeader);
              END;
              *******}
              FORM.RUN(0,SalesHeader);
              //E/P1010
            //S/P0923
            END ELSE BEGIN
              SalesHeaderArchive.RESET;
              SalesHeaderArchive.SETRANGE("Document Type",p_DocumentType);
              SalesHeaderArchive.SETRANGE("No.",p_DocumentNo);
              IF SalesHeaderArchive.FINDSET THEN
              //S/P1055
              //  FORM.RUN(5159,SalesHeaderArchive);
                FORM.RUN(0,SalesHeaderArchive);
              //E/P1055
            END;
            //E/P0923
          END;
        5107:
          BEGIN
            SalesHeaderArchive.RESET;
            SalesHeaderArchive.SETRANGE("Document Type",p_DocumentType);
            SalesHeaderArchive.SETRANGE("No.",p_DocumentNo);
            //S/P1055
            //IF SalesHeaderArchive.FINDSET THEN
            IF SalesHeaderArchive.FINDSET THEN
            //  FORM.RUN(5159,SalesHeaderArchive);
              FORM.RUN(0,SalesHeaderArchive);
            //E/P1055
          END;
      END;
    END;

    PROCEDURE ShowFilteredOrders@1000000009(p_SIIMessage@1000000000 : Record 50141;p_ShowArchive@1000000005 : Boolean);
    VAR
      SalesHeader@1000000002 : Record 36;
      SalesHeaderArchive@1000000006 : Record 5107;
      SIIFillLog@1000000001 : Codeunit 50123;
      RecRefHeader@1000000004 : RecordRef;
      FieldRef@1000000010 : FieldRef;
      OpenTblNo@1000000007 : Integer;
    BEGIN
      //S/P0923
      CLEAR(RecRefHeader);
      CLEAR(FieldRef);
      CLEAR(SalesHeader);
      CLEAR(SalesHeaderArchive);

      IF NOT p_ShowArchive THEN
        OpenTblNo := 36
      ELSE
        OpenTblNo := 5107;

      RecRefHeader.OPEN(OpenTblNo);

      IF GetMsgType(p_SIIMessage) <> 0 THEN BEGIN
        SIIFillLog.GetMsgTypeGlob(p_SIIMessage);
        SIIFillLog.SetKeyForMessage(RecRefHeader,p_SIIMessage);
        SIIFillLog.FilterSalesHeaderWithMessage(RecRefHeader,p_SIIMessage);
        SIIFillLog.AdditionalFilter(RecRefHeader,p_SIIMessage);

        IF RecRefHeader.ISEMPTY THEN
          ERROR(Text001)
        ELSE BEGIN
          IF NOT p_ShowArchive THEN BEGIN
            SalesHeader.SETVIEW(RecRefHeader.GETVIEW);
            FORM.RUN(0,SalesHeader);
          END ELSE BEGIN
            SalesHeaderArchive.SETVIEW(RecRefHeader.GETVIEW);
            FORM.RUN(0,SalesHeaderArchive);
          END;
        END;
      END;

      RecRefHeader.CLOSE;
      //E/P0923
    END;

    PROCEDURE CheckForActiveChannel@1000000007(p_WebsiteNo@1000000003 : Integer;p_MessageCode@1000000000 : Code[30];VAR p_FilterText_Var@1000000001 : Text[1024]) : Boolean;
    VAR
      SIIActiveChannel@1000000002 : Record 50144;
    BEGIN
      SIIActiveChannel.RESET;
      SIIActiveChannel.SETRANGE("Website No.",p_WebsiteNo);
      SIIActiveChannel.SETRANGE("Message Code NAV",p_MessageCode);
      SIIActiveChannel.SETRANGE(Active,TRUE);
      IF SIIActiveChannel.FINDSET THEN BEGIN
        REPEAT
          IF p_FilterText_Var = '' THEN
            p_FilterText_Var := SIIActiveChannel."Purchasing Code"
          ELSE
            p_FilterText_Var := p_FilterText_Var + '|' + SIIActiveChannel."Purchasing Code";
        UNTIL SIIActiveChannel.NEXT = 0;
        EXIT(TRUE);
      END ELSE
        EXIT(FALSE);
    END;

    PROCEDURE GetForeColorForLog@1000000014(p_Status@1000000000 : 'Unprocessed,Canceled,Error,Processed') : Integer;
    VAR
      SIISetup@1000000001 : Record 50140;
    BEGIN
      SIISetup.GET;
      CASE p_Status OF
        p_Status::Unprocessed: EXIT(SIISetup."Color Unprocessed");
        p_Status::Canceled: EXIT(SIISetup."Color Canceled");
        p_Status::Error: EXIT(SIISetup."Color Error");
        p_Status::Processed: EXIT(SIISetup."Color Processed");
      END;
    END;

    PROCEDURE GetForeColorForProcessLog@1000000015(p_Status@1000000000 : 'Succes,Error') : Integer;
    VAR
      SIISetup@1000000001 : Record 50140;
    BEGIN
      SIISetup.GET;
      CASE p_Status OF
        p_Status::Succes: EXIT(0);
        p_Status::Error: EXIT(SIISetup."Color Error");
      END;
    END;

    PROCEDURE GetMsgType@1000000008(p_SIIMessage@1000000000 : Record 50141) : Integer;
    VAR
      SIISetup@1000000001 : Record 50140;
    BEGIN
      SIISetup.GET;

      CASE p_SIIMessage."Message Code NAV" OF
        SIISetup."Shipment Date NAV": EXIT(1);
        SIISetup."Payment Update Confirm. NAV": EXIT(2);
        SIISetup."Shipment Confirmation NAV": EXIT(3);
        SIISetup."Shipment Delivered NAV": EXIT(4);
        SIISetup."Cancellation NAV": EXIT(5);
        SIISetup."Return Order Requested NAV": EXIT(6);
        SIISetup."Return Item Received NAV": EXIT(7);
        SIISetup."Return Order Refund NAV": EXIT(8);
        SIISetup."Change Return Requested NAV": EXIT(9);
        SIISetup."Change Ret. Item Received NAV": EXIT(10);
        SIISetup."Change Order Created NAV": EXIT(11);
        //S/P1010
        //SIISetup."Change Shipment Delayed NAV": EXIT(12);
        //SIISetup."Change Shipment Confirm. NAV": EXIT(13);
        //SIISetup."Change Shipment Delivered NAV": EXIT(14);
        //E/P1010
        SIISetup."Spare Part Request NAV": EXIT(15);
        //S/P1010
        //SIISetup."Cancellation Request NAV": EXIT(16);
        //SIISetup."Cancellation Successful NAV": EXIT(17);
        //SIISetup."Cancellation Outpayment NAV": EXIT(18);
        //E/P1010
        //S/P1058
        SIISetup."Return Item Not Received NAV": EXIT(19);
        //E/P1058
        //H0651  11.11.2013  MBY  +++++++++++++++++++++++++
        SIISetup."Invoice Document NAV": EXIT(20);
        //H0651  11.11.2013  MBY  -------------------------
        //T0003 10.06.14 tec-sf +++++++++++++++++++++++++++++
        SIISetup."Return Order Label NAV" : EXIT(21);
        SIISetup."Change Return Req. Label NAV" : EXIT(22);
        //T0003 10.06.14 tec-sf -----------------------------
        //T0009 02.07.14 tec-sf +++++++++++++++++++++++++++++
        SIISetup."Credit Memo Mail NAV" : EXIT(23);
        //T0009 02.07.14 tec-sf -----------------------------
        //H1515  22.09.14  MBY  +++++++++++++++++++++++++
        SIISetup."Credit Card Capture NAV" : EXIT(24);
        //H1515  22.09.14  MBY  -------------------------
        ELSE
      //H0545 05.09.2013 ARI +++++++++++++++++++++++++++++++++++++++++++++++++++++
      //    EXIT(0);
          CASE p_SIIMessage."Message Code Shop" OF
            SIISetup."Shipment Date Shop": EXIT(1);
            SIISetup."Payment Update Confirm. Shop": EXIT(2);
            SIISetup."Shipment Confirmation Shop": EXIT(3);
            SIISetup."Shipment Delivered Shop": EXIT(4);
            SIISetup."Cancellation Shop": EXIT(5);
            SIISetup."Return Order Requested Shop": EXIT(6);
            SIISetup."Return Item Received Shop": EXIT(7);
            SIISetup."Return Order Refund Shop": EXIT(8);
            SIISetup."Change Return Requested Shop": EXIT(9);
            SIISetup."Change Ret. Item Received Shop": EXIT(10);
            SIISetup."Change Order Created Shop": EXIT(11);
            //S/P1010
            //SIISetup."Change Shipment Delayed Shop": EXIT(12);
            //SIISetup."Change Shipment Confirm. Shop": EXIT(13);
            //SIISetup."Change Shipment Delivered Shop": EXIT(14);
            //E/P1010
            SIISetup."Spare Part Request Shop": EXIT(15);
            //S/P1010
            //SIISetup."Cancellation Request Shop": EXIT(16);
            //SIISetup."Cancellation Successful Shop": EXIT(17);
            //SIISetup."Cancellation Outpayment Shop": EXIT(18);
            //E/P1010
            //S/P1058
            SIISetup."Return Item Not Received Shop": EXIT(19);
            //E/P1058
            //H0651  11.11.2013  MBY  +++++++++++++++++++++++++
            SIISetup."Invoice Document Shop": EXIT(20);
            //H0651  11.11.2013  MBY  -------------------------
            //T0009 02.07.14 tec-sf +++++++++++++++++++++++++++++
            SIISetup."Credit Memo Mail Shop" : EXIT(23);
            //T0009 02.07.14 tec-sf -----------------------------
            //H1515  22.09.14  MBY  +++++++++++++++++++++++++
            SIISetup."Credit Card Capture NAV" : EXIT(24);
            //H1515  22.09.14  MBY  -------------------------
            ELSE
              EXIT(0);
          END;
      //H0545 05.09.2013 ARI -----------------------------------------------------
      END;
    END;

    PROCEDURE InitMessageStructureVersion@1000000012(p_SIIMessage@1000000000 : Record 50141);
    BEGIN
      ClearAllGlobals;
      GlobalMessageTemp := p_SIIMessage;
      GlobalRunType := GlobalRunType::TestStructureVersion;
    END;

    PROCEDURE CheckMessageStructureVersion@1000000011(p_SIIMessage@1000000000 : Record 50141) : Boolean;
    VAR
      SIIXMLStructure@1000000001 : Record 50148;
      TempDec@1000000002 : Decimal;
      MessageStructure@1000000003 : Decimal;
      HighestStructure@1000000004 : Decimal;
      LocText001@1000000005 : TextConst 'ENU=No Structure';
      LocText002@1000000006 : TextConst 'ENU=Higher Structure';
      TempText@1000000007 : Text[30];
    BEGIN
      IF p_SIIMessage."Actual Structure Version" = '' THEN
        ERROR(LocText001);
      TempText := '';
      TempText := p_SIIMessage."Actual Structure Version";
      TempText := CONVERTSTR(TempText,'.',',');
      EVALUATE(MessageStructure,TempText);

      SIIXMLStructure.RESET;
      SIIXMLStructure.SETRANGE("Website No.",p_SIIMessage."Website No.");
      SIIXMLStructure.SETRANGE("Message Code NAV",p_SIIMessage."Message Code NAV");
      SIIXMLStructure.SETRANGE("Message Code Shop",p_SIIMessage."Message Code Shop");
      IF SIIXMLStructure.FINDSET THEN BEGIN
        REPEAT
          TempText := '';
          TempText := SIIXMLStructure."Structure Version";
          TempText := CONVERTSTR(TempText,'.',',');
          EVALUATE(TempDec,TempText);
          IF HighestStructure < TempDec THEN
            HighestStructure := TempDec;
        UNTIL SIIXMLStructure.NEXT = 0;
      END;

      IF HighestStructure > MessageStructure THEN
        ERROR(LocText002);
    END;

    PROCEDURE SetSorting@1000000013(VAR p_RecRef_Var@1000000001 : RecordRef;p_SIIMessage@1000000000 : Record 50141);
    VAR
      KeyText@1000000002 : Text[1024];
    BEGIN
      //S/P0923
      //IF p_SIIMessage."Use Key For Processing SO" <> 0 THEN BEGIN
      //  KeyText := GetKeyName(p_RecRef_Var,p_SIIMessage."Use Key For Processing SO");
      //  p_RecRef_Var.SETVIEW(STRSUBSTNO('SORTING(%1)',KeyText));
      //END;
      CASE p_RecRef_Var.NUMBER OF
        36:
          BEGIN
            IF p_SIIMessage."Use Key For Processing SO" <> 0 THEN BEGIN
              KeyText := GetKeyName(p_RecRef_Var,p_SIIMessage."Use Key For Processing SO");
              p_RecRef_Var.SETVIEW(STRSUBSTNO('SORTING(%1)',KeyText));
            END;
          END;
        5107:
          BEGIN
            IF p_SIIMessage."Use Key For Processing SO Arch" <> 0 THEN BEGIN
              KeyText := GetKeyName(p_RecRef_Var,p_SIIMessage."Use Key For Processing SO Arch");
              p_RecRef_Var.SETVIEW(STRSUBSTNO('SORTING(%1)',KeyText));
            END;
          END;
      END;
      //E/P0923
    END;

    PROCEDURE GetKeyName@1000000022(p_RecRef@1000000000 : RecordRef;p_KeyCount@1000000003 : Integer) : Text[1024];
    VAR
      FieldRef@1000000008 : FieldRef;
      KeyRef@1000000007 : KeyRef;
      KeyArray@1000000005 : ARRAY [99] OF Text[1024];
      i@1000000004 : Integer;
      Separator@1000000002 : Text[30];
      TextKey@1000000001 : Text[1024];
    BEGIN
      Separator := '';
      KeyRef := p_RecRef.KEYINDEX(p_KeyCount);
      IF KeyRef.ACTIVE THEN BEGIN
        i := 0;
        FOR i := 1 TO KeyRef.FIELDCOUNT DO BEGIN
          FieldRef := KeyRef.FIELDINDEX(i);
          TextKey := STRSUBSTNO('%1%2%3',TextKey,Separator,FieldRef.NAME);
          Separator := ',';
        END;
      END;

      EXIT(TextKey);
    END;

    PROCEDURE ShowLogSalesHeader@1000000018(p_SalesHeader@1000000000 : Record 36);
    VAR
      SIILog@1000000001 : Record 50146;
      SIILogForm@1000000002 : Form 50218;
      SIILogArchive@1000000003 : Record 50147;
      SIILogArchiveForm@1000000004 : Form 50226;
    BEGIN
      SIILog.RESET;
      SIILog.SETCURRENTKEY("Attached to Document Type","Attached to Document No.");
      SIILog.SETRANGE("Attached to Document Type",p_SalesHeader."Document Type");
      SIILog.SETRANGE("Attached to Document No.",p_SalesHeader."No.");
      IF SIILog.FINDSET THEN;
      CLEAR(SIILogForm);
      SIILogForm.SETTABLEVIEW(SIILog);
      SIILogForm.RUN;
    END;

    PROCEDURE ShowArchiveLogSalesHeader@1000000025(p_SalesHeader@1000000000 : Record 36);
    VAR
      SIILogArchiv@1000000001 : Record 50147;
      SIILogArchivForm@1000000002 : Form 50226;
    BEGIN
      SIILogArchiv.RESET;
      SIILogArchiv.SETCURRENTKEY("Attached to Document Type","Attached to Document No.");
      SIILogArchiv.SETRANGE("Attached to Document Type",p_SalesHeader."Document Type");
      SIILogArchiv.SETRANGE("Attached to Document No.",p_SalesHeader."No.");
      IF SIILogArchiv.FINDSET THEN;
      CLEAR(SIILogArchivForm);
      SIILogArchivForm.SETTABLEVIEW(SIILogArchiv);
      SIILogArchivForm.RUN;
    END;

    PROCEDURE ShowManTriggerLogSalesHeader@1000000020(p_SalesHeader@1000000000 : Record 36);
    VAR
      SIILogManualTrigger@1000000001 : Record 50155;
      SIILogManualTriggerForm@1000000002 : Form 50233;
    BEGIN
      SIILogManualTrigger.RESET;
      SIILogManualTrigger.SETCURRENTKEY("Attached to Document Type","Attached to Document No.");
      SIILogManualTrigger.SETRANGE("Attached to Document Type",p_SalesHeader."Document Type");
      SIILogManualTrigger.SETRANGE("Attached to Document No.",p_SalesHeader."No.");
      IF SIILogManualTrigger.FINDSET THEN;
      CLEAR(SIILogManualTriggerForm);
      SIILogManualTriggerForm.SETTABLEVIEW(SIILogManualTrigger);
      SIILogManualTriggerForm.RUN;
    END;

    PROCEDURE ShowLogSalesHeaderArc@1000000023(p_SalesHeaderArchive@1000000000 : Record 5107);
    VAR
      SIILog@1000000001 : Record 50146;
      SIILogForm@1000000002 : Form 50218;
      SIILogArchive@1000000003 : Record 50147;
      SIILogArchiveForm@1000000004 : Form 50226;
    BEGIN
      SIILog.RESET;
      SIILog.SETCURRENTKEY("Attached to Document Type","Attached to Document No.");
      SIILog.SETRANGE("Attached to Document Type",p_SalesHeaderArchive."Document Type");
      SIILog.SETRANGE("Attached to Document No.",p_SalesHeaderArchive."No.");
      IF SIILog.FINDSET THEN;
      CLEAR(SIILogForm);
      SIILogForm.SETTABLEVIEW(SIILog);
      SIILogForm.RUN;
    END;

    PROCEDURE ShowArchiveLogSalesHeaderArc@1000000021(p_SalesHeaderArchive@1000000000 : Record 5107);
    VAR
      SIILogArchiv@1000000001 : Record 50147;
      SIILogArchivForm@1000000002 : Form 50226;
    BEGIN
      SIILogArchiv.RESET;
      SIILogArchiv.SETCURRENTKEY("Attached to Document Type","Attached to Document No.");
      SIILogArchiv.SETRANGE("Attached to Document Type",p_SalesHeaderArchive."Document Type");
      SIILogArchiv.SETRANGE("Attached to Document No.",p_SalesHeaderArchive."No.");
      IF SIILogArchiv.FINDSET THEN;
      CLEAR(SIILogArchivForm);
      SIILogArchivForm.SETTABLEVIEW(SIILogArchiv);
      SIILogArchivForm.RUN;
    END;

    PROCEDURE ShowManTrigLogSalesHeaderArc@1000000019(p_SalesHeaderArchive@1000000000 : Record 5107);
    VAR
      SIILogManualTrigger@1000000001 : Record 50155;
      SIILogManualTriggerForm@1000000002 : Form 50233;
    BEGIN
      SIILogManualTrigger.RESET;
      SIILogManualTrigger.SETCURRENTKEY("Attached to Document Type","Attached to Document No.");
      SIILogManualTrigger.SETRANGE("Attached to Document Type",p_SalesHeaderArchive."Document Type");
      SIILogManualTrigger.SETRANGE("Attached to Document No.",p_SalesHeaderArchive."No.");
      IF SIILogManualTrigger.FINDSET THEN;
      CLEAR(SIILogManualTriggerForm);
      SIILogManualTriggerForm.SETTABLEVIEW(SIILogManualTrigger);
      SIILogManualTriggerForm.RUN;
    END;

    PROCEDURE OpenWindow@1000000028(p_NoOfRecs@1000000001 : Integer;p_WindowText@1000000008 : Text[30]);
    VAR
      i@1000000000 : Integer;
      WinText1@1000000002 : TextConst 'ENU=Processing Records\';
      WinText2@1000000003 : TextConst 'ENU=#1########## of #2##########\';
      WinText3@1000000004 : TextConst 'ENU=@3@@@@@@@@@@@@@@@@@@@@@@@@@@\';
      WinText4@1000000005 : TextConst 'ENU=Starttime          #4##########\';
      WinText5@1000000006 : TextConst 'ENU=Runtime            #5##########\';
      WinText6@1000000007 : TextConst 'ENU=Estimated Endtime  #6##########';
    BEGIN
      IF NOT GUIALLOWED THEN
        EXIT;
      //S/P0979
      IF p_WindowText = '' THEN
        p_WindowText := WinText1;
      //E/P0979
      CLEAR(GlobalWindow);
      GlobalNoOfRecs := p_NoOfRecs;
      GlobalStartTime := TIME;
      GlobalFactor := 9999 / p_NoOfRecs;
      //S/P0979
      //GlobalWindow.OPEN(WinText1 + WinText2 + WinText3 + WinText4 + WinText5 + WinText6);
      GlobalWindow.OPEN(p_WindowText + WinText2 + WinText3 + WinText4 + WinText5 + WinText6);
      //E/P0979
      GlobalWindow.UPDATE(2,p_NoOfRecs);
      GlobalWindow.UPDATE(4,GlobalStartTime);
    END;

    PROCEDURE UpdateWindow@1000000027(p_Counter@1000000000 : Integer);
    VAR
      "Actual%"@1000000002 : Decimal;
      "EstimatedEndtime1%"@1000000001 : Integer;
      EstimatedEndtime@1000000003 : Time;
    BEGIN
      IF NOT GUIALLOWED THEN
        EXIT;

      GlobalWindow.UPDATE(1,p_Counter);
      GlobalWindow.UPDATE(3,(p_Counter * GlobalFactor) DIV 1);
      GlobalWindow.UPDATE(5,FORMAT((TIME - GlobalStartTime) / 1000) + 's');
      "Actual%" := p_Counter / (GlobalNoOfRecs / 100);
      "EstimatedEndtime1%" := ((TIME - GlobalStartTime) / "Actual%") DIV 1;
      EstimatedEndtime := GlobalStartTime + ("EstimatedEndtime1%" * 100);
      GlobalWindow.UPDATE(6,EstimatedEndtime);
    END;

    PROCEDURE CloseWindow@1000000026();
    BEGIN
      IF NOT GUIALLOWED THEN
        EXIT;

      GlobalWindow.CLOSE;
    END;

    PROCEDURE GetCWDifference@1000000024(p_FromDate@1000000000 : Date;p_ToDate@1000000005 : Date) : Integer;
    VAR
      FromCW@1000000003 : Integer;
      ToCW@1000000004 : Integer;
    BEGIN
      FromCW := DATE2DWY(p_FromDate,2);
      ToCW := DATE2DWY(p_ToDate,2);

      EXIT(ToCW - FromCW);
    END;

    PROCEDURE LastShipmentDelayMailSend@1000000029(p_RecRefOrderLine@1000000000 : RecordRef) : DateTime;
    VAR
      SIILogArchive@1000000001 : Record 50147;
      SIISetup@1000000002 : Record 50140;
      DocType@1000000003 : Integer;
      DocNo@1000000004 : Code[20];
      FieldRef@1000000005 : FieldRef;
    BEGIN
      //S/P0936
      SIISetup.GET;
      SIISetup.TESTFIELD("Shipment Date NAV");
      SIISetup.TESTFIELD("Shipment Date Shop");
      FieldRef := p_RecRefOrderLine.FIELD(1);
      EVALUATE(DocType,FORMAT(FieldRef.VALUE));
      FieldRef := p_RecRefOrderLine.FIELD(3);
      EVALUATE(DocNo,FORMAT(FieldRef.VALUE));

      SIILogArchive.RESET;
      SIILogArchive.SETRANGE("Attached to Table",p_RecRefOrderLine.NUMBER-1);
      SIILogArchive.SETRANGE("Attached to Document Type",DocType);
      SIILogArchive.SETRANGE("Attached to Document No.",DocNo);
      SIILogArchive.SETRANGE("Message Code NAV",SIISetup."Shipment Date NAV");
      SIILogArchive.SETRANGE("Message Code Shop",SIISetup."Shipment Date Shop");
      IF SIILogArchive.FINDLAST THEN BEGIN
        EXIT(SIILogArchive."Processed At");
      END;
      //E/P0936
    END;

    PROCEDURE CountSentMailsForSO@1000000030(p_RecRefOrderLine@1000000001 : RecordRef) : Integer;
    VAR
      SIILogActions@1000000004 : Record 50153;
      SIILogActionsArchive@1000000000 : Record 50136;
      DocNo@1000000003 : Code[20];
      FieldRef@1000000002 : FieldRef;
    BEGIN
      FieldRef := p_RecRefOrderLine.FIELD(3);
      EVALUATE(DocNo,FORMAT(FieldRef.VALUE));

      SIILogActions.RESET;
      SIILogActions.SETRANGE("Document No.",DocNo);
      SIILogActions.SETRANGE("Action For",SIILogActions."Action For"::EMail);

      SIILogActionsArchive.RESET;
      SIILogActionsArchive.SETRANGE("Document No.",DocNo);
      SIILogActionsArchive.SETRANGE("Action For",SIILogActionsArchive."Action For"::EMail);

      EXIT(SIILogActions.COUNT + SIILogActionsArchive.COUNT);
    END;

    PROCEDURE CountSentMailsForSL@1000000032(p_RecRefOrderLine@1000000004 : RecordRef) : Integer;
    VAR
      SIILogActions@1000000005 : Record 50153;
      SIILogActionsArchive@1000000002 : Record 50136;
      DocNo@1000000001 : Code[20];
      LineNo@1000000003 : Integer;
      FieldRef@1000000000 : FieldRef;
    BEGIN
      FieldRef := p_RecRefOrderLine.FIELD(3);
      EVALUATE(DocNo,FORMAT(FieldRef.VALUE));
      FieldRef := p_RecRefOrderLine.FIELD(4);
      EVALUATE(LineNo,FORMAT(FieldRef.VALUE));

      SIILogActions.RESET;
      SIILogActions.SETRANGE("Document No.",DocNo);
      SIILogActions.SETRANGE("Action For",SIILogActions."Action For"::EMail);

      SIILogActionsArchive.RESET;
      SIILogActionsArchive.SETRANGE("Document No.",DocNo);
      SIILogActionsArchive.SETRANGE("Action For",SIILogActionsArchive."Action For"::EMail);
      EXIT(SIILogActions.COUNT + SIILogActionsArchive.COUNT);
    END;

    PROCEDURE ShowLastMessageSH@1000000034(p_SalesHeader@1000000000 : Record 36);
    VAR
      SIISalesOrderLastMessage@1000000001 : Record 50157;
      SIILogArchive@1000000002 : Record 50147;
      SIILogArchiveForm@1000000003 : Form 50226;
    BEGIN
      //S/P0970
      //IF SIISalesOrderLastMessage.GET(p_SalesHeader."Document Type",p_SalesHeader."No.",0) THEN BEGIN
      IF SIISalesOrderLastMessage.GET(p_SalesHeader."Document Type",p_SalesHeader."No.",0,3) THEN BEGIN
      //E/P0970
        SIILogArchive.RESET;
        SIILogArchive.SETRANGE("Entry No.",SIISalesOrderLastMessage."Log Entry No.");
        IF SIILogArchive.FINDFIRST THEN BEGIN
          CLEAR(SIILogArchiveForm);
          SIILogArchiveForm.SETTABLEVIEW(SIILogArchive);
          SIILogArchiveForm.RUNMODAL;
        END;
      END;
    END;

    PROCEDURE ShowLastMessageSL@1000000035(p_SalesLine@1000000000 : Record 37);
    VAR
      SIISalesOrderLastMessage@1000000003 : Record 50157;
      SIILogArchive@1000000002 : Record 50147;
      SIILogArchiveForm@1000000001 : Form 50226;
    BEGIN
      //S/P0970
      //IF SIISalesOrderLastMessage.GET(p_SalesLine."Document Type",p_SalesLine."Document No.",p_SalesLine."Line No.") THEN BEGIN
      IF SIISalesOrderLastMessage.GET(p_SalesLine."Document Type",p_SalesLine."Document No.",p_SalesLine."Line No.",3) THEN BEGIN
      //E/P0970
        SIILogArchive.RESET;
        SIILogArchive.SETRANGE("Entry No.",SIISalesOrderLastMessage."Log Entry No.");
        IF SIILogArchive.FINDFIRST THEN BEGIN
          CLEAR(SIILogArchiveForm);
          SIILogArchiveForm.SETTABLEVIEW(SIILogArchive);
          SIILogArchiveForm.RUNMODAL;
        END;
      END;
    END;

    PROCEDURE ShowLastMessageSHA@1000000036(p_SalesHeaderArchive@1000000000 : Record 5107);
    VAR
      SIISalesOrderLastMessage@1000000003 : Record 50157;
      SIILogArchive@1000000002 : Record 50147;
      SIILogArchiveForm@1000000001 : Form 50226;
    BEGIN
      //S/P0970
      //IF SIISalesOrderLastMessage.GET(p_SalesHeaderArchive."Document Type",p_SalesHeaderArchive."No.",0) THEN BEGIN
      IF SIISalesOrderLastMessage.GET(p_SalesHeaderArchive."Document Type",p_SalesHeaderArchive."No.",0,3) THEN BEGIN
      //E/P0970
        SIILogArchive.RESET;
        SIILogArchive.SETRANGE("Entry No.",SIISalesOrderLastMessage."Log Entry No.");
        IF SIILogArchive.FINDFIRST THEN BEGIN
          CLEAR(SIILogArchiveForm);
          SIILogArchiveForm.SETTABLEVIEW(SIILogArchive);
          SIILogArchiveForm.RUNMODAL;
        END;
      END;
    END;

    PROCEDURE ShowLastMessageSLA@1000000037(p_SalesLineArchive@1000000000 : Record 5108);
    VAR
      SIISalesOrderLastMessage@1000000003 : Record 50157;
      SIILogArchive@1000000002 : Record 50147;
      SIILogArchiveForm@1000000001 : Form 50226;
    BEGIN
      //S/P0970
      //IF SIISalesOrderLastMessage.GET(p_SalesLineArchive."Document Type",
                                      //p_SalesLineArchive."Document No.",
                                      //p_SalesLineArchive."Line No.")
      IF SIISalesOrderLastMessage.GET(p_SalesLineArchive."Document Type",
         p_SalesLineArchive."Document No.",
         p_SalesLineArchive."Line No.",
         3)
      //E/P0970
      THEN BEGIN
        SIILogArchive.RESET;
        SIILogArchive.SETRANGE("Entry No.",SIISalesOrderLastMessage."Log Entry No.");
        IF SIILogArchive.FINDFIRST THEN BEGIN
          CLEAR(SIILogArchiveForm);
          SIILogArchiveForm.SETTABLEVIEW(SIILogArchive);
          SIILogArchiveForm.RUNMODAL;
        END;
      END;
    END;

    PROCEDURE SetFieldNoForFieldRef@1000000033(p_FieldNo@1000000000 : Integer);
    BEGIN
      //S/P1161
      GlobFieldNoDifferent := TRUE;
      GlobalFieldNo := p_FieldNo;
      //E/P1161
    END;

    PROCEDURE GetIntFromOptionString@1000000038(p_FieldRef@1000000004 : FieldRef) : Integer;
    VAR
      NewString@1000000001 : Text[250];
      locText01@1000000002 : TextConst 'DEU=" abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!""ı$%&/()=?·Ô`^+*~''#-_:.;<>|@∞[]}{\¸ÅÑîôéö†ÖÉÇäà°çå¢ïì£óñµ∑∂ê‘“÷ﬁ◊‡„‚ÈÎÍ";ENU=" abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!""ı$%&/()=?·Ô`^+*~''#-_:.;<>|@∞[]}{\¸ÅÑîôéö†ÖÉÇäà°çå¢ïì£óñµ∑∂ê‘“÷ﬁ◊‡„‚ÈÎÍ"';
      OptionStringComplete@1000000003 : Text[250];
      OptionStringValue@1000000000 : Text[250];
    BEGIN
      //S/P1161
      CLEAR(OptionStringComplete);

      IF STRPOS(p_FieldRef.OPTIONSTRING,FORMAT(p_FieldRef.VALUE)) > 0 THEN
        OptionStringComplete := p_FieldRef.OPTIONSTRING
      ELSE
        IF STRPOS(p_FieldRef.OPTIONCAPTION,FORMAT(p_FieldRef.VALUE)) > 0 THEN
          OptionStringComplete := p_FieldRef.OPTIONCAPTION;

      IF OptionStringComplete = '' THEN
        EXIT(0);

      OptionStringValue := FORMAT(p_FieldRef.VALUE);

      IF (OptionStringComplete <> '') AND (OptionStringValue <> '') THEN BEGIN
        NewString := DELSTR(OptionStringComplete,STRPOS(OptionStringComplete,OptionStringValue));
        NewString := DELCHR(NewString,'=',locText01);
        EXIT(STRLEN(NewString));
      END;

      EXIT(0);
      //E/P1161
    END;

    BEGIN
    {
      +--------------------------------------------+
      |                                            |
      |                  Home24                    |
      |     Cooperation GOB & Home24 NAV Team      |
      |                                            |
      +--------------------------------------------+

      Project No. Date      Shortcut  Description
      _____________________________________________
      P0879       26.03.13  gob-rste  Object Created
      P0923       22.05.13  gob-rste  TestMessageConnection for Yellow Traffic Light, Show Log and Archive from SII Log
                            gob-mlan  ShowFilteredOrders()
                  29.05.13  gob-mlan  Seperate Keys for 36 and 5107
      P0936       31.05.13  gob-rste  new Function GetCWDifference, Func. GetMsgType New Case 19 Shipment Delayed
                                      new Function LastShipmentDelayMailSend
      P0951       07.06.13  gob-rste  New Function ExportXMLFromLogArc
      P0956       13.06.13  gob-rste  New Functions ShowLastMessageSH, ShowLastMessageSL, ShowLastMessageSHA, ShowLastMessageSLA
      P0970       18.06.13  gob-rste  Show Last Message for Active Messages
      P0974       19.06.13  gob-rste  SII Log Manual Trigger
      P0979       20.06.13  gob-rste  Open Window Optional Window Text
      P1010       22.07.13  gob-mlan  FTTC Phase 2: Triggered Msg.
      P1055       30.07.13  gob-mlan  FTTC Phase 2: Triggered Msg.
      P1058       31.07.13  gob-mlan  New JQ Msg. "Return Item Not Received"
      H0545       05.09.13  ARI       Changes in Function GetMsgType. Check Shop Code isf NAV Code doesnt match anything
      P1111       24.09.13  gob-mlan  Web Service Test Connection
      P1161       04.12.13  gob-mlan  Fix WebService-Problem FieldRef Option Values

      +--------------------------------------------+
      |                                            |
      |                  Home24                    |
      |     Cooperation Tectura & Home24 NAV Team  |
      |                                            |
      +--------------------------------------------+

      Project No. Date      Shortcut  Description
      _____________________________________________

      T0003       10.06.14  tec-sf    Extended GetMsgType()
      T0003       10.06.14  tec-sf    Changed GetMsgType() since their is no new Shop Code for Return Order Label
      T0009       02.07.14  tec-sf    Extended GetMsgType()

      +--------------------------------------------+
      |                                            |
      |                  Home24                    |
      |       Internal Customizing by NAV-Team     |
      |                                            |
      +--------------------------------------------+

      Project No. Date     Shortcut  Description
      _____________________________________________
      H0651       11.11.13 MBY       Add message type Invoice Document to function GetMsgType
      H1515       22.09.14 MBY       Credit Card Capturing SII part
      H2008       16.01.15 MIK       Delete XSD functionality from SII Setup
    }
    END.
  }
}

